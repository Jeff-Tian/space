---
stackbit_url_path: >-
  posts/数据点的最小二乘多项式拟合(改进算法)
title: '数据点的最小二乘多项式拟合(改进算法)'
date: '2012-10-20 21:31:14.4272649'
excerpt: >-
  
comments_count: 0
positive_reactions_count: 0
tags: 
  - 拟合
  - 最小二乘
  - 统计
canonical_url: >-
template: post
---
<h2><font color="#9b00d3">一、背景：</font></h2>  <p>文章《<a href="http://zizhujy.com/blog/post/2011/11/19/数据点的最小二乘多项式拟合.aspx">数据点的最小二乘多项式拟合</a>》描述了详细的多项式拟合算法，在2012-8-19之前，<a href="http://zizhujy.com/Ploter" target="_blank">统计计算器</a>也应用了该算法来实现二次函数和三次函数的拟合。为什么没有更高阶的多项式拟合功能呢？因为发现从4次开始，该算法的JavaScript计算结果非常不理想。原因是多项式阶数越高，涉及到的矩阵维度更高。在高维度的矩阵计算时，涉及到的非常多的浮点计算误差，就变得越来越不可忽略，最终导致计算结果与实际值相差甚远。于是将多项式拟合功能暂时搁置了。</p>  <p>在网友Goldman发信来希望在<a href="http://zizhujy.com/Ploter" target="_blank">统计计算器</a>里增加四次函数拟合功能后，我开始想有没有其他的拟合算法。最后在王宇曦同学的提醒下，了解到可以通过使用多元统计回归的途径来实现多项式拟合。下面将《<a href="http://zizhujy.com/blog/post/2011/11/19/数据点的最小二乘多项式拟合.aspx">数据点的最小二乘多项式拟合</a>》文所用的方法称之为多项式拟合的普通算法，而将本文将要描述的称为多元回归算法。仔细研究后发现，同样阶数的多项式拟合，使用多元回归算法，要比普通算法节省很多运算。原因是，它用的矩阵维数更少。举例来说，4次多项式拟合，普通算法涉及到5维矩阵，而多元回归算法只涉及到4维矩阵。</p>  <p>2012-8-19，我将<a href="http://zizhujy.com/Ploter" target="_blank">统计计算器</a>的多项式拟合模块的算法由原来的普通算法更新为多元回归算法，Goldman的4次多项式拟合功能，于是很自然的实现了。忙完了最近的一些事，今天有空终于可以将多元回归算法记录下来，以备参考。</p>  <p>当然，这个算法完全不能解决JavaScript的浮点计算误差问题，只不过它使用更少的矩阵维度，得以让这个问题在低次的多项式拟合过程中，不至于被暴露出来。经过实现，<a href="http://zizhujy.com/Ploter" target="_blank">统计计算器</a>现在可以支持6阶及以下的多项式拟合。</p>  <p>要实现更高阶的多项式拟合，估计非要写个JavaScript的数学运算库，能够没有任何误差不可。想了想，应该需要能够直接进行分数、根号等等运算（或者说，支持符号运算）。或者直接支持符号运算。像MatLab、Mathematica等软件，是有完整的符号运算系统的，不知道有没有相应的JavaScript版本。有了解的朋友请分享给我，不甚感激。</p>  <p>6阶以上的多项式拟合，实用性估计也不怎么高，于是，这个功能就又暂时放下了。先把这个多元回归的多项式拟合算法记录下来吧。</p>  <h2><font color="#9b00d3">二、问题：</font></h2>  <p>任何算法总从问题始，这里的问题同《<a href="http://zizhujy.com/blog/post/2011/11/19/数据点的最小二乘多项式拟合.aspx">数据点的最小二乘多项式拟合</a>》文里所说的。</p>  <p>给定一个数据点的集合：</p>  <p>{ (x<sub>i</sub>, y<sub>i</sub>) | i = 1, 2, …, n}</p>  <p>现在使用m次多项式函数 <em>y = b<sub>m</sub>x<sup>m</sup> + b<sub>m-1</sub>x<sup>m-1</sup> + … + b<sub>2</sub>x<sup>2</sup> + b<sub>1</sub>x + b<sub>0</sub></em> 对其进行拟合，使得拟合的误差平方和最小。</p>  <p>求能达到此目标的参数 [<em>b<sub>m </sub>, b<sub>m-1 </sub>, …, b<sub>2 </sub>, b<sub>1 </sub>, b<sub>0</sub></em>]<sup><em>T</em> </sup>的值。</p>  <h2><font color="#9b00d3">三、求解过程：</font></h2>  <p>以4阶多项式为例。</p>  <p>(1) 将数据整理成下表，就像是多元统计回归中那样：</p>  <p>表 1：观测数据</p>  <table border="1" cellspacing="0" cellpadding="2" width="600"><tbody>     <tr>       <td valign="top" width="100">序号 \ 变量</td>        <td valign="top" width="100">y</td>        <td valign="top" width="100">x</td>        <td valign="top" width="100">x<sup>2</sup></td>        <td valign="top" width="100">x<sup>3</sup></td>        <td valign="top" width="100">x<sup>4</sup></td>     </tr>      <tr>       <td valign="top" width="100">1</td>        <td valign="top" width="100">y<sub>1</sub></td>        <td valign="top" width="100">x<sub>1</sub></td>        <td valign="top" width="100">x<sub>1</sub><sup>2</sup></td>        <td valign="top" width="100">x<sub>1</sub><sup>3</sup></td>        <td valign="top" width="100">x<sub>1</sub><sup>4</sup></td>     </tr>      <tr>       <td valign="top" width="100">2</td>        <td valign="top" width="100">y<sub>2</sub></td>        <td valign="top" width="100">x<sub>2</sub></td>        <td valign="top" width="100">x<sub>2</sub><sup>2</sup></td>        <td valign="top" width="100">x<sub>2</sub><sup>3</sup></td>        <td valign="top" width="100">x<sub>2</sub><sup>4</sup></td>     </tr>      <tr>       <td valign="top" width="100">…</td>        <td valign="top" width="100">…</td>        <td valign="top" width="100">…</td>        <td valign="top" width="100">…</td>        <td valign="top" width="100">…</td>        <td valign="top" width="100">…</td>     </tr>      <tr>       <td valign="top" width="100">n</td>        <td valign="top" width="100">y<sub>n</sub></td>        <td valign="top" width="100">x<sub>n</sub></td>        <td valign="top" width="100">x<sub>n</sub><sup>2</sup></td>        <td valign="top" width="100">x<sub>n</sub><sup>3</sup></td>        <td valign="top" width="100">x<sub>n</sub><sup>4</sup></td>     </tr>   </tbody></table>  <p>(2) 偏微分求极小值</p>  <p>回归方程为<a href="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B1%5D.gif"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="CodeCogsEqn[1]" border="0" alt="CodeCogsEqn[1]" src="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B1%5D_thumb.gif" width="240" height="18" /></a>，现欲求出使得<a href="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B1%5D%5B4%5D.gif"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="CodeCogsEqn[1][4]" border="0" alt="CodeCogsEqn[1][4]" src="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B1%5D%5B4%5D_thumb.gif" width="138" height="53" /></a></p>  <p><a href="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B1%5D%5B6%5D.gif"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="CodeCogsEqn[1][6]" border="0" alt="CodeCogsEqn[1][6]" src="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B1%5D%5B6%5D_thumb.gif" width="353" height="56" /></a>的最小值，分别对<em>b<sub>0</sub></em>, <em>b<sub>1</sub></em>, <em>b<sub>2</sub></em>, <em>b<sub>3</sub></em>, <em>b<sub>4</sub></em>求偏微分并令它们等于0：</p>  <p><a href="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B1%5D%5B8%5D.gif"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="CodeCogsEqn[1][8]" border="0" alt="CodeCogsEqn[1][8]" src="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B1%5D%5B8%5D_thumb.gif" width="439" height="55" /></a></p>  <p><a href="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B2%5D.gif"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="CodeCogsEqn[2]" border="0" alt="CodeCogsEqn[2]" src="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B2%5D_thumb.gif" width="550" height="55" /></a></p>  <p>整理得：</p>  <p><a href="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B2%5D%5B7%5D.gif"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="CodeCogsEqn[2][7]" border="0" alt="CodeCogsEqn[2][7]" src="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B2%5D%5B7%5D_thumb.gif" width="537" height="117" /></a></p>  <p>计算得</p>  <p><a href="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B1%5D%5B10%5D.gif"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="CodeCogsEqn[1][10]" border="0" alt="CodeCogsEqn[1][10]" src="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B1%5D%5B10%5D_thumb.gif" width="267" height="20" /></a></p>        <p>记：<img src="http://latex.codecogs.com/gif.latex?SS_i=\sum_{j=1}^n\left(x_j^i-\overline{x^i}\right)^2" />， <a href="http://latex.codecogs.com/gif.latex?SS_y=\sum_{j=1}^n\left(y_i-\overline{y}\right)^2"><img alt="LaTeX rendered as an image" src="http://latex.codecogs.com/gif.latex?SS_y=\sum_{j=1}^n\left(y_i-\overline{y}\right)^2" /></a>，</p>  <p><a href="http://latex.codecogs.com/gif.latex?SP_{ik}=\sum_{j=1}^n\left(x_j^i-\overline{x^i}\right)\left(x_j^k-\overline{x^k}\right)=SP_{ki}"><img alt="LaTeX rendered as an image" src="http://latex.codecogs.com/gif.latex?SP_{ik}=\sum_{j=1}^n\left(x_j^i-\overline{x^i}\right)\left(x_j^k-\overline{x^k}\right)=SP_{ki}" /></a>，</p>  <p><a href="http://latex.codecogs.com/gif.latex?SP_{i0}=\sum_{j=1}^n\left(x_j^i-\overline{x^i}\right)\left(y_j-\overline{y}\right)=SP_{0i}"><img alt="LaTeX rendered as an image" src="http://latex.codecogs.com/gif.latex?SP_{i0}=\sum_{j=1}^n\left(x_j^i-\overline{x^i}\right)\left(y_j-\overline{y}\right)=SP_{0i}" /></a>。</p>  <p>将<em>b<sub>0</sub></em>代入上述方程组，可以消去一个方程，再将方程组整理成矩阵形式：</p>  <p><a href="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B1%5D%5B14%5D.gif"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="CodeCogsEqn[1][14]" border="0" alt="CodeCogsEqn[1][14]" src="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B1%5D%5B14%5D_thumb.gif" width="654" height="79" /></a></p>  <p><a href="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B2%5D%5B9%5D.gif"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="CodeCogsEqn[2][9]" border="0" alt="CodeCogsEqn[2][9]" src="http://zizhujy.com/blog/image.axd?picture=CodeCogsEqn%5B2%5D%5B9%5D_thumb.gif" width="183" height="88" /></a></p>  <p>将上式简写为：</p>  <p>Ab = C</p>  <p>求得b = A<sup>-1</sup>C。</p>  <p>这正是目前<a href="http://zizhujy.com/Ploter" target="_blank">统计计算器</a>多项式拟合所进行的计算。</p>