{"componentChunkName":"component---src-templates-post-js","path":"/posts/rpx2sx7znvgygnly/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/rpx2sx7znvgygnly","relativePath":"posts/rpx2sx7znvgygnly","frontmatter":{"title":"欢迎来调戏我：在公众号里对接 AWS Bedrock 服务","stackbit_url_path":"posts/rpx2sx7znvgygnly","date":"2023-12-25T12:02:19","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a name=XklWR></a></p>\n<h1>调戏截图</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.35135135135135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAByElEQVR42m1SXYvaQBQNfVqSSTKZiF+JZqO0WsENGmtBFDU7UHa7tC4iStFt6AYf973QvvalUOhjf+0pd9ZYKT4c7sfM3HPvnKsJIdBqtTAcDtHpdNButxFFEXzfB2MMlUoFs9kMvV4PlmXBcRxwzo+g2LZtlMtl1Ot1aJTIA8/zUKvVlF8sFtWDQqGAMAxRrVaPBf4H5ek+3dFyBgId5D7lqXvXdY8294Ur4AiCc4A4FtbOMZ4yU4c0QalUgltwYZsWuG6BMwvc+Gd1w4BpmtDEmULiwChOmLlwwC9MlKcthD9uEHxNcPlNIvguUU3fIs0eMZUJNIMxGKalqpMI9PHGgY3i3DLLhPHiAu78JRp/7hH+vEXj1x0avz/Aexoje/yCuZTQ7u/e40bO8ar9Gv1+X6k8GAzQ7XaVsmTjOFZn5EdXERqXIXzPh8MdBW7Z0HX9eeRPH2/xbvIG0+Qanx8esFgskKYpttutsrvdDuv1Wtksy7Df79UdIlHiHZQX4vm7NGaa0A2G6yTBarXCcrnEZrPBeDzGaDTCZDJR3VHXtI+Ul1IiHsSwz6yRUpmEaTabalxachotCAK1kwTyT2MC7Wwu2GnBv7hrF6wtPH9UAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/7f7b12ada31f177d518ed1c198d12f85/fcda8/1703502269904-cdd5179d-2c33-47d4-834b-cd7050e42beb.png\"\n        srcset=\"/static/7f7b12ada31f177d518ed1c198d12f85/12f09/1703502269904-cdd5179d-2c33-47d4-834b-cd7050e42beb.png 148w,\n/static/7f7b12ada31f177d518ed1c198d12f85/e4a3f/1703502269904-cdd5179d-2c33-47d4-834b-cd7050e42beb.png 295w,\n/static/7f7b12ada31f177d518ed1c198d12f85/fcda8/1703502269904-cdd5179d-2c33-47d4-834b-cd7050e42beb.png 590w,\n/static/7f7b12ada31f177d518ed1c198d12f85/efc66/1703502269904-cdd5179d-2c33-47d4-834b-cd7050e42beb.png 885w,\n/static/7f7b12ada31f177d518ed1c198d12f85/7a3d6/1703502269904-cdd5179d-2c33-47d4-834b-cd7050e42beb.png 990w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACDUlEQVR42m2SXW8SQRSG96a1lu7O7gIuyC6fWpAKVEytJC0p0JpiMIBIWb5KJRXujRf+AD9+hDHReOelf/AxM1pCjBdv5s1J5jlzzjtaPB6nXC6Tz+dXyuVymKaJYRjK1xsN4sk4wjKxQjZWcE0hG2GaxGIxYq6LFo1GSaVSJBIJksmk8rKJZVkIIZR/kM4SDlgYGwHE5g5i/dwIoN8KqAdEHAdNXpQvkZelbrxt29hBGyOgE2pkcd9U8K4O8V4f4s2f4s6e4F4d4i4ruGdFXrTb5Ap7aFtbt1egdemGji4M9M1tvPc1Mj99Ul9fkv7WI/2jT/pLl/vf++z+mpJ5d8rnDx85OTtFq9dOcD1vNbKU9FJy/GQiSeZhlnuP86Qf5UjtZ0nt73Jn1yOYjhLK3MVygtiWrabSPr1dslcsMBwOuby8pNfr0el06Ha7TCYTLi4uGA2GvOr0mPhjWufPeVY/IxpyMLZ1zB2BKUyEKdQeNSF0iqUSo9GI5XKpQBIynU6ZzWaMx2MG/gB/OGQynTC7mtHudIhEIypdy7ZUgDfSdnRdfZV+v4/v+zSbTQaDgQLJJhI6n89ZLBarRnIKx3HU7tdhCigDKBQKCnB9fU2r1aJSqVCr1Tg6OqLRaFCv19V5fHxMtVpV9Ugk8n+gLHqeR6lU4uDggGKx+CeMv3/yJqh1yXo4HFY7+xf4G4uIL3muZrzzAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/70bd90684604c3d963e84f7b5c69a9ef/fcda8/1703502280051-269f77ce-46d4-4f14-be80-298a2c6be0e1.png\"\n        srcset=\"/static/70bd90684604c3d963e84f7b5c69a9ef/12f09/1703502280051-269f77ce-46d4-4f14-be80-298a2c6be0e1.png 148w,\n/static/70bd90684604c3d963e84f7b5c69a9ef/e4a3f/1703502280051-269f77ce-46d4-4f14-be80-298a2c6be0e1.png 295w,\n/static/70bd90684604c3d963e84f7b5c69a9ef/fcda8/1703502280051-269f77ce-46d4-4f14-be80-298a2c6be0e1.png 590w,\n/static/70bd90684604c3d963e84f7b5c69a9ef/efc66/1703502280051-269f77ce-46d4-4f14-be80-298a2c6be0e1.png 885w,\n/static/70bd90684604c3d963e84f7b5c69a9ef/91f10/1703502280051-269f77ce-46d4-4f14-be80-298a2c6be0e1.png 992w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />欢迎关注我的公众号“哈德韦”，然后开始调戏。如果你碰到问题发现它不回答了，那一定是我没钱了！欢迎打赏，好让我给 AWS 充钱。<br />不知道能活多久，且调戏且珍惜。\n<a name=ZXV5T></a></p>\n<h1>源代码</h1>\n<p>全部源代码在这里：<a href=\"https://github.com/Jeff-Tian/bedrock\">https://github.com/Jeff-Tian/bedrock</a> ，后面进行详细讲解。\n<a name=qJzUi></a></p>\n<h1>对接步骤</h1>\n<p>尽管我这个人工智能小助手，由于经费的问题可能会随时停止服务，但接下来的对接步骤却是长期都有价值的，因为只要有钱，可以使用该步骤分分钟建立起一个新的服务。\n<a name=qE27k></a></p>\n<h2>开通服务</h2>\n<p>开通之后，AWS 的 Bedrock 面板如下：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0585abffd3d9db836bb5e18885e0a06f/23814/1703502653044-cdc29607-ec8c-46bd-bf79-ab05a1124443.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACVElEQVR42lWS2W7cOBBF9RHBYBJPbHerWwslSlwkape61V4mmQAB8pAfyP9/wxmIshHkocDiUof3Fhlcli+MT9+p+ieUGSlUS6Z6KtVRmpa6nViWV8z4Qt3dWK7fsOMLsp0ww7/U0yvt7RvD+oNm+UrQVwu6u6G7F7Rdyesref+VoV5J8prwJMmjkofEcD4pRGx5jDUHkROKnjC1HOKCc+QIY0Pgxpm67YkzyTnNSHOFqRrirOTxGHMIE+6PEYdDxGMY83CMuDvE/P2Y8M/9kbvPB/66O/Ph04kPH48E43Kjn1ey0hKJglgorJtIMsM5LYlSRZSWnJP3XHFMSg5JyUMoiFPJz+WeX88f+TF+JmiGhWFeEYXZgZlGlDVhXHCMpI9TUpJISxjv8y3fLjvGBUmmWVzKf7NgaTKCdrxQ2oZUag8stKOdrl7xdskWubHoziHNvlZYh3jbTwvDSRhOeiBSHUHdTei624HpDlxurxjXI3VNKnegGStkZf28akcK43y+gTOpkc1AXncEw3JjXl8obOsVJrmm7ievWkiNkO8K612hNB7224H157KqJ7MdQTvMrM9fqOeVKJUkmWK4PPmHKprRF2yg6uIo6sqrspsaVf0BzNuJzA0EmZsQ1YBQjnOmkdrRzVdvSzeDL8i1RbWVV7oBTTNQmMYD35X+VjivbLH1a7O8jdtDbf8xlerNsvE9LKo3y763+36ynctLsqpD2JagGVf6yzPaTZyzrbijHlaS0pGWjqRwCO0o2gZh9rW6v2LbBeUmqv5CWQ2ofkX1V/4H/BZ5wMHnGZ0AAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/0585abffd3d9db836bb5e18885e0a06f/fcda8/1703502653044-cdc29607-ec8c-46bd-bf79-ab05a1124443.png\"\n        srcset=\"/static/0585abffd3d9db836bb5e18885e0a06f/12f09/1703502653044-cdc29607-ec8c-46bd-bf79-ab05a1124443.png 148w,\n/static/0585abffd3d9db836bb5e18885e0a06f/e4a3f/1703502653044-cdc29607-ec8c-46bd-bf79-ab05a1124443.png 295w,\n/static/0585abffd3d9db836bb5e18885e0a06f/fcda8/1703502653044-cdc29607-ec8c-46bd-bf79-ab05a1124443.png 590w,\n/static/0585abffd3d9db836bb5e18885e0a06f/efc66/1703502653044-cdc29607-ec8c-46bd-bf79-ab05a1124443.png 885w,\n/static/0585abffd3d9db836bb5e18885e0a06f/c83ae/1703502653044-cdc29607-ec8c-46bd-bf79-ab05a1124443.png 1180w,\n/static/0585abffd3d9db836bb5e18885e0a06f/23814/1703502653044-cdc29607-ec8c-46bd-bf79-ab05a1124443.png 2856w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=ZYzaL></a></p>\n<h2>配置密钥</h2>\n<p>新增加一个密钥对，以便在后面的代码中，通过它们来调用 AWS 的服务。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACbElEQVR42j2S25LiOBBE/RV0092AMTa+yJItyXcwYGDomd5LxE7M2/7/d5wJi9h9yFCpKlUqpdI7T5+Mty+q7oyte7TtKUyLsT2VbSlsw9Af6ccbw/Sd4/lBe7hSNiPNODFcvlP1E/e/fvL161+8+/GLw7dftNNPTHunbn+gugelvmNFx67oaESNLAZie0LLI9ZcSMwJ0Xeo7k+EnRB2JC1OeKfbgz/+/ofL/RNlatK8JBWadZSzePN5ffN5edvystw8Me//i5cbFq8rFss1C1fb4CXSEOeGIFZkRUUmDbo+EGclSW4c9llJKq3jRWlBlJZunfOZqknyZ23ee81woqx7UqmRuiaTGl33mGZwsO3gJq/7EdseyJRxcHxTcX7M2p6x3YAsK7zx+nDEWBSu4fzkuVFZdSjTUNiWRBQIZVzOcaR2F4uyojxNZNqSzFJJjaf7kUw9EzM5ShQfQYIfJOyijDDO2e4FQSJ5Xe1YvG95+Qgclh8Bb+uQ5XvA8n3L8t3HG6c7VXf8f8I4LRBFTRAJVn7MZhsj/Ai9DSk2AfJjg1z5yPWWYLXjbRXi7xI2QcI2zPAO55t74j5Tz4ZZyTh90gwXctOSq55MC1KVsA9zSmURWck+EoT7nG2UEwtDLDS5bvCG05Xp8cMJPYu6Twt2SUkkLP5OspMC8RXhx4pNpJyh93nFOpQEcUEQ5Q5+OEPgtYcz59vns6GbsCBVFdf7nVh1ZGNJNmTEiUU3A1K3xOJpm1lvVR/QxyuJtISJmn/5G8fp/rSDNOz2AlFUtH2LOt3I2wuZsIjSOuvMlhKFdZjP6OaAMK2L59xvxERzyiXgb6kAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/56fac36ea846c0e5856228b2a9a00f0d/fcda8/1703503114025-d3b72832-673f-429a-90a1-39e34e0ed955.png\"\n        srcset=\"/static/56fac36ea846c0e5856228b2a9a00f0d/12f09/1703503114025-d3b72832-673f-429a-90a1-39e34e0ed955.png 148w,\n/static/56fac36ea846c0e5856228b2a9a00f0d/e4a3f/1703503114025-d3b72832-673f-429a-90a1-39e34e0ed955.png 295w,\n/static/56fac36ea846c0e5856228b2a9a00f0d/fcda8/1703503114025-d3b72832-673f-429a-90a1-39e34e0ed955.png 590w,\n/static/56fac36ea846c0e5856228b2a9a00f0d/efc66/1703503114025-d3b72832-673f-429a-90a1-39e34e0ed955.png 885w,\n/static/56fac36ea846c0e5856228b2a9a00f0d/c83ae/1703503114025-d3b72832-673f-429a-90a1-39e34e0ed955.png 1180w,\n/static/56fac36ea846c0e5856228b2a9a00f0d/963fa/1703503114025-d3b72832-673f-429a-90a1-39e34e0ed955.png 2666w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=Cn8Eg></a></p>\n<h2>写点代码</h2>\n<p>需要写一点点代码，来调用 AWS Bedrock 的服务，我这里使用 koa 创建了一个新的服务，并通过@aws-sdk/client-bedrock-runtime 来简化对 AWS Bedrock 服务的 API 交互。\n<a name=jo00G></a></p>\n<h3>调包侠的核心代码</h3>\n<p>就一个文件，不妨命名为 bedrock.js，代码如下：\njavascript\nconst {\nBedrockRuntimeClient,\nInvokeModelCommand,\n} = require(@aws-sdk/client-bedrock-runtime);</p>\n<p>module.exports = {\nasync chat({question, modelId, maxTokensToSample, temperature, topP, topK}) {\nconst input = {\nmodelId: modelId ?? anthropic.claude-v2,\ncontentType: application/json,\naccept: application/json,\nbody: JSON.stringify({\nprompt: Human:nYour task is to answer questions. Follow the instruction closely, but dont mention the instructions in your reply. Your answer must be a properly formatted plain text. Do not add any additional remarks or notes. Do not act like a chatbot, but do act like a real person, and your name is 哈德韦 ... If the question content is English then respond with English. If the question content is in Chinese, then respond in Chinese. If its in other language, then respond with the language too.nDo not lose the original meaning.nYou must keep the text as plain text and make it as short as possible without any line breaks as the text will be sent back to wechat official accounts in the wechat app, the space is limited. Dont think too long, respond quickly with short text is totally OK.nnContent:n${question}nnAssistant:,\nmax_tokens_to_sample: maxTokensToSample ?? 2000,\ntemperature: temperature ?? 1,\ntop_p: topP ?? 1,\ntop_k: topK ?? 250\n})\n}</p>\n<pre><code>const client = new BedrockRuntimeClient({\n  region: us-east-1,\n  credentials: {\n    accessKeyId: process.env.AWSAccessKeyId,\n    secretAccessKey: process.env.AWSSecretAccessKey\n  }\n});\n\ntry {\n  const command = new InvokeModelCommand(input);\n  const response = await client.send(command);\n\n  const rawRes = response.body;\n  const jsonString = new TextDecoder().decode(rawRes);\n\n  console.log(-------------------------);\n  // Answers are in parsedResponse.completion\n  console.log(jsonString);\n  console.log(-------------------------);\n\n  const json = JSON.parse(jsonString);\n  return json.completion;\n} catch (ex) {\n  console.error(chat error = , ex);\n\n  return 抱歉，服务出错了，原因是： ${ex.message};\n}\n</code></pre>\n<p>}\n}</p>\n<p>这就文件就一个方法，即 chat。注意，这里没有使用流式交互，因为目前还没有探索出如何在和微信公众号的 API 打交道的过程中使用流式交互。但是在别的地方，使用流式交互效果非常好，敬请期待下次分享。</p>\n<p>注意文件中 AWS 密钥是从环境变量里读取的，而注入的过程通过 K8S 的 secrets 实现。</p>\n<p>另外，我的提示词里让模型尽量回复得简洁，以及当用户使用中文提问，就用中文回复等，没想到，它就真的够简洁：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 114.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAACE4AAAhOAFFljFgAAAEm0lEQVR42n2T2W8bVRSH/VKpDc0kcTyblzi2Yzu2Z8Z2FqeO48ZOvCTe7WZxUgppaSBd1AARotAKUCWWilVIvAF9KKhCgJQHxCP/2ofmuimlavvw6Zx7ded3fufcOw6n24PmD6BNTOIJTjGq6kiyyoiiMqIqSJqKpCtIbplhj8KwR0ayo1vB6XPji0QITk8SiekovgkcI6pGJn+ezFKe+Vwel8fHsKxg70uqLaYy4tGQvCrDXoVhr4zkUxjSxgmaMZbX6pSrBpf7bjS/H4ekqAyNu4TIkHMcSTjTRJQ0jTMuJ6fGRzglS5zRnQz7FM7aol6FEbuIOvhWUnTGdTcOl9eHPxJBkhVGNV2InXBWUUjnstQ2ujS2e0QzSSEqTahIPpVRr8aYR8MTDGDOzeLUdBxjmoYaCDGs6gzLsnB2VlYEQy4XASNOMrdAfGEWbyLMaW2MIbeLV+yZuu0ZK3hDQYx0CpftMH/xKjtbm+y+ukt+9zK+YAjDsogbhojBcJjAVIhwbJpAOETCMrHSKRJJC8MyicbjyAvncZ0roGSLOFZv3ub489s8vHud/KU3iMYTNOt16vU63W6XarXK+to6W5ubLC4u0ul02Nvbo9vpir35TAalWEet9lArHRwLl/a5f+cdru1v4y/XSM9n6LRbzMykMQ2DdDpNKpUSuZFIYJkmlmWRTCZJp1IYpolWrKGsNgUOV7GOtFxntNgUlYyZWeYyGYxkUrRtkzBNDNMiYVpP9mI2CYO4aaGt1FFKrYGgWmqhlVqogqaopi6voRXWcRdryPkKY7kyY7kSrnwFvVhDL6w/wT534k4IPr0Q2JWEeBtnsY659TqVg0OB1d/DudJALbdRyq2nzg7MPF9wtYm62hSuR/JrrOzf4tYnX3Dzo08p7t1gJFtFtcez3EApNpFXGowX6gI7f67g/6g08fQv4NnZQN/u4e730Le66NtdtG4bT7VHpLdLuLeLp9p5iWCpiXy+gefKBcK/XST0yw6hB9sEf9xk6uEO4V938T/YJnN4yGdffsXH924zd/XGf5dycjHKakO0rJabyPkG3oMNon9fIvx7n6lHWwR/7hL+c4fIH30CxxdZfPeAf/465tFP37N47QiHs1BjdHnAeKGGIgbeQbZjsSna8n+wjf/Dx9zpD9Z3tvG8vUGodYGDe/c5+uoHjI3XcKR3r1K9co2VK29h9i/jmc/hm8sykV0etG4PPtd4PksNXMUGQ4tlTp9bZbxYx1G+8T7fHl3nm6MDKvs3iUSn6fe6pGbnUFbqqOWWaP8E5Rns56KX2wJ7VI7lNw85/vou3723R6zVI5pMs1wokJjLDN5atYNSaYv/1I6DkQxQT/LS47zUxuFfrZOstYiUqmjnK+jZIsr8Enq2gJKvvBA1X0FeKgvs3JUriX2HZyqCP26ihyJMTscJxA0CCZNJO8YSBOLPEEsQjCfwRaL4ozHxja0RsVL4wlEc1vwCjW4Pc26eUMJgOpkiaiVfSMRKMp1KCbH1dodap0d8ZpZqs42VWcBhV5zJ5kQlu/JUwiT0UgymDAtfOEI6u8hcLi+cJTPnhPt/Adj76oQzGRbaAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/4f72dd9fb924f18eba1865531b2b2366/fcda8/1703502485787-ec1cd5a7-d7a4-4bb2-8b11-74fcf0082c66.png\"\n        srcset=\"/static/4f72dd9fb924f18eba1865531b2b2366/12f09/1703502485787-ec1cd5a7-d7a4-4bb2-8b11-74fcf0082c66.png 148w,\n/static/4f72dd9fb924f18eba1865531b2b2366/e4a3f/1703502485787-ec1cd5a7-d7a4-4bb2-8b11-74fcf0082c66.png 295w,\n/static/4f72dd9fb924f18eba1865531b2b2366/fcda8/1703502485787-ec1cd5a7-d7a4-4bb2-8b11-74fcf0082c66.png 590w,\n/static/4f72dd9fb924f18eba1865531b2b2366/efc66/1703502485787-ec1cd5a7-d7a4-4bb2-8b11-74fcf0082c66.png 885w,\n/static/4f72dd9fb924f18eba1865531b2b2366/d9199/1703502485787-ec1cd5a7-d7a4-4bb2-8b11-74fcf0082c66.png 960w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />服务器端日志：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.70270270270271%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACUElEQVR42mXQXW8TRxTGcX8CGmzv2vs+M7uzOzO7ayd+awICCUgJCpEBkfSu36iqepGAiSIuolI+5r/yRCoXXPz0nLl5dOYM/v7rTz7vdtzcfPrf9fUN158+c/v1K7e3t+x2O3Zfvvxst+Pu7o77f79zf/8P3799Y3C+veLD5R+8ubjkfPs7Z28/8nZ7xYvXW+/0zXvv1dm7n5yevePFb1vOL96z/XDJy4srBnW7QtZHRJkhlS2VW6PbY5ruGO026PZXzOwE2SyJRUcie28/70VFR6HnFPqQvF4wePL8NW7+hKLsUXbJ5ukp65OXSD2jbA4R1exhNkdksiWTjlRYVD33Krui6TaY2THarhj0i2d0i+dUbkPpNthuhaoc0yQnVxlxnhFGgiQVhNOUx8MJB8OQ0TjygknGcDRlFMQMg5hBVs5QZuVJsyIuDHGuEcrQ6AYhNZO8QVaGTGiSvCTNS59xKgmj3BuHCcNxxEDUR347ZdYYs6QpHVoZbGlZ6g4nLUo0uKpBJAXpJCGPUtJpQhxGROMJ0Xjqyx4K9SGl3SDNGmeWSGnJRYMqHa45RKmOaaJo2znWzdDaEccF4X6j/fcPAqaPxzw6CLwfG9o1dl+oLLI0lFVLU/c+s0L7sq5fYGyPUDWFqBCy9sz+LTWyah9uWNo1slmhmyVp2TEVDbG0ZMr5DIuaIJUMo4JRLBgn0gtSxSgRZElBEMZI3TNQ+7v1J1TdMQu3ZK00R7JiqWqe1h0rZehzybosmecFfZJ6XZJiJxH1OEAHIb8MQ0Tp+A9DQ1uDlKnRXwAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"WX20231225-190653@2x.png\"\n        title=\"WX20231225-190653@2x.png\"\n        src=\"/static/e6adb8a21e895e40d58aac3f679c8b47/fcda8/1703504653975-44d251ad-f928-4931-bc35-fe7cb95dd4f7.png\"\n        srcset=\"/static/e6adb8a21e895e40d58aac3f679c8b47/12f09/1703504653975-44d251ad-f928-4931-bc35-fe7cb95dd4f7.png 148w,\n/static/e6adb8a21e895e40d58aac3f679c8b47/e4a3f/1703504653975-44d251ad-f928-4931-bc35-fe7cb95dd4f7.png 295w,\n/static/e6adb8a21e895e40d58aac3f679c8b47/fcda8/1703504653975-44d251ad-f928-4931-bc35-fe7cb95dd4f7.png 590w,\n/static/e6adb8a21e895e40d58aac3f679c8b47/efc66/1703504653975-44d251ad-f928-4931-bc35-fe7cb95dd4f7.png 885w,\n/static/e6adb8a21e895e40d58aac3f679c8b47/c83ae/1703504653975-44d251ad-f928-4931-bc35-fe7cb95dd4f7.png 1180w,\n/static/e6adb8a21e895e40d58aac3f679c8b47/1fec9/1703504653975-44d251ad-f928-4931-bc35-fe7cb95dd4f7.png 3808w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=m9226></a></p>\n<h2>应用代码</h2>\n<p>也就一个文件，app.js，要启用该应用，只需要 node app.js即可，全部代码如下：\njavascript\nconst Koa = require(koa);\nconst app = new Koa();\nconst router = require(@koa/router)();\nconst convert = require(xml-js);</p>\n<p>const {koaBody} = require(koa-body);\nconst {getFromUserName, getToUserName, getContent} = require(./helpers/wechat);\nconst {chat} = require(./ai/bedrock);</p>\n<p>app.use(koaBody({includeUnparsed: true}));</p>\n<p>router.get(/message, async (ctx, next) => {\nconsole.log(received message: , ctx.query);\nctx.body = ctx.query.echostr;\n});</p>\n<p>router.post(/message, async (ctx) => {\nconst xmlString = ctx.request.body;\nconsole.log(xml = , xmlString);\nconst json = convert.xml2js(xmlString);\nconsole.log(received message: , json);</p>\n<pre><code>const content = getContent(json);\nconsole.log(content = , content);\n\nconst rtnMsg = await chat({\n\t\tquestion: content\n});\n\nconst toUserName = getFromUserName(json);\nconst fromUserName = getToUserName(json);\nconst createTime = new Date().toLocaleDateString(en-US, {\n    weekday: long,\n    month: long,\n    day: numeric,\n    year: numeric,\n});\n\nconsole.log(starting reply:  + rtnMsg +  to  + toUserName +  from  + fromUserName);\nconst xml = &#x3C;xml>\n&#x3C;ToUserName>&#x3C;![CDATA[${toUserName}]]>&#x3C;/ToUserName>\n&#x3C;FromUserName>&#x3C;![CDATA[${fromUserName}]]>&#x3C;/FromUserName>\n&#x3C;CreateTime>${createTime}&#x3C;/CreateTime>\n&#x3C;MsgType>&#x3C;![CDATA[text]]>&#x3C;/MsgType>\n&#x3C;Content>&#x3C;![CDATA[${rtnMsg}]]>&#x3C;/Content>\n</code></pre>\n</xml>\n<pre><code>ctx.set(Content-Type, text/plain);\nctx.body = xml;\n</code></pre>\n<p>})</p>\n<p>app.use(router.routes());</p>\n<p>app.listen(8080);</p>\n<p>总共两个路由，一个是 GET /message，用来重复接收到的微信服务器发来的消息，这个路由虽然简单，但却必不可少，因为在微信后台配置服务时，微信需要收到它的回复，才能允许你配置成功；另一个是 POST /message，用来处理微信转发的来自用户的消息，不过消息的格式是 XML，所以这里用了 xml-js来将 xml 文本解析成 json。<br />其中依赖的一个帮助文件，写得非常简单，如下，可以看出不过是从 json 表示的 xml 数据里取出对应的值而已。\njavascript\nmodule.exports = {\ngetFromUserName: (xml) => {\nreturn xml.elements[0].elements[1].elements[0].cdata;\n},\ngetToUserName: (xml) => {\nreturn xml.elements[0].elements[0].elements[0].cdata;\n},\ngetContent: (xml) => {\nreturn xml.elements[0].elements[4].elements[0].cdata;\n}\n}</p>\n<p><a name=LkRD7></a></p>\n<h2>发布</h2>\n<p>本来将它发布到了 Azure 的免费 Web 应用上，实测效果不理想。因为冷启动时间太长，导致多数消息得不到回复。于是再次利用 Okteto，部署在 k8s 环境里，并且将 pod 副本数设置成了 7，以期能够应对较多的流量。<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5a6824bb921ea6cbaf0849caa9389a46/8b936/1703504227884-17c685f5-bed5-4b8f-bf2d-8e2190625bb1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.675675675675674%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABD0lEQVR42kXOS0/CUBCG4f4ODJy2pz29cFp6Ly2IglwWEG+JJLowcWHcGP//7jUtiIsn+WYyMxnDdCeosESNS5wgRzgTLJVcsnBiRjJGqAgZZJhu0tfS/8/djT9GMJnx8fnDYv1EvdgjwwqdXvP6/kU13/Wa+Z5k2XD8fmG9PRKmM/aPb6x2z6T1ChmUF0b3hRc1WF6BqbKL00Bxoir8OiU7ZCi/xdU1np6izmy/xPbznmE6Me3ynvb2QNFsKNttr8tpfUc+XVO0G3R2g86WePGMot0RJNdk0w3z1QN5u0UGFU5YYYxsjZBjTEdjOhGWG2OrGMuNzvWpN7RDBiOPgfAZWiED4fW9bq/bvxJ+7xcLt5vARYqCfQAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/5a6824bb921ea6cbaf0849caa9389a46/fcda8/1703504227884-17c685f5-bed5-4b8f-bf2d-8e2190625bb1.png\"\n        srcset=\"/static/5a6824bb921ea6cbaf0849caa9389a46/12f09/1703504227884-17c685f5-bed5-4b8f-bf2d-8e2190625bb1.png 148w,\n/static/5a6824bb921ea6cbaf0849caa9389a46/e4a3f/1703504227884-17c685f5-bed5-4b8f-bf2d-8e2190625bb1.png 295w,\n/static/5a6824bb921ea6cbaf0849caa9389a46/fcda8/1703504227884-17c685f5-bed5-4b8f-bf2d-8e2190625bb1.png 590w,\n/static/5a6824bb921ea6cbaf0849caa9389a46/efc66/1703504227884-17c685f5-bed5-4b8f-bf2d-8e2190625bb1.png 885w,\n/static/5a6824bb921ea6cbaf0849caa9389a46/c83ae/1703504227884-17c685f5-bed5-4b8f-bf2d-8e2190625bb1.png 1180w,\n/static/5a6824bb921ea6cbaf0849caa9389a46/8b936/1703504227884-17c685f5-bed5-4b8f-bf2d-8e2190625bb1.png 1368w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>之前多次介绍过 Okteto，比如《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/611823061%5D(https://zhuanlan.zhihu.com/p/611823061)\">【免费架构】Heroku 不免费了，何去何从之 Keycloak 的容器化部署之路 - Jeff Tian的文章 - 知乎</a> 》。不过坏消息是，Okteto 从 2024 年 1 月 15 日之后，也将停止免费服务！所以，即使 AWS 账户里的钱没用完，我的公众号也可能因为 Okteto 停止免费服务而停止响应（Okteto 最便宜的计划也是 1 个月 149 美元，真心用不起呀……）。还是那句话：且调戏且珍惜。</p>\n<p>要将应用发布到 Okteto，只需要将应用容器化，再配置一下 GitHub 流水线自动部署即可。具体可以参考前面一段提到的文章，或者这一篇：《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/611115815%5D(https://zhuanlan.zhihu.com/p/611115815)\">免费架构：Heroku 不免费了，何去何从之 eggjs 的容器化部署之路 - Jeff Tian的文章 - 知乎</a> 》，不像前一篇是 Java 应用，这也是一个 nodejs 应用的示例。</p>\n<p>唯一不同之处，在于这一次我尝试了私有 Docker 镜像：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e9c5a4a8732d1ef0e06107cf7b1084fb/95c1f/1703504858825-7a989c26-602f-467c-b8e0-74155cf5a66b.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACXUlEQVR42nWTTWsTURSG8yNEECtYBQX3/gtRFxURtLr119gItsWd6FJsdaOCuBHBL9TWaoz2I6aNJpkkncnM3O+ZR+ZOYtW2Bx7eM3PvvJxz59zKxPQsE9NzHL48y+TVOU5fv82Ja/McuzLP5KVbHL9U5dTlmxyZqnL0QpWDZ2c4cOYGh87OcOpi1XNyqsrk+Rkmz81QWViFP9Rhsea4twT3PubcXcp48Bke1WDxCyx8KfVhrXz39FvJkzo8/gqPa1ABS4kDNLgUMJCH6KwBOgWbgEsQwwhMsZ6N9jt2vi+ppEIzRihDp9ul/atL4+c6K5tviSOBdRatDVJblDYoZZAjlLZYl3mMzagUG7XfpDHGEoQJ3YGgOWhT66/QDw1BlBJEkl4kvW4niu1EeqJUI22OMDkuy0tDNTK01rIVOt5tWN5s9njZ/srKZs5yS/KpZfjU0ixvGepdw/fAjjDUO5q1vvHGuypMpKbTS2j0miwFr+kOMobSEEtLrKzXoSiJhClJjV9zeWGo9B/DokIhJM3NAWvtDT4Gr+gGhn44RKQp6YhxLoVAa4WSEmsMRVSKdrUaVWgd/aGk34v5mTRYkx+wCoSUfl0q5bVE4Zzj//inQi2lz4up6GdrdHTd51mekef5LrIsw7kdimdvqIxFbw8wQYegsU6rXqe9sYpotyCOyIE82222FzsVxjEmCrG9LXS7Qdj8QdruEIdJOWfW+hbHul9UxiPj/7Z1PHsfc/9FSDQUpElCnJSaJAlCCOI49rqvoW9ZFaNT6qM3ijvPJUIV1yvf8+wK/j67v/kNrCoQ/JLhJW0AAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/e9c5a4a8732d1ef0e06107cf7b1084fb/fcda8/1703504858825-7a989c26-602f-467c-b8e0-74155cf5a66b.png\"\n        srcset=\"/static/e9c5a4a8732d1ef0e06107cf7b1084fb/12f09/1703504858825-7a989c26-602f-467c-b8e0-74155cf5a66b.png 148w,\n/static/e9c5a4a8732d1ef0e06107cf7b1084fb/e4a3f/1703504858825-7a989c26-602f-467c-b8e0-74155cf5a66b.png 295w,\n/static/e9c5a4a8732d1ef0e06107cf7b1084fb/fcda8/1703504858825-7a989c26-602f-467c-b8e0-74155cf5a66b.png 590w,\n/static/e9c5a4a8732d1ef0e06107cf7b1084fb/efc66/1703504858825-7a989c26-602f-467c-b8e0-74155cf5a66b.png 885w,\n/static/e9c5a4a8732d1ef0e06107cf7b1084fb/c83ae/1703504858825-7a989c26-602f-467c-b8e0-74155cf5a66b.png 1180w,\n/static/e9c5a4a8732d1ef0e06107cf7b1084fb/95c1f/1703504858825-7a989c26-602f-467c-b8e0-74155cf5a66b.png 2330w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>由于不能直接 docker pull jefftian/bedrock 了，因此 k8s 的 deployment 文件有些变化，即增加了一个拉取镜像的配置：</p>\n<p>yaml\nimagePullSecrets:\n- name: regcred</p>\n<p>这对应地需要在 k8s 里创建一个名为 regcred 的 secret，该 secret 明文如下所示，不过在代码仓库里看不到如下明文，因为通过 SOPS （sops -e -i k8s/secrets.yaml --aws-profile the-profile）加密了。</p>\n<p>apiVersion: v1\nkind: Secret\nmetadata:\nname: regcred\nlabels:\nbranch: main\ntype: kubernetes.io/dockerconfigjson\ndata:\n.dockerconfigjson: ewo...KfQo=</p>\n<p>�注意这里的 .dockerconfigjson 是一串 base64 编码的字符串，其解码后的形式是这样的 JSON：\njson\n{\nauths: {\n<a href=\"https://index.docker.io/v1/\">https://index.docker.io/v1/</a>: {\nusername: jefftian,\npassword: dckr_pat_...-...,\nemail: <a href=\"mailto:jeff.tian@outlook.com\">jeff.tian@outlook.com</a>,\nauth: amVm...0NkNB\n}\n}\n}</p>\n<p>注意以上密码，其实是一个访问令牌，而 auth，实际上是 jefftian:访问令牌的 base64 编码。该访问令牌需要从 Docker 后台创建：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/843d3b21a955b876088f211e261ed5c3/70b07/1703505225353-e4638233-9727-47a1-8929-a8b254545399.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAChUlEQVR42lWSy04TURiA+yAmStAEl8alCMGNuvAJXNiu5AmMBdTEjYlxoVJAY1QSDJ12pp05M1C8RRMvUaRVUSFcOk1bWuhAgZZEevczcwSNf/LlP+csvvyX4zlytpf20xfpONvLsXO9dJzppa3Hx6HuC7R1eyWHurwcOOHlYKeXo6d8dPT4ONzlo/2kj/ZOLx1dXo50ejlw/DyevvsT9N37g394Av+QhX94kv5hC39A4A+Y+AcFl+4YXL4juBIQDAwK+u8K+t37oMn1kRjXAjH6b1t4XsQELi9jAsMwEKZgQlf58PYVP758Yjb+ge+fp5n/Fmd+Ns6cZIa5rzPyLTH9lmeTBs9jBi+mBB7dELhYpslIUGcoKFCCQRaXkmyVdlgrbLBVKlNvNKnW6tTqDar1FrUmMhxnnahuENWFxCOEYB/LMrEsC03TSKVS1Gp1KpUqjUaDVqslc7Pp0qLR/GN0CuuYQvB8yuRpzMQTjeq4aFoURQljGAJFUUgmk5TLO5RKZZrNpuRv/NoDWFtf4fG4ysCtCDcCETyRSFQKVTXCw0ejaFoERQlJYbFYJJfP4zgOuVyeUCRKYWdF2rYaq2xgY2984cH4GFdvhbk5pP0Tunls7AmhUFiSTNo465tksjnSmRVsO8P7+EdmnXcslRLEi09ZLtosLGcxdV22PDUp/he6lbkyt/W0vUClssvqmiNZKzhsb5cpb/6kuLnFTnkTqLKazxFUFFRVk8v9T7h/DgYV8rmMnNHuboVqtUa9Vme3UqG+N8u5bAt9GmYXC0TUEOGwKhfr2ZftL0fOM6wSTyRIZzJksxky2SwLdlpmO5Uim7Z5/XGJUWuJl28SaHtC9x//BqIevahBV2v1AAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/843d3b21a955b876088f211e261ed5c3/fcda8/1703505225353-e4638233-9727-47a1-8929-a8b254545399.png\"\n        srcset=\"/static/843d3b21a955b876088f211e261ed5c3/12f09/1703505225353-e4638233-9727-47a1-8929-a8b254545399.png 148w,\n/static/843d3b21a955b876088f211e261ed5c3/e4a3f/1703505225353-e4638233-9727-47a1-8929-a8b254545399.png 295w,\n/static/843d3b21a955b876088f211e261ed5c3/fcda8/1703505225353-e4638233-9727-47a1-8929-a8b254545399.png 590w,\n/static/843d3b21a955b876088f211e261ed5c3/efc66/1703505225353-e4638233-9727-47a1-8929-a8b254545399.png 885w,\n/static/843d3b21a955b876088f211e261ed5c3/c83ae/1703505225353-e4638233-9727-47a1-8929-a8b254545399.png 1180w,\n/static/843d3b21a955b876088f211e261ed5c3/70b07/1703505225353-e4638233-9727-47a1-8929-a8b254545399.png 2906w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>发布完成后，就可以通过 <a href=\"https://bedrock-backstage-jeff-tian.cloud.okteto.net/message?echostr=xml\">https://bedrock-backstage-jeff-tian.cloud.okteto.net/message?echostr=xml</a> 访问到了：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.243243243243242%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAeklEQVR42q3KPQoEIQyGYS/gL1iObJxObKbVURvvf6VvMeyAC1tu8RDyJmKMgTkneu9oreG+b7b6as++bvtea0UphV3XhZQScs4Q53mCiPAi4hljZKuvubcdff6XEAKO42DCew8pJbTWTCn15Vd7+s4Yw4S1Fs65v3kD0ENs26Sl8AIAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/8874f5f3abab2289e94d8fd21c5d4fde/fcda8/1703505278108-3d82a3eb-4e93-4afb-afc8-13978dc738f5.png\"\n        srcset=\"/static/8874f5f3abab2289e94d8fd21c5d4fde/12f09/1703505278108-3d82a3eb-4e93-4afb-afc8-13978dc738f5.png 148w,\n/static/8874f5f3abab2289e94d8fd21c5d4fde/e4a3f/1703505278108-3d82a3eb-4e93-4afb-afc8-13978dc738f5.png 295w,\n/static/8874f5f3abab2289e94d8fd21c5d4fde/fcda8/1703505278108-3d82a3eb-4e93-4afb-afc8-13978dc738f5.png 590w,\n/static/8874f5f3abab2289e94d8fd21c5d4fde/efc66/1703505278108-3d82a3eb-4e93-4afb-afc8-13978dc738f5.png 885w,\n/static/8874f5f3abab2289e94d8fd21c5d4fde/c83ae/1703505278108-3d82a3eb-4e93-4afb-afc8-13978dc738f5.png 1180w,\n/static/8874f5f3abab2289e94d8fd21c5d4fde/1134b/1703505278108-3d82a3eb-4e93-4afb-afc8-13978dc738f5.png 1470w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />以上请求成功后，就可以开始配置微信后台了。\n<a name=uFz18></a></p>\n<h2>配置微信后台</h2>\n<p>在基本配置中填写以上 URL： <a href=\"https://bedrock-backstage-jeff-tian.cloud.okteto.net/message\">https://bedrock-backstage-jeff-tian.cloud.okteto.net/message</a> ，保存即可：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.45945945945947%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACY0lEQVR42nWTa27UMBSFs9m2UvlRkrYsAMQ2WEJZAivgJ0JFAhU0eWfyduJHZg46N8koM1UtHdlje06++7D38PCAx8cPCO7vEQT3Mvu+j7u7O7z3ffhBAN8P5jkIEJy03g1we/sOV9fXuL65gfdH5fhXZdjne4zawE0HJPsCP349I05SGDdBW/emeG6nw0le0dRI8hydGqFGjXHUyFWLuC1R1S2arsegzZl471L9MIq8um6QZgWqJMZQV+hHA2sdHAm0gbEWo+aHRvkY5ZyDmyY4N83zRl5VN0iyHE1RYGhbKG2grUWapvj78oLdbicKwxBZliEMI6hB463hNW2HLC8kNMEfRhjrME0TjsejzCSy1qJXCkop9P069zDGiBHvUl7dtJL8JEkxDHMeGSZNONIkxaePn/H09IS6roWc4v08zzEMw7khCXdhJJSDEGoh1HoOiyRRGKHrOvnD4XB4FeZqJobaWCHMiz24ZqUs6Y5HuUzzrp/33KJLs+3aY87COEbTtlLBlZBkLfe0llDVkj+SM3dlWco5c0x6nklRaFjsS7Tst6UoW0K2Tlm3KKtW7tBQ2snMouFaQP7FYxF+lxGypoIezVxl59A0zUw4jkiSBOxX7pGWRFVVydll+B6pwihGWdXy9FbCNclcx3EsNDRgVfXS6Gs+z4pCgyhOwPbZGq7DLk1OA67XUNffrw1HDb6WrlfnOVwG26QoCgmVJltSrvlEsam0l6WpPKdeDWK2NVy/yqTTeC0AQ53cBOMsOjPAHmi65JCGZVWd6Ng2l4aXYzrOzf2t+omr5y/4mn8/7f8HWscGYC8t6mUAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/68f3c7f5896c6e255e824c3bd3278a8e/fcda8/1703505378753-1a9603f9-9354-48e9-8135-1a3ab46ef84f.png\"\n        srcset=\"/static/68f3c7f5896c6e255e824c3bd3278a8e/12f09/1703505378753-1a9603f9-9354-48e9-8135-1a3ab46ef84f.png 148w,\n/static/68f3c7f5896c6e255e824c3bd3278a8e/e4a3f/1703505378753-1a9603f9-9354-48e9-8135-1a3ab46ef84f.png 295w,\n/static/68f3c7f5896c6e255e824c3bd3278a8e/fcda8/1703505378753-1a9603f9-9354-48e9-8135-1a3ab46ef84f.png 590w,\n/static/68f3c7f5896c6e255e824c3bd3278a8e/efc66/1703505378753-1a9603f9-9354-48e9-8135-1a3ab46ef84f.png 885w,\n/static/68f3c7f5896c6e255e824c3bd3278a8e/c83ae/1703505378753-1a9603f9-9354-48e9-8135-1a3ab46ef84f.png 1180w,\n/static/68f3c7f5896c6e255e824c3bd3278a8e/bfe41/1703505378753-1a9603f9-9354-48e9-8135-1a3ab46ef84f.png 2082w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=c4lFT></a></p>\n<h1>对接完成</h1>\n<p>这样就可以开始调戏啦！不过，也不要太频繁调戏人家哦，很费钱的！<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b0a4b65b33057a1dc03d714477a43e87/7e23a/1703505653364-e4597d91-bbb0-4258-8182-73b26315fa61.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.10810810810811%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACY0lEQVR42lWS2Y7jNhBF9Ru9zbS1URQlklooW5JteenN7Zmg0wjSCPL/33ECcl4mDwcskYWry1uM9k/vDNORzo203UhtHcY4tG6pTEffOqybaNY7erej2yzU/Ug77nDzmf35wuvnF9ePf3i5fhItL5+45U+sO9EPryxvX1wv//Lx44vl+hdbd8C6I2o4MXdnandCDQvu6Z318W/6/YV+d6Fd/6SbL0T75wu2G1CmQ1YN/bTgpgXTjzTDjGrXZFIT54pYVOSlQShLJk3YL3WPqBrSouZ7LIg25wtCGZTp0XXD0+HM6DaYssbUlmHe021mSt1SN47D81vYk3WDsn2om2EKhtKiIjJuRFaW0udVW077A4flyDhuGbSlKDWishS+R7f04w7bb0LtRQv16ywIiopomPZB0DssS02WK2SuULkkWWWsUsljLBClYZUU3N6vuPuWcPfgiUN9c7/i9j7m5m5F9PLjg3ZaULpFlJa4bMnKhkT43CpyaZBVS1F1PKy8YMLtQ/obCau05DGR3NzHRLvjc8jAX8G7WU8Lw7Rg/dNwE27cMe6OmGEmV00YyO/4Ifn+48s7Zd0RbZ/eyJUNeXxbCaTuKXSHqFvS0pJITVJoUmlCX+ZF/FqaQFr8Om/X2/CD4NCH6gX92MuqRaomkGQVcarC6skLg1QtWV6TZhWi0Bg7kPvvVPEYF0Sv1z/Cdf1bUqng4NbM3RDYDyPLemRqHU2hsKKklRUmlwFbKPrKoHMZepzSRPNyCg6LuiFLCkY3shkmxmFiHrfs5j2bYaSSNXkiEGnxP/JUkMU5fePQyvAf4w53VGs7s0kAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/b0a4b65b33057a1dc03d714477a43e87/fcda8/1703505653364-e4597d91-bbb0-4258-8182-73b26315fa61.png\"\n        srcset=\"/static/b0a4b65b33057a1dc03d714477a43e87/12f09/1703505653364-e4597d91-bbb0-4258-8182-73b26315fa61.png 148w,\n/static/b0a4b65b33057a1dc03d714477a43e87/e4a3f/1703505653364-e4597d91-bbb0-4258-8182-73b26315fa61.png 295w,\n/static/b0a4b65b33057a1dc03d714477a43e87/fcda8/1703505653364-e4597d91-bbb0-4258-8182-73b26315fa61.png 590w,\n/static/b0a4b65b33057a1dc03d714477a43e87/efc66/1703505653364-e4597d91-bbb0-4258-8182-73b26315fa61.png 885w,\n/static/b0a4b65b33057a1dc03d714477a43e87/c83ae/1703505653364-e4597d91-bbb0-4258-8182-73b26315fa61.png 1180w,\n/static/b0a4b65b33057a1dc03d714477a43e87/7e23a/1703505653364-e4597d91-bbb0-4258-8182-73b26315fa61.png 2850w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>本篇文章请大家<strong>不要点赞， 不要分享，自己留着玩</strong>就行啦！</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}}}},"staticQueryHashes":[],"slicesMap":{}}