{"componentChunkName":"component---src-templates-post-js","path":"/posts/dguhht9fp9onm0x7/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/dguhht9fp9onm0x7","relativePath":"posts/dguhht9fp9onm0x7","frontmatter":{"title":"部分迁移代码库时保留完整的提交历史","stackbit_url_path":"posts/dguhht9fp9onm0x7","date":"2024-01-08T10:55:01","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p>最近做了一个工作，需要将一个工程中的某一文件夹迁移到新的代码库中，但是希望能够保留提交历史，经过一番折腾，最后找到了一个 git-filter-repo工具完美完成了这份工作，特此记录。\n<a name=l0y9O></a></p>\n<h1>安装 git-filter-repo</h1>\n<p>因为使用了 mac，通过 brew 安装最方便：\nshell\nbrew install git-filter-repo</p>\n<p>它是一个开源工具，源代码详见： <a href=\"https://github.com/newren/git-filter-repo\">https://github.com/newren/git-filter-repo</a>\n<a name=kmPUn></a></p>\n<h1>打出新分支</h1>\n<p>在原有工程的目录下，开启一个新的分支用于这个部分迁移。比如可以从 main 分支执行如下命令：\nshell\ngit checkout -b feature/JIRA-123-github-migration</p>\n<p><a name=f9eg1></a></p>\n<h1>筛选需要迁移的目录和文件</h1>\n<p>如果有这些文件或者目录需要迁移：</p>\n<ul>\n<li>Lambda.sln 文件</li>\n<li>Lambda.Worker.sln.DotSettings.user 文件</li>\n<li>Worker 目录</li>\n<li>Worker.Tests 目录</li>\n</ul>\n<p>并且希望迁移到 ~/repos/NewLambda 文件夹中，那么可以通过 path指定要迁移的文件或者目录，以及通过 --target指定目录文件夹：\nshell\ngit filter-repo --path Lambda.sln --path Lambda.Worker.sln.DotSettings.user --path Worker --path Worker.Tests --target ~/repos/NewLambda</p>\n<p><a name=Bns91></a></p>\n<h1>检查结果</h1>\n<p>在以上命令执行完毕后，进行 ~/repos/NewLambda目录，通过 ls检查一下所有的目录都已经迁移过来，并且不带有任何其他不在迁移范围内的原项目文件。<br />并且可以在 ~/repos/NewLambda目录下执行 git logs --oneline来检查提交历史是否完整地迁移过去了。\n<a name=LjX15></a></p>\n<h1>推送迁移后的文件</h1>\n<p>假设希望迁移到 GitHub，通过在 GitHub 上创建出新的仓库后，按照提示，在本地 ~/repos/NewLambda目录里添加 origin，然后推送即可：</p>\n<p>shell\ngit push --set-upstream origin $(git branch --show-current)</p>\n<p><a name=PIxyW></a></p>\n<h1>创建 PR</h1>\n<p>以上。然后可以向 main 分支发起 PR，已供团队成员进行审核。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5cf0de666c3f932db1e8c0f25fdb0ed9/99365/1704711234647-b0c6be43-1adc-4060-89a0-19822efe1fbf.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnElEQVR42n1S246bMBDN/3/QvvUX9mkfKjW7ajYkQMAYfPfY5lQeQhOpUUca2Rg4cy4+aOuglIWWGt21hRAS/SAwiAmjkJgmCTFNmKSEEBOEnBEobR0TrA8wLsD5yGcHAGjnG97ef6DverRth9PpG5e2x7kbcGwGfF5H/Kprc8M8L9hrXVc452GMB1HiswNyhvYaP/svlFKQckYIEZQyQsrwqUAHgqWChNcVU4CJ9g74+wgEQggJYpLQxiJG4q5TU0ogIl5zzjzwuSMRrHMIRBtgKBp+1ViUxencsG/WBVRvfaSHX3fPnp9jKvztosxDMq0BTfqAUpo7pYxSVvbnf13WFRSqmghrHbNlwJy2zfXS4HK5YlEa86JY5v7jS8BS4M0EbQwGIdkiBqze1BLjiK7v2ceaJN092dLES8DoNbz3TILSnvI9fmMMlkUx/RAjS6ld9zWMnW35C7gipy2syq4OYMD6slbXtjh+fuH73OB8biDlzODGWDb8FUOnRyitcRvEQ/KOrJRi6vWi1qn7oOdL/A9ozsy+yt0Z/gG1w1iK9JbQ8gAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/5cf0de666c3f932db1e8c0f25fdb0ed9/fcda8/1704711234647-b0c6be43-1adc-4060-89a0-19822efe1fbf.png\"\n        srcset=\"/static/5cf0de666c3f932db1e8c0f25fdb0ed9/12f09/1704711234647-b0c6be43-1adc-4060-89a0-19822efe1fbf.png 148w,\n/static/5cf0de666c3f932db1e8c0f25fdb0ed9/e4a3f/1704711234647-b0c6be43-1adc-4060-89a0-19822efe1fbf.png 295w,\n/static/5cf0de666c3f932db1e8c0f25fdb0ed9/fcda8/1704711234647-b0c6be43-1adc-4060-89a0-19822efe1fbf.png 590w,\n/static/5cf0de666c3f932db1e8c0f25fdb0ed9/efc66/1704711234647-b0c6be43-1adc-4060-89a0-19822efe1fbf.png 885w,\n/static/5cf0de666c3f932db1e8c0f25fdb0ed9/c83ae/1704711234647-b0c6be43-1adc-4060-89a0-19822efe1fbf.png 1180w,\n/static/5cf0de666c3f932db1e8c0f25fdb0ed9/99365/1704711234647-b0c6be43-1adc-4060-89a0-19822efe1fbf.png 2934w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}