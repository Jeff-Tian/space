{"componentChunkName":"component---src-templates-post-js","path":"/posts/使用Java编写一个邮件发信客户端/","result":{"data":{"sitePage":{"id":"SitePage /posts/使用Java编写一个邮件发信客户端/"}},"pageContext":{"url":"/posts/使用Java编写一个邮件发信客户端/","relativePath":"posts/使用Java编写一个邮件发信客户端.md","relativeDir":"posts","base":"使用Java编写一个邮件发信客户端.md","name":"使用Java编写一个邮件发信客户端","frontmatter":{"title":"使用Java编写一个邮件发信客户端","stackbit_url_path":"posts/使用Java编写一个邮件发信客户端","date":"2010-05-26 01:57:49","excerpt":"","comments_count":0,"positive_reactions_count":0,"tags":[null],"canonical_url":"https://be-net.azurewebsites.net/post/2010/05/26/使用Java编写一个邮件发信客户端","template":"post"},"html":"<pre><code>    &#x3C;p>要写这个客户端，需要先了解SMTP协议。了解了这个协议后，可以先直接在cmd界面下，通过telnet命令，使用本地的SMTP服务器，向任意邮箱发送一封测试信，以加深对SMTP协议的直观理解。详细步骤可见：&#x3C;a href=\"http://www.myfootprints.cn/blog/post/HowToUseSMTP.html\">http://www.myfootprints.cn/blog/post/HowToUseSMTP.html&#x3C;/a>。&#x3C;/p>\n</code></pre>\n<p>现在来通过Java编写一个使用本地SMTP服务器发送电子邮件的客户端，它无非是将在cmd界面下通过telnet命令来完成的工作变得更加友好一点。可以下载运行一下查看示例。在界面的Local MailServer一栏中，填写本地的邮件服务器地址，如果安装了IIS，那么可以填写Localhost。</p>\n<p>&nbsp;通过此工具发邮件，可以实现伪装发件人的效果，即在发件人一栏中，可以填写任何想要填写的邮件地址，只要它符合邮件地址格式规范就行（如admin@myfootprints.cn 形式）。</p>\n<p><a target=\"_blank\" href=\"http://www.myfootprints.cn/OldWeb/blog/upload/MailClient.rar\">MailClient.rar</a></p>\n<p>解压缩后运行MailClient.class即可。</p>\n<p>以下是Java代码，主要代码来自《计算机网络自顶向下方法》中的编程实验室作业，某些是由涂鸦填充而成，一共有4个类文件。以下分别贴出：</p>\n<p>MailClient.java</p>\n<pre class=\"brush: java\">\nimport java.io.*;\nimport java.net.*;\nimport java.awt.*;\nimport java.awt.event.*;\n<p>/**</p>\n<ul>\n<li>A simple mail client with a GUI for sending mail.</li>\n<li>@author 涂鸦</li>\n<li></li>\n</ul>\n<p>*/\npublic class MailClient extends Frame {\nprivate Button btSend = new Button(\"Send\");\nprivate Button btClear = new Button(\"Clear\");\nprivate Button btQuit = new Button(\"Quit\");\nprivate Label serverLabel = new Label(\"Local mailserver:\");\nprivate TextField serverField = new TextField(\"\", 40);\nprivate Label fromLabel = new Label(\"From:\");\nprivate TextField fromField = new TextField(\"\", 40);\nprivate Label toLabel = new Label(\"To:\");\nprivate TextField toField = new TextField(\"\", 40);\nprivate Label subjectLabel = new Label(\"Subject:\");\nprivate TextField subjectField = new TextField(\"\", 40);\nprivate Label messageLabel = new Label(\"Message:\");\nprivate TextArea messageText = new TextArea(10, 40);</p>\n<pre><code>/**\n * Create a new MailClient window with fields for entering all the relevant\n * information (From, To, Subject, and message).\n */\npublic MailClient() {\n\tsuper(\"Java MailClient\");\n\t\n\tPanel serverPanel = new Panel(new BorderLayout());\n\tPanel fromPanel = new Panel(new BorderLayout());\n\tPanel toPanel = new Panel(new BorderLayout());\n\tPanel subjectPanel = new Panel(new BorderLayout());\n\tPanel messagePanel = new Panel(new BorderLayout());\n\tserverPanel.add(serverLabel, BorderLayout.WEST);\t\n\tserverPanel.add(serverField, BorderLayout.CENTER);\n\tfromPanel.add(fromLabel, BorderLayout.WEST);\n\tfromPanel.add(fromField, BorderLayout.CENTER);\n\ttoPanel.add(toLabel, BorderLayout.WEST);\n\ttoPanel.add(toField, BorderLayout.CENTER);\n\tsubjectPanel.add(subjectLabel, BorderLayout.WEST);\n\tsubjectPanel.add(subjectField, BorderLayout.CENTER);\n\tmessagePanel.add(messageLabel, BorderLayout.NORTH);\n\tmessagePanel.add(messageText, BorderLayout.CENTER);\n\tPanel fieldPanel = new Panel(new GridLayout(0, 1));\n\tfieldPanel.add(serverPanel);\n\tfieldPanel.add(fromPanel);\n\tfieldPanel.add(toPanel);\n\tfieldPanel.add(subjectPanel);\n\t\n\t/** Create a panel for the buttons and listeners to the buttons. */\n\tPanel buttonPanel = new Panel(new GridLayout(1, 0));\n\tbtSend.addActionListener(new SendListener());\n\tbtClear.addActionListener(new ClearListener());\n\tbtQuit.addActionListener(new QuitListener());\n\tbuttonPanel.add(btSend);\n\tbuttonPanel.add(btClear);\n\tbuttonPanel.add(btQuit);\n\t\n\t/** Add, pack, and show */\n\tadd(fieldPanel, BorderLayout.NORTH);\n\tadd(messagePanel, BorderLayout.CENTER);\n\tadd(buttonPanel, BorderLayout.SOUTH);\n\tpack();\n\tshow();\n}\n\nstatic public void main(String argv[]) {\n\tnew MailClient();\n}\n\n/** Handler for the Send-button. */\nclass SendListener implements ActionListener {\n\tpublic void actionPerformed(ActionEvent event) {\n\t\tSystem.out.println(\"Sending mail\");\n\t\t\n\t\t/** Check that we have the local mailserver */\n\t\tif ((serverField.getText()).equals(\"\")) {\n\t\t\tSystem.out.println(\"Need name of local mailserver!\");\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t/** Check that we have the sender and recipient */\n\t\tif ((fromField.getText()).equals(\"\")) {\n\t\t\tSystem.out.println(\"Need sender!\");\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif ((toField.getText()).equals(\"\")) {\n\t\t\tSystem.out.println(\"Need recipient!\");\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t/** Create the message */\n\t\tMessage mailMessage = new Message(fromField.getText(), \n\t\t\t\ttoField.getText(),\n\t\t\t\tsubjectField.getText(),\n\t\t\t\tmessageText.getText());\n\t\t\n\t\t/** Check that the message is valid, i.e., sender and recipient addresss look ok. */\n\t\tif (!mailMessage.isValid()) {\n\t\t\tSystem.out.println(\"Mail is not valid!\");\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t/** Create the envelope, open the connection and try to send the message. */\n\t\tEnvelope envelope;\n\t\ttry \n\t\t{\n\t\t\tenvelope = new Envelope(mailMessage, serverField.getText());\n\t\t} catch (UnknownHostException e) {\n\t\t\t/** If there is an error, do not go further */\n\t\t\tSystem.out.println(\"Unknown host!\");\n\t\t\treturn;\n\t\t}\n\t\t\n\t\ttry {\n\t\t\tSMTPConnection connection = new SMTPConnection(envelope);\n\t\t\tconnection.send(envelope);\n\t\t\tconnection.close();\n\t\t} catch (IOException error) {\n\t\t\tSystem.out.println(\"Sending failed: \" + error);\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tSystem.out.println(\"Mail send successfully!\");\n\t}\n}\n\n/** Clear the fields on the GUI. */\nclass ClearListener implements ActionListener {\n\tpublic void  actionPerformed(ActionEvent e) {\n\t\tSystem.out.println(\"Clearing fields\");\n\t\tfromField.setText(\"\");\n\t\ttoField.setText(\"\");\n\t\tsubjectField.setText(\"\");\n\t\tmessageText.setText(\"\");\n\t}\n}\n\n/* Quit */\nclass QuitListener implements ActionListener {\n\tpublic void actionPerformed(ActionEvent e) {\n\t\tSystem.exit(0);\n\t}\n}\n</code></pre>\n<p>}\n</pre></p>\n<p>Message.java</p>\n<pre class=\"brush: java\">\nimport java.util.*;\nimport java.text.*;\n<p>/**</p>\n<ul>\n<li>Mail message</li>\n<li>@author 涂鸦</li>\n<li></li>\n</ul>\n<p>*/\npublic class Message {\npublic String Headers;\npublic String Body;</p>\n<pre><code>private String From;\nprivate String To;\n\n/** To make it look nicer */\nprivate static final String CRLF = \"\\r\\n\";\n\n/** Create the message object by inserting the required headers from RFC 822 (From, To, Date). */\npublic Message(String from, String to, String subject, String text) {\n\t/** Remove whitespace */\n\tFrom = from.trim();\n\tTo = to.trim();\n\tHeaders = \"From: \" + From + CRLF;\n\tHeaders += \"To: \" + To + CRLF;\n\tHeaders += \"Subject: \" + subject.trim() + CRLF;\n\t\n\t/** A close approximation of the required format. Unfortunately only GMT. */\n\tSimpleDateFormat format = new SimpleDateFormat(\"EEE, dd MMM yyyy HH:mm:ss 'GMT'\");\n\tString dateString = format.format(new Date());\n\tHeaders += \"Date: \" + dateString + CRLF;\n\tBody = text;\n}\n\n/** Two functions to access the sender and recipient. */\npublic String getFrom() {\n\treturn From;\n}\n\npublic String getTo() {\n\treturn To;\n}\n\n/** Check whether the message is valid. In other words, check that both sender and recipient \n * contains only one @-sign. */\npublic boolean isValid() {\n\tint fromat = From.indexOf('@');\n\tint toat = To.indexOf('@');\n\t\n\tif (fromat &#x26;lt; 1 || (From.length() - fromat) &#x26;lt;= 1) {\n\t\tSystem.out.println(\"Sender address is invalid.\");\n\t\treturn false;\n\t}\n\t\n\tif (toat &#x26;lt; 1 || (To.length() - toat) &#x26;lt;= 1) {\n\t\tSystem.out.println(\"Recipient address is invalid.\");\n\t\treturn false;\n\t}\n\t\n\tif (fromat != From.lastIndexOf('@')) {\n\t\tSystem.out.println(\"Sender address is invalid.\");\n\t\treturn false;\n\t}\n\t\n\tif (toat != To.lastIndexOf('@')) {\n\t\tSystem.out.println(\"Recipient address is invalid.\");\n\t\treturn false;\n\t}\n\t\n\treturn true;\n}\n\n/** For printing the message. */ \npublic String toString() {\n\tString res;\n\t\n\tres = Headers + CRLF;\n\tres += Body;\n\treturn res;\n}\n</code></pre>\n<p>}\n</pre></p>\n<div>&nbsp;</div>\n<p>Envelope.java</p>\n<pre class=\"brush: java\">\nimport java.io.*;\nimport java.net.*;\nimport java.util.*;\n<p>/**</p>\n<ul>\n<li>SMTP envelope for one mail message</li>\n<li>@author 涂鸦</li>\n<li></li>\n</ul>\n<p>*/\npublic class Envelope {\npublic String Sender;</p>\n<pre><code>/** SMTP-recipient, or contents of To-header. */\npublic String Recipient;\n\n/** Target MX-host */\npublic String DestHost;\npublic InetAddress DestAddr;\n\n/** The actual message. */\npublic Message Message;\n\n/** Create the envelope. */\npublic Envelope(Message message, String localServer) throws UnknownHostException {\n\t/** Get sender and recipient. */\n\tSender = message.getFrom();\n\tRecipient = message.getTo();\n\t\n\t/** Get message. We must escape the message to make sure that there are no single periods on \n\t * a line. This would mess up sending the Mail. */\n\tMessage = escapeMessage(message);\n\t\n\t/** Take the name of the local mailserver and map it into an Inet Address */\n\tDestHost = localServer;\n\ttry {\n\t\tDestAddr = InetAddress.getByName(DestHost);\n\t} catch (UnknownHostException e) {\n\t\tSystem.out.println(\"Unknown Host: \" + DestHost);\n\t\tSystem.out.println(e);\n\t\tthrow e;\n\t}\n\treturn;\n}\n\n/** Escape the message by doubling all periods at the beginning of a line. */\nprivate Message escapeMessage(Message message) {\n\tString escapeBody = \"\";\n\tString token;\n\tStringTokenizer parser = new StringTokenizer(message.Body, \"\\n\", true);\n\t\n\twhile (parser.hasMoreTokens()) {\n\t\ttoken = parser.nextToken();\n\t\tif (token.startsWith(\".\")) {\n\t\t\ttoken = \".\" + token;\n\t\t}\n\t\t\n\t\tescapeBody += token;\n\t}\n\t\n\tmessage.Body = escapeBody;\n\treturn message;\n}\n\n/** For printing the envelope. Only for debug. */\npublic String toString() {\n\tString res = \"Sender: \" + Sender + \"\\n\";\n\tres += \"Recipient: \" + Recipient +\"\\n\";\n\tres += \"MX-host: \" + DestHost + \", address: \" + DestAddr + \"\\n\";\n\tres += \"Message: \" + \"\\n\";\n\tres += Message.toString();\n\t\n\treturn res;\n}\n</code></pre>\n<p>}\n</pre></p>\n<div>&nbsp;</div>\n<p>SMTPConnection.java</p>\n<pre class=\"brush: java\">\nimport java.net.*;\nimport java.io.*;\nimport java.util.*;\n<p>/**</p>\n<ul>\n<li>Open an SMTP connection to a mailserver and send one mail</li>\n<li>@author 涂鸦</li>\n<li></li>\n</ul>\n<p>*/\npublic class SMTPConnection {\nprivate Socket connection;</p>\n<pre><code>/** Streams for reading and writing the socket */\nprivate BufferedReader fromServer;\nprivate DataOutputStream toServer;\n\nprivate static final int SMTP_PORT = 25;\nprivate static final String CRLF = \"\\r\\n\";\n\n/** Are we connected? Used in close() to determine what to do. */\nprivate boolean isConnected = false;\n\n/** Create an SMTPConnection object. Create the socket and the associated streams. Initialize \n * SMTP connection.\n */\npublic SMTPConnection(Envelope envelope) throws IOException {\n\tconnection = new Socket(envelope.DestAddr, SMTP_PORT);\n\tfromServer = new BufferedReader(new InputStreamReader(connection.getInputStream()));\n\ttoServer = new DataOutputStream(connection.getOutputStream());\n\t\n\t\n\t/** Read a line from server and check that the reply code is 220. If not, throw an IOException. */\n\tString reply = fromServer.readLine();\n\tif (reply.startsWith(\"220\")) {\n\t\t\n\t} else {\n\t\tthrow new IOException(\"Server reply\" + reply);\n\t}\n\t\n\t/** SMTP handshake. We need the name of the local machine.\n\t * Send the appropriate SMTP handshake command. */\n\tString localhost = envelope.DestHost;\n\ttry {\n\t\tsendCommand(\"HELO \" + localhost, 250);\n\t} catch (IOException error) {\n\t\tSystem.out.println(error);\n\t\tSystem.exit(1);\n\t} catch (Exception e) {\n\t\tSystem.out.println(e);\n\t\tSystem.exit(1);\n\t}\n\t\n\tisConnected = true;\n}\n\n/** Send the message. Write the correct SMTP-commands in the correct order. No checking for errors,\n * just throw them to the caller.\n */\npublic void send(Envelope envelope) throws IOException {\n\t/** Send all the necessary commands to send a message. Call sendCommand() to do the dirty \n\t * work. Do _not_ catch the exception thrown from sendCommand().\n\t */\n\tsendCommand(\"MAIL FROM: \" + envelope.Sender + CRLF, 250);\n\tsendCommand(\"RCPT TO: \" + envelope.Recipient + CRLF, 250);\n\tsendCommand(\"DATA\" + CRLF + envelope.Message.Headers + envelope.Message.Body + CRLF + \".\" + CRLF, 354);\n}\n\n/** Close the connection. First, terminate on SMTP level, then close the socket. */\npublic void close() {\n\tisConnected = false;\n\ttry {\n\t\t/**\n\t\tsendCommand(\"QUIT\", 221);*/\n\t\t// 我的机器localhost对于QUIT的返回码是250\n\t\tsendCommand(\"QUIT\", 250);\n\t\tconnection.close();\n\t} catch (IOException e) {\n\t\tSystem.out.println(\"Unable to close connection: \" + e);\n\t\tisConnected = true;\n\t}\n}\n\n/** Send an SMTP command to the server. Check that the reply code is what is is supposed to be \n * according to RFC 821.\n */\nprivate void sendCommand(String command, int rc) throws IOException {\n\tString reply;\n\t\n\ttoServer.writeBytes(command);\n\ttoServer.writeBytes(CRLF);\n\tSystem.out.println(\"Me: \" + command + '\\n');\n\treply = fromServer.readLine();\n\tSystem.out.println(\"Server: \" + reply + '\\n');\n\tif(!reply.startsWith(String.valueOf(rc))) {\n\t\tthrow new IOException(\"Server reply: \" + reply);\n\t}\n\t/**\n\tif(rc != parseReply(reply)) {\n\t\tthrow new IOException(\"Server reply\" + reply);\n\t}*/\n\t/**\n\tif ((command.equalsIgnoreCase(\"HELO\") &#x26;amp;&#x26;amp; rc != 250) \n\t\t\t|| (command.equalsIgnoreCase(\"MAIL FROM\") &#x26;amp;&#x26;amp; rc != 250) \n\t\t\t|| (command.equalsIgnoreCase(\"RCPT TO\") &#x26;amp;&#x26;amp; rc != 250)\n\t\t\t|| (command.equalsIgnoreCase(\"DATA\") &#x26;amp;&#x26;amp; rc != 354)\n\t\t\t|| (command.equalsIgnoreCase(\"QUIT\") &#x26;amp;&#x26;amp; rc != 221)) {\n\t\tthrow new IOException(\"Server replys \" + rc);\n\t}*/\n}\n\n/** Parse the reply line from the server. Returns the reply code. */\nprivate int parseReply(String reply) {\n\treturn Integer.parseInt(reply);\n}\n\n/** Destructor. Closes the connection if something bad happens. */\nprotected void finalize() throws Throwable {\n\tif (isConnected) {\n\t\tclose();\n\t}\n\t\n\tsuper.finalize();\n}\n</code></pre>\n<p>}\n</pre></p>\n<p>以下是原书的作业提示：</p>\n<hr>\n<p>&nbsp;</p>\n<h1 style=\"font-weight: normal; font-size: 19pt; color: rgb(167, 124, 70); font-family: Arial, sans-serif; line-height: normal; \">Programming Assignment 2: A Mail User Agent in Java</h1>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">In this lab you will implement a mail user agent that sends mail to other users. Your task is to program the SMTP interaction between the MUA and the local SMTP server. The client provides a graphical user interface containing fields for entering the sender and recipient addresses, the subject of the message and the message itself. Here's what the user interface looks like:<br>\n&nbsp;</p>\n<center style=\"font-family: Simsun; line-height: normal; font-size: medium; \"><img height=\"342\" alt=\"[Interface]\" width=\"420\" src=\"http://www.plaust.edu.cn/networks/jiaofuziyuan/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C4/labsite2/Programming%20Assignments/Programming%20Assignment%202%20%20A%20Mail%20User%20Agent%20in%20Java.files/interface.gif\"></center>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">With this interface, when you want to send a mail, you must fill in complete addresses for both the sender and the recipient, i.e.,<code>user@someschool.edu</code>, not just simply&nbsp;<code>user</code>. You can send mail to only one recipient. You will also need to give the name (or IP address) of your local mailserver. If you do not know the name of your local mailserver, see&nbsp;<a style=\"color: rgb(0, 0, 102); \" href=\"http://media.pearsoncmg.com/aw/aw_kurose_network_3/labs/lab2/lab2.html#dns\">Querying the DNS</a>&nbsp;below for more information on how to obtain the address of the local mailserver.</p>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">When you have finished composing your mail, press&nbsp;<i>Send</i>&nbsp;to send it.</p>\n<h2 style=\"font-weight: bold; font-size: 16pt; color: rgb(167, 124, 70); font-family: Arial, sans-serif; line-height: normal; \">The Code</h2>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">The program consists of four classes:<br>\n<br>\n</p><table>\n    <tbody>\n        <tr>\n            <td width=\"150\">MailClient</td>\n            <td width=\"300\">The user interface</td>\n        </tr>\n        <tr>\n            <td width=\"150\">Message</td>\n            <td width=\"300\">Mail message</td>\n        </tr>\n        <tr>\n            <td width=\"150\">Envelope</td>\n            <td width=\"300\">SMTP envelope around the Message</td>\n        </tr>\n        <tr>\n            <td width=\"150\">SMTPConnection</td>\n            <td width=\"300\">Connection to the SMTP server</td>\n        </tr>\n    </tbody>\n</table>\n<p></p>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">You will need to complete the code in the&nbsp;<code>SMTPConnection</code>&nbsp;class so that in the end you will have a program that is capable of sending mail to any recipient. The code for the&nbsp;<code>SMTPConnection</code>&nbsp;class is at the&nbsp;<a style=\"color: rgb(0, 0, 102); \" href=\"http://media.pearsoncmg.com/aw/aw_kurose_network_3/labs/lab2/lab2.html#smtpconnection\">end of this page</a>. The code for the other three classes is provided&nbsp;<a style=\"color: rgb(0, 0, 102); \" href=\"http://media.pearsoncmg.com/aw/aw_kurose_network_3/labs/lab2/othercode.html\">on this page</a>.</p>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">The places where you need to complete the code have been marked with the comments&nbsp;<code>/* Fill in */</code>. Each of the places requires one or more lines of code.</p>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">The&nbsp;<code>MailClient</code>&nbsp;class provides the user interface and calls the other classes as needed. When you press&nbsp;<i>Send</i>, the&nbsp;<code>MailClient</code>class constructs a&nbsp;<code>Message</code>&nbsp;class object to hold the mail message. The&nbsp;<code>Message</code>&nbsp;object holds the actual message headers and body. Then the&nbsp;<code>MailClient</code>&nbsp;object builds the SMTP envelope using the&nbsp;<code>Envelope</code>&nbsp;class. This class holds the SMTP sender and recipient information, the SMTP server of the recipient's domain, and the&nbsp;<code>Message</code>&nbsp;object. Then the&nbsp;<code>MailClient</code>&nbsp;object creates the<code>SMTPConnection</code>&nbsp;object which opens a connection to the SMTP server and the&nbsp;<code>MailClient</code>&nbsp;object sends the message over the connection. The sending of the mail happens in three phases:</p>\n<ol style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">\n    <li>The&nbsp;<code>MailClient</code>&nbsp;object creates the&nbsp;<code>SMTPConnection</code>&nbsp;object and opens the connection to the SMTP server.</li>\n    <li>The&nbsp;<code>MailClient</code>&nbsp;object sends the message using the function&nbsp;<code>SMTPConnection.send()</code>.</li>\n    <li>The&nbsp;<code>MailClient</code>&nbsp;object closes the SMTP connection.</li>\n</ol>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">The&nbsp;<code>Message</code>&nbsp;class contains the function&nbsp;<code>isValid()</code>&nbsp;which is used to check the addresses of the sender and recipient to make sure that there is only one address and that the address contains the @-sign. The provided code does not do any other error checking.</p>\n<hr style=\"font-family: Simsun; line-height: normal; font-size: medium; \">\n<h2 style=\"font-weight: bold; font-size: 16pt; color: rgb(167, 124, 70); font-family: Arial, sans-serif; line-height: normal; \">Reply Codes</h2>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">For the basic interaction of sending one message, you will only need to implement a part of SMTP. In this lab you need only to implement the following SMTP commands:<br>\n<br>\n</p><table>\n    <tbody>\n        <tr>\n            <th>Command</th>\n            <th>Reply Code</th>\n        </tr>\n        <tr>\n            <td>DATA</td>\n            <td>354</td>\n        </tr>\n        <tr>\n            <td>HELO</td>\n            <td>250</td>\n        </tr>\n        <tr>\n            <td>MAIL FROM</td>\n            <td>250</td>\n        </tr>\n        <tr>\n            <td>QUIT</td>\n            <td>221</td>\n        </tr>\n        <tr>\n            <td>RCPT TO</td>\n            <td>250</td>\n        </tr>\n    </tbody>\n</table>\n<p></p>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">The above table also lists the accepted reply codes for each of the SMTP commands you need to implement. For simplicity, you can assume that any other reply from the server indicates a fatal error and abort the sending of the message. In reality, SMTP distinguishes between transient (reply codes 4xx) and permanent (reply codes 5xx) errors, and the sender is allowed to repeat commands that yielded in a transient error. See Appendix E of&nbsp;<a style=\"color: rgb(0, 0, 102); \" href=\"http://www.ietf.org/rfc/rfc0821.txt?number=821\">RFC 821</a>&nbsp;for more details.</p>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">In addition, when you open a connection to the server, it will reply with the code 220.</p>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \"><em>Note:</em>&nbsp;RFC 821 allows the code 251 as a response to a RCPT TO-command to indicate that the recipient is not a local user. You may want to verify manually with the&nbsp;<code>telnet</code>&nbsp;command what your local SMTP server replies.</p>\n<hr style=\"font-family: Simsun; line-height: normal; font-size: medium; \">\n<h2 style=\"font-weight: bold; font-size: 16pt; color: rgb(167, 124, 70); font-family: Arial, sans-serif; line-height: normal; \">Hints</h2>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">Most of the code you will need to fill in is similar to the code you wrote in the WebServer lab. You may want to use the code you have written there to help you.</p>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">To make it easier to debug your program, do not, at first, include the code that opens the socket, but use the following definitions for<code>fromServer</code>&nbsp;and&nbsp;<code>toServer</code>. This way, your program sends the commands to the terminal. Acting as the SMTP server, you will need to give the correct reply codes. When your program works, add the code to open the socket to the server.</p>\n<pre>       fromServer = new BufferedReader(new InputStreamReader(System.in));\n       toServer = System.out;\n</pre>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">The lines for opening and closing the socket, i.e., the lines&nbsp;<code>connection = ...</code>&nbsp;in the constructor and the line&nbsp;<code>connection.close()</code>&nbsp;in function&nbsp;<code>close()</code>, have been commented out by default.</p>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">Start by completing the function&nbsp;<code>parseReply()</code>. You will need this function in many places. In the function&nbsp;<code>parseReply()</code>, you should use the&nbsp;<code>StringTokenizer</code>-class for parsing the reply strings. You can convert a string to an integer as follows:</p>\n<pre>\t   int i = Integer.parseInt(argv[0]);\n</pre>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">In the function&nbsp;<code>sendCommand()</code>, you should use the function&nbsp;<code>writeBytes()</code>&nbsp;to write the commands to the server. The advantage of using&nbsp;<code>writeBytes()</code>&nbsp;instead of&nbsp;<code>write()</code>&nbsp;is that the former automatically converts the strings to bytes which is what the server expects. Do not forget to terminate each command with the string CRLF.</p>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">You can throw exceptions like this:</p>\n<pre>           throw new Exception();\n</pre>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">You do not need to worry about details, since the exceptions in this lab are only used to signal an error, not to give detailed information about what went wrong.</p>\n<hr style=\"font-family: Simsun; line-height: normal; font-size: medium; \">\n<h2 style=\"font-weight: bold; font-size: 16pt; color: rgb(167, 124, 70); font-family: Arial, sans-serif; line-height: normal; \">Optional Exercises</h2>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">You may want to try the following optional exercises to make your program more sophisticated. For these exercises, you will need to modify also the other classes (MailClient, Message, and Envelope).</p>\n<ul style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">\n    <li><b>Verify sender address</b>. Java's System-class contains information about the username and the InetAddress-class contains methods for finding the name of the local host. Use these to construct the sender address for the Envelope instead of using the user-supplied value in the From-header.</li>\n    <li><b>Additional headers</b>. The generated mails have only four header fields, From, To, Subject, and Date. Add other header fields from RFC 822, e.g., Message-ID, Keywords. Check the&nbsp;<a style=\"color: rgb(0, 0, 102); \" href=\"http://info.internet.isi.edu/in-notes/rfc/files/rfc822.txt\">RFC</a>&nbsp;for the definitions of the different fields.</li>\n    <li><b>Multiple recipients</b>. Currently the program only allows sending mail to a single recipient. Modify the user interface to include a Cc-field and modify the program to send mail to both recipients. For a more challenging exercise, modify the program to send mail to an arbitrary number of recipients.</li>\n    <li><b>More error checking</b>. The provided code assumes that all errors that occur during the SMTP connection are fatal. Add code to distinguish between fatal and non-fatal errors and add a mechanism for signaling them to the user. Check the RFC to see what the different reply codes mean. This exercise may require large modifications to the&nbsp;<code>send()</code>,&nbsp;<code>sendCommand()</code>, and<code>parseReply()</code>&nbsp;functions.</li>\n</ul>\n<hr style=\"font-family: Simsun; line-height: normal; font-size: medium; \">\n<h2 style=\"font-weight: bold; font-size: 16pt; color: rgb(167, 124, 70); font-family: Arial, sans-serif; line-height: normal; \"><a name=\"dns\">Querying the DNS</a></h2>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">The Domain Name System (DNS) stores information in resource records. Normal name to IP-address mappings are stored in type A (Address) resource records. Type NS (NameServer) records hold information about nameservers and type MX (Mail eXchange) records tell which server is handling the mail delivery of the domain.</p>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">The server you need to find is the server handling the mail for your school's domain. First, you must find the nameserver of your school and then query this nameserver for the MX-host. Assuming you are at Someschool and your domain is&nbsp;<code>someschool.edu</code>, you would do the following:</p>\n<ol style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">\n    <li>Find the address of a nameserver for the top-level domain&nbsp;<code>.edu</code>&nbsp;(NS query)</li>\n    <li>Query the nameserver for .edu about the nameserver for the domain&nbsp;<code>someschool.edu</code>&nbsp;to get the address of Someschool's nameserver. (NS query)</li>\n    <li>Query Someschool's nameserver for MX-records for the domain&nbsp;<code>someschool.edu</code>. (MX query)</li>\n</ol>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">Ask your local system administrator how to perform DNS queries manually.</p>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">Under Unix you can query DNS manually with the&nbsp;<code>nslookup</code>-command. The syntax of the&nbsp;<code>nslookup</code>-command is as follows. Note that the argument&nbsp;<code>host</code>&nbsp;can also be a domain.\n</p><table>\n    <tbody>\n        <tr>\n            <td>Normal query</td>\n            <td><code>nslookup host</code></td>\n        </tr>\n        <tr>\n            <td>Normal query using a given server</td>\n            <td><code>nslookup host server</code></td>\n        </tr>\n        <tr>\n            <td>NS-query</td>\n            <td><code>nslookup -type=NS host</code></td>\n        </tr>\n        <tr>\n            <td>MX-query</td>\n            <td><code>nslookup -type=MX host</code></td>\n        </tr>\n    </tbody>\n</table>\n<p></p>\n<p style=\"font-size: 10pt; font-family: Arial, sans-serif; line-height: normal; \">The reply to the MX-query may contain multiple mail exchangers. Each of them is preceded by a number which is the preference value for this server. Lower preference values indicate preferred servers so you should use the server with the lowest preference value.</p>\n<p>&nbsp;</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}}}},"staticQueryHashes":[],"slicesMap":{}}