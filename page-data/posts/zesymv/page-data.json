{"componentChunkName":"component---src-templates-post-js","path":"/posts/zesymv/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/zesymv","relativePath":"posts/zesymv","frontmatter":{"title":"Free Arch：给 GraphQL 加上服务器端响应缓存","stackbit_url_path":"posts/zesymv","date":"2021-10-27T13:00:45","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a name=CdND2></a></p>\n<h1>题外话（声明本文和图数据库无关）</h1>\n<p>最近写了几篇关于 GraphQL 的文章：</p>\n<p>《<a href=\"https://zhuanlan.zhihu.com/p/412196725\">一顿操作猛如虎，部署一个万能 BFF</a>》<br />《<a href=\"https://zhuanlan.zhihu.com/p/415577362\">使用万能 BFF，将语雀文章 GraphQL 服务化</a>》<br />《<a href=\"https://zhuanlan.zhihu.com/p/416697232\">在小程序里接入 GraphQL</a>》<br />《<a href=\"https://zhuanlan.zhihu.com/p/423766959\">Free Arch：给 GraphQL 增加 CDN 缓存</a>》</p>\n<p>得到一些私信以及评论，问我关于图数据库的问题。我声明一下，<strong>目前我还没有任何使用图数据库的经验！</strong></p>\n<p>当然如果通过<a href=\"https://www.zhihu.com/consult/people/1073548674713423872\"><strong>付费咨询</strong></a>来问我，我可能不会这么说，我会悄悄地学习一下，再回答，哈哈哈哈哈。</p>\n<p>我在另一个<a href=\"https://www.zhihu.com/question/336797348/answer/2189072784\">回答</a>里，也简单声明了，GraphQL 和图数据库完全是两码事，这里再澄清一下：</p>\n<ul>\n<li>图数据库是一种将数据存储在图中的数据存储技术，如果数据和数据间存在相互关系的话（当前的大多数数据集正好符合这个特征），据说它的性能是非常非常好的。但是我本人目前并没有任何使用图数据库的经验。</li>\n<li>GraphQL 是查询数据的一种方式。它定义了灵活的 API 协议，允许你查询指定的刚好需要的数据，并且按需返回。至于数据存储技术采用什么，GraphQL 完全不管。这个我有一些经验。</li>\n</ul>\n<p><a name=Ffzl4></a></p>\n<h2>GraphQL 总结</h2>\n<p>GraphQL 和图数据库是两回事情，GraphQL 是一种灵活的查询语言，其优势并不依赖图数据库，所以放心地使用吧！</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBklEQVR42p2S0WqEMBBF/f+f6lOhbB+2CNWouIoKinZx1VVjTHLLjFj2YS20Fy6TGZJM5hDn9fQC3/+EHHscyVp7aNI4Sdy6AdMs4VyvDZLLBa7rIgxDdpZlSNMUcRwjiiKs6/pz8VFDY7YGDhUmqbAoBWsN1lXDaA2tNW/WxsAY8/R1j/VdDh18fzuhrmvc2hZaSQzjzGMURYH5FxSPov08Mt3eNF/wPA+BEAiEDyECnM8fPHaSxByrquJILsuSsfi+z3me50iSBF3XbyOTqEi8hAgxjhP6foBSKyNYloU5UtzXSilIKTmnNZkQODsLReyMxXCfIKVCexs4/lXOBtT+68s88zdNtWvhvQmJxgAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/1117d53b6f9ee12edf947afcd5e509ad/fcda8/1635309885666-1ffdcd5f-649e-470b-ad70-86d0734c6678.png\"\n        srcset=\"/static/1117d53b6f9ee12edf947afcd5e509ad/12f09/1635309885666-1ffdcd5f-649e-470b-ad70-86d0734c6678.png 148w,\n/static/1117d53b6f9ee12edf947afcd5e509ad/e4a3f/1635309885666-1ffdcd5f-649e-470b-ad70-86d0734c6678.png 295w,\n/static/1117d53b6f9ee12edf947afcd5e509ad/fcda8/1635309885666-1ffdcd5f-649e-470b-ad70-86d0734c6678.png 590w,\n/static/1117d53b6f9ee12edf947afcd5e509ad/efc66/1635309885666-1ffdcd5f-649e-470b-ad70-86d0734c6678.png 885w,\n/static/1117d53b6f9ee12edf947afcd5e509ad/c83ae/1635309885666-1ffdcd5f-649e-470b-ad70-86d0734c6678.png 1180w,\n/static/1117d53b6f9ee12edf947afcd5e509ad/4719e/1635309885666-1ffdcd5f-649e-470b-ad70-86d0734c6678.png 1330w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=OqhqF></a></p>\n<h1>前情提要</h1>\n<p>在 《<a href=\"https://zhuanlan.zhihu.com/p/423766959\">Free Arch：给 GraphQL 增加 CDN 缓存</a>》一文里，详细叙述了如何薅各种云厂商的羊毛，从而给 GraphQL 服务加速，以一个非常慢的的查询为例子，解决了其三慢合一中的两慢。</p>\n<ul>\n<li>服务器端慢查询</li>\n<li><del>AWS lambda 冷启动</del>，通过 CDN 缓存直接响应，多数请求不再打到 AWS lambda。</li>\n<li><del>Heroku 冷启动</del>，通过 AWS API Gateway 的自定义域名，不再依赖 Heroku 上的代理服务。</li>\n</ul>\n<p>其中服务器端慢查询并未解决，从而需要 CDN 预热。即正如前文所说的，请求量分布越广泛，请求量越大，该服务的整体性能表现越好。但是对于小站点来说，用户是零星分布在各个不同的地域。就是说尽管每个地域只要有第一个人访问了该服务，触发了该地域的 CDN 缓存建立，从而使得后续该地域的用户感受到极快的服务响应，但是这个小站点在该地域就那么一个用户，他的体验不好，就直接流失了，没有更多的用户来感受到后续的极快响应。所以反而是小站点更需要解决第一个慢的问题，因为它的用户发出的请求，更容易直接打到服务器。而大站点，多数用户的请求只到达 CDN 就直接折返了。</p>\n<p>今天就来解决这第一个慢的问题。</p>\n<p><a name=XgNUh></a></p>\n<h1>思路</h1>\n<p>尽管慢查询的根本原因在后端的代码，但是免费架构的思路确实从前到后去做优化。就是尽量在烂代码的前提下，提升系统的整体表现。在烂代码的前提下，改善了系统整体性能表现后，再去优化后端代码（如果追求极致的话）；多数情况下可能直接省略了烂代码的优化过程，毕竟，又不是不能跑，而且已经跑得很好了！</p>\n<p>CDN 缓存是最靠前的优化，今天往后一步，在请求从服务器端发出时做个拦截，将请求发出去时，同时将响应体写在内存里。这样，再有请求打到服务器端，就直接从内存读取上次查询得到的结果并发出去，从而避免执行慢查询。</p>\n<p><a name=glA66></a></p>\n<h1>启用响应缓存</h1>\n<p>使用 Apollo 的话，有官网可以参考。所以从编码层面不做详述，具体的实际案例的细节，可以参考这个提交：<br /><a href=\"https://github.com/Jeff-Tian/serverless-space/commit/45cce5614866b340c8fb08b8b911dc9294c2017e\">https://github.com/Jeff-Tian/serverless-space/commit/45cce5614866b340c8fb08b8b911dc9294c2017e</a></p>\n<p>这仍然是一篇免费架构的系列文章，因此重点会放在如何薅羊毛上，以及分享其他的小妙招。</p>\n<p><a name=ovzLI></a></p>\n<h1></h1>\n<p><a name=HQTMg></a></p>\n<h1>效果展示</h1>\n<p><a name=IbaBS></a></p>\n<h2>端到端体验（微信扫码）</h2>\n<p><span>fallback node</span></p>\n<p><a name=NPPn4></a></p>\n<h2>响应速度</h2>\n<p>通过 Apollo Studio，直接访问 AWS lambda API Gateway 的原始默认链接（绕过 CDN）：<br /><a href=\"https://jqp5j170i6.execute-api.us-east-1.amazonaws.com/dev/nest/graphql\">https://jqp5j170i6.execute-api.us-east-1.amazonaws.com/dev/nest/graphql</a>，请求慢查询，可以看到延时在 1 秒以内！（要知道，因为使用的是 AWS 免费账户，所以是 AWS 海外的 lambda 服务）<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABsUlEQVR42l2QTWsTURSG81NcCKKLahM79QMJmJQqiG7FH+Lf8DeIq4Kumqhpoi3VBoq06C7F2CRS02Q+MvdmPu7cuZM8MhPceOAsXjjnOe97Sta9R2zef0zZqlO2tlirPOTG2gOuXL3NtesWd6wqG1ad9Uqd8s0alc2tYu5Wucq6tc2GVeNu9Rm17ec8ffKC0sdOl2brK+3946IPvpzQ6hzR7Z7y+l2Xl6/22Nk9otE6pNE+otnp0j48oX3wjfb7z7San9h9s8Pe2wYf9o8p+TJgJgS+lJjFgn+1BLIlJMuViKUgFoLUviT785vsYoge/cIM+6hBn0wp+oMBpXkY4/pzPF8ig5hIJWRZhjYGWEAgSKaXjHs9pmc9pO3guzOk5zN2fWZRgog1yiw4/f6DUhgnTBzB1PUJIkWcaLROMSYjNQatFCrRTGYSRwQEKmUeJQSxZup4CBkwDyKUNpz97OcOFbYnClgQJcRKE4ZRAdWpIdHpCmi7ON7qaJ4k38uBvgyRYUyUpJwPRyvgxcRjPLGxPb9w+H+lJmM8cbDdGXmi/E05eOrMEPOo0HFiOB+M+Avfl+CbG1h0bAAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/9c44cd10cd63052d93fd7b980d1d6095/fcda8/1635337730382-83860f2f-f176-407d-82bd-8468e7b3a85d.png\"\n        srcset=\"/static/9c44cd10cd63052d93fd7b980d1d6095/12f09/1635337730382-83860f2f-f176-407d-82bd-8468e7b3a85d.png 148w,\n/static/9c44cd10cd63052d93fd7b980d1d6095/e4a3f/1635337730382-83860f2f-f176-407d-82bd-8468e7b3a85d.png 295w,\n/static/9c44cd10cd63052d93fd7b980d1d6095/fcda8/1635337730382-83860f2f-f176-407d-82bd-8468e7b3a85d.png 590w,\n/static/9c44cd10cd63052d93fd7b980d1d6095/efc66/1635337730382-83860f2f-f176-407d-82bd-8468e7b3a85d.png 885w,\n/static/9c44cd10cd63052d93fd7b980d1d6095/c83ae/1635337730382-83860f2f-f176-407d-82bd-8468e7b3a85d.png 1180w,\n/static/9c44cd10cd63052d93fd7b980d1d6095/647f4/1635337730382-83860f2f-f176-407d-82bd-8468e7b3a85d.png 2682w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a name=n89Qb></a></p>\n<h2>请求头</h2>\n<p>缓存控制被正确设置<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9be6aa515bc59cf105631fed0fb93b39/5b30f/1635337959300-e34b616a-d677-4f0b-a348-b54f8f8ba927.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.486486486486484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABhElEQVR42l2Q62oTQRiG9x78IxQM1JRstgWl2GpRwYvxMryC4u/iD9HapukiPUmtxHtRmm6q2Rz2kNlDZvb0yGyslg4888H7zTvzzmeYa88x116w0n7Gw9bTmkbzCUuNR9y7b7L0YBWrvU7b0v1NLPMlzeYGq49f0VheZ6W1wXJrC9PcxLK2MOyjHh37Avv4Owefv3F41ENru50zjk97vH13yus3XbZ3TtjdP2Hnvc3Hgy986p6zb1+wd/iVve55XT90zjBCERPMBF4QkuUFd1eaQ98DBeSZIhIRUkqUUv9qWZaUQFaUGF4gmPohEy8gmMWEIkHKDCkVIk6pSn20oswVE8dheOXwu3/F9c8+zo9Lfl06eIMB4Syq/UYylwQiYTD0EHFClEryW0kroKyqWpv5Ae7QZeS6jIYTxu4Uf+zhjX1EPCdOJYbedMLRNCBKFmI6lyRJWqfUzP+iH7uNSP5z4zV049r18UOBnqf+pjbr2eRFQVEUZFmOUtnCdJf0hsWlfwBfSNrRC73pJAAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/9be6aa515bc59cf105631fed0fb93b39/fcda8/1635337959300-e34b616a-d677-4f0b-a348-b54f8f8ba927.png\"\n        srcset=\"/static/9be6aa515bc59cf105631fed0fb93b39/12f09/1635337959300-e34b616a-d677-4f0b-a348-b54f8f8ba927.png 148w,\n/static/9be6aa515bc59cf105631fed0fb93b39/e4a3f/1635337959300-e34b616a-d677-4f0b-a348-b54f8f8ba927.png 295w,\n/static/9be6aa515bc59cf105631fed0fb93b39/fcda8/1635337959300-e34b616a-d677-4f0b-a348-b54f8f8ba927.png 590w,\n/static/9be6aa515bc59cf105631fed0fb93b39/efc66/1635337959300-e34b616a-d677-4f0b-a348-b54f8f8ba927.png 885w,\n/static/9be6aa515bc59cf105631fed0fb93b39/c83ae/1635337959300-e34b616a-d677-4f0b-a348-b54f8f8ba927.png 1180w,\n/static/9be6aa515bc59cf105631fed0fb93b39/5b30f/1635337959300-e34b616a-d677-4f0b-a348-b54f8f8ba927.png 2372w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=azsRe></a></p>\n<h2>Redis 缓存的内容展示</h2>\n<p>后面会详述如何使用免费的 Redis 服务，以及为什么需要使用公开服务展示 Redis 的缓存内容。</p>\n<p>访问： <a href=\"https://uniheart.herokuapp.com/redis\">https://uniheart.herokuapp.com/redis</a> 可以展示 Redis 的缓存内容，可以看到慢查询的结果被正确缓存了，并且以 Apollo 默认的 fqc:xxxx 作为键值：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.513513513513516%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZUlEQVR42j1R2W6CUBTk62sT20S9WI1xSauxS9I/MRE3wIuAC7hEhRf1wQenmdPAw8nZZubMBaOtFFqqgtrrCyrPBZQLT1DFIpSqolQqwzTfUFEmTLOKZqOBVrOFmqqj0+6g2+3h472Lfq+Hr/4nfr9/YASBD09rhEGArHYdB7PZDLZtS/Y8D3EcIQgCWJaF6XQK13URhiG01jK3HRtJmsIYDAaYTCYCGI/HEsOhlRMoOp/PJTijOGfZXGtPBA+HA67XKwzHcWS5Xq/h5CANzglcLpdYrVZS0xlx2X6xWMg+jmPcbjc8Hg8YURTB9315GsGs6YJBEoNH2NMhRTMhzpnJS9MU9/v93yEv0gVJBPCpFCaRh0ajUZ45pwmKELfdbqVmvlwuMAig2PF4FOt8GvvNZiN9kiSyy/rz+Yz9fp+b4Iw7HiHWoAAJtLzb7cQlgSQxTqeT7FmTTDfM/AkMcrgjht/xDw1qMZjGgGCuAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/5852a96e6bfec8a48a073af2bd31b44d/fcda8/1635338521823-c0cc06fb-b84e-44fb-a725-11ba62a30bf3.png\"\n        srcset=\"/static/5852a96e6bfec8a48a073af2bd31b44d/12f09/1635338521823-c0cc06fb-b84e-44fb-a725-11ba62a30bf3.png 148w,\n/static/5852a96e6bfec8a48a073af2bd31b44d/e4a3f/1635338521823-c0cc06fb-b84e-44fb-a725-11ba62a30bf3.png 295w,\n/static/5852a96e6bfec8a48a073af2bd31b44d/fcda8/1635338521823-c0cc06fb-b84e-44fb-a725-11ba62a30bf3.png 590w,\n/static/5852a96e6bfec8a48a073af2bd31b44d/efc66/1635338521823-c0cc06fb-b84e-44fb-a725-11ba62a30bf3.png 885w,\n/static/5852a96e6bfec8a48a073af2bd31b44d/c83ae/1635338521823-c0cc06fb-b84e-44fb-a725-11ba62a30bf3.png 1180w,\n/static/5852a96e6bfec8a48a073af2bd31b44d/7ebf9/1635338521823-c0cc06fb-b84e-44fb-a725-11ba62a30bf3.png 1919w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<blockquote>\n<p>这里为了方便在线展示，复用了几年前的免费服务。如果被滥用，以上路由可能会被加上锁。</p>\n</blockquote>\n<p><a name=L6med></a></p>\n<h1>免费使用 Redis To Go 的中转方案</h1>\n<p>正如 Apollo 官网所说，启用响应缓存，可以使用 Redis 或者其他内存数据库。这里发现一个好的在线 Redis 服务，Redis To Go：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2bce5575d194f3a263bbbde50476346c/c88ae/1635338666871-0c8afeb8-e729-4204-94fe-9f9773c93b41.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.78378378378378%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABz0lEQVR42mXQXU9SAQDGcT9AdzHocA4cOCC1sBUvBifOqdDMNLtgq0FJa71K6qAtmsvwqktrrEWzdVlXtVZrIW3O9TKsQS3NMkTHRq7Xq/oI/wJvXF7899z9Lp4Wt3sHbds8uFxbsdtbsSsuFGUzDsdqNsWFZ4ubaCjEYVUl4vUSVVU0r59AYBdBfwjvdj+BoIa7zUOLJNlpZLEoWK2OZmazzCbBiiBYMRglPEorF7v2keoIM7jTT0ILIQsWNmwUMJpEjEYJk0lqGi2y7GRtDbDdr6Jre9H1cHODQR1fUMMX0GhXdU5FjzLUHyfVH6djTye79TA+b2AVbABrQbNo49qxGC9G0+TPnqBw6QJPhweYSiaYzozwbPgc5atjzOWyvBkbYTKZ4GU6yeWeboyibT0oijbu3JpguVqlvrhIqVhkuVJhaX6et6USK7UacwsLfKgu8ev3H8ozM3yt18llb2AwCP+BVgeS7ORu9jpf8g/5PvuOz4Un1PKP+PZxlk8P7rFSfE7t9Ssqj+/z432ZylSBn9OT3B4fx2CS1oMW2cmR3oMM9vU2fxqKxRg41EcifpyT+7s4E4lwM3OFiXSKXGaU89EYpw900xPuRPz34V8nzxv7uYVVqAAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/2bce5575d194f3a263bbbde50476346c/fcda8/1635338666871-0c8afeb8-e729-4204-94fe-9f9773c93b41.png\"\n        srcset=\"/static/2bce5575d194f3a263bbbde50476346c/12f09/1635338666871-0c8afeb8-e729-4204-94fe-9f9773c93b41.png 148w,\n/static/2bce5575d194f3a263bbbde50476346c/e4a3f/1635338666871-0c8afeb8-e729-4204-94fe-9f9773c93b41.png 295w,\n/static/2bce5575d194f3a263bbbde50476346c/fcda8/1635338666871-0c8afeb8-e729-4204-94fe-9f9773c93b41.png 590w,\n/static/2bce5575d194f3a263bbbde50476346c/efc66/1635338666871-0c8afeb8-e729-4204-94fe-9f9773c93b41.png 885w,\n/static/2bce5575d194f3a263bbbde50476346c/c83ae/1635338666871-0c8afeb8-e729-4204-94fe-9f9773c93b41.png 1180w,\n/static/2bce5575d194f3a263bbbde50476346c/c88ae/1635338666871-0c8afeb8-e729-4204-94fe-9f9773c93b41.png 1541w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>正如上图首页展示的，官网没有免费选项，但是免费架构教你如何免费使用 Redis To Go 的服务。很简单，去 Heroku 里创建一个应用，然后在这个应用里添加一个 Redis add-on，选择 Redis To Go。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9a0e5203488c7fdd27125b89ddf9d7f9/b97f6/1635338796244-b8a6a5c1-2475-4489-9a76-419c0cf32c66.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.27027027027026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+0lEQVR42p2SS28TMRSF83tpqKCQQkvgxyGxAQQLClmgCkJbOtPMxPb4ff04yJ4kVdR0g6VPtjzXx+eM7+TZ6TlOX5/h+clLvJm/xXz+Dmfnc8xmr3DyYobp9BhPjp4e5KgwPa41WyZdb8E6BWcI/zM8JVgf4HyAdQET1isIbiAHByn36VcKbK0hpUW3kuBMQ2mPQboNFlwYsIqu88RulI2jeyzVG5uGY7m8q6LNDcenLwssfi5BxZWjes75LXF0GGJCfAStHbRyUNrCWA8+aIhBQxtXBcteoaylsogpYwLkB/8l53HPl5sdgYgQQqhQKG48vKfdTJ7gva91k3L4EGUobcAYBxcCq65Hv2ZQqjg0FakUtDbgg4KQxb08JHjvUFtXCxmX+Hpxid9X7ZggBCQauyLEDKYS1iqCIkbBXcytaNlIEdISOm6wblbo2x5mkKUS6voPmu8/0DGFVbtG1/HqNOW0L7gX2WiIxTdcfXiPdduhv/kLPwhkKWAZg3YB2vgd5YUpxMcFs5Kwt9cQvy4hux6ivauCSQqQHEAxgyhWkRBiXZfO2I+8Fa6RE6yxNUpz2+Lj5wu0zQrIaVdb6wEIk8B1gg/5oeBe2xBhKK9XHkZIhBgPpin954vTGB9xuFmXvirtYWxpZI8YY/2WUkbKG1IaLw8OFAj/AP2qJGQ/Y7wAAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/9a0e5203488c7fdd27125b89ddf9d7f9/fcda8/1635338796244-b8a6a5c1-2475-4489-9a76-419c0cf32c66.png\"\n        srcset=\"/static/9a0e5203488c7fdd27125b89ddf9d7f9/12f09/1635338796244-b8a6a5c1-2475-4489-9a76-419c0cf32c66.png 148w,\n/static/9a0e5203488c7fdd27125b89ddf9d7f9/e4a3f/1635338796244-b8a6a5c1-2475-4489-9a76-419c0cf32c66.png 295w,\n/static/9a0e5203488c7fdd27125b89ddf9d7f9/fcda8/1635338796244-b8a6a5c1-2475-4489-9a76-419c0cf32c66.png 590w,\n/static/9a0e5203488c7fdd27125b89ddf9d7f9/efc66/1635338796244-b8a6a5c1-2475-4489-9a76-419c0cf32c66.png 885w,\n/static/9a0e5203488c7fdd27125b89ddf9d7f9/b97f6/1635338796244-b8a6a5c1-2475-4489-9a76-419c0cf32c66.png 958w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>然后你就可以从环境变量里读取链接字符串，形如：redis://redistogo:<a href=\"mailto:password@hostname.redistogo.com\">password@hostname.redistogo.com</a>:9295</p>\n<p><a name=KdZeH></a></p>\n<h1>Redis Insight 小妙招分享</h1>\n<p>Redis Insight 是一个 Redis Web 控制台，使用它可以方便观测 Redis 服务器。要启动很简单，可以参考如下 docker-compose 文件：</p>\n<p>yaml\nversion: 3\nservices:\nredis:\nimage: redis\nports:\n- 6379:6379</p>\n<p>redisinsight:\nimage: redislabs/redisinsight:latest\nports:\n- 8001:8001</p>\n<p>然后执行：</p>\n<p>shell\ndocker compose up -d\nopen <a href=\"http://localhost:8001\">http://localhost:8001</a></p>\n<p>接下来是一个小妙招系列。打开 Redis Insight 后，添加 Redis 服务器时，会看到对话框中分开给予了配置项，但是我们拿到的是一个连接字符串。我曾经准备给 Redis Insight 提改进意见，让它直接接收连接字符串，从而不需要手动去拆开连接字符串。但是实际上 Redis Insight 是支持连接字符串的！只需要复制连接字符串，然后在对话框里粘贴就行，它会自动拆解：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 386px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/148af8536467d79b25ca0044a3f9f548/7bc0b/1635339263887-55731036-72af-4a85-96e0-e6ba12279af9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.51351351351351%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1klEQVR42p2TbWvbMBSF/f9/SWEfRvdxKwz2Zc1GNih9XZPQ2nmzLVtJ/CLJkvwMq11IOjpYBcdI11eHc3Xujba7Cq01w+r7PoABb1zRY7JEbqqjoAe6Ises5nQixVmL73u8/zcGMZHWHfPFmlxIclFSCIkFtuNzyo8fkF8+oXYVxnq0sWjj/oLpHEpbnPNETauJ4znLVUoyX5HlBdb1TwR1g5IS48EYGy6+BmUsdiDMC0kmSpz3+5KtdU9liww1uw975xze+5A3KBn2A6xz+3MoOctLlus8BMP7HRji5o+424unuHNHXr207Y+h0UAkpSTPBVJuqOuG9TqllBvSJOHn13OqpkVrQ9uqkDMafacoSoQoODv7zPX1LUrpoD6qm5abmzs2my3j8Q9OTt4xmUyZTmfEyYK7+ynLxZKHhziQDS2WZRnGGKqqYjT6FnKHJwmEvXcUeY6zHZcXF5y+P6UzGlkWAVo11NWOshB0Rh2XeFBy19mAKNta8p2n2HVsNegeytpR1B7ZeETlwllUniF301j63j/3nt+bte/DdGu5Wygma8110nIV18xSxWXchvgs1fxaKq6SNvyPhXlW+MqkvGW8wnjS7509RDR8/H/iaO5fKPwN7dXuyoYzPLIAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/148af8536467d79b25ca0044a3f9f548/7bc0b/1635339263887-55731036-72af-4a85-96e0-e6ba12279af9.png\"\n        srcset=\"/static/148af8536467d79b25ca0044a3f9f548/12f09/1635339263887-55731036-72af-4a85-96e0-e6ba12279af9.png 148w,\n/static/148af8536467d79b25ca0044a3f9f548/e4a3f/1635339263887-55731036-72af-4a85-96e0-e6ba12279af9.png 295w,\n/static/148af8536467d79b25ca0044a3f9f548/7bc0b/1635339263887-55731036-72af-4a85-96e0-e6ba12279af9.png 386w\"\n        sizes=\"(max-width: 386px) 100vw, 386px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/89331480428eca24bb289de0dc59d1be/b5a09/1635339304122-4aac1cd0-93ec-4dd7-8e9c-47f3633ba453.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABs0lEQVR42n2Q225SQRRA+Sjjuy8mbWzTKrRF2waUc6HlcpgzNP0Foy9GH0xjLGB90oKfogj1F4zGBIVT4NyWmaEHlRInWdk7OzNr9t6pfGGPfPERRtkkZz9kz8iRLxY4qNmUhE3ZLWI7RayqwsasWgvYc4yKRSpj3idjZEkbWTLmjC0zy63tHW5u7HBjLc3q7j02cmnu7G+ysrvO6l+sPFibs57bJFWXxyxyVD9me19y+67EEs94/uIVJy9POH3dpNV4Q/O0RVPFxhmNRktz1nrLk8dPSdWEZBlOtcSRrPLl4iPj8SWDwQDfn+p86vv4Kg5/Mv014PLbV9Rpdz4sEbp1hJC4rsRxBL3eBcmZTCZ4nkcQhhAERN6IyBvi//j+RyiU4AolTKJTE5QrDr1eX18OgoDxeKzzMAyJ4pgYNGEc6/p5u/2vULiqy1mUUiKEoN+fdRjHsRYNh0NGo5HOVU3Xg0Df6XQ61zucCeuUKhKr6OiRVQNKoMaNr7pJPkk+0iO3/yM8OKxQMGw+dT8z9cN5d0qacE24bIfJHssVgWkd0u32CIJQ7zCKIv04YVH47n2b3xwrS8rBYqiWAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/89331480428eca24bb289de0dc59d1be/fcda8/1635339304122-4aac1cd0-93ec-4dd7-8e9c-47f3633ba453.png\"\n        srcset=\"/static/89331480428eca24bb289de0dc59d1be/12f09/1635339304122-4aac1cd0-93ec-4dd7-8e9c-47f3633ba453.png 148w,\n/static/89331480428eca24bb289de0dc59d1be/e4a3f/1635339304122-4aac1cd0-93ec-4dd7-8e9c-47f3633ba453.png 295w,\n/static/89331480428eca24bb289de0dc59d1be/fcda8/1635339304122-4aac1cd0-93ec-4dd7-8e9c-47f3633ba453.png 590w,\n/static/89331480428eca24bb289de0dc59d1be/efc66/1635339304122-4aac1cd0-93ec-4dd7-8e9c-47f3633ba453.png 885w,\n/static/89331480428eca24bb289de0dc59d1be/c83ae/1635339304122-4aac1cd0-93ec-4dd7-8e9c-47f3633ba453.png 1180w,\n/static/89331480428eca24bb289de0dc59d1be/b5a09/1635339304122-4aac1cd0-93ec-4dd7-8e9c-47f3633ba453.png 1360w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=wgASU></a></p>\n<h1>总结</h1>\n<p>通过 Heroku 免费应用的中转，成功薅到 Redis To Go 的 Redis 服务羊毛。启用 GraphQL 响应缓存，使得在没有 CDN 的情况下，也能改善系统的整体响应速度。结合前面的 CDN 缓存，解决三慢合一问题，既优化了第一个用户的体验，又优化了后续其他用户的体验。</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}