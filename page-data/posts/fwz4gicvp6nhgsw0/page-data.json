{"componentChunkName":"component---src-templates-post-js","path":"/posts/fwz4gicvp6nhgsw0/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/fwz4gicvp6nhgsw0","relativePath":"posts/fwz4gicvp6nhgsw0","frontmatter":{"title":"架构整洁：增加代理层解决一团乱麻的问题","stackbit_url_path":"posts/fwz4gicvp6nhgsw0","date":"2023-02-16T11:52:46","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<blockquote>\n<p>计算机领域的任何问题都可以通过增加一个间接的中间层来解决……除非是中间层太多了。</p>\n</blockquote>\n<p><a name=dNWzh></a></p>\n<h1>什么是一团乱麻问题？</h1>\n<p>两个层之间分别有多个应用或者服务，而它们之间存在多对多的调用关系，如下图所示：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f9ee36c810e3f372d08df37b82abae19/3126c/1676347893891-5bf8f6d0-c72a-4876-8c83-789d7be21561.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.5945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACA0lEQVR42nVT247iMAxNSQul7Mww7EJjF/ECAhXRW9IU/gC+g/9/5nl1uskoO9JEcuM69kmcnCOYecLMws2jT0QTIhLOl24d/pf5mK8pimL08fnNzC0zMxFFrjBm5gMzN0SUfQOU4YbMjJojM9dE9I7AGxEBFIX+NDERrWDMnAanBdCCiKYBIDb4Q0RLZp6J9XodWWvHdouiiPI8F1mWiaqqJsaYyWq1iqqq+q/d0LbbbbTb7UTbttgsEl3XiaZpFk3TyLqu4QMMc9I0Tda2rcAwxozx/X4vjsejsNaOuaip6zpGLv7Hhb7vY2PMvOu6SGstDocDAGLEtdYTxL4bNnA+Okn7vk+GYRA+KLXWkTFmprVeaK0xTzEbY6bOUq11prVOnc1hWHO1cuzmer16QOkAUgfoQZMAwMc9qP9HF7IsSzHegbUW7aW+lb7vfSyx1kZu05/ajlBrrU3GO3w+nwD9VZZljAfCPeDol8tlhvj9fhev12t8gODexsfERsg9n89JXdeLx+MhhFJK3m43UAbUkaBNnufydDpJ0Gmz2UhQw9PEj0Ap4G40DANok4wkVkq9O3VIR9iJUgqEfkOyV0YIGICiJlNKzZn5Uzi5fQYyihxoyswf0KiTG7r5Ags0jfwFM0NBSwSX9G8oZk5cIqS1ISLo+wNAsPCEgVoSl6uIaP0XRSx8ZmAIv8YAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/f9ee36c810e3f372d08df37b82abae19/fcda8/1676347893891-5bf8f6d0-c72a-4876-8c83-789d7be21561.png\"\n        srcset=\"/static/f9ee36c810e3f372d08df37b82abae19/12f09/1676347893891-5bf8f6d0-c72a-4876-8c83-789d7be21561.png 148w,\n/static/f9ee36c810e3f372d08df37b82abae19/e4a3f/1676347893891-5bf8f6d0-c72a-4876-8c83-789d7be21561.png 295w,\n/static/f9ee36c810e3f372d08df37b82abae19/fcda8/1676347893891-5bf8f6d0-c72a-4876-8c83-789d7be21561.png 590w,\n/static/f9ee36c810e3f372d08df37b82abae19/efc66/1676347893891-5bf8f6d0-c72a-4876-8c83-789d7be21561.png 885w,\n/static/f9ee36c810e3f372d08df37b82abae19/c83ae/1676347893891-5bf8f6d0-c72a-4876-8c83-789d7be21561.png 1180w,\n/static/f9ee36c810e3f372d08df37b82abae19/3126c/1676347893891-5bf8f6d0-c72a-4876-8c83-789d7be21561.png 1876w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>这样，如果有n个应用，m个服务，相互调用的关系就是 nxm 的规模。而且，每当增加一个应用，都需要 m 规模的开发量去分别对接上层的服务。而每增加一个服务，也需要改动 n 规模的应用。\n<a name=D3BC7></a></p>\n<h1>解决方案</h1>\n<p>通过引入一个代理层，将上层所有应用的请求收拢至一个点，然后代理所有请求至下层的服务。这样在层数上增加了一层，并将一个多对多的映射关系，变换成了分别是一个多对一的关系和另一个一对多的关系，如下图所示：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fac522cbbb7b76e6d1fa217221926c87/8b936/1676348325920-6fc3fbe4-80b3-41a7-a220-87ae164fae3f.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 130.40540540540542%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAC0UlEQVR42p1VwU7jMBCdxMmywBa629DGU1raAgHSlGAngDgggRBfwYU7/39fPWtcmRK0C5ZGju2Z53E8z4+YWWmtY/TMjJ7Qyxws0VpTl3lfsQg9Fn4zs9FaT4MFgBfMXGutezLngRLZjGQuZeaSmSut9T4md/Chtf4pQCRZ7wvYVgAYaa1/AQTg4/GY5AR9rfUufGkwGFBVVfHh4aHbNc9zOjg4oOPj42i5XKrRaBT1+30ajUYfjjwcDp3/2dkZLM6yLKLlcglL6rpWq9UKQOTbarVKb29vo6Zp6ObmxoEiq6OjI3p4eKCTkxP4wFRVVUlZlkS9Xo+m0yk1TZNYa+PLy0sXbIyhu7s7stYmAIRZa9eGMRpiEDubzVy2bhEAyNRaqwQAfSQgqmmaKATDmsw7XwADw2+y3jEMgKMAKwn24Em4iQdZg4Vt80hiAPiBzCWzdwl0AnUBw/H6+tr1bdvutm2r2rZ1c/8NtNlwa+fn51QUxfZisYjn87m7wG811CRKZDweR/jhWZa5i0PpfKsFBZwwc8bM/bCovwsG9oBmc2YeCiW/DuqPO5lM4jRNo6enp+T19RVUc/8Ra19qj4+PjlJFUQAUrNk1xiQXFxd0f39PV1dXuPl/A4W1hR70s9amqEFjTBwU+AcKdtZd6OyZIoXtWRFLgccdBPiUHe9ABGCTnh5YbZ5qk/AgexQ4KT/uenEC4DUl6eXlxf1kLLy9vbkgMASPJzKo65qen58//UXySrlTuAZqGWNcJrhFOOEFxq64WfdoErlSCcXp9PTU+SIGFwZfVAWolFRVpSaTCYpW4ZHM8zyezWaqLEtIgAL9ApFag4oEqMVioSAXeZ6nXmR6Ijxr+YRoQZAgUNgoANzCWL4jiYFwQcwyT68BgJGdD2ZmqOCfQAU9wI5IqYvF0w+FZOZtrbUDhPztwURjXdYy3pP1ziML71OJx2kGfwGb8738cbvPewAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/fac522cbbb7b76e6d1fa217221926c87/fcda8/1676348325920-6fc3fbe4-80b3-41a7-a220-87ae164fae3f.png\"\n        srcset=\"/static/fac522cbbb7b76e6d1fa217221926c87/12f09/1676348325920-6fc3fbe4-80b3-41a7-a220-87ae164fae3f.png 148w,\n/static/fac522cbbb7b76e6d1fa217221926c87/e4a3f/1676348325920-6fc3fbe4-80b3-41a7-a220-87ae164fae3f.png 295w,\n/static/fac522cbbb7b76e6d1fa217221926c87/fcda8/1676348325920-6fc3fbe4-80b3-41a7-a220-87ae164fae3f.png 590w,\n/static/fac522cbbb7b76e6d1fa217221926c87/efc66/1676348325920-6fc3fbe4-80b3-41a7-a220-87ae164fae3f.png 885w,\n/static/fac522cbbb7b76e6d1fa217221926c87/c83ae/1676348325920-6fc3fbe4-80b3-41a7-a220-87ae164fae3f.png 1180w,\n/static/fac522cbbb7b76e6d1fa217221926c87/8b936/1676348325920-6fc3fbe4-80b3-41a7-a220-87ae164fae3f.png 1368w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=OtvzS></a></p>\n<h1>这样有什么好处？</h1>\n<p>这样，通过引入了代理层，就将上层应用和下层服务解藕了。它们之间不再直接沟通，而是通过代理层中转。这样的好处是，每当增加一个应用，该应用只需要和代理层对接一次，就能享受到所有 m 个服务；而同样，当增加一个服务时，应用层完全无感知，不用做任何修改。</p>\n<p>所以，引入这个代理层带了一点点复杂性，但是同时却节省了大量的开发量！这个解决方案，不仅仅是让架构图看起来更清晰和有条理，更能让实际的开发效率翻不知道多少倍。\n<a name=DK96O></a></p>\n<h1>案例1：身份认证代理</h1>\n<p>通过引入身份认证代理实现的身份认证功能开发上的效率碾压，实现了软件开发中的身份认证自由。显然，几乎所有的软件应用都需要身份认证功能，而为每个应用单独去实现这个功能，不仅乏味，且很难在短时间内对接众多的不同身份源。然而，通过引入身份认证代理，每个应用就只需要集成一次，便能立即对接到这个代理之后丰富的身份源，并且，每当有新的身份源时，只需要在这个代理中集成一次，便能赋能到每一个前端应用。</p>\n<p>其实，我回顾了一下最近几年写的文章，大多都是在介绍一些具体的身份认证代理实现细节。</p>\n<p><a name=BRRDO></a></p>\n<h2>Authing</h2>\n<p>身份云 authing.cn 是一个 IDaaS，除了对接外，没有额外的开发量。我自己做了一些例子：\n<a name=DLfDg></a></p>\n<h3>哈德韦的个人小程序</h3>\n<ul>\n<li>Web版： <a href=\"https://taro.jefftian.dev/pages/subpages/auth/authing\">https://taro.jefftian.dev/pages/subpages/auth/authing</a> <br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 89.86486486486487%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADGElEQVR42pWS7U9TZxiH+7eIL0OHrioyt7ipUTAadeLLwMWv+mVOkVooxgi1uplsQ6ygM1Gi7oOJYyYmiwlkYsJrNp0DqqBEosHTlr6cQ4s97Xm9TM8BlKTFeCe/3Pdz8pzree7f/TiKVqxk1eoS1n21gS++XEfxmrUULXdaWr5iJZ8WOWfXixYXUrBwCQULP2FBweKcchytqsbtrqWm1kNNjceqXS63reNuql3HrfpYtYvvD//AkaNVVFVV55Xjpx99XPSfx9/UiP9CIy3NTVxqvjBHl1v8+Jt+wec9hb/pV367dJHLLfb3GWX3NfvP49h36Ax7D/os7Tl4mrL9J9hc4WHTt7VWfl+llXWUVtTZ9UyuzNYeth44yb5DPhzO7Q04dzTw2fZ6ind5abzWzo07vdy408f1P3tp/aOb1raeaXVb62u3u7h6u8uqr9zqorWtH8/PbSwtO4Hj83Iva3d7Kf6mno3fnSU5lSIbJjr5wtQVJiURDBXThJ5haO9+RtGWGhwl5Q2UlHtZvbOeryt8hCKThMNR9u7cw+B/jyyAYZhzgKqqoSgqiqqhaRqqDn89GGJZWQ5gJJ4kGoni857j3r0OBgPDCMEwghDi34ePGR4ZnQPXdMPKD/qfULh5DvAU6yvPEJwQMXSN56NjjIw8JxB4Sig8wfi4wP8DAV6MvXzXummiTwM7+56wtDQHUAjH7bZ0SMiQ1uyf5XTGyrphIEkJVFW192k2sKN7iEUbXbmBWcdCMZVXYZVgTMMwdGRZJpPJoKkKKVm2vNN1nYyiWMDHgTHLsrw3NMx3g9AMkzeqSVIxiKVmpm+STCYRBIFgMIQkxnGd/X0eoGFaHmXjpaTwNCwTeJ1iKCwjJBQLmE6nSSanwNTo7B3Aua1ufmA2FM0gktLoHJS42RFEiKtIsjF72MxQ/u4JsGST+8PAbOvjCYX+0QR3+2L8I0QR5KmcUy6cb8p2y7Zb0ZSO8EZHVqEtMkC7ODh9mDELvN+X5x3m8lBVMgQnokzEREQxjjL9ZN6/4UcBs+bH43EmJQlRFK0nkw/4FqY+UQTu6LIrAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/df5fac5cf1a9f0669b6d545a71786973/fcda8/1676520738814-7463aed9-06ff-445c-b71a-f5d0921f21da.png\"\n        srcset=\"/static/df5fac5cf1a9f0669b6d545a71786973/12f09/1676520738814-7463aed9-06ff-445c-b71a-f5d0921f21da.png 148w,\n/static/df5fac5cf1a9f0669b6d545a71786973/e4a3f/1676520738814-7463aed9-06ff-445c-b71a-f5d0921f21da.png 295w,\n/static/df5fac5cf1a9f0669b6d545a71786973/fcda8/1676520738814-7463aed9-06ff-445c-b71a-f5d0921f21da.png 590w,\n/static/df5fac5cf1a9f0669b6d545a71786973/efc66/1676520738814-7463aed9-06ff-445c-b71a-f5d0921f21da.png 885w,\n/static/df5fac5cf1a9f0669b6d545a71786973/798d4/1676520738814-7463aed9-06ff-445c-b71a-f5d0921f21da.png 976w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></li>\n<li>小程序版：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 430px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8e19a35a0376a332670865c3da0f9a18/05ed2/1676519903213-e32a7aeb-0741-4dba-a703-2c56695514c5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEGklEQVR42m2UXUxbZRjHGxMvvdmNXposUTOXxezCmHmliYkSE82WSJaZzLjMwVbULZUQNeLHNhIj4rZa2GjpEUpbKFhb+gntaSmclh76Iee05XxwoKcttOeU9iA5Z6VtDq9hJYjG/9WbvO/vefLkef9/BTim/f19AECz2czlcrIsVyoVu92ez+dbVy0df684TsqyDACIx+NKpZJlWY7jYBimKKpSqQiCUK/Xjxr8Ax9hgiBwHBcOh9VqdbVaXV1dRRBkZ2fH5/NVq9VyuVwqlQAAsiy3SiiOikUiEa1WOzExUa1WTSYThmH1en0+FHI6ncPDw7VaTafT9ff3u91uSZJalKI1ZCQSMRqNBoNhdnY2n8+XisXNQt7lcpEE8ejhkNvtYhgGhmGr1QpBEIqi1Wr1sHM4HFapVMFgkOf5RCKh0Wi8Xu8mx4XjiRCKRv9cWWcYURS3traKxaLP54NhmCCIZrN5CGu1Wp7ns9lsIBCYnJxg2UJ37+2TL5168dTLFzu7YBzzwX69Xp9Kp1OpVLFYJEmyXq8fwCzL7u7uSpKEYbhep2O5yu3+Byeefur862cvvnnuhRPPnG9vZ8t8GEHMZrPFYgEAhEIhFEUVCwsLBoMhnU5nMpmlSNjhmZtbSp85fUbb1b5lHSo5dL67yldOPm/zB9hczulwYDhOkiSKooIgKHAcFwSBJMnRsbGF+eBcJP5oZuGN11794sLb31z+4KeOD29daHvr7OlvBwexNZoiyGQyKYri4Z5Zlp2ZmREEgaLoedg3v0JMxZn7ysvmnqvWXqVJ9fF4T8fQJ+8/uPP9bDRm/X0aQZByuVwoFGiaVmSzWQiCNBpNOBzxul2haGw6yY7d7Vn6+dPZH5TT3R3ILyrDrUvdyg5/IJDC8Wg06nK5CIKYmppS8Dw/MjJC03Qul1tGUZpZt5vHv+r8aGLgy/hAd7y/x3Gn8922c9d6r+DpFTydWk7Eomg0FAp5vV6FLMu5XM5oNGIYVi7zNrv9j0mzVacevd+n7Xrv12ttfVfe6fvxO2/Q4/F6gQxSaFLY2WEYptFoHKzK6XQODg56PB5BEAiCWI7FMiSZjCIB00M3NJBadCUSyXsD9yiaUvPwTdYUE9YIPCNK4gEsSRIEQWq12m6322y2jY0NlmXXGMY24yBpOoour6TwkNvfixkV85euZoZVjIlv/HX4PVuWahnA4/EUCgW/37+4uLi9Xd7cLAQD8Gc3PyeTqa/z09cJfQc58hxygxS3/uVnURQ5jgMAaDQak8kEACBJ0mKxsCyr/w1iCDojFjop/bPI9RsUdOAqsK/4T4wUi8XR0dHt7W0AwPr6eitGSJIcN47TBFkG0ppU+p8kaanRaOzt7bUOtVotk8lQFNXipcePnzQBT6LgIAz+BoU5shQZQWADAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/8e19a35a0376a332670865c3da0f9a18/05ed2/1676519903213-e32a7aeb-0741-4dba-a703-2c56695514c5.png\"\n        srcset=\"/static/8e19a35a0376a332670865c3da0f9a18/12f09/1676519903213-e32a7aeb-0741-4dba-a703-2c56695514c5.png 148w,\n/static/8e19a35a0376a332670865c3da0f9a18/e4a3f/1676519903213-e32a7aeb-0741-4dba-a703-2c56695514c5.png 295w,\n/static/8e19a35a0376a332670865c3da0f9a18/05ed2/1676519903213-e32a7aeb-0741-4dba-a703-2c56695514c5.png 430w\"\n        sizes=\"(max-width: 430px) 100vw, 430px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n</ul>\n<p><a name=e3Cxf></a></p>\n<h3>Brickverse</h3>\n<p><a href=\"https://www.brickverse.net/login\">https://www.brickverse.net/login</a><br />《<a href=\"https://zhuanlan.zhihu.com/p/605669675\">A Dream: What is Brickverse? - Jeff Tian的文章 - 知乎</a> 》</p>\n<p>你会看到，这两个前端应用的登录界面很像，因为它们都是 Authing 提供的。虽然可以自定义界面，但如果你像我一样懒，那么默认主题就是 Authing 提供的了。你可以选择不同的登录方式，具体可以有多少种登录方式，取决于在 Authing 的后台配置多少了。需要强调的是，你可以在 Authing 后台配置很多身份源，然后，所有的前端应用（比如上面列举的两个），就能立刻使用上了。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/27a04551544a6090f5c80310152d5618/e2d3b/1676520392940-bc94c522-8041-4662-b5e7-24a680527b36.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABt0lEQVR42p1S227TQBD1pwIJLRAntCmUjwGJb4AHPqAPAdRWfehzm+LG8Tpt4st672ufatYhqBLw0JFGuz4zc7xzZqLDo2NM331APD7A4fQ9pkfHGE8O8Or1CKN4gnj8FnE82d1HozHebH043MdgsIfBcA8vBi/x7PkQ0ffZT2QsB28ktHGwzuOp5n2LKF1muF9vIKSGVAaNkGAZw2z2A9fzm21q97iy69D9xcmi1cag4g7aWEhlkecrFEWJX8kCZVlBawPeCCitg9OdsO4fpFFRCSxShqpuQsssX8FaB6UtpFSh2FgXMGN63P1Hloi0Y6t7FBXvCVkeip1zgUxKDaVIDh30JZ1aANa3EEIGnOJCqF7DnnCNiosdoXMdZmcnSNIUSZKGDlh+FwZH9uXrN3z++AmLNMPVdQLG7pDcLkMnUSNUICzK+tEL5zdzrMsavFFhYBSjoZFdXFzi7PQ8YP122H5DrEdERMuMgQu105ASlPGouAEXBkIalLVG3Rh472E9gjchZkNOyXX/wk1Rg1aH/q7075Y9nPehmM7wvXWaJJ29zn9w0rdtWyKskNymu7aIkAJPtQdBozMWHkOAwAAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/27a04551544a6090f5c80310152d5618/fcda8/1676520392940-bc94c522-8041-4662-b5e7-24a680527b36.png\"\n        srcset=\"/static/27a04551544a6090f5c80310152d5618/12f09/1676520392940-bc94c522-8041-4662-b5e7-24a680527b36.png 148w,\n/static/27a04551544a6090f5c80310152d5618/e4a3f/1676520392940-bc94c522-8041-4662-b5e7-24a680527b36.png 295w,\n/static/27a04551544a6090f5c80310152d5618/fcda8/1676520392940-bc94c522-8041-4662-b5e7-24a680527b36.png 590w,\n/static/27a04551544a6090f5c80310152d5618/efc66/1676520392940-bc94c522-8041-4662-b5e7-24a680527b36.png 885w,\n/static/27a04551544a6090f5c80310152d5618/c83ae/1676520392940-bc94c522-8041-4662-b5e7-24a680527b36.png 1180w,\n/static/27a04551544a6090f5c80310152d5618/e2d3b/1676520392940-bc94c522-8041-4662-b5e7-24a680527b36.png 1466w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>当然，这里的前端应用并不局限于前端技术，对于身份认证来说，哪怕是后端服务，在这个语境里，也是前端应用。但从展示方便的角度来说，这里列举的只是前端技术层面的前端应用（但你要知道，列举的只是少数几个而已）。</p>\n<p><a name=Ki7Bx></a></p>\n<h2>Keycloak</h2>\n<p>Keycloak 是一个基于 Java 的开源身份认证解决方案，使用它和使用 Authing 一样，除了对接，几乎没有开发量。虽然 Authing 提供私有化部署，但如果你想我一样懒，可以直接使用其 SaaS 服务，省去部署。而 Keycloak 一般来说，是需要自己部署的，一个比较省钱的方案，是部署到 Heroku（参考《<a href=\"https://zhuanlan.zhihu.com/p/554534245\">FreeArch: 一键拥有你自己的身份认证平台 Keycloak！ - Jeff Tian的文章 - 知乎 </a> 》）。当然，也可以使用 SaaS 方案，省去自己部署的麻烦，详见：《<a href=\"https://www.amazonaws.cn/en/solutions/keycloak-on-aws/\">https://www.amazonaws.cn/en/solutions/keycloak-on-aws/</a>》。</p>\n<p><a name=xMRW9></a></p>\n<h3>egg js 对接示例</h3>\n<p><a href=\"http://uniheart.pa-ca.me/keycloak/login\">http://uniheart.pa-ca.me/keycloak/login</a><br />《<a href=\"https://zhuanlan.zhihu.com/p/359057316\">在 eggjs 中集成 Keycloak 用户认证 - Jeff Tian的文章 - 知乎 </a> 》<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 102.7027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACyklEQVR42p1Uy27TUBC1xI49VAgk/qCbVuqiq0DCqqrUSl1VXbNgWV5/wT/wHSygUCgUUJPGzZMqbVLHSZ34ce347YNmkhj3AQSudDLx3NG5Z649R9ra2kKtVgOtKIo4xnEMIQRGoxHDdd30/xS2bSMMw7SelqqqkLKEtJEkCUdN02BZFhzHYXJdN2BZApYQnDcMkwkTEvI7wigM8H8r4d9utwtpc3MTzWYDumHh8zcZrc4AbdXAaVefCVR73NZgihF6pHBjYwP1eg26aePT9xrkZhf10wFqJ9pMoNpyU4WmC/R7KqT19XVUq1WWTHfDDSTju5wV05fCLa+traFarfAtVI776Jy76JsJekaMnvl39M0YXT1CxIQKpNXVVVQqR3zCue5iaPkw7HBmDEWInuEjnhKurKxAlseEiW8z/u39JlAdf9yyokAqFB6hciTDiYG3VRO7P2x8aIgU7yk2BfZbNnabk+cMPjYF3lVNaCOgryqQcg8eotU4wpuGj5tPvuLOswPMPT3A3PY43t4+wL0XJRRe1XH/ZQm3ti/u331exI3H+3j9xcRI70HK5/OQy2WWrFk+dCe8gKEdYGAHOBcBNBHw8+UaTfj8UhXljFouoDwhBOKrlxSHcB0bgedyjK+dpvGkdDodSLlcDoeHh5wIwwgxfVf8bY0jzanrehi5Hscoii/sE8KJqZwR4fLyMkqlEid83+eBn4Lch3JkDGQGFD3f53y2jmpShVlCKrw8AdNIhFl7y9ZN81cIqaUgCLiFVEEUcc4wrlc3Vhj8IlxaWkKxWOSEonTTeSYVUyWeR23rbLR/UthutyEtLi6mhJ7nsSK6+IjjBHGc3mmczU8QTJybFS4sLGBvb49PImcmh74MypPlW7YD275+nw6s1+uQ5ufnsbOzw+rI9qm1LDRtgFbrhO29pmhQtSEMXccwUzMYDJhYlmX8BP3NDTmO3rZZAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/1e07dcd17d5392eaf128a5a86124036f/fcda8/1676521482803-36ecb201-b37f-43e1-9b92-ae1e3e145d98.png\"\n        srcset=\"/static/1e07dcd17d5392eaf128a5a86124036f/12f09/1676521482803-36ecb201-b37f-43e1-9b92-ae1e3e145d98.png 148w,\n/static/1e07dcd17d5392eaf128a5a86124036f/e4a3f/1676521482803-36ecb201-b37f-43e1-9b92-ae1e3e145d98.png 295w,\n/static/1e07dcd17d5392eaf128a5a86124036f/fcda8/1676521482803-36ecb201-b37f-43e1-9b92-ae1e3e145d98.png 590w,\n/static/1e07dcd17d5392eaf128a5a86124036f/66caf/1676521482803-36ecb201-b37f-43e1-9b92-ae1e3e145d98.png 853w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=elUBX></a></p>\n<h3>基于 UmiJs 的纯前端对接示例</h3>\n<p><a href=\"https://umi-ckeditor5.brickverse.dev/\">https://umi-ckeditor5.brickverse.dev/</a><br />《<a href=\"https://zhuanlan.zhihu.com/p/572820262\">实战案例：在 Umi Js 项目中通过 umi-plugin-oauth2 插件对接 Keycloak - Jeff Tian的文章 - 知乎 </a> 》\n<a name=oVzk5></a></p>\n<h3>基于 SpringBoot 的后端对接示例</h3>\n<p><a href=\"https://tranquil-plains-58233.herokuapp.com/visitor\">https://tranquil-plains-58233.herokuapp.com/visitor</a><br />《<a href=\"https://zhuanlan.zhihu.com/p/480816990\">Free Arch: 如何在 Spring Boot 应用中集成 Keycloak？ - Jeff Tian的文章 - 知乎 </a> 》\n<a name=gtq0O></a></p>\n<h3>命令行应用对接示例</h3>\n<p>没错，除了前端、后端项目外，命令行工具也可以享受到身份认证代理带来的好处！这里有一个例子：《<a href=\"https://zhuanlan.zhihu.com/p/488194876\">OAuth 2.0：对接 Keycloak 设备码授权流程 - Jeff Tian的文章 - 知乎 </a> 》</p>\n<p>如果安装了 npm，使用如下两行即可体验：\nshell\nnpm i -g k8ss\nk8ss login</p>\n<p>可以看到，以上多个应用，其登录界面都相同，因为对接了同一个身份认证代理： <a href=\"https://keycloak.jiwai.win\">https://keycloak.jiwai.win</a> 。</p>\n<p><a name=uXf8k></a></p>\n<h2>IdentityServer</h2>\n<p>Duende IdentityServer 是基于 ASP.NET 的身份认证解决方案，相比 Keycloak，它没有内置完备的 UI：免费的示例 UI 提供的功能特别少，而要使用完整的管理后台的话，需要付费购买 AdminUI。它的核心功能，都可以免费使用，前提是你的代码得开源。如果商用的话需要购买许可证。</p>\n<p>我之前写过如何部署 IdentityServer 的文章，详见这两篇：《<a href=\"https://zhuanlan.zhihu.com/p/482103322\">部署到 Azure 网站应用 IdentityServer 初体验 - Jeff Tian的文章 - 知乎</a> 》和《<a href=\"https://zhuanlan.zhihu.com/p/591856146\">Free Arch： 将 IdentityServer 部署到 Okteto - Jeff Tian的文章 - 知乎 </a> 》。</p>\n<p>部署到 Azure 后的应用实例有： <a href=\"https://id6.azurewebsites.net/Account/Login\">https://id6.azurewebsites.net/Account/Login</a>：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABjElEQVR42pWSUU8TQRDH+2XVGBJrRENFNMZP4qskIon64osxBhJewAeqLVUKDy1he7d37e7dcbd7+zO74RBtqWGSf2YzM/nNzO622o/WedzZ4MnT56yuPQvqbLwMWn/xivbqGnfuP+DeykPurrT/qxYLbDqdkaYpv46PkVJyG2vVdU0j5xzWWn70ehx2uxwcfOPk9DQU+nhT58/W/vHXGS0PaeTNB8+FYBJFVFXFbe1q5QbofRRFjMbj4GMpybIswI0xFEWBmExIkiRch/da65D3E/8FbKBCCAaDnwyHQ44GAxIpKcsLqrJEKc1h9zv9/lGo6fX7jEbj0Mg3XAic6YJUZVdrWAelcfhsLBM2tz/w+esu2x8/8WVnjzdb7zk7F/MrN8BEFQg5Iy8tRVVzYdylwBiL0posz9FZRp4XaJ2FdXFuMTBNp0xieRkHW7ugunZLH8TdBLRViZqmKKXC3VzPL9PcyjZM4Hi9D53NE95uvUNE8RxwWYN/JgwnzhQMo5I4jqmMuRG46B/+BiORhearkz/+AAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/90302f1b78484194dc30348b915b9201/fcda8/1676545868015-e585d859-2a18-428a-b75f-54ec02696078.png\"\n        srcset=\"/static/90302f1b78484194dc30348b915b9201/12f09/1676545868015-e585d859-2a18-428a-b75f-54ec02696078.png 148w,\n/static/90302f1b78484194dc30348b915b9201/e4a3f/1676545868015-e585d859-2a18-428a-b75f-54ec02696078.png 295w,\n/static/90302f1b78484194dc30348b915b9201/fcda8/1676545868015-e585d859-2a18-428a-b75f-54ec02696078.png 590w,\n/static/90302f1b78484194dc30348b915b9201/efc66/1676545868015-e585d859-2a18-428a-b75f-54ec02696078.png 885w,\n/static/90302f1b78484194dc30348b915b9201/c83ae/1676545868015-e585d859-2a18-428a-b75f-54ec02696078.png 1180w,\n/static/90302f1b78484194dc30348b915b9201/d6853/1676545868015-e585d859-2a18-428a-b75f-54ec02696078.png 3070w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a name=uZpwh></a></p>\n<h3>基于 UmiJs 的纯前端对接</h3>\n<p>《<a href=\"https://zhuanlan.zhihu.com/p/591563537\">使用 IdentityServer 保护 Vue 前端 - Jeff Tian的文章 - 知乎</a> 》\n<a name=iDVdq></a></p>\n<h3>基于 AntD Pro 的前端对接</h3>\n<p>《<a href=\"https://zhuanlan.zhihu.com/p/533197284\">使用 IdentityServer 保护 Web 应用（AntD Pro 前端 + SpringBoot 后端） - Jeff Tian的文章 - 知乎 </a> 》\n<a name=oQXIm></a></p>\n<h3>基于 SpringBoot 的后端对接</h3>\n<p>《<a href=\"https://zhuanlan.zhihu.com/p/533197284\">使用 IdentityServer 保护 Web 应用（AntD Pro 前端 + SpringBoot 后端） - Jeff Tian的文章 - 知乎 </a> 》\n<a name=w71bi></a></p>\n<h3>命令行应用对接示例</h3>\n<p>这个示例还是 k8ss，通过指定 idp 参数，可以切换指向身份认证代理到部署在 Azure 上的 identityserver：  k8ss login --idp=id6：<br />《<a href=\"https://zhuanlan.zhihu.com/p/594742263\">OAuth 2.0：对接 IdentityServer 设备码授权流程 - Jeff Tian的文章 - 知乎 </a> 》</p>\n<p><a name=IwVaG></a></p>\n<h1>案例2：API 网关</h1>\n<p>如果没有网关，采用前端直接调用后端服务的模式，就会是这样的状态：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2e2c6a59a9e13ef98fd4831da81795ab/07a9c/1676546785931-56b3dd9a-069a-4c71-920d-37bd2ccc1931.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.54054054054053%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBElEQVR42o2UW2/CMAyF+///Gw+IyyTERSCuJS2XFkohiafPqlk3hraHKKljH59jO01ijF5EJMYYm12897pCCHI6nWS9Xstut5Ptdqu2x+Ohu/m3Yn3yE/B2u0lVVVLXtZ5ns5lMp1OZTCZyPB7VzrpcLm3Q94DX61U2m42yIqAoCgVL01SDAZ3P53I4HP4HCKvlcinD4VBZnM9n+Rh+qOT7/S6LxUJGo5ECNyHvAc0BIFgCBmPYUUuSUUfYtcBeAdtGZADIInC/32tNOTvnpCxLvaOOBsj2FpAOEgAbQPI8V3nsWZY971h/SrYaWqcBpClIhilggFNLfBitdrm+McSOXAM0abCCnTGlpjYyLdmvkvkmI9kBY3d7p0ypHUlgCQgNIoa7F4Yi8gTEGVDrqAEhHWbYKUFxLrTW3DWz+LtkHABlXAg0EGNlcs3GQklL9VdTQggRCdYMwAEAnEASUAqrL3f48v2NIagGiCMLRwJYBNiowIYEnJFsKp4vAoYhBN8Mc7Si40R3AQYEO8H4YQeUM8mbmNj8nXxSVZUnY5qmEWcuGA+eGGfGpd/v6xs2hrxrY8w5z/PYEPFJWZaen0Gv14tIg914PNalo+OcdDod/WGgDIDBYKBvHZYMfbfbjavVCpU+qeva04Qsy6LVDVbYkGyyrLMwJImNFqVwzsXmX+k/AW8Ec818BjuYAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/2e2c6a59a9e13ef98fd4831da81795ab/fcda8/1676546785931-56b3dd9a-069a-4c71-920d-37bd2ccc1931.png\"\n        srcset=\"/static/2e2c6a59a9e13ef98fd4831da81795ab/12f09/1676546785931-56b3dd9a-069a-4c71-920d-37bd2ccc1931.png 148w,\n/static/2e2c6a59a9e13ef98fd4831da81795ab/e4a3f/1676546785931-56b3dd9a-069a-4c71-920d-37bd2ccc1931.png 295w,\n/static/2e2c6a59a9e13ef98fd4831da81795ab/fcda8/1676546785931-56b3dd9a-069a-4c71-920d-37bd2ccc1931.png 590w,\n/static/2e2c6a59a9e13ef98fd4831da81795ab/efc66/1676546785931-56b3dd9a-069a-4c71-920d-37bd2ccc1931.png 885w,\n/static/2e2c6a59a9e13ef98fd4831da81795ab/c83ae/1676546785931-56b3dd9a-069a-4c71-920d-37bd2ccc1931.png 1180w,\n/static/2e2c6a59a9e13ef98fd4831da81795ab/07a9c/1676546785931-56b3dd9a-069a-4c71-920d-37bd2ccc1931.png 1440w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>在这样的架构下，如果又增加了一个前端，比如说需要一个在汽车智慧屏上显示的应用，并且后端服务也增加了，这时调用关系就变成了一团乱麻。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ea266aa96b7b8addbf437c037b730141/07a9c/1676546854438-a5b39d31-7afc-463a-ab2a-1cd07a41e5de.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.48648648648649%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABfUlEQVR42oWS27KCMAxF/f8fdHzCGyqiWAS5SEmcFQ3iw5nDTKeFJis7OyxUNYqIqqrEGHUYBh3H0fa+77Wuaz0cDnq9XrXrOiXGlyWJsAwAazEHNk2jl8tFd7udJd/vd12tVnq73fR0Ohm8LEs9Ho92/y8QVUVRGARwCEGTJLHzer02pZvNxgr+qVBE4ufCPqISJbTorQJAVZqmVpD75/M5AWfpvwqpSjBQ2syybFK03+/1fD7bd2LatjWv57RJoQPxhcCqqkwJvqEKpZwdyD1xWDQHwppaHsdRmOrj8TAYyXmem3+8s9M+C2+JQ8BHpXy8/AKHYRCqkgyIRCaKInYgvohxKF7K+3kD6Rtg3/fiCrwtFr8Ou/8yvvPd/aS7Hw+Rnue5AakOgCSGgxJ/R5ErK0M5KS+K4uth27aRaYYQBN+ozGRJ4t1/leVyaZ5RlIlz3m63Bs2yTBgcrEVd1xEFTdMI8gGSgJ8Uwk/OJHj7fs+gKNp1nVC4qqr4AmuznEXuOt/iAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/ea266aa96b7b8addbf437c037b730141/fcda8/1676546854438-a5b39d31-7afc-463a-ab2a-1cd07a41e5de.png\"\n        srcset=\"/static/ea266aa96b7b8addbf437c037b730141/12f09/1676546854438-a5b39d31-7afc-463a-ab2a-1cd07a41e5de.png 148w,\n/static/ea266aa96b7b8addbf437c037b730141/e4a3f/1676546854438-a5b39d31-7afc-463a-ab2a-1cd07a41e5de.png 295w,\n/static/ea266aa96b7b8addbf437c037b730141/fcda8/1676546854438-a5b39d31-7afc-463a-ab2a-1cd07a41e5de.png 590w,\n/static/ea266aa96b7b8addbf437c037b730141/efc66/1676546854438-a5b39d31-7afc-463a-ab2a-1cd07a41e5de.png 885w,\n/static/ea266aa96b7b8addbf437c037b730141/c83ae/1676546854438-a5b39d31-7afc-463a-ab2a-1cd07a41e5de.png 1180w,\n/static/ea266aa96b7b8addbf437c037b730141/07a9c/1676546854438-a5b39d31-7afc-463a-ab2a-1cd07a41e5de.png 1440w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>可以通过引入一个网关层来解决这个问题，该网关层收拢所有前端的调用，再转发给后端，调用关系会简单清晰很多。虽然应用在了不同的场景，但是架构图画起来，和案例1中的身份认证代理一模一样。</p>\n<p><a name=TJtET></a></p>\n<h2>AWS API Gateway</h2>\n<p>通过 AWS API Gateway，只需要在界面上可视化做些配置即可实现对后端服务的编排，不需要编码了。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.02702702702703%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACXUlEQVR42oVSa0/UQBTt70AFEXAJCBHQb8b4b0wgElK7PAIsieGXmu1uu9uZPqad6Wt6zL2kZWMk3uTkdmfPPffpfPj0FQefv2Hv6At29o+x+f4AG9v72Njew+vNXcartyP2W7uH2Nw9wvroBOujY2yMTvBm5yPW3h1ibesJzqV7DffmF86vHnExfoB3/Ygf4wecuxN4P+9wcT3BlXcL93KC8d0jXO8e3vgW3s0Dvl/c4tS9w5k3YZy693CMEjBaoSpLhtYFiiLHfD5HmsTIco00N1B5AZVlkFIglgIqSxnEzXPFqKsKDhHTNIVSGYwxUIVGWVYojUFZVQiiBL8DgShOEcznmM1mCIIAy+USURRhOp3C92fsF4sFHApUeY7Wdui6DnXdQogMHcC/0Vn6QhLHkDJGXmgkSYKcYtoWq0Z8pywNrE7RmQydtejQQYgc2lQsRCQCBbetxVIkXGXTNMN/PcgcUyiIwEdjchZoGgspMtRNg3+ZLnKEYYiiKIaqVuFUVYlISHRD2RbTmYDMNOrGciVxHENEEYJwgWWc4yVjQQpIV2ZCs/TDBIkq0LQW1lp+p8UFQYgkzTgJvZHvMbRcluXQwtOsLKTULIyhbvBGfd/Hcrngk5JSchFKKQYlZsE+O50MWdO0kLFmYUpARK01nwqNRqQFrG1fbJsrJDIJsGBrESeGPQlSMiEEV5WkKer6ebuUrMewFMpOd9UbbTlNzFBhlmW8FPIkTvxe7O8NsyAR6eqHlluLUBaom5YJNFsSpE76Tb4kxoIUQEOlWfaPpmpg7fOxrp7F//AHiRFCZUX7qD0AAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/d86d2b43935ad3eba52749a6e1c0fff7/fcda8/1676547225026-9409f49b-08f8-45f9-b51e-2e8e00f45007.png\"\n        srcset=\"/static/d86d2b43935ad3eba52749a6e1c0fff7/12f09/1676547225026-9409f49b-08f8-45f9-b51e-2e8e00f45007.png 148w,\n/static/d86d2b43935ad3eba52749a6e1c0fff7/e4a3f/1676547225026-9409f49b-08f8-45f9-b51e-2e8e00f45007.png 295w,\n/static/d86d2b43935ad3eba52749a6e1c0fff7/fcda8/1676547225026-9409f49b-08f8-45f9-b51e-2e8e00f45007.png 590w,\n/static/d86d2b43935ad3eba52749a6e1c0fff7/efc66/1676547225026-9409f49b-08f8-45f9-b51e-2e8e00f45007.png 885w,\n/static/d86d2b43935ad3eba52749a6e1c0fff7/c83ae/1676547225026-9409f49b-08f8-45f9-b51e-2e8e00f45007.png 1180w,\n/static/d86d2b43935ad3eba52749a6e1c0fff7/beade/1676547225026-9409f49b-08f8-45f9-b51e-2e8e00f45007.png 2266w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />我之前写了一个前端应用，后来需要文件上传的能力时，写了一个新的服务，只需要使用 AWS API 网关的界面配置上去，前端就能使用该服务了，不需要对接新的 API Endpoint，十分方便。不过，对于文件上传来说，在配置上有一个要注意的地方，详见：《<a href=\"https://zhuanlan.zhihu.com/p/595401224\">AWS API Gateway 踩坑记 -- Binary Media Types - Jeff Tian的文章 - 知乎 </a> 》。</p>\n<p><a name=eGjvX></a></p>\n<h2>手写 API 网关</h2>\n<p>除了 AWS API Gateway，其实也可以手写网关。其实，我在 2018 年至 2020 年，做的事情总结下来就是在用 nodejs 手写 API 网关。这一点在《<a href=\"https://zhuanlan.zhihu.com/p/442433967\">编排还是编舞，暨近几年工作回顾 - Jeff Tian的文章 - 知乎 </a> 》里提到了。</p>\n<p>这种模式相信很多公司现在仍然在采用，大概有几个原因：一是团队的习惯。在一个团队中，引入改变并不容易，还得慢慢来。二是有复杂的逻辑，我之前在一个大型跨国企业，他们在全球的 APP 中使用了同一个网关，但是给到不同国家的用户体验完全不一样。所以通过手写网关，实现了一种策略模式，来使用同一个代码库，来对不同国家不同的底层实现提供支持。三是使用了一些特别的协议，比如下面这种：\n<a name=fIiJa></a></p>\n<h1>案例3 ：GraphQL 网关</h1>\n<p>GraphQL 实现网关特别容易，不需要 AWS API Gateway 就可以自己实现。但是要求后端服务都暴露 GraphQL 接口。这样，使用 Apollo Gateway 框架，就可以自己搭建一个 GraphQL 网关。</p>\n<p>我自己搭建了一个简单的，详见《<a href=\"https://zhuanlan.zhihu.com/p/583120262\">Free Arch: GraphQL Federation 初体验（成功，且丝滑！） - Jeff Tian的文章 - 知乎</a> 》，目前也是处于手写阶段。因为，当有新的服务需要接进来时，要在网关层的代码中添加进去，当然，只要再写点儿代码，从一个外部文件中读取后端 GraphQL 服务列表，就可以将这个手写网关变成配置型的。</p>\n<p><a href=\"https://github.com/Jeff-Tian/serverless-space/blob/main/src/gateway/gateway.module.ts\">https://github.com/Jeff-Tian/serverless-space/blob/main/src/gateway/gateway.module.ts</a>：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.75675675675676%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABh0lEQVR42o2SW27bMBBFvZLGkk2RFN962ZJlJ24MOP1sgHb/OzmFFMdJ6wTNx8UFQc7hHQ4Xw+kn1fiDMJzZnZ45nH+xf/rNcHqm3p3x7QFXjbjmgK1GTBpmuXqkHh6JmyO+2eObIyr0LKaNu5Xm20qjC0tXb2n6B6ruQNx+x9Qj0jYUrmWlArl05NJ/qoWJ28vBgDQ1rhpQvkW5FmnrGSRsMx/OCnf1jzQDl8Je6Ssd5+IplU09OnSIMs0Xvhb8T4vrQgVWKs6FMg7o2CN0fEkkLNPF2XsV/ib1DXCtX4Ejpj2iwxZT79BVjwwbZOiQvqOwLdkE+UefAiepNGK6B1TYo/09Jh1RfkS6Hum35FMiYcgL++Y3LV+A83uaGmE2mH3CPZXYR4e596iuQtjI0rbcheHNTTv/gJuEy8KiXYurdpRxoGwbVOcQybCOhqLVs3ITycqaTKerf9jyNFGhE8U08TKxVolcRLK1f5O4DGFq873/BZSewlToMiFdc23/5Qm+9mUm4B/1f0vqtQl2+QAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/dc5b76d54fe4c984eeb71203886d59a9/fcda8/1676548261823-8eca6075-0f9b-43e7-9913-b8a929663e2b.png\"\n        srcset=\"/static/dc5b76d54fe4c984eeb71203886d59a9/12f09/1676548261823-8eca6075-0f9b-43e7-9913-b8a929663e2b.png 148w,\n/static/dc5b76d54fe4c984eeb71203886d59a9/e4a3f/1676548261823-8eca6075-0f9b-43e7-9913-b8a929663e2b.png 295w,\n/static/dc5b76d54fe4c984eeb71203886d59a9/fcda8/1676548261823-8eca6075-0f9b-43e7-9913-b8a929663e2b.png 590w,\n/static/dc5b76d54fe4c984eeb71203886d59a9/efc66/1676548261823-8eca6075-0f9b-43e7-9913-b8a929663e2b.png 885w,\n/static/dc5b76d54fe4c984eeb71203886d59a9/c83ae/1676548261823-8eca6075-0f9b-43e7-9913-b8a929663e2b.png 1180w,\n/static/dc5b76d54fe4c984eeb71203886d59a9/91945/1676548261823-8eca6075-0f9b-43e7-9913-b8a929663e2b.png 2944w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=QSkq6></a></p>\n<h1>总结</h1>\n<p>代理，或者网关，是个好东西，可以简化架构，但是别太多层代理了哦！</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}