{"componentChunkName":"component---src-templates-post-js","path":"/posts/hsnbxhp84mme3hnz/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/hsnbxhp84mme3hnz","relativePath":"posts/hsnbxhp84mme3hnz","frontmatter":{"title":"Free Arch： 将 IdentityServer 部署到 Okteto","stackbit_url_path":"posts/hsnbxhp84mme3hnz","date":"2022-12-14T12:10:49","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a name=sxzta></a></p>\n<h1>最终成果</h1>\n<p>部署了一个免费的 IdentityServer 实例： <a href=\"https://id6-jeff-tian.cloud.okteto.net/\">https://id6-jeff-tian.cloud.okteto.net/</a></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/adcbb6b869b556da48d6a1c9a8e640c1/63908/1671017413089-2fafb866-9c5d-4c65-823b-59958913b92f.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABeUlEQVR42lWR2W7UQBBF5xcIiVA8Xrvtdi9u70tmBo9JBEEEXuD//+WgMQiJh6Nzbz2Vqg5VPTBMF7rhiaabsVWP9T2+mXC+pzQN2raYqkMqRyYNIrdk+V9L8x+HJHf08zNCtXTjlVz3KDPg2/Oeg1gTpo4gutnuHBOzz26OhCMW1T8O0jTM6ytlvZCUDdIOFPVMpjtO21dMd6bwE8v6Bdud8MOF8fKC68/M62dyO5Gpjqzsdw5mdmxvr8jGkLoC4UvU4El9Sf3xjL9xOdFtK/V6od1W+ueNbrvSv6yoYUDqBWkmcrdwMH3Dp28/0N1I5jxF3aLHac9vv36ybBuZMWTWcpQFYaH+dGOIS4Uwt3OUJLJC3DYs7cjT+h2pZ4SeKOyCblcyNTAvV2Thef8Q8fAhJAhjHo8Rd/dH3t09cv8QEieKIMwI44IoLTkEcUnhFoQed6QZkXYmVR1BpAjTElE05MZRjw7tNUGqyFWFyA2p0Pt3k0wRxpLfd1rRXG3V4cwAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/adcbb6b869b556da48d6a1c9a8e640c1/fcda8/1671017413089-2fafb866-9c5d-4c65-823b-59958913b92f.png\"\n        srcset=\"/static/adcbb6b869b556da48d6a1c9a8e640c1/12f09/1671017413089-2fafb866-9c5d-4c65-823b-59958913b92f.png 148w,\n/static/adcbb6b869b556da48d6a1c9a8e640c1/e4a3f/1671017413089-2fafb866-9c5d-4c65-823b-59958913b92f.png 295w,\n/static/adcbb6b869b556da48d6a1c9a8e640c1/fcda8/1671017413089-2fafb866-9c5d-4c65-823b-59958913b92f.png 590w,\n/static/adcbb6b869b556da48d6a1c9a8e640c1/efc66/1671017413089-2fafb866-9c5d-4c65-823b-59958913b92f.png 885w,\n/static/adcbb6b869b556da48d6a1c9a8e640c1/c83ae/1671017413089-2fafb866-9c5d-4c65-823b-59958913b92f.png 1180w,\n/static/adcbb6b869b556da48d6a1c9a8e640c1/63908/1671017413089-2fafb866-9c5d-4c65-823b-59958913b92f.png 2410w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=TcKP9></a></p>\n<h1>相关代码提交</h1>\n<p>一共 3 个，以这个为主：<br /><a href=\"https://github.com/Jeff-Tian/IdentityServer/commit/b40e6c6f8e4193ef459ab558a102f84442b3cede\">https://github.com/Jeff-Tian/IdentityServer/commit/b40e6c6f8e4193ef459ab558a102f84442b3cede</a><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.35135135135135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB40lEQVR42pVT2W7bMBDUnyR1rIuSKFISqYOUZEtu7dpBgKBA07e+9v9/YAquKydNUNR+GCz3wOzskvTMMKPrJ+RSozEDdGMhyxq5VGRFocFFBS5KikWMw4+SM8IEQZSSdb47ez9+/kJZD2j7GVU7QrUjwrRAkDiUYKKG2R6xO35DPz9i/PyEfjqRT7HphP3Td0yHZwy7R3iJbBFLi1i0YNKAFQMiYRDyBnGuEWUVIeYKUaYu/vmsPuS8pOzBmiMi/RXMPIMNL0iGF4T6gIgrrGOBu3WCez+9CmeFuYafGwTCInA2N/CzBquQE9axJOJVmOMhWiAot/irKKcaL04LlMoiYBJJriGUBeMVfCYhVE+jxFwjKzqKMdGAVxZp0cJPCopnZYcgLZErC48xAQfqEr52c+dFgZtC6JEmWVT/C959kMHh0zu4pLOOUDYbNOMBWWk+1L2H97+OrmhZOCmOxeve3tRcRbgo9VmBMFO0pzCtyLr9uSZLzWXkawjdSqSy6OcT2nEPbXeEqpsgdP+X2usI/Yy+ZDd+QdFsIPRARLIekBYdVhG/nVDVFt1mT6ocqaxHlO2WnhDVBzeOXCiD2s4Xhbwy9JPc27xp5IeQ487P0LY97PaAysykzpGmf37Z20v5DVXwzCBbTBOZAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/b60ebae66f162bb0efdd05b6b1ce6e00/fcda8/1671017480049-a4d02026-fece-4104-ad32-3c358f8393ff.png\"\n        srcset=\"/static/b60ebae66f162bb0efdd05b6b1ce6e00/12f09/1671017480049-a4d02026-fece-4104-ad32-3c358f8393ff.png 148w,\n/static/b60ebae66f162bb0efdd05b6b1ce6e00/e4a3f/1671017480049-a4d02026-fece-4104-ad32-3c358f8393ff.png 295w,\n/static/b60ebae66f162bb0efdd05b6b1ce6e00/fcda8/1671017480049-a4d02026-fece-4104-ad32-3c358f8393ff.png 590w,\n/static/b60ebae66f162bb0efdd05b6b1ce6e00/01dae/1671017480049-a4d02026-fece-4104-ad32-3c358f8393ff.png 721w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=EeCMf></a></p>\n<h1>前情提要</h1>\n<p>早在《<a href=\"https://zhuanlan.zhihu.com/p/482103322\">身份验证哪家强？IdentityServer 初体验 - Jeff Tian的文章 - 知乎</a> 》中，就部署了一个免费的 IdentityServer 实例，托管在 Azure 上： <a href=\"https://id6.azurewebsites.net/\">https://id6.azurewebsites.net/</a>。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.78378378378378%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB30lEQVR42n2RT2oUQRSH+yqKuHThwgN4B3cJJFmYpSsXIiQHCIQkSDySFxBEBAUXYaZneqaruqrrf32hqnvGCMYHP96r11Vf/+pV8+LtDS9Pr3l6dMXrdzccfLjmzfsrDj9+4vjslqOzW07OP9dcVHrH8/rk/JZXp5c8Objg2eEFz48uab78tvwY4OsWfmlYOLizsPDQBlgWzfVOpdfGqf6p4ZuA73LKTdcuIPtZgRQ8OThInuBsFSnU7I3G6YHgDGYQxNIbB/CGZBUEQ9O2S6SUSCnQxrHcjiw7xVoYFhvN3UrQSUevE1sV2A6eXseaxRjp1bTelL4KNF3XMQwD3ntCCLRdjzIBFyIhJvycU6YqAyFM/dFnhEko9+d7BSqlyDlX6EZqpBor/O8otFwrawyrVct2MAwmEGLe72lWq3UFFkDwnk4opLYVPBqLMQbrJ3iegeXHxchGOYxP2JDQxWXKNEKKvQfnLBshMcbSCc26V4zjSIixwh4qpXLNXMexUwWu1+u9XRcSy04w6jKCRIqBGOPe3b80TXVSWTfWuelASjUrrfHe7V2XK++gj8UOWaLp+209sJuPsZ7R+vpiJcpcY/D/dflQjRACt3OZM1J5pI24ML9oyOh58A+hj8U9Mg2Ljvi9IJEAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/acb59b67f59e0d0c67aa792e3928882a/fcda8/1671019573468-4b8d3038-8c95-42fb-8b68-8e48cc6e2a38.png\"\n        srcset=\"/static/acb59b67f59e0d0c67aa792e3928882a/12f09/1671019573468-4b8d3038-8c95-42fb-8b68-8e48cc6e2a38.png 148w,\n/static/acb59b67f59e0d0c67aa792e3928882a/e4a3f/1671019573468-4b8d3038-8c95-42fb-8b68-8e48cc6e2a38.png 295w,\n/static/acb59b67f59e0d0c67aa792e3928882a/fcda8/1671019573468-4b8d3038-8c95-42fb-8b68-8e48cc6e2a38.png 590w,\n/static/acb59b67f59e0d0c67aa792e3928882a/efc66/1671019573468-4b8d3038-8c95-42fb-8b68-8e48cc6e2a38.png 885w,\n/static/acb59b67f59e0d0c67aa792e3928882a/c83ae/1671019573468-4b8d3038-8c95-42fb-8b68-8e48cc6e2a38.png 1180w,\n/static/acb59b67f59e0d0c67aa792e3928882a/928ed/1671019573468-4b8d3038-8c95-42fb-8b68-8e48cc6e2a38.png 2552w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>后来，我宣称 Free Arch 要狡兔三窟，多处部署：《<a href=\"https://zhuanlan.zhihu.com/p/580160351\">Free Arch: 狡兔三窟，多处部署 - Jeff Tian的文章 - 知乎</a> 》。今天，就来给 IdentityServer 这个实例，添加一个分身，从此不局限于 Azure 平台。就详述一下部署将它部署到 Okteto 的步骤。由于采用了 OAM，不需要太多工作，就能参考前文，将它部署到 Napptive 等任何 Kubernetes 集群里。</p>\n<p><a name=le6Cj></a></p>\n<h1>第一步，容器化</h1>\n<p>这是一个 ASP.NET Core 项目，从官方的开源仓库 fork 过来后做了一些魔改，源代码在： <a href=\"https://github.com/Jeff-Tian/IdentityServer\">https://github.com/Jeff-Tian/IdentityServer</a>。其 Dockerfile 如下：</p>\n<p>dockerfile\nFROM mcr.microsoft.com/dotnet/aspnet:6.0 AS base\nWORKDIR /app</p>\n<p>EXPOSE 5000\nEXPOSE 5001</p>\n<p>FROM mcr.microsoft.com/dotnet/sdk:6.0 AS build\nWORKDIR /src\nCOPY . .\nRUN dotnet restore hosts/main/Host.Main.csproj\nRUN dotnet build hosts/main/Host.Main.csproj -c Release -o /app/build</p>\n<p>FROM build AS publish\nRUN dotnet publish hosts/main/Host.Main.csproj -c Release -o /app/publish</p>\n<p>FROM base AS final\nWORKDIR /app\nCOPY --from=publish /app/publish .\nENTRYPOINT [dotnet, Host.Main.dll]</p>\n<p><a name=w1gMI></a></p>\n<h1>第二步，构建镜像并上传至 Docker Registry</h1>\n<p>为了能够自动在 github actions 的 cicd 过程中自动进行这一步，我们把手动执行的命令放在一个文件里： .github/ci.sh。这一步的提交见：<br /><a href=\"https://github.com/Jeff-Tian/IdentityServer/commit/3db4235f5e091cda1d2752a8f61df5a9fddbd2b4\">https://github.com/Jeff-Tian/IdentityServer/commit/3db4235f5e091cda1d2752a8f61df5a9fddbd2b4</a>。\nshell\ndocker build -t jefftian/id6 .\ndocker images\ndocker run --network host -e CI=true -d -p 127.0.0.1:5000:5000 --name id6 jefftian/id6\ndocker ps | grep -q id6\ndocker ps -aqf name=id6\ndocker push jefftian/id6\ndocker logs $(docker ps -aqf name=id6$)\ncurl localhost:5000 || docker logs $(docker ps -aqf name=id6$)\ndocker kill id6 || echo id6 killed\ndocker rm id6 || echo id6 removed</p>\n<p><a name=aEJKz></a></p>\n<h1>第三步，准备数据库</h1>\n<p>本 IdentityServer 使用了 PostgreSQL 数据库。如何拥有一个免费的 PostgreSQL 数据库服务？如果喜欢自己部署，仍然可以利用 Okteto，参考：《<a href=\"https://zhuanlan.zhihu.com/p/590349401\">Free Arch: 在 Okteto 上部署 backstage （第一部分： PostgreSQL） - Jeff Tian的文章 - 知乎 </a> 》。</p>\n<p>当然，也可以使用别人部署好的免费 PostgreSQL 服务，比如 app.nhost.io 提供的服务就不错。</p>\n<p>为了验证数据库连接正常，本 IdenityServer 只是连接了数据库，并且执行了一个空的 EF Migration，在本地使用 docker compose 验证了成功执行了 Migration：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4f9f10e3d9ef1f1d155cb1abda10c4f8/4255a/1671018738119-98214810-fe97-46ac-8e11-1e4636a1bfcb.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3klEQVR42oWSb2vaUBSH/ZDbXqywqqsbrKtWtn24FcrECivtO2OiBrXRJJpo/plodDHJM+6V7dVgB34cDpz7nPO791ZuWm2Erhof+fL1G63bNtefmzRbtzRbbT5d33BZveLdZYP6+wbVWkPWtfoHKVFXa3XeXlzw6vUbKmEYslqtmM/nxHFMlmVSf+J0KjHmW3Q9wLZjTDPBMLY4bsZyeWCxiLHtAMfxMU2TioAZhiGBlmVJuOd5bDYeQbAhDHN6PZvx+Be9nsn9vU6nM6PbfaHzY0q3O+PpycM0zwtUXNfFsmxEFhDfD+SmUbQlSbbEcYaieIxGAZrmoQzWKIqDqnpoQ59+f8N4HOE4GXleUNH1MaqqYBgvpOme4/HA6SQsl3JiUZQYhrC1l9K0Nb4P9hL8AIZjiOOSsszPG3r+jtUqxl1HpGnObpeTJBlhWFCWJadTjqY59HpDBoMVuu7x/DzBMBImk4jZdMtgsMRxojMwjMDzYb8XkwrCqCAIS0zrDCyKgsfHn9zdfefhoYtwpGka0+mE0UgMUQjD4O9DVlw3xnW3qKqDqjno+lputFgE8k4E0DQt0jTleDxKicMip+mBw+EgXYg+CeQ/IRr7/b78AUmSIL7ZXtj5RwhHvwGKrITV3Cw5IQAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/4f9f10e3d9ef1f1d155cb1abda10c4f8/fcda8/1671018738119-98214810-fe97-46ac-8e11-1e4636a1bfcb.png\"\n        srcset=\"/static/4f9f10e3d9ef1f1d155cb1abda10c4f8/12f09/1671018738119-98214810-fe97-46ac-8e11-1e4636a1bfcb.png 148w,\n/static/4f9f10e3d9ef1f1d155cb1abda10c4f8/e4a3f/1671018738119-98214810-fe97-46ac-8e11-1e4636a1bfcb.png 295w,\n/static/4f9f10e3d9ef1f1d155cb1abda10c4f8/fcda8/1671018738119-98214810-fe97-46ac-8e11-1e4636a1bfcb.png 590w,\n/static/4f9f10e3d9ef1f1d155cb1abda10c4f8/efc66/1671018738119-98214810-fe97-46ac-8e11-1e4636a1bfcb.png 885w,\n/static/4f9f10e3d9ef1f1d155cb1abda10c4f8/4255a/1671018738119-98214810-fe97-46ac-8e11-1e4636a1bfcb.png 915w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>这个 docker compose 文件如下：\nyaml\nversion: 3\nservices:\npostgres:\nimage: postgres\nports:\n- 5432:5432\nenvironment:\nPOSTGRES_DB: id6\nPOSTGRES_USER: postgres\nPOSTGRES_PASSWORD: nopwd\nvolumes:\n- pg:/var/lib/postgresql/data</p>\n<pre><code>adminer:\n    image: library/adminer:latest\n    restart: always\n    ports:\n        - 7777:8080\n</code></pre>\n<p>volumes:\npg: ~</p>\n<p>由于依赖了数据库，在本地运行本 IdentityServer 实例，需要：</p>\n<p>shell\ndocker compose up -d\ndotnet run --project hosts/main/Host.Main.csproj</p>\n<p>最终部署后，它会在线上的数据库里也创建出一个 __EFMigrationHistory 表，如果是使用了 app.nhost.io 的服务，可以使用其提供的 Hasura 验证：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dec5f4af855536da89e61bb3ecf7af92/d2f5c/1671018928161-50628f8d-75dd-4238-9599-e2742a078e39.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTUlEQVR42q2RuU7DQBCG/aq0lNDxBjQOh6EAIcETUCPxBBQcEkpAiGCcw7EhmPhYO3t9yDaXRKBipF+jmR19c6yz6e2zueWx5e02fnvbw3U3cDt/q/NL3uGfzSmKHGMMWiuU+ltSKazWTCvJenfMRFRgdJP/qHGEEA3ZWvuraqub1qotSlKObwLCJP3x5lRl2c5qP6BmITAvBIPRhOE4YjAMmU4ihnUcRozCmCwvWuBLIVEIpC0X3sTUDbBIqUgzQZYL0qxgHE+ZpXkb54K5VC1wVuakNiIxIc86INZ9UhMj7Iy5FV9gJTHqW1NbA0y7WuM19TKOkvKzRtqqmTQxY0J9y0j38NUFI3vFfZhy1nvl8j6j+yi4CQTXfsFVP+f8LuNhUr7fsKo+P2WRFToDZhydxiy5Dyzv+KzuB6wdDljZC1j2fJbcPgcnTw3wDdSenUXuptmVAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/dec5f4af855536da89e61bb3ecf7af92/fcda8/1671018928161-50628f8d-75dd-4238-9599-e2742a078e39.png\"\n        srcset=\"/static/dec5f4af855536da89e61bb3ecf7af92/12f09/1671018928161-50628f8d-75dd-4238-9599-e2742a078e39.png 148w,\n/static/dec5f4af855536da89e61bb3ecf7af92/e4a3f/1671018928161-50628f8d-75dd-4238-9599-e2742a078e39.png 295w,\n/static/dec5f4af855536da89e61bb3ecf7af92/fcda8/1671018928161-50628f8d-75dd-4238-9599-e2742a078e39.png 590w,\n/static/dec5f4af855536da89e61bb3ecf7af92/efc66/1671018928161-50628f8d-75dd-4238-9599-e2742a078e39.png 885w,\n/static/dec5f4af855536da89e61bb3ecf7af92/c83ae/1671018928161-50628f8d-75dd-4238-9599-e2742a078e39.png 1180w,\n/static/dec5f4af855536da89e61bb3ecf7af92/d2f5c/1671018928161-50628f8d-75dd-4238-9599-e2742a078e39.png 1363w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACPklEQVR42oWQy2oUQRSG+4HEoEJioglEURARdy4VIho1iRoDghiShaIbn8Ode0HfIKhovEdz0ejM9HRXVVd19aW6ej7pzqg7PfBz/lOLr85/gukTZzl15hxTx04zOnGc8cmTHD5yolUzjzVvR5t5mtGxcQ6NTjI2Mc2h0ak/ff+BcfaNjDFycILgzvJ97j94xNLtFS5evsmFmfmhFjg/M8/M7C1mF1ZYWlpkdXmRKzdWmbt1j0vX7nD1+jLzi6vM3VzhysLd1gdZ/JZo9yU2Wof8E+Sfh9qA7CO4HspYYiFI4h3iznvicIuscDhfU7qKsvJ7vvIExii6vRCRROAral8wqAtUIpAqpvaOnd0fbO9sk2w8pvfiIcnXJxTVgMK5FtJA83LPB74eoOKYNJFkaAYMa2gqX2OsJUkNae6wZY3UGcbmpFmOUIbEWGxeoHRKUA8GZIkg1zFd+40t+5rv1Tqh3ySpu3hfk6Ylma7JrMNkGZFI0HYP2hcKqdMWGCtN0GzR/KK0/b0bjpyw3uS7f8N6+ZxXyTPWfj5no/OBqC+IpcCklljqP1ELV+GayFVVkaYWbVKqytHMvqrBw8BD6Rwds8uafMoX846tbsnbHclGx2CLqgUVwxs2CsKwj5QSrZO2K6WQSiKVQLSbpOS5xwiHEIZupOhEip992d4szUt0VrSwBhx47/mXmhhSa7r9Ht1+n14YEsUxUiVtKluUJDb/C+Q/5esapQ1hFNOPRduFSsiKEls40rygrP7G/gUV+gO6nQz8mAAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/702b30359f6c6e91fda25f19f4c54cac/fcda8/1671018962994-11610b12-1a5e-48a4-af3a-de4d47fd96b6.png\"\n        srcset=\"/static/702b30359f6c6e91fda25f19f4c54cac/12f09/1671018962994-11610b12-1a5e-48a4-af3a-de4d47fd96b6.png 148w,\n/static/702b30359f6c6e91fda25f19f4c54cac/e4a3f/1671018962994-11610b12-1a5e-48a4-af3a-de4d47fd96b6.png 295w,\n/static/702b30359f6c6e91fda25f19f4c54cac/fcda8/1671018962994-11610b12-1a5e-48a4-af3a-de4d47fd96b6.png 590w,\n/static/702b30359f6c6e91fda25f19f4c54cac/efc66/1671018962994-11610b12-1a5e-48a4-af3a-de4d47fd96b6.png 885w,\n/static/702b30359f6c6e91fda25f19f4c54cac/b7877/1671018962994-11610b12-1a5e-48a4-af3a-de4d47fd96b6.png 891w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=yunLG></a></p>\n<h1>第四步，加密敏感信息</h1>\n<p>这就是前面提到的主要的提交。再一次使用了 SOPS，对 SOPS 步骤的详细介绍参考《<a href=\"https://zhuanlan.zhihu.com/p/590640020\">Free Arch： 在 Okteto 上部署 backstage（第二部分） - Jeff Tian的文章 - 知乎 </a> 》。要使用它，需要在项目根目录添加一个 .sops.yaml 文件：</p>\n<p>yaml\ncreation_rules:</p>\n<h1>If assuming roles for another account use arn+role_arn.</h1>\n<h1>See Advanced usage</h1>\n<ul>\n<li>path_regex: k8s/app/secrets.yaml$\nkms: arn:aws:kms:us-east-1:443862765029:key/b1739688-ec15-407d-895d-d05ca1217a2f\naws_profile: lambda-doc-rotary</li>\n</ul>\n<p>在 k8s/app/secrets.yaml添加数据库连接信息：</p>\n<p>yaml\napiVersion: v1\nkind: Secret\nmetadata:\nname: id6\nlabels:\nbranch: main\ntype: Opaque\nstringData:\nDatabaseHost: xxx\nDatabasePort: 5432\nDatabaseUser: postgres\nDatabasePassword: yyy\nDatabaseName: zzz</p>\n<p><a name=VNF1X></a></p>\n<h1>第五步，添加 k8s 相关的描述文件</h1>\n<p>这一步，基本上和《<a href=\"https://zhuanlan.zhihu.com/p/590640020\">Free Arch： 在 Okteto 上部署 backstage（第二部分） - Jeff Tian的文章 - 知乎</a> 》相同。一个显著不同的是在开启 Ingress 这里，这次没有使用自动 Ingress，而是专门添加了一个 Ingress.yaml 描述文件：</p>\n<p>yaml\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\nname: id6\nannotations:\ndev.okteto.com/generate-host: id6\nspec:\nrules:\n- http:\npaths:\n- backend:\nservice:\nname: id6\nport:\nnumber: 80\npath: /\npathType: ImplementationSpecific</p>\n<p>这一点在那篇文章有提及，但这次算是真的补上了这个公开示例。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1e18672cb5c15870309d6a2258f9a927/073e9/1671019200012-e8b99a2c-88aa-444c-bc8c-a3716fe59410.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACiklEQVR42lWTW3PiRhCF9UsSgyUhxNyl0QWBuJg1NsTgda2duCoPW5Xn/P/HL6XB1JKHrlPd03N6TndPNJOGfrWl7ZYYV6K0Q9sioFQWqS3KfMWMC3Fjy68cG3Dws6lgHE+I3j7+pt8+028PFHXPRBSoYh5Mlx2u7jF+EXxb97hmhbQtulzgqiG/JM40cWYCRn6+YaoqZqYhnRWMM00mPbmuyU2NLOZMdUUmyxCb2QZRN8i2RTUdubKMp4JRLhnPFNHv8YxRKoONJ4o4t6FqOnNMZBmKjFIVzgYc8qbGIluPXJQY32CqOaJsmNqSaEi82n2mwwVZdBTthqJd45p1KDDE7ycyyJL1ieLhk/L5B+XySNW/UHQHVLUjur4sWKYDpqLA1qvQp+vZXarIhCJTBnX8E/fjJ+b4ido+4p6eMY9PqM3j5YW3pMMrtV9QL3ehh7/FOaPJpSX3uSYWBnus8B8t/q1DrD162+K+LVCb5oYw/SU5ly1FvUXZJZPcE0/cJSdTgdQe5/j3JdXbmryvcYcl9fmB5ny8lTygZpwLxFZQvVR03zvac4vcCUapIFaGxFjsy5zqr57qfY3qPe44p3zd4M97omEV7hLxRXohnDYav+voDtuAqi9CwViaYHldIhaevClRzpEZS2KGYvoieSAMPRokJzJIVG4ZZOuiJ8mKS1zqQCjMiqJ7wj/t8f2etj8wXx2pFnuicr4NE70PE770MBUuLPTwK4ZFvktmYQcHwkQ71ONP3Ou/mMM/mPUJ93DCrF8odu9EplqGfUtyy+1OXid+6wcVUx166D+W+Ncef+7pPvc0309U5xORcO2vn/JFcPVvf9D/CP+4THkgVN9a/HmFeuhJGsN/eeu6vORZepEAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/1e18672cb5c15870309d6a2258f9a927/fcda8/1671019200012-e8b99a2c-88aa-444c-bc8c-a3716fe59410.png\"\n        srcset=\"/static/1e18672cb5c15870309d6a2258f9a927/12f09/1671019200012-e8b99a2c-88aa-444c-bc8c-a3716fe59410.png 148w,\n/static/1e18672cb5c15870309d6a2258f9a927/e4a3f/1671019200012-e8b99a2c-88aa-444c-bc8c-a3716fe59410.png 295w,\n/static/1e18672cb5c15870309d6a2258f9a927/fcda8/1671019200012-e8b99a2c-88aa-444c-bc8c-a3716fe59410.png 590w,\n/static/1e18672cb5c15870309d6a2258f9a927/073e9/1671019200012-e8b99a2c-88aa-444c-bc8c-a3716fe59410.png 719w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>相比上文，其他的改进点在 deployment.yaml 文件中添加了 replicas，并指定了 2，使得同时有 2 个 pod 运行。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bdf761580b286922585eac1db544ee7b/4d08a/1671019268246-1de82347-6145-45e4-9b15-d15fbb5e53bd.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACRElEQVR42l2Sa26bQBhFvZLGjjFgzAwMDJgBg59xbKexkypu00iJVFVdQH9W3UE3fSrGiav0x9E8QFf3znc7ntCEiSHOaiI9QZdzkvHU7tV4ii4XyLQiymrSYoEvMj70A7qDkItBaFeLKyydvh/hhan9sWUoM9wwxR0l9t4TGWFSIlVOXBpkZhCqQCQFoXpjzFBofJHScYYxQVwwjHK7jpShvbv0JD1X0vMioukjyfyJbP+VbLHHzO8p5ncUsz1Z85F0coPIVpZObxBaB6mZWdqorbOeK+h7AseXqMML6tMLav+MXG5JNhvU9Q3Z7jNBs8HJa9xiaulcvkZOzRyRlPY9Tu4EvpAMZUxymKGPOeNjhdoa9KEmu71GbVYMJyleGZ/pXHqCOG/sMNrYbw/e7Um6TkRvkKB2a5K7Cfn9ErVuKI4z1PUCzyS4RuGVid23dAaisILjek1eLW3kduqjWiLXIXIXMPmZM/0dsv4T0Pzy0bcNajfBK/VZ0D0LhmN8oW3kol7bmvgyI6gE0VYgN4Li24Tiu6b6YZA7hbwq0IcGsSpOLstXl2VyGooTqFPPzNw6bKvTvWzfMabvp+fI5uGKUV0Qbw3muEKumn+Rz4KeZBAoGzurlrbMreN2MI6IGESK5LBEHyvqpzWjaU68K2me1wTTDLf4X9AVVlDqiXXYVujCGdkpO2GEIxXJfoV+qDBfFgRNZl3FG4NcNniVfufSCrZu2vr0X7FnS/stIj2cBKvHFaMmJ1zk6H2NvDL4VfpO8C/wiYKJ+sEtRwAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/bdf761580b286922585eac1db544ee7b/fcda8/1671019268246-1de82347-6145-45e4-9b15-d15fbb5e53bd.png\"\n        srcset=\"/static/bdf761580b286922585eac1db544ee7b/12f09/1671019268246-1de82347-6145-45e4-9b15-d15fbb5e53bd.png 148w,\n/static/bdf761580b286922585eac1db544ee7b/e4a3f/1671019268246-1de82347-6145-45e4-9b15-d15fbb5e53bd.png 295w,\n/static/bdf761580b286922585eac1db544ee7b/fcda8/1671019268246-1de82347-6145-45e4-9b15-d15fbb5e53bd.png 590w,\n/static/bdf761580b286922585eac1db544ee7b/4d08a/1671019268246-1de82347-6145-45e4-9b15-d15fbb5e53bd.png 709w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br />其他文件略过，在此不表。最终需要在 .github/workflows 文件夹下添加一个 cicd 的描述文件：</p>\n<p>yaml\nname: cicd</p>\n<p>on:\npush:\nbranches: [ main ]\npull_request:\nbranches: [ main ]\nschedule:\n- cron: 0 */12 * * *</p>\n<p>jobs:\ndeploy-okteto:\nruns-on: ubuntu-latest\nneeds: build\nsteps:\n- uses: actions/checkout@v3\n- run: curl -LO <a href=\"https://storage.googleapis.com/kubernetes-release/release/$(curl\">https://storage.googleapis.com/kubernetes-release/release/$(curl</a> -s <a href=\"https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl\">https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl</a>\n- run: chmod +x ./kubectl\n- run: sudo mv ./kubectl /usr/local/bin/kubectl\n- run: mkdir ${HOME}/.kube&#x26;&#x26;mkdir ${HOME}/.aws\n- run: npm i -g k8ss\n- run: echo -e machine github.comn  login ${{secrets.GH_TOKEN}} > ~/.netrc\n- run: echo -e [lambda-doc-rotary]naws_access_key_id = ${{secrets.AWS_ACCESS_KEY}}naws_secret_access_key = ${{secrets.AWS_SECRET_KEY}}n > ~/.aws/config</p>\n<pre><code>  - run: wget https://github.com/mozilla/sops/releases/download/v3.7.3/sops-v3.7.3.linux.amd64\n  - run: sudo cp sops-v3.7.3.linux.amd64 /usr/local/bin/sops\n  - run: sudo chmod +x /usr/local/bin/sops\n\n  - run: git clone https://github.com/Jeff-Tian/k8s-config.git ${HOME}/k8s-config\n  - run: k8ss switch --cluster=okteto --namespace=jeff-tian\n  - run: sops -d k8s/app/secrets.yaml --aws-profile lambda-doc-rotary | kubectl apply -f -\n  - run: kubectl apply -k k8s/app&#x26;&#x26;kubectl rollout restart deploy id6\n</code></pre>\n<p>build:\nruns-on: ubuntu-latest\nsteps:\n- uses: actions/checkout@v3\n- run: echo ${{secrets.DOCKER_PASSWORD}} | docker login -u ${{secrets.DOCKER_USERNAME}} --password-stdin\n- run: sh .github/ci.sh</p>\n<p>注意在这个文件里，依赖了多个环境变量，这需要添加在 github 代码仓库的 secrets 里：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 97.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAAC8ElEQVR42n1UyY7UMBCd70Cj6U46i+MlduLEWTq9zCoWaSRAiCMSAnHigDhz5Lsfqkp3Tw8SHEplO85z1XtVdZFrD1X1KMoWtNZVz97UI3thGkgbkKmavXIdaj8i9FukhcNKWCRndhFlBqmsIV2HOLegfZSVB2/4MdtOKJs1dD1gmWokuUHC3/XpHp0vMzMD5qZBpj0f0j7Oy5NJ18P4NYwfGTBTHqmq2SgDCobW4oBxArTNxNFQCkdQ8hSZH/bwwzXqfsdUEC3kKXL6R1cDymbiR58A2w0firJ9FqX0W6h6Yo4LG2ZftjO3rmPP+4MGDEih0uVcN8/AaC3KDtqvORJpO358tvbMzyZMOwMSOqWWFG4GPBiRTml0mweEzT2a9Q2UXUNXxOe5DQcbzwEnRCQKKV1UiIRDnFmkquK0KEJlR6jJIFYKUTpnEAuH1E5IzMB7BqR0637PnCzaW1xNj1i2e0TdBpHoud4IOF55uLc5qncp4qVDIi1nxSbmNQMSEClIIS/8DlfNPdJg4T8tEB4D+u1LTrnqdlBuQPu+hR730M0WutlAdddQ3Q2vZ0DbMYdUMjEVa2wgdwLtlwX6rynM0ELZAarukWQO+e2I1eYBsb9G7HeIwy2i8RVWZf+kciIr5iCRDlHiUGwKjD8v4T/kyEQLWQVkIiDvJMzrBMtIz49nGnFKpp44JFGqbsvFTWoVJmAlNYYflzB3GsIELl5Vdei+LZFWGlFiEYvyrKss+wOHPXcCDQB+URgsFw799wXsGwkpJxZNh4D6roF2c18r13NDUGkRZRTYBSErv2VRuFC1R156JEmA/yiw/XWJohjhug1y3WKV1SdlV0eFj/vjtFkJxxFQ+cy1VXJKaa2w//0ChWtYOIqKOaaiz58m0tFOKRM6TZHzKcOtl1q0nyPo0UOWw9xNB/H+vnu0Ux26sOVephE2fzSIkhLFqCEqGq49UlmdyP8vIKVKgCRMUYYTaJQbpMIzd/ToeWr/AvwDOTNGvGhRxk4AAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/49d07779c00bf58c270570f595be9e75/fcda8/1671019509566-c8b7f9ac-9e53-46fd-ba10-2f5eb67588db.png\"\n        srcset=\"/static/49d07779c00bf58c270570f595be9e75/12f09/1671019509566-c8b7f9ac-9e53-46fd-ba10-2f5eb67588db.png 148w,\n/static/49d07779c00bf58c270570f595be9e75/e4a3f/1671019509566-c8b7f9ac-9e53-46fd-ba10-2f5eb67588db.png 295w,\n/static/49d07779c00bf58c270570f595be9e75/fcda8/1671019509566-c8b7f9ac-9e53-46fd-ba10-2f5eb67588db.png 590w,\n/static/49d07779c00bf58c270570f595be9e75/efc66/1671019509566-c8b7f9ac-9e53-46fd-ba10-2f5eb67588db.png 885w,\n/static/49d07779c00bf58c270570f595be9e75/c83ae/1671019509566-c8b7f9ac-9e53-46fd-ba10-2f5eb67588db.png 1180w,\n/static/49d07779c00bf58c270570f595be9e75/11d70/1671019509566-c8b7f9ac-9e53-46fd-ba10-2f5eb67588db.png 1802w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=DZLgd></a></p>\n<h1>第六步，没有第六步了！</h1>\n<p>提交代码，等待 Actions 跑完：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/aedbed6e221cfbd8b0f6c9d9e1df4aad/9e7e4/1671019674517-d0ca42bb-7c2c-4b14-8a68-abac30757c40.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.432432432432435%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABuUlEQVR42mVS2Y7aQBD0d0AEBttzX54Z28DasCtFq+QhUv7/ZyqahgWWPJSq5+jqnpquQj4hzb8QTr8RL3/h5z+waYGyEVx5cB0gdKC44QYN03duuUHLLaFhBsolVJ2O0HEG82+Q6R28v4DZCa3qUc5aGa6x6immPdWD6YRGeOy4w5474nJeMRWhwwENt2AqUDVrI6SJt6QApiOEzejUlWntBhLc3wRJlFlUYkgIxwU+L4iHd/hhQRgX+GGGzzP68QxhB+w6Qwn1Cz8LFlTMZ4SpiJyvGBYSdekNNp0I3KRbsr114u5ir6KVcEeYeKSk8gTyTAZsWw1hEqQfwW0mtDpjxwM9m5tMAqY/3nNa2aMSfQJ3+VGJPUyWNkGHCSpM5Bl3B+zl1cdSqDRQuIg1BcKj4jHB5hOkG7+1XjxiJtPF1ZZhXXPCj534Ly78BRqb8pxXc0vHu85i0yis64cgYcux2jCsNt33/ZqjKl7004U8eTa4bg1kGpHnn/DDGW5YEI8fYDqDuYTp4xPj/IkwXhCmC4Qbsd4yVM8fQV19/V5nsZeOBnlf5o3u9WTFlhkwm+5zWlB3ljr8BzSvSlR9h0CSAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/aedbed6e221cfbd8b0f6c9d9e1df4aad/fcda8/1671019674517-d0ca42bb-7c2c-4b14-8a68-abac30757c40.png\"\n        srcset=\"/static/aedbed6e221cfbd8b0f6c9d9e1df4aad/12f09/1671019674517-d0ca42bb-7c2c-4b14-8a68-abac30757c40.png 148w,\n/static/aedbed6e221cfbd8b0f6c9d9e1df4aad/e4a3f/1671019674517-d0ca42bb-7c2c-4b14-8a68-abac30757c40.png 295w,\n/static/aedbed6e221cfbd8b0f6c9d9e1df4aad/fcda8/1671019674517-d0ca42bb-7c2c-4b14-8a68-abac30757c40.png 590w,\n/static/aedbed6e221cfbd8b0f6c9d9e1df4aad/efc66/1671019674517-d0ca42bb-7c2c-4b14-8a68-abac30757c40.png 885w,\n/static/aedbed6e221cfbd8b0f6c9d9e1df4aad/c83ae/1671019674517-d0ca42bb-7c2c-4b14-8a68-abac30757c40.png 1180w,\n/static/aedbed6e221cfbd8b0f6c9d9e1df4aad/9e7e4/1671019674517-d0ca42bb-7c2c-4b14-8a68-abac30757c40.png 2056w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>IdentityServer 的第二个分身上线了！</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}