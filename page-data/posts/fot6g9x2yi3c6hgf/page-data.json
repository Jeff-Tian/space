{"componentChunkName":"component---src-templates-post-js","path":"/posts/fot6g9x2yi3c6hgf/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/fot6g9x2yi3c6hgf","relativePath":"posts/fot6g9x2yi3c6hgf","frontmatter":{"title":"使用 Keycloak 打造多个系统间的单点登录体验","stackbit_url_path":"posts/fot6g9x2yi3c6hgf","date":"2023-05-08T11:56:23","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p>之前因为不同的目的，做了几个示例程序。今天，把它们串起来，以实例的方式，展示一下如何用 Keycloak 来打造单点登录体验。\n<a name=GM1LT></a></p>\n<h1>问题</h1>\n<p>有两个系统，分别由不同的团队开发，技术栈也完全不同。在交付时，发现其用户群体是一样的，用户希望能够拥有单点登录体验。在这里，虽然是一个假想问题，但是在实际工作中可能会经常碰到。比如，A 系统由外包团队开发，B 系统由公司 in house 开发。或者 A 系统由一个外包公司开发，而 B 系统由另一个外包公司开发。但是它们都是整个公司数字化中的一小块儿，在实际上线后，属于同一个整体。在这种场景下，启用单点登录体验，不仅方便用户，也方便公司的管理。</p>\n<p>要启用单点登录，用任何一种身份认证服务都行，之前也举过基于 Duende IdentityServer、authing.cn 等的例子，今天再拿 Keycloak 举一个例子。\n<a name=nYRdI></a></p>\n<h1>流程图</h1>\n<p>不同的具体情况有不同的集成方式，但是以下流程图是一个最基本的并且可行的集成方式，即将 Keycloak 做为一个独立的服务，不同的系统和它进行对接即可。这种方式，会导致页面之间存在跳转，但是对于用户来说，不需要二次登录，因此体验上还是可以接受的。\n<img src=\"https://cdn.nlark.com/yuque/__mermaid_v3/88daa1c58940e7642fdaf2a42cf7de88.svg#lake_card_v2=eyJ0eXBlIjoibWVybWFpZCIsImNvZGUiOiJzZXF1ZW5jZURpYWdyYW1cbiAgICBhY3RvciBVc2VyIGFzIOeUqOaIt1xuICAgIHBhcnRpY2lwYW50IEJyb3dzZXIgYXMg5rWP6KeI5ZmoXG4gICAgcGFydGljaXBhbnQgQVxuICAgIHBhcnRpY2lwYW50IEJcbiAgICBwYXJ0aWNpcGFudCBLZXljbG9ha1xuXG4gICAgVXNlciAtPj4gQnJvd3Nlcjog6K-35rGC6K6_6ZeuIEFcbiAgICBCcm93c2VyIC0-PiBBOiBcbiAgICBBIC0tPj4gQnJvd3Nlcjog5bGV56S65qyi6L-O6aG1XG4gICAgXG4gICAgVXNlciAtPj4gQnJvd3Nlcjog6K-35rGC6K6_6ZeuIEEg5Lit6ZyA6KaB55m75b2V55qE6aG16Z2iXG4gICAgQnJvd3NlciAtPj4gQnJvd3Nlcjog5qOA5p-l5piv5ZCm5a2Y5ZyoIHRva2VuXG5cbiAgICBhbHQg5rKh5pyJIHRva2VuIOaIluiAhSB0b2tlbiDov4fmnJ9cbiAgICAgICAgQnJvd3NlciAtPj4gQTog6K-35rGC6K6_6ZeuIEEg5Lit6ZyA6KaB55m75b2V55qE6aG16Z2iXG4gICAgICAgIEEgLS0-PiBCcm93c2VyOiAzMDIg6YeN5a6a5ZCR5YiwIEtleWNsb2FrXG4gICAgICAgIEJyb3dzZXIgLT4-IEtleWNsb2FrOiDor7fmsYLmjojmnYPnoIFcbiAgICAgICAgS2V5Y2xvYWsgLS0-PiBCcm93c2VyOiDlsZXnpLogS2V5Y2xvYWsg55m75b2V6aG1XG4gICAgICAgIFVzZXIgLT4-IEJyb3dzZXI6IOi-k-WFpeeZu-W9leWHreaNrlxuICAgICAgICBCcm93c2VyIC0-PiBLZXljbG9hazog55m75b2V5Yet5o2uXG4gICAgICAgIEtleWNsb2FrIC0tPj4gQnJvd3Nlcjog5Zue6LCDQe-8jOWcqHVybCDkuIrluKbkuIrmjojmnYPnoIFcbiAgICAgICAgQnJvd3NlciAtPj4gS2V5Y2xvYWs6IOS9v-eUqOaOiOadg-eggeaNouWPliB0b2tlbiAoUE9TVClcbiAgICAgICAgS2V5Y2xvYWsgLS0-PiBCcm93c2VyOiDov5Tlm54gdG9rZW5cbiAgICAgICAgQnJvd3NlciAtPj4gQnJvd3Nlcjog5a2Y5YKoIHRva2VuXG4gICAgZWxzZSDlrZjlnKjmnInmlYjnmoQgdG9rZW5cbiAgICAgICAgIFxuICAgIGVuZFxuXG4gICAgQnJvd3NlciAtPj4gQTog5ZCO57ut6K-35rGC5bim5LiKIHRva2VuXG4gICAgQSAtLT4-IEJyb3dzZXI6IOWxleekuueZu-W9leWQjueahOmhtemdolxuXG4gICAgVXNlciAtPj4gQnJvd3Nlcjog6K-35rGCIEIg5Lit6ZyA6KaB55m75b2V55qE6aG16Z2iXG4gICAgQnJvd3NlciAtPj4gQnJvd3Nlcjog5rKh5pyJIEIg5Z-f5ZCN5LiL55qEIHRva2VuIFxuICAgIEJyb3dzZXIgLT4-IEI6IOivt-axgkLvvIjmnKrluKbkuIp0b2tlbu-8iVxuICAgIEIgLS0-PiBCcm93c2VyOiAzMDIg6YeN5a6a5ZCR5YiwIEtleWNsb2FrXG4gICAgbm90ZSBsZWZ0IG9mIEJyb3dzZXI6IOi_memHjOeUqOaIt-S9k-mqjOWIsOmhtemdouS4gOmXquiAjOi_hzxiciAvPuiZveeEtuaciei3s-i9rO-8jOS9hueUseS6juS4jeeUqOmHjeaWsDxiciAvPueZu-W9le-8jOaJgOS7peWunumZhei_h-eoi-W-iOW_q-OAglxuICAgIEJyb3dzZXIgLT4-IEtleWNsb2FrOiDor7fmsYLmjojmnYPnoIFcbiAgICBLZXljbG9hayAtPj4gQnJvd3Nlcjog5Zue6LCDIELvvIzlnKggdXJsIOS4iuW4puS4iuaOiOadg-eggVxuICAgIEJyb3dzZXIgLT4-IEtleWNsb2FrOiDkvb_nlKjmjojmnYPnoIHmjaLlj5YgdG9rZW4gKFBPU1QpXG4gICAgS2V5Y2xvYWsgLT4-IEJyb3dzZXI6IOi_lOWbniB0b2tlblxuICAgIEJyb3dzZXIgLT4-IEJyb3dzZXI6IOWtmOWCqCB0b2tlblxuICAgIEJyb3dzZXIgLT4-IEI6IOWQjue7reivt-axguW4puS4iiB0b2tlblxuICAgIEIgLS0-IEJyb3dzZXI6IOWxleekuueZu-W9leWQjueahOmhtemdoiIsInVybCI6Imh0dHBzOi8vY2RuLm5sYXJrLmNvbS95dXF1ZS9fX21lcm1haWRfdjMvODhkYWExYzU4OTQwZTc2NDJmZGFmMmE0MmNmN2RlODguc3ZnIiwiaWQiOiJ0VTZBOCIsIm1hcmdpbiI6eyJ0b3AiOnRydWUsImJvdHRvbSI6dHJ1ZX0sImNhcmQiOiJkaWFncmFtIn0=\" alt=\"\">\n<a name=GusTR></a></p>\n<h1>举例</h1>\n<p>Keycloak 仍然拿我的 <a href=\"https://keycloak.jiwai.win\">https://keycloak.jiwai.win</a> 做为实例，A 系统是 <a href=\"https://umi-ckeditor5.brickverse.dev/\">https://umi-ckeditor5.brickverse.dev/</a>，而 B 系统是 <a href=\"https://uniheart.pa-ca.me/keycloak/login\">https://uniheart.pa-ca.me/keycloak/login</a> 。你可以先点击 A 系统中的登录按钮：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/be7b6cc49a60a385d8a03b692f743ed9/136a2/1683546463383-f08270ff-b4d9-401a-a145-90f65a7f0de9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABV0lEQVR42rWQzU7CQBSF5yEUDCZCFAoIldpfoIXyE4FIQY3x6YhPgAtCqT4BrFh12x2EHRCWhADHdJSGxB3gJF/u3JPJmXMveeNYNGoMAjkG8SiLSs3AY70Jw3imtVoz0Hx6/dEaL6hU68jrJfCCgiTLIRyJ4Sp4jWDohkLkOw6imMItz0GSssjrZWhaAcXSA3L5IsW9u7peKENVdShpjRomkilEYwlEmLgHkTM5JFkBsqQiq+oIhsIIR+JIcQK4exGqpkOS0uAFGaKoQBAVyEoGPC/h7PwCPn8APv+lB2m13tFuf8CyvmCaFsyeBdPs0dr7hfae9klx33Y63T8Q27axXq9xqkPm8zmm0ykmkwkWiwU2mw394FBIv9/HcDjEYDDAaDTCarXCcrk8GOI4DsbjMWazGY3sJtxutwdD9ud3haN3uDPamR2Tzku4LxyblJxq1H8z/AZEAWSK46Iw7wAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/be7b6cc49a60a385d8a03b692f743ed9/fcda8/1683546463383-f08270ff-b4d9-401a-a145-90f65a7f0de9.png\"\n        srcset=\"/static/be7b6cc49a60a385d8a03b692f743ed9/12f09/1683546463383-f08270ff-b4d9-401a-a145-90f65a7f0de9.png 148w,\n/static/be7b6cc49a60a385d8a03b692f743ed9/e4a3f/1683546463383-f08270ff-b4d9-401a-a145-90f65a7f0de9.png 295w,\n/static/be7b6cc49a60a385d8a03b692f743ed9/fcda8/1683546463383-f08270ff-b4d9-401a-a145-90f65a7f0de9.png 590w,\n/static/be7b6cc49a60a385d8a03b692f743ed9/136a2/1683546463383-f08270ff-b4d9-401a-a145-90f65a7f0de9.png 884w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>它会跳转到 Keycloak 登录页：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e853e52018e757d49cd64e044809fed9/2aa89/1683546513421-6a50a629-deb8-495b-ac48-a82e0be3d8bb.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.21621621621621%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB8ElEQVR42q2TbXPSQBSF81v1S7/x0oqD/jCccToFK0jakiCFabGjgJR3NoEkkJBs8jhEqm21NVV35uTOJnfP3XtyrnJw8JK9vTzPnr9g/yBH/tVrcrk8mcw+qXSW9O2YypJOZ+N9/C6d/ZGXSmXiqEgZUipFnJ3xX5biOCtKJQ9VDQjDiChKhvu5YRjGUfG8DZrmc3wcYNsRkJz0d1Bc16Vc3qCqMibbru8f/7Jlz/NRVZ9aTbJc/iT8Jw0LBRddl3/UMEkxJQgCqtWAWi3Cth+vnuTmimEIZrMVprnCdVd4nsdW1/V6HcctHMdhs9nc0vdhYuWoWOTw8C2aXqNarVKv16lUKmiaxsnpKeVKhTeFAv1+Pz5wY48HCa3OZ6zBNdIQ+GKGNx2zmU0ITAFiCtbil5YfJbz8UORCP8EYdHCNCZ4hYrimgZxPYSFiMyX2Ye9ijPa+jV5u065/RVoWkWMROhaRvQTff5ptanqPM73P3ABzCSH3sBurpFAW5gwxHyPmIxzbjKvILUnELkk+jXA+FwyHI0bjKYulHU9f5K6J1isi39/pdxePtrx9dDtw+dHj6sKncTSg/a5H47BPqyq4+gLNZkCjITk/l7RaEiHCO56881OGkylm94prtUlX7eO1P8GwCzKAUN4YJvHUfAPZk1fZ3rMPUwAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/e853e52018e757d49cd64e044809fed9/fcda8/1683546513421-6a50a629-deb8-495b-ac48-a82e0be3d8bb.png\"\n        srcset=\"/static/e853e52018e757d49cd64e044809fed9/12f09/1683546513421-6a50a629-deb8-495b-ac48-a82e0be3d8bb.png 148w,\n/static/e853e52018e757d49cd64e044809fed9/e4a3f/1683546513421-6a50a629-deb8-495b-ac48-a82e0be3d8bb.png 295w,\n/static/e853e52018e757d49cd64e044809fed9/fcda8/1683546513421-6a50a629-deb8-495b-ac48-a82e0be3d8bb.png 590w,\n/static/e853e52018e757d49cd64e044809fed9/efc66/1683546513421-6a50a629-deb8-495b-ac48-a82e0be3d8bb.png 885w,\n/static/e853e52018e757d49cd64e044809fed9/c83ae/1683546513421-6a50a629-deb8-495b-ac48-a82e0be3d8bb.png 1180w,\n/static/e853e52018e757d49cd64e044809fed9/2aa89/1683546513421-6a50a629-deb8-495b-ac48-a82e0be3d8bb.png 1698w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>推荐使用邮箱密码登录（没有账号的话可以先注册），或者使用 GitHub 登录（其他的登录方式还在开发中……）。</p>\n<p>登录完成后（跳回了系统 A），可以看到 token 信息：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/16de7acb83ee934d3284f87902652c8c/c6bbc/1683546582422-ae6b3dcb-dd73-402b-81a3-335653dff5cc.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 122.97297297297298%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAABYlAAAWJQFJUiTwAAAChElEQVR42q2V2U4bQRBF+yMSKW/JQ8hDAtgWToz4t2AgwhvK1yHLNt7wvgDeN4ztik5JNZo4RkqsjHTV3dXVt27VdM24QDAsXw5DiuNAWA4+fZb3Hz7K0XFIAsET+RY5k8jpmQRDYQl/PZWTcERxeBSUN2/f/QEXvbiS7+cXEk+kJHXzU2LxpFz9uJZYLKHzRPJGkskbiTNPpDxcxxISjV7KefRSR4O7v78X8L8e1+l0pNlsyuPjozw9PclyuZT1er03XC6Xk2w2K7e3t4rpdKqki8ViL7jn5+ffJGNcrVb7pzyZTLSGhULBGweDgRLP53MhIJjNZmpjbnvb6rC5Wq0md3d3QuqlUknK5bIUi0W1AWyMlCWTyWhA5gA763w+751xEGAAkHIIEhwYK5WKd5B9v6+fzOA4ACmHcTJVbOLMmlJgs7WpNHJ8OQuPq1arurAIOLBh0QFBt5VAbPv4mhC92CwsdcgNrHHCx4iY++vHvoFyOXMwJ1PrH60EVhLzMzGmjgCOLmk0GtopdI0/IuUgXcgYWZOJ2U09MLszJxS2Wi15eXnx7p/dL7uDdJDdS2B30ToLm77lbrerUR4eHmSz2SisN5nzmM32zWZBGIG2Ht2CMpRASuq9Xk8/Fszb7baO7FEiMqnX61omIzY4ZFMjHFCZTqe9boGAQ2TA3AKwJki/399NSB1pQSJTaJzp5795LH3v42CERmRzlIzHY00ROxkQ0BSyt63OIyRFXg7gINeIlKktaVJPUmZEOaDefkJPIRsQkjKEkI1GI53/a7qeQmsr0rV2oxMIQrqAj64/vdegCg2Q8wsYDodaIz92qdn5xYaAC4sC7iLjrp/P9gV+Db8AlewbWsOeaSEAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/16de7acb83ee934d3284f87902652c8c/fcda8/1683546582422-ae6b3dcb-dd73-402b-81a3-335653dff5cc.png\"\n        srcset=\"/static/16de7acb83ee934d3284f87902652c8c/12f09/1683546582422-ae6b3dcb-dd73-402b-81a3-335653dff5cc.png 148w,\n/static/16de7acb83ee934d3284f87902652c8c/e4a3f/1683546582422-ae6b3dcb-dd73-402b-81a3-335653dff5cc.png 295w,\n/static/16de7acb83ee934d3284f87902652c8c/fcda8/1683546582422-ae6b3dcb-dd73-402b-81a3-335653dff5cc.png 590w,\n/static/16de7acb83ee934d3284f87902652c8c/efc66/1683546582422-ae6b3dcb-dd73-402b-81a3-335653dff5cc.png 885w,\n/static/16de7acb83ee934d3284f87902652c8c/c6bbc/1683546582422-ae6b3dcb-dd73-402b-81a3-335653dff5cc.png 910w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>这时，打开系统 B：  <a href=\"https://uniheart.pa-ca.me/keycloak/login\">https://uniheart.pa-ca.me/keycloak/login</a> ，你会看到页面一闪而过，但是不需要你输入登录凭据，它会自动进入登录态，即展示 token 信息：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.4054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAABs0lEQVR42k2UR3bDMAxEeRdvZJVYxYqqe/fz/a+DvI9kFC5gQiAwGBQ61E1r7XdvZdnYtu2sbTvrh9Gqemt1vbVknVma5bZOc0uRrHAbsv6TPP+yLCtcD13X2eVysfv9bvM82zxPdrvd3MZ5vV7tfD7b8Xh0Hfvj8bDT6eR2+egu7HY7v5AjF4CjYyeQROjYOfF5Pp+LLzb80R0QRYxwfL/fDgSrGERJiMFf7OVLfOj7fgk4HA4u0zQtJfDNSQC6APb7vdsExB0xYRiGpUcYx3H0APVIYJxKLCBA5cs3sYEfBeEgBgLDJjCxoWR0MYUIlSI+ZV1yAWN0OSDYCeSOdmCDCCJmq9XKkiSx0DSNZ0SUkbI0fZUjXcNj8vj+rtr8vzb60KQ5NVkC0VUquvZObdGksWNzwNfr5esidgoggfolJgKSlGVpdV37WVWVBXrC3hEstqIfl4auAaLHQ5OQ2BdbZajcGFATZqm12FojAcatCFqLuBT1TYPQ7qETqCcavyYlCHpGevzKhtDbeN/0xuM/j8/n43580zoH1PjVP+2XWEjYR/w2m41lWeaSpukiRVHYD11BLFT2b7kcAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/b42ef8f8d65dfb6e26f429048812d918/fcda8/1683546675811-c1f74cf1-28ce-4441-b193-9feb01b7d299.png\"\n        srcset=\"/static/b42ef8f8d65dfb6e26f429048812d918/12f09/1683546675811-c1f74cf1-28ce-4441-b193-9feb01b7d299.png 148w,\n/static/b42ef8f8d65dfb6e26f429048812d918/e4a3f/1683546675811-c1f74cf1-28ce-4441-b193-9feb01b7d299.png 295w,\n/static/b42ef8f8d65dfb6e26f429048812d918/fcda8/1683546675811-c1f74cf1-28ce-4441-b193-9feb01b7d299.png 590w,\n/static/b42ef8f8d65dfb6e26f429048812d918/efc66/1683546675811-c1f74cf1-28ce-4441-b193-9feb01b7d299.png 885w,\n/static/b42ef8f8d65dfb6e26f429048812d918/c83ae/1683546675811-c1f74cf1-28ce-4441-b193-9feb01b7d299.png 1180w,\n/static/b42ef8f8d65dfb6e26f429048812d918/de766/1683546675811-c1f74cf1-28ce-4441-b193-9feb01b7d299.png 1838w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a name=F40lg></a></p>\n<h1>具体配置</h1>\n<p>一般来说，要将多个不同的系统中联系起来，实现单点登录，并不需要太多编码，只需要配置即可。实现上，以上两个项目，在开发时是出于完全不同的目的，但通过配置同一个 keycloak 实例，它们就联在一起了。</p>\n<p><a name=nfeZZ></a></p>\n<h2>A 系统的配置</h2>\n<p>源码见：<a href=\"https://github.com/Jeff-Tian/umi-ckeditor5/blob/main/.umirc.js\">https://github.com/Jeff-Tian/umi-ckeditor5/blob/main/.umirc.js</a></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e03a260701c0feb49a57076dfbcbc478/cea38/1683546835452-724d7977-1ab1-49c5-9e16-0fc2b2d2b942.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.1081081081081%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACqUlEQVR42pWT627jOAxG/STTpollybJlSY7vdpw07WQ76Gx3gMW+/5uchZRuO5digP1xQJMGP5EUlbTDgWE+UbcT43JiXM7U3QFbD/hmwNU9ru6wvqVyDaqwpLJAyPJDknK/0Cx/MJ+f8eM9Zf+IXV5w42f6w2dst1L4kbKeImY//4aFxNQTvj/Srxf65cK+P2HbGdcdKOoJ267Y9vCDaPEdwdduYD+dWR6+ksiyQZoWZVra4ZH1/I3p+JXl/oVufsI1K2nu2ErDVlYfslMWoT1ZUZOkuY8Jt2nBzVaRuRl7+puyv1A3J6xfMHZE+xm9X1F+Qu8PKD+T1zPKTexyx0YUbET5Kqh9dO4yg/ILohoR1cBOOXbSkgabB/xP1rFVLub9l59Is3+rMJSd6ppNZrjLqnhqiAc20eof/CAShV7Fgk2afmEjqygST9UeUTaRna6RVUda1Gzz97gwTazsVpTcZuaKuNrEuJZMWXRuybUnzx1KGmRWIKVBqerqh+/vkFn5C5koSLbaM6kCnzuG+Qvj9MTUnxj2E5XQmFT9hjxSpYoyzemFIgkza3TFjShR3SPm+BfV8Ru6OyPsQGoHMjch9wdkfUC4KW5C5hcyP7+xczNFVpCEmbV5GGhB0T3g1j+xh2f8+ozpz1TjI6a7p2xP0S+alaI5Ur7GivaI6U5IP2OEDhV6mtywzQzF9Ew5PWGGhyjklqerYH9GuTEucbzNnwi5N5mhFPm7YLhy3T1g1xfMeIkLK+2ItAN5WOpmJa+XKBz+hZiKTDEW2vZlfRVsdcUm1ZTDhf3jP/jjC9XwEF9EILQZWnxveX1rN7Qf/Lw9YVX1Kpib+FqEmxH+wK7s2IYFD/v5hn2l+pBP0lKGGd4pS61Kel3hhMKlEi8UXuT4TP8vmkzzL+4uETUizUTCAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/e03a260701c0feb49a57076dfbcbc478/fcda8/1683546835452-724d7977-1ab1-49c5-9e16-0fc2b2d2b942.png\"\n        srcset=\"/static/e03a260701c0feb49a57076dfbcbc478/12f09/1683546835452-724d7977-1ab1-49c5-9e16-0fc2b2d2b942.png 148w,\n/static/e03a260701c0feb49a57076dfbcbc478/e4a3f/1683546835452-724d7977-1ab1-49c5-9e16-0fc2b2d2b942.png 295w,\n/static/e03a260701c0feb49a57076dfbcbc478/fcda8/1683546835452-724d7977-1ab1-49c5-9e16-0fc2b2d2b942.png 590w,\n/static/e03a260701c0feb49a57076dfbcbc478/efc66/1683546835452-724d7977-1ab1-49c5-9e16-0fc2b2d2b942.png 885w,\n/static/e03a260701c0feb49a57076dfbcbc478/c83ae/1683546835452-724d7977-1ab1-49c5-9e16-0fc2b2d2b942.png 1180w,\n/static/e03a260701c0feb49a57076dfbcbc478/cea38/1683546835452-724d7977-1ab1-49c5-9e16-0fc2b2d2b942.png 1644w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=ijeV3></a></p>\n<h2>B 系统的配置</h2>\n<p>源码见： <a href=\"https://github.com/Jeff-Tian/alpha/blob/master/keycloak.json\">https://github.com/Jeff-Tian/alpha/blob/master/keycloak.json</a><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.24324324324324%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACT0lEQVR42nWT2ZLbNhBF+SXOWOKGnSQIcJfkGXmrpFJ5if//T46L0EiWK5WHU91oEBe9gFkcFk7nN1zTE+LIPK+EOKFNg2s8TRto2h7ruvTNzXqqWnE4VhzzmmNekRc1RSnIZLugpr+Q8Qtm+o45/4vuT1g/k9eOY8KSC/dY736KVzbFDpXBNBOv17/JjqKlsiO56ilNpHIzKaZ9olAdpfYcRZMoVfcu2qR4/hQvZEcmdYvvZwrhkoBqBvLaIGzA+BnZDNh+RdiYsP1CZXpUO+LCRm0DtQnobkqimesWpvnCdPpCO16oTKRoL4h2TmVbvyTRPdOPpeGl0Mn+n58dlceGjbh9pkuCgdxtN8F+SdntgrloH4fvHCr7H7JtO9PGLZW3p7yXolxEuuG9nB7hIqqd0t5e2n7BnVw2HOonQWl8am6xN1h15Mo/0d2Q7zz2b36RBtGS74gbWb9eCdMn3q5/sp4+MwxnpvmVcbok4nBiWa/Myyt9v+D9gu+X5Ld+wfRrasudTBnPybbMzhOlI0rLoJpk7+sbhlBrgtDJ9kJzlhqp2l/Z7lNWtcHXig+FQc8DZh0R++2Xb8hwotCBo+rJTaR0I4UdKO3AwQ5JuCoUfzwNKtPS0dWal8rirxvh65n4/YJ/+0R3/sb49Qfh9R90uCD9huhWZLdSdWvKvCpvZx9DUbUlCpNef+06dAjUtkO4CTu8IZoJ7TdK5Xk5Cj7mikMu+ZArQimoK81LaTncM9z/xSg0496fUhKqJ0rx8ONOrX5jqiXF/mQe/7zjJ7c5sR6pWFvnAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/25807c91340f09a30f088edc0d57e8b3/fcda8/1683546873609-4094c9a7-ab25-460c-961a-ecf27bccb60a.png\"\n        srcset=\"/static/25807c91340f09a30f088edc0d57e8b3/12f09/1683546873609-4094c9a7-ab25-460c-961a-ecf27bccb60a.png 148w,\n/static/25807c91340f09a30f088edc0d57e8b3/e4a3f/1683546873609-4094c9a7-ab25-460c-961a-ecf27bccb60a.png 295w,\n/static/25807c91340f09a30f088edc0d57e8b3/fcda8/1683546873609-4094c9a7-ab25-460c-961a-ecf27bccb60a.png 590w,\n/static/25807c91340f09a30f088edc0d57e8b3/efc66/1683546873609-4094c9a7-ab25-460c-961a-ecf27bccb60a.png 885w,\n/static/25807c91340f09a30f088edc0d57e8b3/c83ae/1683546873609-4094c9a7-ab25-460c-961a-ecf27bccb60a.png 1180w,\n/static/25807c91340f09a30f088edc0d57e8b3/4719e/1683546873609-4094c9a7-ab25-460c-961a-ecf27bccb60a.png 1330w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a name=Yz0Fz></a></p>\n<h2>java 项目</h2>\n<p>以上两个示例，都是 node 应用。如果是 java 项目，1） 如果引用 keycloak-spring-boot-starter，可以参考 <a href=\"https://zhuanlan.zhihu.com/p/480816990\">https://zhuanlan.zhihu.com/p/480816990</a> ；2） 如果使用 spring-boot-starter-oauth2-resource-server，可以参考 <a href=\"https://zhuanlan.zhihu.com/p/623303771\">https://zhuanlan.zhihu.com/p/623303771</a></p>\n<p><a name=xZpud></a></p>\n<h1>彩蛋</h1>\n<p>关于 Keycloak 的部署，欢迎参考 <a href=\"https://github.com/Jeff-Tian/keycloak-heroku\">https://github.com/Jeff-Tian/keycloak-heroku</a>。也欢迎提出意见和直接贡献代码！另外，附一张 Keycloak 的数据库模型图：</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2023/svg/221736/1683547226030-d75d5487-44aa-4b63-ae77-91038d3604df.svg#clientId=u11751011-b26f-4&#x26;from=ui&#x26;id=u06aa0af0&#x26;originHeight=2741&#x26;originWidth=14600&#x26;originalType=binary%E2%88%B6=2&#x26;rotation=0&#x26;showTitle=false&#x26;size=180462&#x26;status=done&#x26;style=none&#x26;taskId=ube76c8db-c4fe-4f02-b282-8958f09a51b&#x26;title=\" alt=\"graphviz (1).svg\"></p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}