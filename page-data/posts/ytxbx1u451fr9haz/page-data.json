{"componentChunkName":"component---src-templates-post-js","path":"/posts/ytxbx1u451fr9haz/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/ytxbx1u451fr9haz","relativePath":"posts/ytxbx1u451fr9haz","frontmatter":{"title":"免费架构： 靠攻击者活着（赠送红包封面）","stackbit_url_path":"posts/ytxbx1u451fr9haz","date":"2023-01-24T09:51:07","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a name=u04si></a></p>\n<h1>免费架构</h1>\n<p>云计算普及的今天，计算和存储基础设施早已超过了原先希望的有一天能够像水电煤一样随时取用，而是到了像空气一般无孔不入的程度了。空气相比于水电煤，不仅更加容易获取，而且还是免费的。这就催生了一种我杜撰的架构：免费架构：它将全部软件架设在各种云厂商提供的免费云基础设施上。我之前写过系列的“Free Arch”文章，介绍过各种薅云厂商的免费计划的技巧。</p>\n<p>免费架构最好的一点，就是免费，这显而易见。然而，美中不足的是，有一些免费计划，会有一个休眠机制。一旦没有流量，这个应用就会被强制自动休眠。</p>\n<p><a name=dtH15></a></p>\n<h1>被攻击是好事！</h1>\n<p>我部署了很多基于免费架构的应用，最近观察到其中几个应用日志，发现持续收到一些奇怪但有规律的 http 请求，它们请求的路由，是我的应用中并未定义的，明显是在对服务进行扫描，尝试攻击。对于传统应用来说，会想办法对这些可疑请求进行拦截，甚至不惜花高价购买各种防火墙，比如 Imperva、Akamai、阿里云盾等服务。但是对于免费架构的应用，它们的这种行为，简直就是 —— 真香！</p>\n<p>因为这些不怀好意的请求，也是真正的流量呀！它们的存在，让我的应用可以躲过系统的休眠机制，长期对外提供服务了！</p>\n<p><a name=d8CNX></a></p>\n<h1>没有攻击的应对之法</h1>\n<p>当然，不是所有的应用都有这种好运气，能够吸引到这种攻击流量。对于这种情况，当然可以自己定时去访问来避免，但是为此额外做一些工作总感觉不自然，所以最好是能够有足够的自然流量，让应用一直活着。如果没有，这里也提供一个小技巧，感觉是更自然的一种方式，因为它非常简单，而是将定时机制嵌入在了 CICD 流水线。</p>\n<p>我认为写一个项目，首要工作就是构建 CICD 流水线。早发布，常发布，不断迭代。代码未动，流水线先行。既然每个项目都有流水线，那么将项目的“保活”嵌在流水线里，实在是天衣无缝。</p>\n<p>以 GitHub Actions 为例，在实例流水线时，只需要在触发条件里增加一个“计划”字段即可。比如我的这个服务： <a href=\"https://github.com/JeffTrain/face-swap/blob/master/.github/workflows/cicd.yaml\">https://github.com/JeffTrain/face-swap/blob/master/.github/workflows/cicd.yaml</a> ，因为部署在 Okteto 上。Okteto 的机制是每12小时还是24小时，如果应用没有开发活动，就会进入休眠状态。于是我设置了每 6 小时触发一次部署，就让这个应用 7x24 小时连续运行了，亲测有效。</p>\n<p>yaml\nname: cicd</p>\n<p>on:\npush:\nbranches: [ master ]\npull_request:\nbranches: [ master ]\nschedule:\n- cron: 0 */12 * * *</p>\n<p>jobs:\n...</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7b6aa94ba69c65980969a57f02875499/88309/1674553687553-4a4e01f8-2456-4587-b323-fbcfa23de243.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABw0lEQVR42p2S2XLTMBSG/RRd0riN40WWFVuy7CRd6cANzwADQ1nCJLRNmkJ5/Y+R47iFYYbl4puzSPp1zpnjmfoEbacoXZObMVluSaRGZA7T2CTbxKkyxGlOmKifELKgrE95/uIlXiAKpJ6iJ5cIVVHWZ8hiQigNYaoZtoQtTSweibKSOLMM4pz+UOIlowrREmUWaS9IlCXOSsLUdEJPCZKc4RZRNLgi0mKM535xF4JkRCgtonxGrCpEXpPm485uSVT120+K+py8OsPbtFAQJAWxKrEnl9j6HKUnzSh+JXOY446RPW1QpYuneJE0mxZc6VIzshOmmUGJnEHbzp+IlcWNzvleJ+ZsqsmKCiMNUuQEfyHm3rt5u1E432uSwg14U6EsjzFO+J8E2wq3gl2FUqPKMaX8T0HXspthhyopqinVyKKkbnbx8Vy3u/k0Z4hSvdmEYtzc8XYOQjr8iKNIkg0SBn7Erh/S8yP2/Jj9Q0HvMKJ3FLPvx+z2I3b67t2Q3iDlIJBNzlvdP7Baf2O1fqDxv37nerFm/vma94s73syWfJrPufpwxauPS16/m/N2Nmd2s+TL7T2LmzULZ1drZotbfgBYmHOFvzrK8gAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/7b6aa94ba69c65980969a57f02875499/fcda8/1674553687553-4a4e01f8-2456-4587-b323-fbcfa23de243.png\"\n        srcset=\"/static/7b6aa94ba69c65980969a57f02875499/12f09/1674553687553-4a4e01f8-2456-4587-b323-fbcfa23de243.png 148w,\n/static/7b6aa94ba69c65980969a57f02875499/e4a3f/1674553687553-4a4e01f8-2456-4587-b323-fbcfa23de243.png 295w,\n/static/7b6aa94ba69c65980969a57f02875499/fcda8/1674553687553-4a4e01f8-2456-4587-b323-fbcfa23de243.png 590w,\n/static/7b6aa94ba69c65980969a57f02875499/efc66/1674553687553-4a4e01f8-2456-4587-b323-fbcfa23de243.png 885w,\n/static/7b6aa94ba69c65980969a57f02875499/c83ae/1674553687553-4a4e01f8-2456-4587-b323-fbcfa23de243.png 1180w,\n/static/7b6aa94ba69c65980969a57f02875499/88309/1674553687553-4a4e01f8-2456-4587-b323-fbcfa23de243.png 1683w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=GRaEg></a></p>\n<h1>领红包！</h1>\n<p>感谢你的阅读，新年送一个“哈小免”红包封面给你，欢迎通过“哈德韦”小程序领取：</p>\n<p><span>fallback node</span></p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}}}},"staticQueryHashes":[],"slicesMap":{}}