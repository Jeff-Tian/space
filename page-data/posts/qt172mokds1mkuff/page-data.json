{"componentChunkName":"component---src-templates-post-js","path":"/posts/qt172mokds1mkuff/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/qt172mokds1mkuff","relativePath":"posts/qt172mokds1mkuff","frontmatter":{"title":"我又做了一个网页版的设备码授权许可登录流程","stackbit_url_path":"posts/qt172mokds1mkuff","date":"2023-04-23T07:25:05","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<blockquote>\n<p>Jeff Tian 定律： 一切可以通过网页版实现的应用，最终都将通过网页版应用发布。</p>\n</blockquote>\n<p>开个玩笑，以上 Jeff Tian 定律其实是 Jeff Atwood 定律的一个推论。Jeff Atwood 定律说，一切可以用 JavaScript 编写的应用，最终都将会通过 JavaScript 来编写。于是很容易推出 Jeff Tian 定律，网页应用终将统治世界。</p>\n<p>设备码授权许可，是开放授权 OAuth 2.0 的许可类型之一，之前在《<a href=\"https://zhuanlan.zhihu.com/p/488194876\">OAuth 2.0：对接 Keycloak 设备码授权流程 - Jeff Tian的文章 - 知乎</a> 》以 Keycloak 作为认证服务，详解了如何对接设备码授权许可。紧接着，又在《<a href=\"https://zhuanlan.zhihu.com/p/594742263\">OAuth 2.0：对接 IdentityServer 设备码授权流程 - Jeff Tian的文章 - 知乎</a> 》中以 Duende IdentityServer 为例，再次使用 k8ss 命令行工具对接了设备码许可授权登录流程。</p>\n<p>尽管使用命令行工具对接设备码许可流程是非常适合并且有着广泛的实际应用，但毕竟需要用户安装一下，才能体验。出于教学和体验需要，今天再次做一个网页版本的设备码授权许可登录流程，直接访问 <a href=\"https://id6.azurewebsites.net/deviceflow.html\">https://id6.azurewebsites.net/deviceflow.html</a> 即可体验！<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9klEQVR42p1TyU7bUBT1X3bBLyCxoXRTtm1gR/8gYgmbSlFQaIWQQubBzhybOG1GnMR2BiWBOMOpzpVsqbsWS0fnvPvend67ViaTCbLZHFRNQ+z+B34+PKBQVOG4Uziui4njwJ3OsH59+ycomUwGpx9PcfXtCqFQCGefzhAOh/HeT4k/xnFyfIKLLxe4/HqJow9HOP98LpuHw+G/oTypT7iJ3eD2/hbReBTX36+RzCXfX2HMiCFiRnD36w5RM4rI7wisNwvYAd7Ww36/F+x2O2y3W9FkXxObzSaAYuomaqWa4Ln5DL2qw2gaqNfr0HUdhmEEXC6XA12r1VCpVNBoNNDtdjEcDgXKi/WC2WwG27HR6/cEo9EIg8FA7JwCx3FEk23bFl4ul1iv14K/WqbDarXCfD5Hp9ORLAzIrNPpFL1eD+PxGP1+XzT3uccEDEo/ap5lMqXVaqFUKkmLRLValVbYnqZpgaadYDJWSCYYcLFYCDOoQod8Ph+gWCxCVVVhBiTncjlJWigUxMZ9+lGzalbPK5I7ZHYOdzabRTKZFKYz7VynUimk02kkEglZMyjXBJO1222Ypinggyl+JQxCZgA6cc1KyHxJJiCazaZU53fBIDxDO19fkRe2bbkPy7KCuyFc15U54x/AOfS1P3/+PHL+PM8T/AGpg7FLwVVdSAAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"WX20230423-133005.png\"\n        title=\"WX20230423-133005.png\"\n        src=\"/static/2361ef43265c4b0268079c873c600aa1/fcda8/1682234242745-1dc2ba3f-6268-41c7-9e48-479c491a9de1.png\"\n        srcset=\"/static/2361ef43265c4b0268079c873c600aa1/12f09/1682234242745-1dc2ba3f-6268-41c7-9e48-479c491a9de1.png 148w,\n/static/2361ef43265c4b0268079c873c600aa1/e4a3f/1682234242745-1dc2ba3f-6268-41c7-9e48-479c491a9de1.png 295w,\n/static/2361ef43265c4b0268079c873c600aa1/fcda8/1682234242745-1dc2ba3f-6268-41c7-9e48-479c491a9de1.png 590w,\n/static/2361ef43265c4b0268079c873c600aa1/efc66/1682234242745-1dc2ba3f-6268-41c7-9e48-479c491a9de1.png 885w,\n/static/2361ef43265c4b0268079c873c600aa1/7ae9c/1682234242745-1dc2ba3f-6268-41c7-9e48-479c491a9de1.png 972w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=EGAPh></a></p>\n<h1>相关代码提交</h1>\n<p>基于之前部署的 IdentityServer，增加了一个设备码流程的网页客户端。全部代码改动在一个提交内完成： <a href=\"https://github.com/Jeff-Tian/IdentityServer/commit/c6f28382036ce3723fa0c6e155b6fc0d35488909\">https://github.com/Jeff-Tian/IdentityServer/commit/c6f28382036ce3723fa0c6e155b6fc0d35488909</a></p>\n<p>由于原理在前面的两篇文章中讲解得非常详细了，今天从开发网页客户端这一层进行简单描述。</p>\n<p><a name=kgMkN></a></p>\n<h1>增加获取 XSRF 令牌接口</h1>\n<p>要将设备码授权许可流程做在网页端，需要预防 XSRF 攻击。这是和之前做命令行客户端时不同的一点。网页在请求设备码前，要先请求 XSRF 接口，该接口返回 200 OK，但是没有任何响应体，只是在响应头中设置一些 Cookie。后续的请求，必须带上这些 Cookie 否则拒绝服务。</p>\n<p><a name=uqkCP></a></p>\n<h2>测试先行</h2>\n<p>先添加一个测试，用来描述接口需求：\ncsharp\nusing Microsoft.AspNetCore.Mvc.Testing;\nusing Xunit;\nusing Xunit.Abstractions;</p>\n<p>namespace Host.Main.Test.IntegrationTest;</p>\n<p>public class XsrfTest : IClassFixture&#x3C;WebApplicationFactory<Program>>\n{\nprivate readonly HttpClient _client;\nprivate readonly ITestOutputHelper _testOutputHelper;</p>\n<pre><code>public XsrfTest(WebApplicationFactory&#x3C;Program> factory, ITestOutputHelper testOutputHelper)\n{\n    _testOutputHelper = testOutputHelper;\n\n    _client = factory.CreateClient(new WebApplicationFactoryClientOptions\n    {\n        AllowAutoRedirect = false,\n    });\n}\n\n[Fact]\npublic async Task TestCanGetXsrfToken()\n{\n    var response = await _client.GetAsync(/api/v1/xsrf);\n    response.EnsureSuccessStatusCode();\n}\n</code></pre>\n<p>}</p>\n<p>由于接口还未实现，测试结果自然是 404 。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABe0lEQVR42o2SaW7jMAyFfZHYsmXJ2ijJW2wndZKmRe9/ozeQiqSdBYP++CASIPW4FevpgnFeoQ3BWA/rArQlWBdhLKEzFso4aIrobIRUBlJZdMrmN/lKOwipwYVCcb7ccH19R8MlGOPQMgUROk0QQoG3XaZiLUrGcShrlFWTSfbDz/aBodjOO4ZpRc1lThCtRp2Sq0ci/y35UDZ/+d9FilTddr58ltwICKnAWpOpGEfJmmfwTyiu9zdsL1e0QqGuWwhpwKVDIx3qRoI17R8V/Z9iv92xnvc8w+dMcgtfbaRKf0px2m+Y5hUUB5Dv4cMA4wKUobz5hPoX1n+zKV+Gth7FNC9Yl1Omn46g0OcPH6SgJOLjCKKIQBHeBThDIOtBzsPZT+F0SsW6nnB/+8A2zeh9D0fxC9/nuzQ2gMIInzrwPbQbIE1E3XRgtcxUdboSgaIfZrzsNyzLhmU8ZsZhfjL0E7Tx8PGYBUIc0ZkA3jm00uYF5iUKB9ERfgFcISZxaqpHkAAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"WX20230421-193813@2x.png\"\n        title=\"WX20230421-193813@2x.png\"\n        src=\"/static/b0c122d64f6e3b285f09a0fa57222bb5/fcda8/1682233841438-fdcc83de-b84c-47c1-945a-586aed7d1816.png\"\n        srcset=\"/static/b0c122d64f6e3b285f09a0fa57222bb5/12f09/1682233841438-fdcc83de-b84c-47c1-945a-586aed7d1816.png 148w,\n/static/b0c122d64f6e3b285f09a0fa57222bb5/e4a3f/1682233841438-fdcc83de-b84c-47c1-945a-586aed7d1816.png 295w,\n/static/b0c122d64f6e3b285f09a0fa57222bb5/fcda8/1682233841438-fdcc83de-b84c-47c1-945a-586aed7d1816.png 590w,\n/static/b0c122d64f6e3b285f09a0fa57222bb5/efc66/1682233841438-fdcc83de-b84c-47c1-945a-586aed7d1816.png 885w,\n/static/b0c122d64f6e3b285f09a0fa57222bb5/c83ae/1682233841438-fdcc83de-b84c-47c1-945a-586aed7d1816.png 1180w,\n/static/b0c122d64f6e3b285f09a0fa57222bb5/0be72/1682233841438-fdcc83de-b84c-47c1-945a-586aed7d1816.png 5192w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a name=YZAs5></a></p>\n<h2>增加接口</h2>\n<p>csharp\nusing System;\nusing Microsoft.AspNetCore.Antiforgery;\nusing Microsoft.AspNetCore.Authorization;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.AspNetCore.Mvc;</p>\n<p>namespace IdentityServerHost.Controllers.v1;</p>\n<p>[Route(api/v{apiVersion:apiVersion}/[controller])]\n[ApiController]\npublic class XsrfController : Controller\n{\nprivate readonly IAntiforgery _antiForgery;</p>\n<pre><code>public XsrfController(IAntiforgery antiForgery)\n{\n    _antiForgery = antiForgery;\n}\n\n[HttpGet]\n[Route()]\npublic IActionResult Index()\n{\n    var xsrfTokenSet = _antiForgery.GetAndStoreTokens(HttpContext);\n    if (string.IsNullOrWhiteSpace(xsrfTokenSet.RequestToken))\n    {\n        throw new InvalidOperationException(${nameof(xsrfTokenSet.RequestToken)} was null.);\n    }\n\n    Response.Cookies.Append(XSRF-TOKEN, xsrfTokenSet.RequestToken, new CookieOptions()\n    {\n        HttpOnly = false,\n        Secure = HttpContext.Request.IsHttps,\n        SameSite = SameSiteMode.Lax\n    });\n\n    return Ok();\n}\n</code></pre>\n<p>}</p>\n<p>实现以上接口后，跑了一下测试，居然是 401，出乎我的意料：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.75675675675676%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACG0lEQVR42mWS6XLcKBRG9R5j9y4kNiFAaLPcXrrbWSeTvP/DnJSwK/kxP05dCqjvwqlbpGGm6ydCN2BdwPkO03hOQlLWklNVcyxratWgdINUmqZ1NG1AmQbpLNJaqlpTK0uxBjoXGedH2pCQukHUivvtntoYXNehbItqW2TsKa2nDoFDE6lcQCjJQQh2x5LN7kAhpKYfFr7/+MWnL98ZpoVaGraHEqMN3rVY21BrS1lrDmWNkIajkNxt9txtdn/YH0sKZRxpnvn24yff/v3F8+UNZVoOpeRwqpBVnTFSoY3LZ8a2pNDjrGd/rPK9tR5LSVFJQxgGbp+/Mi9P2Y3UBm0dZaUQQmCMzf4qZbNfUSlKUee6Pwq2u2N+3RpcTA9nQhpZXYY4MzxcGB+vxGHBOo9tfG6yVmnbHLh+f/12pd55X9vsv/AxMa5hacSHkWm5Mj1/pl8u+H5ienxhSCO972jbSPgg+v+v28a/Ozw/LFw/feFpOfMcA7d55nUceQyRpy5xTT0vsWMxlkFbjLY462hM84HDrC89CYpVcPCRy+XG9e0rQUo6pYlSkZSmN4akTd7zVUVT1Xk87jZb7rc7/tn85W67p1jla20YUuJye8uefBrwXY+LHaEfiR/4NGK6GeUHdBgxceJUyTyza5M8h8oGVHghjW9cbv+xP1WopiMMr7T9K6YdcPEB66eMaCZO7Tkj/JmyNn/C1sDfobJUBJSRQ/wAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"WX20230422-094206.png\"\n        title=\"WX20230422-094206.png\"\n        src=\"/static/e82eb0f9d963130dffe5ee2e6d49ad75/fcda8/1682233916078-987e7b71-ae42-4deb-89ee-617d0addf17c.png\"\n        srcset=\"/static/e82eb0f9d963130dffe5ee2e6d49ad75/12f09/1682233916078-987e7b71-ae42-4deb-89ee-617d0addf17c.png 148w,\n/static/e82eb0f9d963130dffe5ee2e6d49ad75/e4a3f/1682233916078-987e7b71-ae42-4deb-89ee-617d0addf17c.png 295w,\n/static/e82eb0f9d963130dffe5ee2e6d49ad75/fcda8/1682233916078-987e7b71-ae42-4deb-89ee-617d0addf17c.png 590w,\n/static/e82eb0f9d963130dffe5ee2e6d49ad75/efc66/1682233916078-987e7b71-ae42-4deb-89ee-617d0addf17c.png 885w,\n/static/e82eb0f9d963130dffe5ee2e6d49ad75/c83ae/1682233916078-987e7b71-ae42-4deb-89ee-617d0addf17c.png 1180w,\n/static/e82eb0f9d963130dffe5ee2e6d49ad75/061c7/1682233916078-987e7b71-ae42-4deb-89ee-617d0addf17c.png 1216w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>赶紧问了一下 ChatGPT，解决了：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/ElEQVR42k2OQU6DUABEOYQ13duq0Ri1qXFhNK56KqtxR72QV3DhylULlKZAgQ9F4EPohyY+U7rQSV4mmUwmo+n6BH3yxtP4mfHLKwvHJU0z/CBk5QeIKCZeJ2S5JBQRRVFSNw2qaaiUotoo1EZRVAVJmaF1Drsc9Y456HTp908RgUAp1VKrel/ejdQ1Ukq22y17/fzjT9rZ+QXDm1sG10PuRyPePz+wjDmu5+O6Pktn1T4U0Zp4/Y0QMY4X4M9meIaJa80JDaPN0yxH6/VPuLwasBu+e3jkazrFNG0se4m9cFqSJG1f5rJAyoJs5yIkF4I8ipBCIGVJWVb8AnOkDjIRqmyeAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/2722050ce3f1cdd96a8d30d0d54b8aa8/fcda8/1682234062137-f6d9bd3d-5686-4d41-9954-0d8a06b01562.png\"\n        srcset=\"/static/2722050ce3f1cdd96a8d30d0d54b8aa8/12f09/1682234062137-f6d9bd3d-5686-4d41-9954-0d8a06b01562.png 148w,\n/static/2722050ce3f1cdd96a8d30d0d54b8aa8/e4a3f/1682234062137-f6d9bd3d-5686-4d41-9954-0d8a06b01562.png 295w,\n/static/2722050ce3f1cdd96a8d30d0d54b8aa8/fcda8/1682234062137-f6d9bd3d-5686-4d41-9954-0d8a06b01562.png 590w,\n/static/2722050ce3f1cdd96a8d30d0d54b8aa8/efc66/1682234062137-f6d9bd3d-5686-4d41-9954-0d8a06b01562.png 885w,\n/static/2722050ce3f1cdd96a8d30d0d54b8aa8/c83ae/1682234062137-f6d9bd3d-5686-4d41-9954-0d8a06b01562.png 1180w,\n/static/2722050ce3f1cdd96a8d30d0d54b8aa8/9dbdb/1682234062137-f6d9bd3d-5686-4d41-9954-0d8a06b01562.png 2622w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>采纳建议，测试通过！</p>\n<p><a name=KHPKO></a></p>\n<h1>添加网页文件和相关的 js</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 307px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFklEQVR42n1U23KjMAzt///I/sJ+QV/2pe0296SBBGwngA02vkDAZ8fupknatAKNxCAdH0saPXR9j85Z/JoBU2qx3aywXK2xWC5xOBwRxHsf9b74+IQ3HRge+v6E4XTCvPQ4yh5KSqhWQ0oF69xN6jCMXzQAjf4KsJEaSlvUvMJqk2C5fsPfyRwvrzM8Pb9iMlvg+WUSrVQaqjWQykC2BlpbPK6fkBYkHpgEwFZbGNuhVS2UKHEsKmQ5xT4jyAmLSugB7FBAGwdjHYxx0Xeux4qlKKSIgJHhMHoMncGGj/j9BjSC/1CvSz2/1NVfAfqhB1Uej3kAFD+Cfft9BhzHEadQXAC6LiHqBoRSEEKx2+2RExK7ba2NMSH+mt38sEGpxaWGIWAYhnAAuGjAhUCeE2RZjiwnoJRFP0zDPUl5jtqqSw3PgEEqLiCVAuccSimIuo5+00gwdkBV8ciWc/GRk1QZais/A44fgGXFkaRpTNzvMyTpLtrN2xaUMaTpDrv9Hn3fx5wpW6Ns+e2VT/9P46JGqzWccyjLClLK6P8kTBZoO32fYWBHKMNqvcFsvsB2m2CbpB//rxtybsqErlB8x1C1Lax1saPGGGhjog1Mu677MofxVrqB6d19hpQdkRMal8N8scR0OoujE2xVVTezd57AP7sXUPm+RLYDxUPoVtBzt4P9bqhj7HheDO+xfvTvdvAgpwL/ABARhLQ+Z4qvAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/71dafb7e7a74714109b35011e65252e3/4651d/1682234169128-bfd3e949-2cb8-48a8-bea3-c24d8ef076e5.png\"\n        srcset=\"/static/71dafb7e7a74714109b35011e65252e3/12f09/1682234169128-bfd3e949-2cb8-48a8-bea3-c24d8ef076e5.png 148w,\n/static/71dafb7e7a74714109b35011e65252e3/e4a3f/1682234169128-bfd3e949-2cb8-48a8-bea3-c24d8ef076e5.png 295w,\n/static/71dafb7e7a74714109b35011e65252e3/4651d/1682234169128-bfd3e949-2cb8-48a8-bea3-c24d8ef076e5.png 307w\"\n        sizes=\"(max-width: 307px) 100vw, 307px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />比较琐碎，就不详述了。如果你查询网页的 html 代码，看到我用了 jQuery，不要惊讶。</p>\n<p>html</p>\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=utf-8/>\n    <meta name=viewport content=width=device-width, initial-scale=1.0>\n    <title>使用设备码流程登录 | Login with device flow</title>\n</head>\n<body>\n<a href=/>首页（Home）</a> > <span class=headline>使用设备码流程登录（Login with device flow）</span>\n<h2>登录（Log in）</h2>\n<ul>\n    <li>点击按钮（Press the button）</li>\n    <li>然后点击生成的链接（Click the generated link）</li>\n    <li>在新打开的窗口中完成登录过程（Complete the sign-in process in the newly opened window）</li>\n    <li>最后回到当前页面，点击“请求令牌”按钮后略做等待，你就能完成设备码登录流程啦！（Return to this page, press the\n        Request token button and behold the glory of device flow）\n    </li>\n</ul>\n<form id=form1 method=post action=>\n    <button id=gobutton>点击我登录！（Sign me in!）</button>\n</form>\n<h3>Output</h3>\n<div id=ResponseOutput>\n</div>\n<script src=js/polyfills.js nonce={{nonce}}></script>\n<script src=js/oidc-client.slim.min.js nonce={{nonce}}></script>\n<script src=lib/jquery/dist/jquery.js></script>\n<script src=js/qrcode.min.js nonce={{nonce}}></script>\n<script src=js/deviceflow.js?nonce={{nonce}} nonce={{nonce}}></script>\n</body>\n</html>\n<p><a name=WNdqo></a></p>\n<h1>愉快的本地测试</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.51351351351351%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACpElEQVR42m2RXW/aSBSG/aO3l4vUlVaqlD+xvc3NSs1Ne5mEFDDYAWyDHQfCV8A2tsf2GDBVkqeaadSrjvTqnQ/Nq+ecY0x9n17P5Oa2Tc80GTsuRVkhihJRFByOR5rzmaKS7LOcJM2IkpRMFGS5IC9KomTPPk1JUoFxdXXFhw9/cXFxwT8fP3J5ecmfVi4Es8VSf472glLWlJUkywvWz1ueliuSTGB8+f8Ln/79ROvvFq1Wi8//fdYBr6+vvL29aamliObLlQ5UQUVVUcgjD5uc+WLBersjEwLjq/2Vb843gkVAlmZIKf9IuE4k7jTEfwgJwpkuPc0LwsUz86cF4WzO/GmJMQqHdJwOSZbojy8vL5zP599qmka76qHnh7gTn2kQ4k0DJsED89Wa1TZit09JRYFxb91j9S2csYPruXiex3a7ZbfbEccxURTxvN2SRgm5/4BwXXLXJRsNScdjYm+CCEOq+Rwxm2EkSaI/rVYrrc1mo8PUfZqm5FnGPs857HYcvt8h79rU3Q6Hfl+7/H5HdXtDeXtD1b7FWC6X1HVNnudkWYYQQu+rqqIsS4S6F4IfRUFtDZCDPrJv/vJ31bal3+rhPcZkMsH3fV3qaDTCcRzttm1rD4KAXRwjk4Ta7CF7XaRpvnuPShHetZH9vj4b4/GY4XDIYDBA7ReLhS55vV5rPW82uodVFHFQRIrEsrQ0af8XcX1vazcURbfbxbIser2eDlV9VD1UZTenE8em4ZSmyE4Haduarry5RnY7mk4TvtMbKkQFttttrq+vtUzTZDqd6iGpia82G8oo4kcQcPJcTo5D4085TjwOts1hNOLoefqshzKbzQjDUEv17PHxUQepKe/3e6I4phCCIk4ooogyTpBCcD4caKSkqWvOtdrX/ARaMKxh11W3nQAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"WX20230423-105954@2x.png\"\n        title=\"WX20230423-105954@2x.png\"\n        src=\"/static/2654f974ea9bbba23897ed15f1a3379c/fcda8/1682234505300-beb78864-e3c2-4e9e-aea1-8d619c1ddc79.png\"\n        srcset=\"/static/2654f974ea9bbba23897ed15f1a3379c/12f09/1682234505300-beb78864-e3c2-4e9e-aea1-8d619c1ddc79.png 148w,\n/static/2654f974ea9bbba23897ed15f1a3379c/e4a3f/1682234505300-beb78864-e3c2-4e9e-aea1-8d619c1ddc79.png 295w,\n/static/2654f974ea9bbba23897ed15f1a3379c/fcda8/1682234505300-beb78864-e3c2-4e9e-aea1-8d619c1ddc79.png 590w,\n/static/2654f974ea9bbba23897ed15f1a3379c/efc66/1682234505300-beb78864-e3c2-4e9e-aea1-8d619c1ddc79.png 885w,\n/static/2654f974ea9bbba23897ed15f1a3379c/c83ae/1682234505300-beb78864-e3c2-4e9e-aea1-8d619c1ddc79.png 1180w,\n/static/2654f974ea9bbba23897ed15f1a3379c/63908/1682234505300-beb78864-e3c2-4e9e-aea1-8d619c1ddc79.png 2410w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a name=DTjvq></a></p>\n<h1>测试通过上线！</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.02702702702703%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzUlEQVR42p1TTW/aUBD0n26k5pJKOTSXHtJ/Qg6V0lNOkUEKqKhNBKaxDcafYGMbMGDDVLPSswg1VdSVRrs882Z39u1qnhPAc33ESYzNZoPtdisoyxKndjgc3kCdHZsWhAEMw4Bt25jNZkjTFOv1Wgh3u12d4PRiE5kQep6HXq+HwWCA4XAo3nEcBEGA6XQqCMMQeZ4LlsslsiwTNY0V8jIrWywWjRnPyT0HzbJs+H6AOI6FlJIZU+b/mJYkMaIohOtOawSBjzzPBJSXJIlIPQVbwO+EOtN+/rLx9GSg/8PE87MDw/BhmnPY4wSWHaModhSM/X7/Rhp/N51p9/ffcXX1Cbe3X/H6aknZZVmhqvaoqsM/+9ooudVq4eLDBS4/Xsro0JiJVRHvfYz6Ue6+3eHmyw2uP1/XhO+xs4SPg0c8vDxA/60jzdJ63hTYcA46X11tEgf+XCtksCeTCUzTxHg8roeZsRpwvrIiX61WKIriL8K6Ql4iGdePmzIajQQkjKJIyEikZlSBszqfz8WrmNC63S50XUe73cZx3Ol0JO73+7AsS5Kyx8pzuxSJImVyjX9mRayQnhV7nitS2Q7XdcX7vl977ja/k4Tyj/EHQBd0vozDHjkAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screencapture-id6-azurewebsites-net-deviceflow-html-2023-04-23-13_29_30.png\"\n        title=\"screencapture-id6-azurewebsites-net-deviceflow-html-2023-04-23-13_29_30.png\"\n        src=\"/static/3eed593e737b601dc64d0d6d2c9ba45d/fcda8/1682234587947-713fd8f8-80a0-4cc4-b103-3110a9ab454a.png\"\n        srcset=\"/static/3eed593e737b601dc64d0d6d2c9ba45d/12f09/1682234587947-713fd8f8-80a0-4cc4-b103-3110a9ab454a.png 148w,\n/static/3eed593e737b601dc64d0d6d2c9ba45d/e4a3f/1682234587947-713fd8f8-80a0-4cc4-b103-3110a9ab454a.png 295w,\n/static/3eed593e737b601dc64d0d6d2c9ba45d/fcda8/1682234587947-713fd8f8-80a0-4cc4-b103-3110a9ab454a.png 590w,\n/static/3eed593e737b601dc64d0d6d2c9ba45d/efc66/1682234587947-713fd8f8-80a0-4cc4-b103-3110a9ab454a.png 885w,\n/static/3eed593e737b601dc64d0d6d2c9ba45d/c83ae/1682234587947-713fd8f8-80a0-4cc4-b103-3110a9ab454a.png 1180w,\n/static/3eed593e737b601dc64d0d6d2c9ba45d/07d37/1682234587947-713fd8f8-80a0-4cc4-b103-3110a9ab454a.png 1790w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>就是这么简单！如果想了解更多，还请查看《<a href=\"https://zhuanlan.zhihu.com/p/488194876\">OAuth 2.0：对接 Keycloak 设备码授权流程 - Jeff Tian的文章 - 知乎</a>  》与《<a href=\"https://zhuanlan.zhihu.com/p/594742263\">OAuth 2.0：对接 IdentityServer 设备码授权流程 - Jeff Tian的文章 - 知乎</a>  》。</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}}}},"staticQueryHashes":[],"slicesMap":{}}