{"componentChunkName":"component---src-templates-post-js","path":"/posts/cbprn8gt8umwshli/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/cbprn8gt8umwshli","relativePath":"posts/cbprn8gt8umwshli","frontmatter":{"title":"原生应用的单点登录体验问题与可能的解决方案","stackbit_url_path":"posts/cbprn8gt8umwshli","date":"2023-06-01T16:06:38","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a name=jxEQs></a></p>\n<h1>二次登录问题</h1>\n<p>经常碰到一个困惑，打开一个应用，明明已经登录了，但是在点开某些页面后，又被要求登录。这种体验很令人困惑，本以为是应用作者技术不行，但是这些情况，竟然在大厂应用中也会遇见。且称这种问题为二次登录问题吧。研究了一下，发现这个问题出现在从应用中打开内嵌式的 web view 时容易出现。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB9UlEQVR42lWS20/acACF+9cu2euSPe9lb0vmm8uSZYqX6QZMBxh1BsFLoSUtUBERKVgUKf5aqLSUetnyLZIsyx5OcpIv5+Q8HKmg6awmdoh93aKoVxiNRvi+P9OzL+pVVuIbLK7FkUs6nuf9xxW9wup6kvj3NGq1hnRgdLHv9rhxNzmqXTOwbwiCgCCY0O/10Mwe29k8m5kMSvOKgd2fcd8PEMIhvrnFu1iC13PzfFxZR8qXO4iJgvdQpFDvzQLjsU84neA4NpV2j9KpyZF2gmY+F9oz/rwwjHw+LcR4MTfPq/QWGz9SSJmsjHH9gP0Eav0CdyT4RYR7e0ejaiEbDU5v77mcQLHewh0KHn9PZyuNQofUThGjLehHoJ62kGTdYPz4RARotQsMpUM+brL4pszSW5W9ok7Z8rBCOKo2uahdIacvSX044/3LHLv7J4yBCVAxO0iH335yGTug/XGP9FwKTbawGgJhe7iuILOvIJ/ZdKeQLdQpH5pY5w6i7zEYOpQyefrLeeylHMraNtLyboWF4zsSSZNEsoA/HRLdT5hGIYOBzXH1nKt7uHkCpdFm6Amih5BwGuIKm2T2hM87fTZW6nxZyCLlVA2l1UVtdcmpZRzh/LvFcMhuvkBOP6PUtMgpOq7zlwczr5YrGE2TRrONrJT4A7J/L4BiV/n3AAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/cab3d96a104b62d94570927e726cf843/fcda8/1685540920000-c50272b2-e1e5-4713-a26d-51c0b8a45ff8.png\"\n        srcset=\"/static/cab3d96a104b62d94570927e726cf843/12f09/1685540920000-c50272b2-e1e5-4713-a26d-51c0b8a45ff8.png 148w,\n/static/cab3d96a104b62d94570927e726cf843/e4a3f/1685540920000-c50272b2-e1e5-4713-a26d-51c0b8a45ff8.png 295w,\n/static/cab3d96a104b62d94570927e726cf843/fcda8/1685540920000-c50272b2-e1e5-4713-a26d-51c0b8a45ff8.png 590w,\n/static/cab3d96a104b62d94570927e726cf843/efc66/1685540920000-c50272b2-e1e5-4713-a26d-51c0b8a45ff8.png 885w,\n/static/cab3d96a104b62d94570927e726cf843/c83ae/1685540920000-c50272b2-e1e5-4713-a26d-51c0b8a45ff8.png 1180w,\n/static/cab3d96a104b62d94570927e726cf843/6efcc/1685540920000-c50272b2-e1e5-4713-a26d-51c0b8a45ff8.png 4008w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=ajDBO></a></p>\n<h1>场景</h1>\n<p>细分一下，可能存在几种场景，都会出现再次要求登录的现象。</p>\n<ul>\n<li>在手机浏览器上登录了某个站点，打开相同开发者开发的原生应用时，再次要求登录</li>\n<li>在手机应用上登录了某个应用，从应用内打开相同开发者开发的网页时，被再次要求登录（如上图所示）</li>\n<li>在手机上登录了某个应用，再次打开另一个相同开发者开发的应用时，被要求再次登录</li>\n</ul>\n<p>以上几种场景，纯粹从技术上看相当合理，毕竟是在一处建立了会话，在另一处自然要求用户重新提供凭据，建立新的会话。但是从用户角度，会觉得相当困惑，毕竟都是在用相同开发者的产品，为什么不能记住我？<br />如果能够为用户提供一种在原生应用世界里的单点登录体验，将会让用户感到更加满意，并且对开发者产生更多的信任（容易认为这样的开发者技术更强，做的产品更棒）。\n<a name=FFja0></a></p>\n<h1>网站的单点登录解决方案</h1>\n<p>关于在浏览器的不同网站之间的单点登录，已经有各种成熟的方案将这个问题解决得很好了。这些方案中，绝大多数都是依赖 Cookie，通过使用各种技术在不同的网站间共享 Cookie，并且结合一些网页的重定向，通过 URL 传递临时令牌的方式，最终实现了同一用户会话在不同的网站之间得以共享或者重建。但是，这一切都建立在浏览器这个介质上，也就是说，虽然对用户来讲，看起来是在不同的网站之间实现了会话共享，但是前提是该<strong>用户始终使用了同一个浏览器</strong>。如果用户打开了新的浏览器，或者同一浏览器使用了隐身模式打开，那么即使是输入同一网址，仍然需要重新登录以建立新的会话。\n<a name=hYX8O></a></p>\n<h1>可能的解决方案</h1>\n<p>如上所述，在网站单点登录中，实际上只是实现了跨站点的会话传递或者共享，该会话始终处于同一浏览器中。而我们现在试图解决的是，跨应用间的会话共享。浏览器是一个应用，而原生应用是另一个应用，它们很可能没有一个共享的存储，从而这种跨应用的单点登录，比纯网站的单点登录更有挑战性。<br />仅以上述场景中的第二种为例，阐述几种可能的解决方案。\n<a name=jNwkQ></a></p>\n<h2>结论</h2>\n<p>这里列举了几种可以解决问题的方案，都能够“解决”用户的单点登录体验问题。但是，安全性由弱到强，而实现的难度也是从简单到复杂。最简单的方案由于没有安全性可言，不建议采用。而最复杂的方案，很可能由于各种原因不能实施，因此有一些折中的方案可以采用，比如 nonce 方案，token exchange 方案。这两种方案都将通过 URL 来传递一些临时令牌类的信息，将用户的会话从一个地方传到另一个地方。和网站间的单点登录不同，这个传递不在同一个介质中，因此安全性比网站间的单点登录方案略弱，但是实际上也很难被攻击到，所以用户体验足够重要，而又没有能力实施最复杂的方案时，建议采用这两种方案。其中 nonce 方案又更简单，而 token exchange 方案的用途更广，可以扩展到非单点登录的场景中使用。<br />以下分别从易到难列举一些可能的“解决”方案：\n<a name=aU54L></a></p>\n<h2>一个幼稚的实现方案</h2>\n<p>因为要解决的问题是将 App 中的用户身份信息，传递给 App 中的 web view，而一个用户的身份，一般都有一个标识，比如说 userId，或者是一个身份令牌，即 id_token。由于没有更多的信息共享方式，一个很自然的想法是，将用户的身份信息直接通过 URL 查询参数传递给 web view。比如在从 App 中打开 web view 前，在目标 URL 中添加一个额外的查询参数，将用户的身份令牌传递过去，而在接收方，即 webview 中的站点，从查询参数上解析用户的身份令牌，并信任这个令牌，以该用户的身份建立会话。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/12e6dc260ad75045cf3c290ab62b5e40/963fa/1685618506364-6c535083-52f7-4c94-8018-e6acda0ba8f9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTklEQVR42tVRTUvDQBD1zxQsFAS9ehMqeFLQ/+DJHyCiR0EoaJWCSEUK6tWDR+8FaRUKIlJNmmaz3TZJ2+wmu9sm2dFtvYi9efIxM8wHj5l9Owd/wNw/JcdxzBiLoiicgHOdMUqFziZNxrQzRimdDhmlYRhqspTSMAyEkG3bpmki5Fh2x7QQ7roY45Zlt1DHQhiTrmkYDnHbTpe4vuf3lVK/zk4kUEMbs3XJfRg0ITBB9HXJ2hB8wPAdYvH9ZjVFmigA1XsRpSVezI2v8goA6uf8OMuLWagWFMDodpOf5GRpUeH6T8FUqqP72ios1/YW7NMVvbh60djPPe9mBg9HAEDK628HGXQ4r5zHWWSvObre4pWN+G4bAOTTDTpb7ZTWRK0CAOn9jrzM83Jekcasr1JJFHjR0E0E0wqMRTQgY+ZrLQBGnA49Evg9lSZf5E9HamMelPHZOAAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/12e6dc260ad75045cf3c290ab62b5e40/fcda8/1685618506364-6c535083-52f7-4c94-8018-e6acda0ba8f9.png\"\n        srcset=\"/static/12e6dc260ad75045cf3c290ab62b5e40/12f09/1685618506364-6c535083-52f7-4c94-8018-e6acda0ba8f9.png 148w,\n/static/12e6dc260ad75045cf3c290ab62b5e40/e4a3f/1685618506364-6c535083-52f7-4c94-8018-e6acda0ba8f9.png 295w,\n/static/12e6dc260ad75045cf3c290ab62b5e40/fcda8/1685618506364-6c535083-52f7-4c94-8018-e6acda0ba8f9.png 590w,\n/static/12e6dc260ad75045cf3c290ab62b5e40/efc66/1685618506364-6c535083-52f7-4c94-8018-e6acda0ba8f9.png 885w,\n/static/12e6dc260ad75045cf3c290ab62b5e40/c83ae/1685618506364-6c535083-52f7-4c94-8018-e6acda0ba8f9.png 1180w,\n/static/12e6dc260ad75045cf3c290ab62b5e40/963fa/1685618506364-6c535083-52f7-4c94-8018-e6acda0ba8f9.png 2666w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br />这个方案，显然是可以解决用户的问题的，立即优化了用户的单点登录体验。但是，通过 URL 传递了用户的信息，基本上没有安全可言。比如开发者可以从应用的访问日志中看到所有的 URL，从而可以重放请求，极易伪装成别的用户。同时，一旦这些 URL 通过某种方式（比如 Excel）发送给更多的受众，而一些正常用户不慎点击了这些链接，就造成了用户身份混乱。<br />之所以列出这个方案在这里，其实是为了起警示作用。一些缺乏经验的程序员，很容易想到这个方案来“解决”用户的问题。更糟糕的是，甚至传递的不是身份令牌，而是 userId。这样，不仅有所有的上述风险，还允许攻击者随意猜测 userId，通过 URL 遍历用户。</p>\n<p><a name=DMUvx></a></p>\n<h2>简化的授权码模式</h2>\n<p>这个模式比上述幼稚方案更安全，但基本思想还是通过 URL 来传递用户的身份信息。只是不直接传递用户的唯一标识符，也不传递其身份令牌，而是传递一个没有任何含义的随机字符串作为授权码。但是这个随机字符串却是可以定位到用户的，并且和 OAuth 2.0 中的 authorization code flow 有点像，有效时限很短，并且只能被使用一次。<br />在 web view 收到这个授权码之后，由其被认证过的后端服务去换取用户的身份令牌。</p>\n<p><img src=\"https://cdn.nlark.com/yuque/__puml/820b73d20fe9fd3a8487770282a025c0.svg#lake_card_v2=eyJ0eXBlIjoicHVtbCIsImNvZGUiOiJAc3RhcnR1bWxcblxuYXV0b251bWJlclxuXG5hY3RvciBcIueUqOaIt1xcbijotYTmupDmi6XmnInogIUpXCIgYXMgVXNlclxucGFydGljaXBhbnQgXCJ3ZWJ2aWV3XFxuXCIgYXMgd2VidmlldyAjT3JhbmdlXG5wYXJ0aWNpcGFudCBcIndlYnZpZXcg5ZCO56uvXFxuXCIgYXMgd2Vidmlld19zZXJ2aWNlICNPcmFuZ2VcbnBhcnRpY2lwYW50IFwiQXBwXFxuKOaOiOadg-acjeWKoeWJjeerrylcIiBhcyB3bXBcbnBhcnRpY2lwYW50IFwiQXBwIOWQjuerr1xcbijmjojmnYPmnI3liqHlkI7nq68pXCIgYXMgd21wX3NlcnZpY2VcbnBhcnRpY2lwYW50IFwi5YW25LuW6aKG5Z-f5pyN5YqhXFxuKOWPl-S_neaKpOeahOi1hOa6kClcIiBhcyBjcm1cblxuYWN0aXZhdGUgVXNlclxuXG5Vc2VyIC0-IHdtcDog6L-b5YWlIEFwcCDlubbnmbvlvZVcXG7msqHmnInmtY_op4jlmajkuK3nmoQgY29va2llIOS_neWtmOatpemqpO-8jOS9huS5n-iOt-WPluWIsOS6hueUqOaIt-eahOS7pOeJjOS_oeaBr1xud21wIC0-IHdtcDog5bCG55So5oi355qE5Luk54mM5L-h5oGv5L-d5a2Y5YiwIGxvY2FsIHN0b3JhZ2VcblVzZXIgLT4gd21wOiDngrnlh7vmn5Dkupvpk77mjqXmiZPlvIDnvZHpobUgXFxuaHR0cHM6Ly93d3cuZXhhbXBsZS5jb21cbndtcCAtPiB3bXBfc2VydmljZTog5Lul55So5oi35ZCN5LmJ77yI6YCa6L-H5Lyg6YCS55So5oi355qEIGFjY2VzcyB0b2tlbu-8ieivt-axguaOiOadg-eggVxud21wX3NlcnZpY2UgLT4gd21wX3NlcnZpY2U6IOS_neWtmOS4gOS4qiAodXNlcl9pZCwgYXV0aENvZGUpIOaYoOWwhOihqFxud21wX3NlcnZpY2UgLT4gd21wOiBhdXRoQ29kZSDmjojmnYPnoIFcbndtcCAtPiB3ZWJ2aWV3OiDmiZPlvIDnvZHpobXml7blnKggVVJMIOeahOafpeivouWtl-espuS4suS4rea3u-WKoCBhdXRoQ29kZSBcXG4gaHR0cHM6Ly93d3cuZXhhbXBsZS5jb20_YXV0aENvZGU9eHh4XG5hY3RpdmF0ZSB3ZWJ2aWV3XG5cbndlYnZpZXdfc2VydmljZSAtPiB3bXBfc2VydmljZTogIOS9v-eUqCBhcHBpZC9zZWNyZXQg5Lqk5o2i5pyN5Yqh5Zmo5L-h5Lu75Luk54mMIFxcbihjbGllbnRfY3JlZGVudGlhbHMpXG53ZWJ2aWV3X3NlcnZpY2UgPC0gd21wX3NlcnZpY2U6IOacjeWKoeWZqOe6p-WIq-eahCBhY2Nlc3NfdG9rZW4sIHJlZnJlc2hfdG9rZW5cblxuXG53ZWJ2aWV3IC0-IHdlYnZpZXdfc2VydmljZSA6IOaOiOadg-eggSBhdXRoQ29kZVxuXG53ZWJ2aWV3X3NlcnZpY2UgLT4gd21wX3NlcnZpY2U6IOmAmui_h-acuuWZqOe6p-eahCBhY2Nlc3NfdG9rZW7vvIzku6Xlj4ogYXV0aENvZGUg5Lqk5o2i55So5oi357qn5Yir55qEIGFjY2VzcyB0b2tlbiBcbndtcF9zZXJ2aWNlIC0-IHdtcF9zZXJ2aWNlOiDmoLnmja4gYXV0aENvZGUg5p-l5om-55So5oi3XG53ZWJ2aWV3X3NlcnZpY2UgPC0gd21wX3NlcnZpY2U6IOeUn-aIkOeUqOaIt-eahCBhY2Nlc3MgdG9rZW4sIHJlZnJlc2ggdG9rZW4sIOetieetiVxud2Vidmlld19zZXJ2aWNlIC0-IHdlYnZpZXc6IFNlc3Npb24gY29va2llc1xud2VidmlldyAtPiB3ZWJ2aWV3X3NlcnZpY2U6IOivt-axguabtOWkmuaVsOaNrlxud2Vidmlld19zZXJ2aWNlIC0-IGNybTog5L2_55So55So5oi355qEIGFjY2VzcyB0b2tlbiDor7fmsYLmm7TlpJrnlKjmiLfmlbDmja5cbndlYnZpZXdfc2VydmljZSA8LSBjcm06IOi_lOWbnueUqOaIt-S_oeaBr-OAgeS8muivneaVsOaNruetiVxud2VidmlldyA8LSB3ZWJ2aWV3X3NlcnZpY2U6IFxuXG5kZWFjdGl2YXRlIHdlYnZpZXdcbkBlbmR1bWwiLCJ1cmwiOiJodHRwczovL2Nkbi5ubGFyay5jb20veXVxdWUvX19wdW1sLzgyMGI3M2QyMGZlOWZkM2E4NDg3NzcwMjgyYTAyNWMwLnN2ZyIsImlkIjoiSUFBbXIiLCJtYXJnaW4iOnsidG9wIjp0cnVlLCJib3R0b20iOnRydWV9LCJjYXJkIjoiZGlhZ3JhbSJ9\" alt=\"\">\n这个方案之所以更安全，是假设 authCode 从 App 传递给 web view 之后，很快被正常消费掉了。即使开发者从应用访问日志里看到 authCode，重放时会因为 authCode 已被使用从而不能继续。除非攻击者能够先于用户自己拿到这个 authCode，并且抢先消费它，否则用户的身份很难被别人伪装冒充。但这个方案，有些定制化开发，并不是一个普遍公认的标准。<br />如果这个 App 正好是微信，而 web view 是微信小程序中的，那么之前的《<a href=\"https://zhuanlan.zhihu.com/p/446314134\">webview 复用微信小程序获取用户信息的解决方案 - Jeff Tian的文章 - 知乎 </a> 》正好是这个方案的一个特例。\n<a name=GJhKf></a></p>\n<h2>Nonce 模式</h2>\n<p>思想和简化的授权码模式比较类似，但是 Nonce 模式更加标准化。其时序图如下，浅黄色标注区域和简化的授权码模式的思想是一致的，而后面的流程中复用和扩展了标准 OAuth 2.0 流程中的授权接口。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7151aaeaf97e866105651ca4d8e967f9/8170e/1685632763255-d562986a-6c59-42ff-969a-e52f655e29d0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAACg0lEQVR42o2S2U8TURSH+yf77guJxhjlkUQFIoQohEKqVLYCLZ3SBWtRUBBIZGtaOi1dptO5+z3nmGkjakXjzZebk1/y3fVEiCyRvkVK3WwwKTgAJ1K3uRCq7vrGhLXW8rra8TwZITolyhDliXJ98lpu++0Y6y4BZBCzRFmAHcQs2BxidoA1Owg8gvAZ7ArCJtEm4QbhhtZJY0K0DmEs4XkrQZDQOjVIQlQKkUfa9cTxp4c35WetyvNefUJ502A2iTJIDvVBTAOEIGboZ5gJ5Za7fnb4uF150a2Ne7Vx5U2j3epfxBniDrlRXT/YHbk+G+u6E6ozBcEM/L9cr64Wnful7IPT/SdnX0Z9d5xgIKf/KTuhzPxM9XysXp4MWjN+Y5p3XqFN9589OwAxY2zaggO4g+FbhIQ18gjR1/5ihR9flWu6s+VvE5WLydrVS7c81XJnujevg86cDhZuUcECQi9CdKxlXPhR4Ud5N6rZot9e6NzMe815EcQ0fwsqTnYZzTKoOKilAVbFEYOwSYxalX5M+DHWXVTBGzAZIdJCbDOeYjwVsKTf2+r1ktYWCPcIS4QfEAuIItLvQfFrh4Ll1jIYAMxaZmzPSqFOLr3zte5loneehkOPJEXojwGAQkgpldZGCGm0CVNNutTolBx3N9ksOirfJPYXmTGmtTbGMMaklABgtb7amz/JTVb2Z92judZp1Ep2t+z7vjHhhpxzz/MY41brg/dPndS9o/2Ry7NHlyejtcrFnTIoJa21iMg5D4JAKqmFui4mqsWY+/FdbW+p8XHNcD4sIxJAOA/nBu0eyrxqOx1RkFBCFDgsS0mt5uDIvw0h0K0JrQARpLTViu956jvQPN2HmME8MQAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/7151aaeaf97e866105651ca4d8e967f9/fcda8/1685632763255-d562986a-6c59-42ff-969a-e52f655e29d0.png\"\n        srcset=\"/static/7151aaeaf97e866105651ca4d8e967f9/12f09/1685632763255-d562986a-6c59-42ff-969a-e52f655e29d0.png 148w,\n/static/7151aaeaf97e866105651ca4d8e967f9/e4a3f/1685632763255-d562986a-6c59-42ff-969a-e52f655e29d0.png 295w,\n/static/7151aaeaf97e866105651ca4d8e967f9/fcda8/1685632763255-d562986a-6c59-42ff-969a-e52f655e29d0.png 590w,\n/static/7151aaeaf97e866105651ca4d8e967f9/efc66/1685632763255-d562986a-6c59-42ff-969a-e52f655e29d0.png 885w,\n/static/7151aaeaf97e866105651ca4d8e967f9/c83ae/1685632763255-d562986a-6c59-42ff-969a-e52f655e29d0.png 1180w,\n/static/7151aaeaf97e866105651ca4d8e967f9/8170e/1685632763255-d562986a-6c59-42ff-969a-e52f655e29d0.png 2132w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=zU8kv></a></p>\n<h2>令牌交换流程</h2>\n<p>令牌交换流程本身并不是为了解决跨应用的单点登录体验问题的，它既是一个标准的流程，又可以用在更多场景。只是，恰好也能利用它的能力来优化跨应用的单点登录体验。</p>\n<p>其时序图如下：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7da4cae5010bab30bbb0a0a18308e4df/963fa/1685633092068-bd7122d4-445b-4d52-b7f2-ab3202984d06.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmElEQVR42oWQPY/UQAyG979SQUVNg0CC30BDcQKqo6VFFFTA3rH3UZ12WSXZSWayyXxmMpPx2CgbEDRwb2HJkp/Xr72SEjknF8y37Vr2rdp/FnXh/RjrBsaR/qvV+fv44hnd6ZsHHx5G38Hlcww8jtOXR4/b9SURYc7/hIfBGaOMNq1olVLi2IU4q+s6a+09mxHRGCuE4IILIZRSAJBSijEi4j1wznmapqUSkbWWc84Yk1Lm34EXF5xFfzvOcEoJEWOMRKS1bpqGMaa1JiKAeVhpWR5KIVrO9oeqDCFQzoT4B142e+8ZY/v9nvOWCN+8S+dv6ez21euLM0IaL16CudV3xc2TpzmlGQ4haK3bto0xWmuHYXDOhTAH2Vyp6+9+U6035TWmpMqvwfey5j8+fnLWrgCg73tjzOEkIcQwDIjonEPEnCHBlCHHMPtWjB+PvR+9HYb5ZgBQSjnnqqoqy3K321VV5ZyTUp7gDABTmuq6rlm9226LouBN45z7BY/jmFJyzk3TdAoccs7L/xYYALz3y4FLuzzoJ/S0b8tX9BNKAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/7da4cae5010bab30bbb0a0a18308e4df/fcda8/1685633092068-bd7122d4-445b-4d52-b7f2-ab3202984d06.png\"\n        srcset=\"/static/7da4cae5010bab30bbb0a0a18308e4df/12f09/1685633092068-bd7122d4-445b-4d52-b7f2-ab3202984d06.png 148w,\n/static/7da4cae5010bab30bbb0a0a18308e4df/e4a3f/1685633092068-bd7122d4-445b-4d52-b7f2-ab3202984d06.png 295w,\n/static/7da4cae5010bab30bbb0a0a18308e4df/fcda8/1685633092068-bd7122d4-445b-4d52-b7f2-ab3202984d06.png 590w,\n/static/7da4cae5010bab30bbb0a0a18308e4df/efc66/1685633092068-bd7122d4-445b-4d52-b7f2-ab3202984d06.png 885w,\n/static/7da4cae5010bab30bbb0a0a18308e4df/c83ae/1685633092068-bd7122d4-445b-4d52-b7f2-ab3202984d06.png 1180w,\n/static/7da4cae5010bab30bbb0a0a18308e4df/963fa/1685633092068-bd7122d4-445b-4d52-b7f2-ab3202984d06.png 2666w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>如果有可以共享的存储以供 App 和 Web View 来获取 device_secret，那么安全性也是比 Nonce 模式更强的。详细讨论见《<a href=\"https://zhuanlan.zhihu.com/p/624589333\">令牌交换流程初体验 - Jeff Tian的文章 - 知乎 </a> 》。</p>\n<p><a name=vcIE0></a></p>\n<h2>系统自带浏览器方案</h2>\n<p>这个方案，即 App 不使用 web view 来打开网页，而是直接通过系统自带的浏览器。这个方案可以说几乎没有什么工作量，就能让用户享受单点登录带来的好处。然而，这个方案会使得用户从 App 离开，切换到浏览器，不知道一般来说产品经理是否愿意。而且，如果是开发微信小程序，这个方案也不可行，因为小程序的开发者并不能在小程序里直接跳转到浏览器。<br />如果系统自带的浏览器方案能够被采用，当在某些场景下用户需要跳转回应用的话，可以使用 Scheme URL 来完成。在认证过程中使用 Scheme URL 跳转回应用时，有可能有恶意的应用故意使用和你的应用同样的 Scheme URL，以截获授权码等等。要预防这种情况，可以为客户端开启 PKCE 模式。</p>\n<p><a name=Cn2nN></a></p>\n<h2>系统特定视图控制器</h2>\n<p>这个方案与上一个方案一样，也是抛弃 web view。但是为了不离开应用本身，可以采用系统特定的视图控制器，从而用户体验上更像是在应用里打开 web view，但是不像 web view 那样被沙箱隔离。它可以和应用共享 cookie 存储，从而拥有单点登录的体验。看上去，这个方案也不需要网页前端和后端做太多改造，但是却需要应用端做很大的修改，并且同样地，不适用于微信小程序这种场景，因为微信给到开发者的网页浏览器，只有 web view，而且只开放给企业级小程序。</p>\n<p>系统特定视图控制器，openid 组织分别提供了 Android 版和 iOS 版：</p>\n<ul>\n<li><a href=\"https://github.com/openid/AppAuth-Android\">https://github.com/openid/AppAuth-Android</a></li>\n<li><a href=\"https://github.com/openid/AppAuth-iOS\">https://github.com/openid/AppAuth-iOS</a></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/abb06693ec852c5dd090fc85ad893c42/c88ae/1685634199965-084e0b0b-74b2-4d51-ae52-3c457e394cb9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 168.24324324324326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAiCAIAAADQyG7qAAAACXBIWXMAAAsTAAALEwEAmpwYAAAElElEQVR42pWV25OqRhCH9/+vynMe8pKHPKQqD5vaC3rU1VVcXK+gCCJ3mIFVBLkJcieleFyzdZJUftU1NQzz0T3dXcNd+T9VFMV1vCvLMkmSMAwPQXA4BL7vi7Li+77repr+Ye33AGppmlbcaQx3pUlVjyeYF6TxDCfm5JrlOV7sdPu//Prb73/cI9+aD8/1h+e6sTMrr0FamtQ3F/1pY4dleYZHExzF3l97/TlJNV9eaWZd5HmapmmWZXl+Gy2nfOzIWjr92Q6ysshPMMsJs/mCmJMsJwzHMwj16+4vCuPMkBaFMf8MO4pj/xAE4bEaD0FgO57jeHvbtR3X9fyzHW4/95kw/3DY265p2dbePmGuZzuu7Xi24yVJkhdFnudZll25sryc5a4o8ig6Rsdj9eaU9oNf5FkYhkkSZ1nmel4UHc9UXlmWpYfgWFRnTrJi74VBlGV5Gaf5zgmyvAyj1PZPjOkc/CC6PXmSFTs3PnneLR/3K8SikY/5n7vlo0k975aP58mTQT5Uk2rl1iz6tO3O1+aWPDH498PHwgG4CwkXEh4kfG3+T+adzQX4KewJTj4grSA4Gpbt+IHthmEU/2ef5nl+VxZFFEW2bedFcarARXl5fvwXy9L05BlC+D4YkGfNZjOWZYsb3Rb2VlmWnWAAQK/XY1l2sVj0ej2CIDzPq8gkSaoxP/fp7ScusK7rKIr2er3xeFyv1weDQa1WQxCk0WjU6/V+v48gCM/zP/YMIWy1WgRBLBYLmqYnkwkAoFarDYdDkiQpiloulzzPu64rSZLjOIZhhGFYVL0timKz2Xx7e2u32/1+/+XlhSTJ6XTa6XSenp7G4zGCIBiG4TiOIAiKogiCQAgvva2qarPZbLVaHMe9vr6uVqvqeF+S9CV551KVpWVZ0+mUIAhN03AclyQpiqIwDKMo8n0/DMM0TeM49n3ftu04jiv4M2EYhnW73U6ng6Jot9ttt9u9Xq9WqzWbzXq93u1239/f7+/vn5+fVVX9mjAMw6bTKcdxo9GIYRiWZUmSZM6az+eNRoMgCIZh1uv1ZDKRZfkTVlUVw7DJZDKbzSqGpmmGYabT6Xg8xnFcEIRWq4Wi6Gg06vf7giB8wrIsj0aj4XCIYVi73X57e6MoajAYVOE0Go3Hx8dq8fbevcC+7wMAVFXVNE0QBACArusURSmKoqoqhFAQBE3TdF2PouhahQvsOI4kSRDCK69pGgBAkiQAgOd518r9oD09zxNFUZIkRVEAABzHsSwLIeQ4Tj1LlmUAgGEY2+22arJP2DRNmqYFQWBZFgAgiuJ6vWZZVlVVRVF4nl8ul6Zp7nY7lmVXq1VVrUuT2LZN07QkSRzHiWcJgiCKoizLgiCs12uO4wzDqIKSJMk0zU/PlmXRNA0AYBimKhWEEAAAIaxyVoWtKIosyxzHxXH8N5hhGEVRqjwpiqLruiiKPM8L38XzPEVRkiRtt9vqDr/Atm1zHCcIgqqqm81G0zQIoaZpPM9X8+12u9lsZFm2LOtrtk3TrGJjWXa73ebff27/rhOc3ig76zq/Xb/dUClJkr8ARn9Ba4FiSH0AAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/abb06693ec852c5dd090fc85ad893c42/fcda8/1685634199965-084e0b0b-74b2-4d51-ae52-3c457e394cb9.png\"\n        srcset=\"/static/abb06693ec852c5dd090fc85ad893c42/12f09/1685634199965-084e0b0b-74b2-4d51-ae52-3c457e394cb9.png 148w,\n/static/abb06693ec852c5dd090fc85ad893c42/e4a3f/1685634199965-084e0b0b-74b2-4d51-ae52-3c457e394cb9.png 295w,\n/static/abb06693ec852c5dd090fc85ad893c42/fcda8/1685634199965-084e0b0b-74b2-4d51-ae52-3c457e394cb9.png 590w,\n/static/abb06693ec852c5dd090fc85ad893c42/efc66/1685634199965-084e0b0b-74b2-4d51-ae52-3c457e394cb9.png 885w,\n/static/abb06693ec852c5dd090fc85ad893c42/c83ae/1685634199965-084e0b0b-74b2-4d51-ae52-3c457e394cb9.png 1180w,\n/static/abb06693ec852c5dd090fc85ad893c42/c88ae/1685634199965-084e0b0b-74b2-4d51-ae52-3c457e394cb9.png 1541w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span> <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/62dbb0edf5bbe2928496b8cbebc1f34d/12e1b/1685634232163-25dbb692-2534-4e2a-a6da-806f20f1e400.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 154.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAIAAABoLHqZAAAACXBIWXMAAAsTAAALEwEAmpwYAAAETUlEQVR42p1VW2+jOBjt/3/b933Yh5X2YdRkp+oQaZSqKU0nKRDI3QYCJNwCuZCYawjYXgUynXa0q13tkWV9Rj6c83182Df0f4EQQim9oZTm53OaZXGSJkkaxfFCN45HdETIsp2151uOW5a4plymxKO7WbXCF7JmLPucwA+kOZSnM9B+fPrt9z+ad8x96+un5t1962sYxbVgdKLBjDk8/+KjM6UVWRpOPjXvxOGEUlqWJcb4XBRlHWH83qdiOPvxfSH9inJKSXkh244rjSa241JKMSG42lcTag75/iTLy91yTPfwh+00O8VJGkbJPjjs9sEuOBxReDiiA0KbXbDbH5I0+8eCxUl6OIYojI6omsMIhVEYxSiM9wcUJ+mbckXD9PvypiQ0yfI0O5Gqmkl6QlFcEhInWZbnJcbBMUyyE6a0JJeBKc0LfAgzTCplgos0RudTTMoCl+cEBQSX51OaxuiSVHTMs+S9Z4xxFEYX5Qakn1X6WSWfZrgByZ8KbUDSgKQp01uAG5A2ZXILSAPSt9GEpLmg7eHuZoWossknFjJDqu9LI8DG4TJWiJqIvs0fB1khau/Si+3pdHp39zmK0HG/iVAQo+CUxv/aoRjjG0JIiXGSfijpf8GFTCm1LKvdbnMVut3udDr9qbHeBz+Tfd/nOE6WZQjh09PTeDwOw7CokGVZURRhGJ7P5ziO66B+0ZXsed7j42O73e52u+12m2VZhmGazWar1WIYhmXZ29tbCGGr1Wo0GhDCWrksq95er9f39/evr6+GYYxGI1EUNU1jWVaqwLKspmnfvn3r9XoAAFEUV6tVURRX5fV6LQgCAABC2Ov1BEFYrVaCIHAcNxgMJElSVfXl5aXf70MIRVHkOI4QciXv93tRFLsVeJ6XJOm1Qr/ff3h4qAs5mUxYlm21Wr7vfyiY67osy9biPM+PKgwGg/F4DAAQBIFhGAjhpMJsNkMI/cjZcRy2Qq/X6/f7AIDJZDIcDnme73a7nU4HAMAwzJcvXzqdDsMwqqpSSouiqA4D2xYEQZIknudfX185joMQDofDOudOp/P8/Pzy8gIAeH9CXJUPh4OiKLIsa5omiqKqqqZp8jyvaVrtczQaKYqiqmqe5z83SRRFnuchhFzXDcNws9l4nrfdbtfr9Xa73e12f9u5VzJCaLFY6Lq+WCyWy6WqqvP53DAMAIBpmqqquq7reV4QBNvt1vf9KIo+2FZVVdf12rCu65qmKYqyWq1s29Y0bT6fbzYb3/chhIqieJ73gxxFkaqqtaZVwahQv0XTNABAEAS+7y8rKIpyOp0IIRdyEASSJGmaVosDAHRdNwzDtm3TNNfrtW3bsiwvl8s6Ncuy8jy/ko/HoyzLlmWZpuk4Tq1Zb337CoqiuK6rKMpisfjQJFEU1W7NCnXmpmnatm1ZlqZpjuPUsSzLpmkWRXElF/XNUpbvg+qewfWyDurf+/2G8/n8F6PsnBa8AyDAAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/62dbb0edf5bbe2928496b8cbebc1f34d/fcda8/1685634232163-25dbb692-2534-4e2a-a6da-806f20f1e400.png\"\n        srcset=\"/static/62dbb0edf5bbe2928496b8cbebc1f34d/12f09/1685634232163-25dbb692-2534-4e2a-a6da-806f20f1e400.png 148w,\n/static/62dbb0edf5bbe2928496b8cbebc1f34d/e4a3f/1685634232163-25dbb692-2534-4e2a-a6da-806f20f1e400.png 295w,\n/static/62dbb0edf5bbe2928496b8cbebc1f34d/fcda8/1685634232163-25dbb692-2534-4e2a-a6da-806f20f1e400.png 590w,\n/static/62dbb0edf5bbe2928496b8cbebc1f34d/efc66/1685634232163-25dbb692-2534-4e2a-a6da-806f20f1e400.png 885w,\n/static/62dbb0edf5bbe2928496b8cbebc1f34d/c83ae/1685634232163-25dbb692-2534-4e2a-a6da-806f20f1e400.png 1180w,\n/static/62dbb0edf5bbe2928496b8cbebc1f34d/12e1b/1685634232163-25dbb692-2534-4e2a-a6da-806f20f1e400.png 1607w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>从网上的资料看，通过使用这个 SDK，不仅可以让同一个 App 里的不同嵌入式网页享受单点登录的体验，还能实现复杂的连锁式单点登录体验：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/86a5c3bdc7fff374fad94adb3db81bd2/c6a7a/1685634517066-84eaf187-e302-405d-88ae-21562e1e5573.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACzUlEQVR42iXQy2/bBACAcf+lXIAbEkNIICrUAxTENpWiJSQp62NqCkWj2zRRVBiw0sHSVE3zdNIkjuNn4lfs2IkTpqn2hzoOv+N3+YS+IiWDoYQ+NtKhqaJYOqZvYfhjrMjGjpw3nMjGn7lMQpsgcojmLtOZQzCzmfgmi9jl6ZMDhCtNTpqKTNvQ0q6pY/gW48BmOFLQbA3DM5jMPSx/hGLIaIaMbsiEoc3EMxiZMrraw3M0Hh8WEbLVSvL+eZkvxEb6QavBeBnRG0rsHvxI8adDfnj8hFavg2qrlOsXnF2eU6lf4Pkjfnt2TDaXJ5fPs1/cZzN/D+G76mXy0VmZu2IrXW2LjOIAzTE5rVcpd0RKYou+ofCamH+vZwRxwOLVlHjpc9mscfLyb5799ZzfT07Y3S4gDHQt6SkaQ8tOx/6EnjrADl2mr2fMryOWxMTXM/zYRXVHeLMJ4c270Caaefihi+2aLJdTDh/uIciKknT7Mv2BmupjC2WsY07GjEOPYTDBvoliB2fuIvkeTuQyDR0mgYXjmYztEeZIJZjaHHy/g1Crt5OXpQYXlau0IQ5wpi5e5OHPpzTcBXYcMY1dgoXH/JVPtPCZzT38wHojCBxc1yQMXQ6K2wiX1Vby4rRKqdRKq/U+1sTGsHSkYQ+p36Y/6GA6OrqlIKtdFK2LovSwLA3dGNDpNKnWKmiqxN7NwytRTJo1kWajnXY6PRzPolI9p5DPsLNVIJ/d4Kx8yp/Pj9jMfc2DrRzbmxn63TrHR4/IrN8mu36HvfsFCht3EFqKmvQNA80yU8sxsCz1f46O5RqopkxbEhElkYEhMzQVBuqA3rCPKHVpdbvUmiKNTpd8Louw8uifZO3nEmtHlXTj1wr3js/ZePqC9Yd/cLv4C1/eP+TzzD6rGw/4dH2Xlbs7fPzVFh+ubXLrswLvrX7Lu598wzsrGd56+xb/AX999f6MiyWHAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/86a5c3bdc7fff374fad94adb3db81bd2/fcda8/1685634517066-84eaf187-e302-405d-88ae-21562e1e5573.png\"\n        srcset=\"/static/86a5c3bdc7fff374fad94adb3db81bd2/12f09/1685634517066-84eaf187-e302-405d-88ae-21562e1e5573.png 148w,\n/static/86a5c3bdc7fff374fad94adb3db81bd2/e4a3f/1685634517066-84eaf187-e302-405d-88ae-21562e1e5573.png 295w,\n/static/86a5c3bdc7fff374fad94adb3db81bd2/fcda8/1685634517066-84eaf187-e302-405d-88ae-21562e1e5573.png 590w,\n/static/86a5c3bdc7fff374fad94adb3db81bd2/efc66/1685634517066-84eaf187-e302-405d-88ae-21562e1e5573.png 885w,\n/static/86a5c3bdc7fff374fad94adb3db81bd2/c83ae/1685634517066-84eaf187-e302-405d-88ae-21562e1e5573.png 1180w,\n/static/86a5c3bdc7fff374fad94adb3db81bd2/c6a7a/1685634517066-84eaf187-e302-405d-88ae-21562e1e5573.png 2719w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=JjN5H></a></p>\n<h1>总结</h1>\n<p>|</p>\n<p>| <strong>通过 URL 传递身份</strong> | <strong>简化授权码/Nonce 模式</strong> | <strong>令牌交换流程</strong> | <strong>系统自带浏览器</strong> | <strong>系统特定视图控制器</strong> |\n| --- | --- | --- | --- | --- | --- |\n| <strong>Description</strong> | 直接将用户身份作为查询字符串放在 URL 里 | 用户在原生应用中认证完成后，授权服务器为其生成一个随机值，并通过某种方式返回给应用。<br />当应用将该随机值传递给web view 之后，web view 用它结合其他服务器认证信息来交换用户的令牌。 | 和 Nonce 模式类似，当用户在原生应用中完成了身份认证，授权服务器为其生成一个 device_secret，并随同 id_token 一起返回给应用。<br />后面 web view 或者其他应用可以使用这个 device_secret 来交换新的令牌。<br />这需要一种方式在应用和 web view 之间共享这个 device_secret。iOS 中如果用了 UIWebView 或者 WKWebView 的话，可以使用 NSHTTPCookieStorage。在其他情况下，如果找不到一个合适的共享存储，则只能通过 URL 来传递这个 device_secret，好在它可以是动态生成的，一次性的。 | 当用户在原生应用中进行身份认证时，原生应用打开系统自带的浏览器来让用户登录。当需要从原生应用打开网页时，应用直接使用系统浏览器来打开该网站的 URL，这样由于 cookie 已经存在，就和纯粹浏览器中的单点登录的情况一样了。<br /> | OpenID 分别为 iOS 和 Android 创建了特定的 SDK，通过使用这些 SDK，cookies 可以在原生应用与嵌入式站点安全共享，从而实现单点登录体验。  |\n| <strong>好处</strong> | <br />- 易于理解<br />- 易于实现<br />- 不用原生应用做太多改动<br /> | <br />- 易于理解<br />- 易于实现<br />- 不用原生应用做太多改动<br /> | <br />- 标准<br />- 可以扩展为其他场景使用，所以更强大<br /> | <br />- 安全<br />- 授权服务器不需要修改<br />- 内嵌网站也不用修改<br />- 原生应用也不用大改<br /> | <br />- 安全<br />- 授权服务器不需要修改<br />- 内嵌网站也不用修改<br /> |\n| <strong>坏处</strong> | <br />- 非常不安全<br /> | <br />- 较不安全<br />- 授权服务器与嵌入式网站都得改动<br /> | <br />- 略不安全<br />- 授权服务器与嵌入式网站都得改动<br />- 原生应用也得改动<br /> | <br />- 用户体验较差<br /> | <br />- 原生应用改动很大<br />- 原生应用中引入了额外的依赖<br /> |\n| <strong>风险</strong> | <br />- PII 信息泄露<br />- 容易被伪装<br /> | <br />- 仍然可以从应用访问日志中看到 URL 中的 nonce<br /> | <br />- 如果没有安全的共享方式，device_secrets 和令牌信息能够从应用访问日志中查看到<br /> | 无 | 无 |\n| <strong>工程量</strong> | 后端： 轻微<br />前端： 轻微<br />原生应用： 无 | 后端： 中等<br />前端： 中等<br />原生应用： 小 | 后端： 中等<br />前端： 中等<br />原生应用： 小 | 后端： 无<br />前端： 无<br />原生应用： 小 | 后端： 无<br />前端： 无<br />原生应用： 较大 |</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}