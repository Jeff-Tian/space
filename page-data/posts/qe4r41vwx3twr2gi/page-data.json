{"componentChunkName":"component---src-templates-post-js","path":"/posts/qe4r41vwx3twr2gi/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/qe4r41vwx3twr2gi","relativePath":"posts/qe4r41vwx3twr2gi","frontmatter":{"title":"身份认证那些事儿","stackbit_url_path":"posts/qe4r41vwx3twr2gi","date":"2024-01-15T09:32:00","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a name=s9qfS></a></p>\n<h1>从安全说起</h1>\n<p>你听说过黄金法则吗？我是从极客时间里何为舟老师的《安全攻防技能 30 讲》课程中学到的这个法则，它指的是<strong>认证</strong>、<strong>授权</strong>和<strong>审计</strong>。<br /><a href=\"http://gk.link/a/12gcV\">安全攻防技能30讲_安全_漏洞_黑客-极客时间</a><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 177.7027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/b1d6df455ad359471396408bfc14250b/fcda8/1705297611055-d777045f-d945-4e9a-a18c-8c74044ff8c0.png\"\n        srcset=\"/static/b1d6df455ad359471396408bfc14250b/12f09/1705297611055-d777045f-d945-4e9a-a18c-8c74044ff8c0.png 148w,\n/static/b1d6df455ad359471396408bfc14250b/e4a3f/1705297611055-d777045f-d945-4e9a-a18c-8c74044ff8c0.png 295w,\n/static/b1d6df455ad359471396408bfc14250b/fcda8/1705297611055-d777045f-d945-4e9a-a18c-8c74044ff8c0.png 590w,\n/static/b1d6df455ad359471396408bfc14250b/efc66/1705297611055-d777045f-d945-4e9a-a18c-8c74044ff8c0.png 885w,\n/static/b1d6df455ad359471396408bfc14250b/c83ae/1705297611055-d777045f-d945-4e9a-a18c-8c74044ff8c0.png 1180w,\n/static/b1d6df455ad359471396408bfc14250b/52c43/1705297611055-d777045f-d945-4e9a-a18c-8c74044ff8c0.png 1499w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />这和黄金有什么关系？这要从它们三个概念的英文单词说起，认证就是 <strong>Au</strong>thentication，而授权对应的是 <strong>Au</strong>thorization，审计呢，对应的英文是 <strong>Au</strong>dit。细心的同学们应该已经发现了，它们三个单词的前两个字母都是“Au”，而在高中化学课上我们学到了，金元素对应的字母表示正是“Au”。这便是“黄金法则”的由来。<br />当然，除了叫做“黄金法则”外，有时也会只取这三个单词中的首字母，称为 AAA 法则，或者叫 3A 法则。如果 3A 法则你也没听过，那么，A &#x26; A 你一定经常听到过吧？这时，就是省去了审计，A&#x26;A 指的就是认证和授权（即 Authentication &#x26; Authorization，时常也会被缩写为 AN 和 AZ，或者 AuthN 和 AuthZ）。<br />是的，认证和授权尽管联系紧密，以至于很多人傻傻分不清，但其实是有区别的。它们的区别可以用下图表示：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADTUlEQVR42jWSfUzUBRjHHxmGB8WLRXJKCHE4aeB2ay1dy5I0cjkx7NxaltLGdhvlcFaDw7losa6j6CqxAzUEbvfeHfyOMzlBuThxXOgd5xhiByORjrvLkOu4u9/Jj2/79fJs3/8+z3fPy5dYlhUlEolmAIr5+XmFzWZThMPhLziOU2KVqzb5o0RCCwEglmXf4Tjuu1gsJler1YrrIyMKAHJwK0oAW6ajHPFgEYDvAbQtLi6qhoaG2gCoAJwPr6Lp7N2I8MCN+wLH7RmerQKg5vm+Plv71NSddgCtCYBZSqwcIL4yMjOzBYJ1FUS0m1daasqrRFRORGUto7d7z/kT6PQnjvET5ghzXieil3klEe36r2f7MZO95et7CXw1u9xBYrH4yJ7yvQc7jAOHT1/olbZ29lZ36i9JZad1ku65vwZkM3GY43ifiPIOSt5qvmC7pdAwTpXedq1V/9PoGTPj/PLcZMhdO83ilC+ipa1bRIc+/ES5ayb48I/Qn2E8iK4m7kc4TC9wE4e0V6rf7bB8lEtEAqLijxs+latciI7+GsHEXAye2Si8s3Fob/4+VqVSy2sXkEVFokLJZ4pvy5y+FZa5Gcb0QgyzwTjuhHCvpLjk+afSBWX54mcpPXVt6YmTTfKrV+/Gx6YewPvbMtwzEXjnHoIZmtAT0V7hYSnxK1dVVr7xplL/S31tu7uh52ffce3FsUZN3/UTL+7cefS57Tv2FxcW0NN5m8SSt6tabhgYY7/Dy1y75VcPunyGi8OT9s+/+UG1bVvpe6n0b23csCFHwh9auF7QvDEnezJt3VoZEb2U/WR2ZX5BQZZIVETPlJSmZWakV1Byyu70jMeO5+Zu8j2+Pus8Ee1JeSS5Ys2apPy8zZv/iU1hMBgsH3aO7Gs4eUpZU1Njra+XNbndntcAvAAgmf8wgCQAO5aXlsobGxtlUqmUqaurOzPsdFYAeAXAVp7jwTaXywWtVgu73Y7BwUEYjUaYTCbE43EAyOdBv9//BAB2fHwcVqsVly8PwOFwwGw2IxAI8Jzlf8MjXq93wGAwmPr7+xmNRmO1WCw9Nputl+M4PsS8EYVCoUcBnPV4PNbu7u4enU5n1el0TFdX14+BQOASgA94w78BOn4KnmoCchAAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/a74d11085227c30f810ae98ef2307fa5/fcda8/1705291610833-261aa57d-735e-457b-8548-e5706678a495.png\"\n        srcset=\"/static/a74d11085227c30f810ae98ef2307fa5/12f09/1705291610833-261aa57d-735e-457b-8548-e5706678a495.png 148w,\n/static/a74d11085227c30f810ae98ef2307fa5/e4a3f/1705291610833-261aa57d-735e-457b-8548-e5706678a495.png 295w,\n/static/a74d11085227c30f810ae98ef2307fa5/fcda8/1705291610833-261aa57d-735e-457b-8548-e5706678a495.png 590w,\n/static/a74d11085227c30f810ae98ef2307fa5/efc66/1705291610833-261aa57d-735e-457b-8548-e5706678a495.png 885w,\n/static/a74d11085227c30f810ae98ef2307fa5/f6f7a/1705291610833-261aa57d-735e-457b-8548-e5706678a495.png 1009w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />当然，极客时间的课程里给我们讲得更加丰富，除了认证和授权，还加入了审计。它们的关系如下图：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACV0lEQVR42l2R60sUURjG9++pPyKQ/oSiQLqR0h0/BRGE0eVLamrq6iaEUSEmsuUFJCzspolSoLi47tycHd3LzJzZ3bntuM37xJndVfPDj3Nm3vc853nOG3NcVnNcFnJsxwx9n4XVap0gsMKqz0LPM8KAfx+h2eN59XNNjZjjmvwHOI7LUDANZIs6sgUdcl7HlpzF4q81CFoeSl6HnCtGRD1FHbplROeaGjHbiW5AxTFpP2B0d0ygkx3rdPphitriIp3ryVBrn0DXRmQ6/zxDF/oFujQgUEtnik50rFPvtEJhzaKybZLtmBRrROXq5PsMU0sank5K6J9R8GpBw+CshN5kGsNzIhLzKkbmVYx+UvFiVsGTSQkLf/YQVBk3VHfYyM5t8xvgeQyux2BVDJRsBiUrYXnlJ9KZFAxLR6ligpUNlO3D3uZzcQ4cNiLj/lsRLZ0p3HwpoT0u4NaojMuDMs52beHOqISL/Rm0xQW0Dws49WATA3MKwpqFin3EYTNy1WcY+6xGooNzKnqnVXQnJTwaT+PxhIC+mR08Syro/rCDno87uPdGxMzKLriRw8jOwZSJW+YFs2RE0zPLDLKqYPX3Gja3UsgbRRiNWlQvGbAq5rEpe1bo+iXYrkUIS3j9JYvWPgGXBwSc6UrjypCI6wkZtxMZ3EiIaIuLuDokRLTHxcgtT3Yg6Fi7oVGQkSto5Hs6VrcLePdVw8R3DePf6uv7HxqSy3uYWtqN9pMNeG1xIxcN51BQl0NN2oAob5Np5rAfWKCaBfrboFYn3GfR49MxasH/U/4HsDQG4ZCvM/sAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/6702321e5e1b0c2c7e10863fe5c775c9/fcda8/1705291713938-11c9e078-268b-44bb-b12d-c87032a0ec97.png\"\n        srcset=\"/static/6702321e5e1b0c2c7e10863fe5c775c9/12f09/1705291713938-11c9e078-268b-44bb-b12d-c87032a0ec97.png 148w,\n/static/6702321e5e1b0c2c7e10863fe5c775c9/e4a3f/1705291713938-11c9e078-268b-44bb-b12d-c87032a0ec97.png 295w,\n/static/6702321e5e1b0c2c7e10863fe5c775c9/fcda8/1705291713938-11c9e078-268b-44bb-b12d-c87032a0ec97.png 590w,\n/static/6702321e5e1b0c2c7e10863fe5c775c9/efc66/1705291713938-11c9e078-268b-44bb-b12d-c87032a0ec97.png 885w,\n/static/6702321e5e1b0c2c7e10863fe5c775c9/c83ae/1705291713938-11c9e078-268b-44bb-b12d-c87032a0ec97.png 1180w,\n/static/6702321e5e1b0c2c7e10863fe5c775c9/963fa/1705291713938-11c9e078-268b-44bb-b12d-c87032a0ec97.png 2666w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />总之，任何计算机系统要做到安全，都离不开“认证”、“授权”和“审计”这三个模块。\n<a name=zNukF></a></p>\n<h1>认证的对象和场景</h1>\n<p>认证的对象可以分为两类，这是我从极客时间里周志明老师的《周志明的软件架构课》中学到的，它们分别是“人类”和“机器”。它们的英文表示比较有意思，不是字面翻译，但是更加传神。分别是“Request Authentication”和“Peer Authentication”。<br /><a href=\"http://gk.link/a/10Abo\">周志明的软件架构课_软件架构_分布式系统_基础设施_架构演进_单体架构_SOA架构_微服务_云原生-极客时间</a><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 177.7027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/d3e717b8e74971c615cfeb688e838de7/fcda8/1705297977354-c8a59e92-b963-443f-9fcc-d1de807e763a.png\"\n        srcset=\"/static/d3e717b8e74971c615cfeb688e838de7/12f09/1705297977354-c8a59e92-b963-443f-9fcc-d1de807e763a.png 148w,\n/static/d3e717b8e74971c615cfeb688e838de7/e4a3f/1705297977354-c8a59e92-b963-443f-9fcc-d1de807e763a.png 295w,\n/static/d3e717b8e74971c615cfeb688e838de7/fcda8/1705297977354-c8a59e92-b963-443f-9fcc-d1de807e763a.png 590w,\n/static/d3e717b8e74971c615cfeb688e838de7/efc66/1705297977354-c8a59e92-b963-443f-9fcc-d1de807e763a.png 885w,\n/static/d3e717b8e74971c615cfeb688e838de7/c83ae/1705297977354-c8a59e92-b963-443f-9fcc-d1de807e763a.png 1180w,\n/static/d3e717b8e74971c615cfeb688e838de7/52c43/1705297977354-c8a59e92-b963-443f-9fcc-d1de807e763a.png 1499w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />以上按认证对象，将认证分成了“人类”和“机器”两种类型。而我个人，将它加以扩展，将它细分成“ABCDE”5 类，可能 2B 和 2C 大家也都听过，比较熟悉。但是 2A、2B、2C、2D 和 2E 这种同花顺式的分法，我之前从来没有见过，现在我在这里将它提出来，说不定以后这种分类法流行了起来，就会成为我的一个<strong>小小独创呢</strong>！<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.21621621621622%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABT0lEQVR42m2RsU7DQAyG80w8HVNHBCsbYkIMDIAEiI0FMZZWosDQUAgUtQq0aUh6adIk5/tQkjYFiiXrfD7fJ9u/BYbCjVmdv10o7DNpc/dxwKN3SCwfZa54+1tvFRyR4sIC+ttKoIEge8YeX+L4V6TGXzyulWOtA0DrABEfraeLbAWNzbCuE5OjTUwmilRCkjwgkxlWGF7Q620xGu0BCmN8PG+LbneTMNwlTeeEYQXx5g8Euc1Mu4zzFjMZ8K6usf1zHtxjhtNbrCTp4/sdoshGpE+et0pwkmTAmEZjwMZGgOKJ+8k+N84OzdE2Sr+VXYsI5sfKrL/jFvtcxoU1m8LRUQzosqMod5lqByUv/GfWUslKzSWsUryCrzav5JVcZmXKSzvYXyfYkzPcqF0LaK0A1NLXcTkTeHEP2z/FmV6SSSWUiCZKJqjEY56p+s83ivJmMS0UwesAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/22a08e12d8261c7f6f0c5128d13bf13f/fcda8/1705292590678-0945b1ca-2cff-4ef0-beeb-ae93c55f6c37.png\"\n        srcset=\"/static/22a08e12d8261c7f6f0c5128d13bf13f/12f09/1705292590678-0945b1ca-2cff-4ef0-beeb-ae93c55f6c37.png 148w,\n/static/22a08e12d8261c7f6f0c5128d13bf13f/e4a3f/1705292590678-0945b1ca-2cff-4ef0-beeb-ae93c55f6c37.png 295w,\n/static/22a08e12d8261c7f6f0c5128d13bf13f/fcda8/1705292590678-0945b1ca-2cff-4ef0-beeb-ae93c55f6c37.png 590w,\n/static/22a08e12d8261c7f6f0c5128d13bf13f/efc66/1705292590678-0945b1ca-2cff-4ef0-beeb-ae93c55f6c37.png 885w,\n/static/22a08e12d8261c7f6f0c5128d13bf13f/c83ae/1705292590678-0945b1ca-2cff-4ef0-beeb-ae93c55f6c37.png 1180w,\n/static/22a08e12d8261c7f6f0c5128d13bf13f/e4ba2/1705292590678-0945b1ca-2cff-4ef0-beeb-ae93c55f6c37.png 1468w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />这种同花顺式的分类法，也可以用在企业认证场景中。企业认证场景，也是可以粗分为两类，分别是“对内”和“对外”，而进一步也可以细分为“ABCDE”，如下图所示：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 120.94594594594594%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAABYlAAAWJQFJUiTwAAADnklEQVR42nWVz2tcVRTHL6UrN7PoJtBtF1UKimk3XRT6H/gDVEQhgogiboK4ECouLBUxFHQlFYvZNKRFgk0bU4zE+Fs0mTCpGSe/pnlOfsxk3syb6cybd+979yPv1503Md7hzn3cc9/3fM8533Of4H+GRod/2Q201gP27C/dE0eC6SAC6FJh3Run1LtOhwcDtghGB/FMnIcORXooNiSHk5fa3Gem/BpTxRGaLBnAI9knG8IYNRnPsdFVDmXnO9adKbqyEe0F2jfsN+UNtuQELnsZhhparFJngRb3+6DEL3pBk71gLnoOUMaxzU/cXh9hpvwqDymZyKKQS941pkovsdz5EI9qPxwNSnfZ0XcMkNQOe8xiyWks52e2nQVcZSfpSHK43Znjd+szSs4ku9ylom9zoH+lRxVFlV2+QlHDYYltPUFLF0O6/an7qhAhaqBig1ax0dM2Df6k4F1hZu0tvi2PsrD7DvPVN2noFcLIwScIApQKTM4Nwxg/MDMNedX5kumVt7lXvMTdlXeZLV5CshbZPC8wRQ6CfiFFipytdDg6+h82exM4sownXeruGhZf8MfyDi++0OXxJ2wuXGgyPt4z7CKGRuXaJ6ALSBp6CYubcYFCW0Lml5VVHsltIkQdIaoIUYvWy5e7kd33Q0Aj4r8pdMfItz5ih35VAx3g+3Hmn33aRYgDjh2rJWDxPH78gK0tPxF24r6hF5ktv8Gd9dcj8FjEyrBrtTRPDts8+pjNmTMNTp2yOXu2ycWLDqdPN7h1q5cCJl0h29QfbmJ3tujJ9kBe0nDOn2+Qyx0wNGRz4kSdoaE6J0/a5HJ15udlUpTsLXKoBVP1h9IIdXX1qocQdpK/A5PD4eGGqbjpZT0gnbT5Q4ahLCD2WWV09DeEaCPEfgR47lyTjQ3fyEcYcjo7tQGDPPAN8APwKTBGoWAxOekzN+ehVD8lRodHXq+JJ6U+YXHxKQqF5ygWXyGffwaYTSU9AJbpFMjeCHEx4sOdzj0qlffY3f0cyxpje/sDXHcV3+c/bTcAqHUfNA09brGvkTKPlCGAi5Q3UaqZnFMDgHCIoU5v66j7e2g9CfyY2FWyloHroavMJ6N/fYuB70g0lul0rtBuvw8sGCdxSH7CfAmlPkbKa2j9V+b9gZD9ZP2ecvl5NjZeDq/eDOsUOHyysKwRKpWwQHPJGf9wDmPavV6dZrOA46wgpTOQn37lbWq1Wfb3p3HdBxlnmn8BWELsBoSaNxAAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/e3fbe55e49a346d17b731be7297a5ae1/fcda8/1705292769019-aef3aa78-b68f-4ddf-a2f7-8a822e791bb2.png\"\n        srcset=\"/static/e3fbe55e49a346d17b731be7297a5ae1/12f09/1705292769019-aef3aa78-b68f-4ddf-a2f7-8a822e791bb2.png 148w,\n/static/e3fbe55e49a346d17b731be7297a5ae1/e4a3f/1705292769019-aef3aa78-b68f-4ddf-a2f7-8a822e791bb2.png 295w,\n/static/e3fbe55e49a346d17b731be7297a5ae1/fcda8/1705292769019-aef3aa78-b68f-4ddf-a2f7-8a822e791bb2.png 590w,\n/static/e3fbe55e49a346d17b731be7297a5ae1/78274/1705292769019-aef3aa78-b68f-4ddf-a2f7-8a822e791bb2.png 644w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=sBNjD></a></p>\n<h2>2A，面向 API 的身份认证</h2>\n<p>在许多应用程序中，API（应用程序接口）扮演着关键的角色，用于数据交换和服务访问。2A（To API）身份认证场景是指在 API 访问中使用身份认证来验证请求的合法性。这种场景下，身份认证通常使用 API 密钥、令牌或其他形式的凭证。<br />这种场景，其实也跨了对内和对外。一般建议有 2 个 API 网关，一个网关面向内部，一个网关面向外部。但是网关的作用都是类似的，都会对 API 的调用者鉴权。一个企业内部会存在多个领域和子领域，能力的复用也可以通过 API 的形式来提供。<br />API 可以分为同步 API 和异步 API，同步 API 多是我们熟悉的 Restful API、或者是 GraphQL。而异步 API 一般应用了事件驱动架构。建议的方式是领域内部通过同步 API 来调用，而跨领域之间使用异步 API 以解耦。\n<a name=cKQie></a></p>\n<h2>2B，面向企业合作伙伴的身份认证</h2>\n<p>企业合作伙伴之间的信息交换和资源共享需要进行身份认证以确保安全性和可信度。2B（To Business）身份认证场景是指企业间的身份认证，允许合作伙伴之间进行受控的访问和交互。\n<a name=QMIUb></a></p>\n<h2>2C，面向客户的身份认证</h2>\n<p>面向客户的身份认证是指为终端用户提供访问应用程序或在线服务的身份验证机制。2C（To Consumer 或者说是 To Customer）身份认证场景在电子商务、社交媒体和在线银行等领域非常常见。这种场景下，常用的认证方式包括用户名密码登录、社交登录和多因素身份验证等。<br />关于该领域的详细探讨，可以参考 Simon Moffatt 编写的《<a href=\"https://identity.jefftian.dev/main.html#ciam\">Consumer Identity &#x26; Access Management Design Fundamentals</a> 》一书。<br />当然，这是从技术角度探讨。从商业角度，我最近也学习了一个观点：要将焦点从客户转移到用户（《From customer to user》）。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADJElEQVR42gEZA+b8ALOjibGhh6+fhauYfaGPc5mHbJiEZ6aTdqWUepaGbYx7YYt6YIJxWXFjT11SQ0M7MTIuJiYiHRMQDUQ3JQC6qpC4qI62pYmunYCnjW6ujm2YgmhzY0+hkHiomYCYiW6JeWERDgwHBQIfGQ86LyBAMiApIBMBAQF6aE0AzL2mybukzbqffnxyH3OLap+ZYHVvAxEVJyklp492rpJ0m4pxDAwKTjwoo4FWwaJxq4tcXEktEhIRXEcsANnKs9rMt+PRtoWHgACBsQi10Ay6yCm8xienry2jp2CTkKKTeiIiI6R6bbJ+Wsmod6eLX0xDLiUiHktCMADYyrDZzLTn17qRjoYAUaIFhMYAkcJApdBUxtkAutATrLqblXw9Oz6bc3GscUziu4PSs36Dd1ocGxliWUYA1cet08as4tK1lo2BABSRAzbKAT/ABGHBFHrDCVnEDVmuraaXQUBDZFFboG5LaltLcmVOuqR8Dw8PbWJNANXHrdLEquHQtZ2TfgAORAwwqAo2vwWPwgapxRZTwRo0i1BQVQ4QGg4OGB8ZGQQECgQEDXZrVhkXEmBYRgDWx67UxKvi0LWkmIUACh8jO3AUSbsAlckEltMtZK5BSFgiJCUHBgsbGyArKy5FREFMSkZFRD4REAxaU0IA18au1cSr49G2qZ2JBg8oMD5gHEqeLoy7SGuVUFJbPTwzNjQvOzo5S0lHTkxHTEpGQD05Pz04HBwaTUQ2ANbErNTDquDPtK+hjAYMIzVBYj45boJoZUlnXB4dKCwoL6mgj1RRTjIyMUVEQUdGQEpIQjw6NS0sKUtFNwDWxKzTwqnfzbKuoYoABiAKGDwIEEoER48AXJgUFDsrJzDJvqiOhnwuLzFGRUNFQz4/PThMSEApKSU+Oi4A1cSr0sKo2smuu6yVR0RFV1JVLi0vS0hQpJeSt62buK2Z18mxkol7IyQlPz06ODcyOjk1ODo2YEo8XUw8ANXDq9bFrdfFrdbEq9zKruLQsWVaR21iUOjbv+baxNbKstjJsZSKeykoJzIwLEhANU5AMj4zJWlKNHRXOzDCREWt4UmJAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"6d9c1d6f-d5f6-4f32-a0ee-2428fb3ac56a.jpeg\"\n        title=\"6d9c1d6f-d5f6-4f32-a0ee-2428fb3ac56a.jpeg\"\n        src=\"/static/7c438b05d91f92b826099fdfc4b50cae/1c72d/1705294512711-5e7646d7-92af-4ec1-9c6c-afbf57a62849.jpg\"\n        srcset=\"/static/7c438b05d91f92b826099fdfc4b50cae/a80bd/1705294512711-5e7646d7-92af-4ec1-9c6c-afbf57a62849.jpg 148w,\n/static/7c438b05d91f92b826099fdfc4b50cae/1c91a/1705294512711-5e7646d7-92af-4ec1-9c6c-afbf57a62849.jpg 295w,\n/static/7c438b05d91f92b826099fdfc4b50cae/1c72d/1705294512711-5e7646d7-92af-4ec1-9c6c-afbf57a62849.jpg 590w,\n/static/7c438b05d91f92b826099fdfc4b50cae/a8a14/1705294512711-5e7646d7-92af-4ec1-9c6c-afbf57a62849.jpg 885w,\n/static/7c438b05d91f92b826099fdfc4b50cae/fbd2c/1705294512711-5e7646d7-92af-4ec1-9c6c-afbf57a62849.jpg 1180w,\n/static/7c438b05d91f92b826099fdfc4b50cae/802e9/1705294512711-5e7646d7-92af-4ec1-9c6c-afbf57a62849.jpg 1661w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />这是什么意思呢？原来作者主张，客户是付费购买你的产品的，而用户的范围更广，他们可能还没有成为你的客户，但是却非常重要，原因是对于潜在客户来说，这些用户的声音更有影响力。比如你在看一个商品时，如果是商家自己说好、或者已经购买的人说好，可能都不太会相信。对于前者，有王婆卖瓜的嫌疑；对于后者，更像是托（比如尊敬的某来车主？）。但如果一个路人说好，你可能会更加采信。该书作者举了一个生动的案例：很多人喜欢在宜家的沙发上坐着，甚至有人在床上躺着睡觉。本来宜家的老板是想赶这些人走的，但后来却被商业顾问建议，不仅不要赶走他们，甚至应该邀请更多人来商场葛优躺。原因是这些占了便宜的“用户”们在社交媒体或者亲朋好友之间随意闲聊时，说起这些体验，就会在其朋友圈产生出比起商业广告之类的宣传大得多的影响力。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 210px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 127.02702702702702%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAGAElEQVR42gH1BQr6AMfCscjBsca+r8a+rsS+rMS8qsa8q8W9q8W8q8O7qcG7p8G6p8C5pr+4pb+4pb63pL22o8K6p6mklIBzYQDNyLfNybnOyLjLxrrIxLbJw7LKwLDJwK7Ivq7EvqrCvKnCu6jDvKnDvKnBuqfCu6jAuabFvqunopKki28A29nL1dHF1dHE1dHF08/C083A0Mq9zci7zce5zce5ysO0ycGwxL2qwruoxL2pw7ypwruoxL2qvLShr5J4AKWineHf09nYy9rYzNnWytbVydnUxtvUxNfRxcbAtMTAtb25q8TBsMjDs8W+qcW+qsO8qcS9q7yznZp7YABmZGPw7uPl4dbk4dng3tbi4dnSy8CxpZnf39LHwrXDqpvCr57EvLDHwrnKxbXKxbLIwq/HwazGwK28rZwAubqzzs3IxsTAz8rE2dbQ29jRwru3o6Ga0s7F0bKc0Z+Cz56CwZZ+y7Wl087B19DB082+zci308282dTBAHdvgF9bcS03Qp6Ql5SNl1hcaBwlORAgNldSU9KojNqwlc2gh86fhr+giNzVx7q1rHRvZmllXqylmr25qgDHsteunbXX0uDAs8FwZ300QF4oNVUeLU6IenjTqY2je2KwiHGifGGoiG3Mw7Z8bl+KcFibgGmrjnZUTkIAz7O/28fPfIGTaVdtwoGNj2J8REJlOjxVuZCCzaKJqHpmuox3nXJdqX5qi3NigGRJs4xwr4txp4htT0U4AOjDuYBvfSpCYHNlg+elo9SkhjM/WjhCaribmtWoj6l8Z5RqWZRoWLSNeIVzY2JMPXZbTH1lVHplUG9aTAB+aXpmY4A5T3sTOXxheILn54hEWl4NLWR1dZW6lIGWcFewh3macF2ff2mij4KOalSPalV8WkmOa1edeWIAS12CLVOBbnycZmaHKliUZpjMN2eiJUV7ioGIn35viGpUkGtXg2RNzcCyyLuvgmRNhWFMh2JSgl5MY04/AFp9rYB/qHaCtVJopVF0wmmS6XeT2ZCXt9vApaJ4WnNVO2xOMnhaP8zCt/j17p6NfXFTPHVaRXFXQjQvJgCPsvKPn9+So9ais+m4u+e4q8KCc4N3d37X0ci9nYCbc06fdlOdfWGSioK7t7aKf3ZlSjJlSTByVj0ZFA8Axr7Mxs7ql8r8Uoa7JD5ZEh8qDBQfCA8YREVIjoiFu6SOxquSk4h9IiEjKCgyLzE7TEVDmYd3qpeGhH15AKmXfLewpG2ClxYhMAMFCQ0QGw0THwkPGwAEEBEVHyAjLBwiKg8WHwEIERMcJyMpNhogL1RcZdDQ0Ovn5ACiknycinByaGAHDBgGDBgLEBsMEh0MER0NEx4KDhoECRUABxEBCBMIDxoTGyQdJS4iKjUXHSqZmJv08ewAoZB7indgkIV4EBIcAgUSAgoVAwoWAQYSAAUSAwgUBgoVAwsTAAgQAAgQChEZDxggFh8tBw0bUlRc5OThAJ+NdJR/aqKTgxMQDwAABwEEEAIGECMnLT5CR0NHSUVISkZJTERHSkRHSUJHR0NJS0pQVD9FShATGr6/wACfi3OahW+0pJBIQDwAAAE+Pj9QUlAxMjM3ODhNTkxVV1RdYV5naWZnaGdjZ2ZiZWVlZ2c+QEAkJShxcnEApJF4nYhyuqiUdWxhGRkZLy8uUVNSV1pYNjg4KCkrKy0vLDAxNDU4PT5AQ0RGQEFDMTM1OTs6S01MSUxKAJ+KcpiFcKSTfnxyZjIzMzQ0NCAhIUlJSWNkYmNlYVtdWktOTz0+QDY3OTIyNTAyMzU5OURFRTU1NT0+PQCahW+IdV+olXyVh3kdHhw5OTk2NjcfHh4kIyM+P0FPUFJaXl9naWpnZ2pkZWdjZWVhY2E4ODgtLS04ODgAloJudmZTuqqVsqSSMzMwOjs7S0tLUVJQS0tILS8wIyUnLS4zODo8PD9AP0NEPUFCLTAyKCgoNDQ0Ly8vAIhzXmBNOqSKcbSeilJLSCoqLDU0NUJCQVRUU15gXlxdX0hKSzg7OzE1NzI2NzAzMzo8PEJCQjU1NT09PV2HtyzZFO3YAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"9cc6b9db-58be-4ab2-8710-85e68a755b7e.jpeg\"\n        title=\"9cc6b9db-58be-4ab2-8710-85e68a755b7e.jpeg\"\n        src=\"/static/56d44bafb9206417956b2bfd75aaea6c/60342/1705294529797-6c647545-2b45-4a3e-adfe-d0262172e923.jpg\"\n        srcset=\"/static/56d44bafb9206417956b2bfd75aaea6c/a80bd/1705294529797-6c647545-2b45-4a3e-adfe-d0262172e923.jpg 148w,\n/static/56d44bafb9206417956b2bfd75aaea6c/60342/1705294529797-6c647545-2b45-4a3e-adfe-d0262172e923.jpg 210w\"\n        sizes=\"(max-width: 210px) 100vw, 210px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />受此观点启发，我有点想将 2C 定义为“面向用户的身份认证”，但无奈没有找到合适的英语单词能够以 C 开头代表用户，于是仍然使用了面向“客户”，但我这里指的客户，并不只是付费用户，而是所有的用户。\n<a name=cloUh></a></p>\n<h2>2D，面向开发者的身份认证</h2>\n<p>2D（To Developer）身份认证场景是指开发者之间进行身份认证，以便在开发过程中访问受保护的资源和服务。这种场景下，通常使用开发者密钥、API 密钥或令牌进行认证。<br />在企业内部，有很多供开发者使用的系统，常见的日志系统、监控系统等等。这种情况下，开发者是企业的内部员工的一个子集。当然，还有面向外部开发者的系统，比如大的平台，都会提供开发者门户网站、或者开放平台等，这时面向的主要就是外部开发者了。<br />谈到一门生意，一般我们会想到 2B 或者 2C，而实际上，2D 也可以做成很大的生意，比如苹果，比如微信，其 2D 的业务如下图所示。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.5945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfklEQVR42nWSzW/TQBDF/f/f4YqQOHDjCGkl2gOqUKRAGmiqJnFbp+TLcePGJCb2zswPeZcQhYqRRrNf82be24n4j5kZZn5FmcGiB8s+pN+hXIXz5t702KN98gHkj2vwxlZ3SveNo/fW8eWVY3mjHPKOPfJV7AD6r1U/jbSvTLvigVT071upIRvA8hrSK8jvfId7dChmRrUxto9GNghnu0JZ9B3jz8LsUjCBeU+5PReKqXF7JoxOHYMPjuRCiBpauyJg5onwNFYeYyUbCVoHXdTBQ1uIz2pmXaUujWqrz+h6yk0Xk46Q3wdd1hPj/pPwK4fkwjE8dcTvHVoGaSYdY9hyHrgqYBUHqk1scqJsoKwnSj5Whi2hXIVKeWKMPgrbB6X1Tjg5WQMz6qr0sqiql6X9Qum+VtovlWnHiLJYPOBTgo+LK2WTGpulMu87bAc3Sca36x9gHWqX7QcLbeTaOKrS+Si1Bsqe9lfnP6OYiwfbJ/nP4hIl9Vs7mtHn9htOCbRf9Pf9wwAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/a3bbbe02acd09b211b9aeb05f009cbd9/fcda8/1705294586973-f379f200-1e03-47fe-bf0c-2f75d910ee69.png\"\n        srcset=\"/static/a3bbbe02acd09b211b9aeb05f009cbd9/12f09/1705294586973-f379f200-1e03-47fe-bf0c-2f75d910ee69.png 148w,\n/static/a3bbbe02acd09b211b9aeb05f009cbd9/e4a3f/1705294586973-f379f200-1e03-47fe-bf0c-2f75d910ee69.png 295w,\n/static/a3bbbe02acd09b211b9aeb05f009cbd9/fcda8/1705294586973-f379f200-1e03-47fe-bf0c-2f75d910ee69.png 590w,\n/static/a3bbbe02acd09b211b9aeb05f009cbd9/efc66/1705294586973-f379f200-1e03-47fe-bf0c-2f75d910ee69.png 885w,\n/static/a3bbbe02acd09b211b9aeb05f009cbd9/c83ae/1705294586973-f379f200-1e03-47fe-bf0c-2f75d910ee69.png 1180w,\n/static/a3bbbe02acd09b211b9aeb05f009cbd9/e4ba2/1705294586973-f379f200-1e03-47fe-bf0c-2f75d910ee69.png 1468w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />这时 2D 的身份认证建设就至关重要。\n<a name=TRBAz></a></p>\n<h2>2E，面向内部员工的身份认证</h2>\n<p>企业内部系统和资源的访问需要对内部员工进行身份认证。2E（To Employee）身份认证场景是指面向内部员工的身份验证，确保他们只能访问其所需的受保护资源和权限。\n<a name=sPqZO></a></p>\n<h1>解决方案</h1>\n<p>前面提到，要实现一个安全的 IT 系统，“认证”、“授权”必不可少。但每次都要从头开始实现，不仅成本巨高而不可行，甚至还是不安全的。因为安全是一个非常专业的领域，自己定制化的方案往往会有各种安全隐患。<br />好在，市面上有非常多的解决方案可供选择，比如 Okta、Auth0、AWS cognito、Entra ID、Authing.cn 身份云等等云解决方案数不胜数。而开源方案也有很多，比如我比较熟悉的 Keycloak、Duende IdentityServer 等等。\n<a name=KTcEC></a></p>\n<h1>对接方式</h1>\n<p>专业的事情交给专业的人或者团队去做，我们只需要做调包侠就行了。但是调包，也有不同的情况。以下分类讨论一下。\n<a name=ZVptf></a></p>\n<h2>购买的成熟产品</h2>\n<p>有时候，自行开发一套产品，不如直接购买来得快速与经济。对于成熟的产品，要对接现有的认证授权解决方案，一般以配置为主，没有太多发挥空间。即这个产品提供了哪种配置方式，就按照它的方式来进行配置就好。以前写过一些案例，比如这篇《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/405425214%5D(https://zhuanlan.zhihu.com/p/405425214)\">在自托管 GitLab 实例中集成 Keycloak 登录 - Jeff Tian的文章 - 知乎</a> 》就详解了在自托管的 GitLab 中对接 Keycloak 的步骤。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 114.86486486486487%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAAExUlEQVR42o3Sf0yUdRwH8O+BNmstDPQgD1wzzZXVzJlmslBA0GlqlqZWGlGauVCIYmKaPzJ/UGr/tFwiCN734OCOu0eYa445bLrFpm5kpvmLAwWzkYnc977f5/l8nk977o6utLQ/Xvt89+y79/P5fJ6HoeAOFPwFFHw8Cj4OBR+Lgj+DwvkUCv4ECj4aBR+Fgj+Ggj+Kgg9HwVNR8GEoeAoKbkfBk1DwRAjygQwFX4OCEwoeQsFVlIyynomoIAreF3ULBe+NuomC96DggILPtwJLQDgJhFOBcEIUhgXvYP4HgKDTaupNK7AYg5wwyCUEuWHBfuJ/k9EplzBTuopMycmUXJqSG6bk8E+uezFM6ZKmdFkZeYyUazUpF5FySVIug5QL7sTvxiDFJSluZeQzU/ICKxBD3NqhgSEOGHKCVft3ap2tbvtrpKvYPWs6K8OUrmWMVO1KU9YQgVsRNRiEtQZRnUHoNog8EabbIKPGIHIb/cGRe/WRu7o1crjD9xiI2hWEXrp07mvFq4rgVOsX8P2RzXDu9FfQ5C8FzVuCbSfK4Leub6HtZBmEg7HWuHG9HFqaN8IvP+0GI3hARTrk7zO9z72cSKPjR7fppSWv4SFtHVRXFuKRw5thzccLcMXyWdjkXwunT+2EDesXY5OvFH5u2xUO2lmWhzXOQuztqVBk1BCGnB8wva/+XaJGamn+XHdWFcOOrW9j+/k90Hq8DL7ckY+rC17G5u82AaHX8NSWoOYthZOtZRC8UQ37ywuw9dhWa6fRHfJVTBfefKImOvHDLv1Q40aoqvgQjxzeAhZX9UforCrGYy3b4PjR7XC1fS+0NG+BH0/uhrYTu+BAZSEebFgLnZf2KIJ6wlBNETOVP89UfiLdr1D6DNL9hurzABl+w1S+cEXpBUN4gMBvqFtuMKUHZG8t6EE3yN4aMIJuRaqeTFlXzFD6l5hKI1NpinQtHEiGZpjKD9a5v0bOkReQ7jP+qmEN0pQeMqWnhKH0vWF1aCq/bqpIQIQGsfO9+CQpH5myoZRByPs66T5r5HAg6X8P1G4L1u54TpEmJOl+Qun7hKlbdYtQNhDpPt1qPzyW7rMu3iUohpS1Hk2SrhFK/6dM9tYvAOElDDVIlA36v/NFRNZyG80Ssr4DSv8Gpvo8C8n6ynCQCBvJ+oViGqMOxpiWxhiMMZW2nfX9Xpslbtad6ek+cLYrUBkIXNzX3X6+/Nf2C3uvBS6Wd3dc3NfVeWnf1SuXK65cba/s7ApUdnR3VAa6O/cHrl3Zf/l6V/WFnmvOMzeuuzqCf9StYoyxeMZYAmNs5ODB9mkpKWlLk1NS8+3JjqX2ZMdie7Jjvt2eOtduT5051J6aO2SoIyspaVhGYuIj6QkJyRMZG/QkYyyNMWZnjA1gj41IiUufPGbgq6/MHJSTkzkk48X0tIyM9OGZUzMcWVlTUrKzp9pzczKTpk/PfnjGjOyEWbNyHpoze/qD8+bNfGDRwrn3L1+2+L71696Ju3D2G1vhqtk29tmmt1jByhw2+nGHLXPq5Pjc3MwBublZA7KzM+IzM9Pjp0yZFJc+eXzchAlPx02cMMY26fkxtufGj7KNe3aEbeSIRFuaYyCb89JYlp83jVVVFLE/AcmRe2bfE3yqAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/764cd8c7a873cc02ef7954e042658efc/fcda8/1705295740511-3448492c-e2d3-4b3a-bc41-f63eb847504a.png\"\n        srcset=\"/static/764cd8c7a873cc02ef7954e042658efc/12f09/1705295740511-3448492c-e2d3-4b3a-bc41-f63eb847504a.png 148w,\n/static/764cd8c7a873cc02ef7954e042658efc/e4a3f/1705295740511-3448492c-e2d3-4b3a-bc41-f63eb847504a.png 295w,\n/static/764cd8c7a873cc02ef7954e042658efc/fcda8/1705295740511-3448492c-e2d3-4b3a-bc41-f63eb847504a.png 590w,\n/static/764cd8c7a873cc02ef7954e042658efc/efc66/1705295740511-3448492c-e2d3-4b3a-bc41-f63eb847504a.png 885w,\n/static/764cd8c7a873cc02ef7954e042658efc/c83ae/1705295740511-3448492c-e2d3-4b3a-bc41-f63eb847504a.png 1180w,\n/static/764cd8c7a873cc02ef7954e042658efc/81ebd/1705295740511-3448492c-e2d3-4b3a-bc41-f63eb847504a.png 1868w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=a30kE></a></p>\n<h2>自建服务</h2>\n<p>由于微服务架构以及前后端分离的开发方式的流行，我这里也按从前到后的情况分类列举一些案例分享。</p>\n<blockquote>\n<p>前后端分离开发尽管有很多优势，但也带来了不少挑战，《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/351121637%5D(https://zhuanlan.zhihu.com/p/351121637)\">前后端分离开发中前端需要克服的挑战 - Jeff Tian的文章 - 知乎</a> 》列举了几个常见的挑战以及解决方案。</p>\n</blockquote>\n<p><a name=rIfdo></a></p>\n<h3>纯前端应用</h3>\n<p>这是指没有服务器端支持的 SPA，由于前端框架众多，所以这里再分类列举一下。\n<a name=cWb4O></a></p>\n<h4>UMI 3</h4>\n<p>《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/572820262%5D(https://zhuanlan.zhihu.com/p/572820262)\">实战案例：在 Umi Js 项目中通过 umi-plugin-oauth2 插件对接 Keycloak - Jeff Tian的文章 - 知乎</a> 》 有一个详细的例子。其中使用了 umi-plugin-oauth2，它是我从别人那里 fork 过来之后，进行了一些优化之后发布的 npm 包，但是只适用于 UMI 3，对于 UMI 4，有一些问题，详见代码库的 Issues，希望有好心人帮忙解决一下！<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 122.97297297297298%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC4klEQVR42p2Ty27USBSGi+QBskNsSMQz8C4kIhFrkEAzInmImQfhCVpC3Ys0JhvIJoRJWnGPXRdXlat8a7s7HdqxXeVCtkmgJ1zC/PoXR6rz+Zw6dQwwAP/bvzhGrW8H37mDAKB37y5ev14MBot+Pz84yN+8+dTr0Xv3UJvwY3hlBQHA1jeM1saYWqnyn486CI3S7MED1Cb8El43ZWmM0bMZBmCyu2uMYevrt4aVauD5vIH39n4Tvrxs4Cxr4JcvG/j+LeGNjVtXXln56tVVDIC3tjZ5/mLyx5/J02cYAP/hw3R3j6ytNfDq6rf5AILv+N8rQwCcq+CmQfToUbSzEz15Em9uJltbceft7WRnJ97ejjY3o62t6PHjJrhhYIwpT0fFu/fKmLyuC61zpS6VutRa1bX5qRr44tWr2V9/52WZJsk0y9LJZJplWZrmi4XRulaqrutaa1PXzfJ8Y1DXtWnPVJukWzWj7pasLa61LsuyKIp6uZemMkTo7cGBZVlHHz70er39/f3BYDAcDo+Pjy3LGg6HlmX1+/3Dw8M8z/8LTyYTznmSJFJK13U550dHR0EQTKdT1kpKGbeqquq6tS/wdDrFGHutOl5K6ft+kiRCCL+V67pRFBFCRqNRFEVLlTHGCCEp5Xw+D8MwCAJCCKXU8zzbth3HOTs78zwvy7LrQXyB0zRFCDmOQwhhjFFKgyAYjUaMMc/zxuNxF3TdYYzPz8+XYNiKEIJaCSG6yhBCx3EwxkIICKFt2+PxuGx/2Kt3vrhwXZcxFkWREIJSijHmnCOEIISUUoRQHMeccwghxnhpYGVZOo7DOY/j2HXdDj45OYEQMsYghAihNE3n87nrur7vV1X1FQ7DEEIopewwQoiU0nEc27YRQmEY0lbdFRaLxdI7z2az09NTjLHv+0IIhBCllDEWBEH3CSEE55wQcj2tbuCge/eiKJRSZVlWVaWUKopCtwtbVVVRFFUrdUOfAQ4fFf/9NBz5AAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/3e91481abd5714b56e468284af936e75/fcda8/1705295693479-4d37cf26-8731-4526-a253-64d3aaa468fb.png\"\n        srcset=\"/static/3e91481abd5714b56e468284af936e75/12f09/1705295693479-4d37cf26-8731-4526-a253-64d3aaa468fb.png 148w,\n/static/3e91481abd5714b56e468284af936e75/e4a3f/1705295693479-4d37cf26-8731-4526-a253-64d3aaa468fb.png 295w,\n/static/3e91481abd5714b56e468284af936e75/fcda8/1705295693479-4d37cf26-8731-4526-a253-64d3aaa468fb.png 590w,\n/static/3e91481abd5714b56e468284af936e75/efc66/1705295693479-4d37cf26-8731-4526-a253-64d3aaa468fb.png 885w,\n/static/3e91481abd5714b56e468284af936e75/c83ae/1705295693479-4d37cf26-8731-4526-a253-64d3aaa468fb.png 1180w,\n/static/3e91481abd5714b56e468284af936e75/f3015/1705295693479-4d37cf26-8731-4526-a253-64d3aaa468fb.png 1804w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=wNEen></a></p>\n<h4>VUE</h4>\n<p>《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/591563537%5D(https://zhuanlan.zhihu.com/p/591563537)\">使用 IdentityServer  保护 Vue 前端 - Jeff Tian的文章 - 知乎</a> 》举了一个详细的例子，而《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/613991655%5D(https://zhuanlan.zhihu.com/p/613991655)\">使用 vuex-oidc 在 Vue 项目中对接 Duende IdentityServer - Jeff Tian的文章 - 知乎</a> 》又再次使用 vuex-oidc 在 VUE 应用中的使用给出了详细的对接步骤。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 114.86486486486487%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/5cf2146911ae6b84c0e4ccf2993ab4a0/fcda8/1705295841946-1e8f613a-37af-45b4-9eb5-c1aad98a14d4.png\"\n        srcset=\"/static/5cf2146911ae6b84c0e4ccf2993ab4a0/12f09/1705295841946-1e8f613a-37af-45b4-9eb5-c1aad98a14d4.png 148w,\n/static/5cf2146911ae6b84c0e4ccf2993ab4a0/e4a3f/1705295841946-1e8f613a-37af-45b4-9eb5-c1aad98a14d4.png 295w,\n/static/5cf2146911ae6b84c0e4ccf2993ab4a0/fcda8/1705295841946-1e8f613a-37af-45b4-9eb5-c1aad98a14d4.png 590w,\n/static/5cf2146911ae6b84c0e4ccf2993ab4a0/efc66/1705295841946-1e8f613a-37af-45b4-9eb5-c1aad98a14d4.png 885w,\n/static/5cf2146911ae6b84c0e4ccf2993ab4a0/c83ae/1705295841946-1e8f613a-37af-45b4-9eb5-c1aad98a14d4.png 1180w,\n/static/5cf2146911ae6b84c0e4ccf2993ab4a0/81ebd/1705295841946-1e8f613a-37af-45b4-9eb5-c1aad98a14d4.png 1868w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=PUmED></a></p>\n<h4>NextJs</h4>\n<p>《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/504711474%5D(https://zhuanlan.zhihu.com/p/504711474)\">用技术直觉力解决棘手问题 - Jeff Tian的文章 - 知乎</a> 》 以一个问题排障为引子，详细介绍了如何在 NestJs 里利用 Next-Auth 来对接身份认证服务。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 114.86486486486487%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/890cda0232daedb61712c95e7439834e/fcda8/1705296008128-87ff30dc-52ad-4c45-bbb7-58db43986ca5.png\"\n        srcset=\"/static/890cda0232daedb61712c95e7439834e/12f09/1705296008128-87ff30dc-52ad-4c45-bbb7-58db43986ca5.png 148w,\n/static/890cda0232daedb61712c95e7439834e/e4a3f/1705296008128-87ff30dc-52ad-4c45-bbb7-58db43986ca5.png 295w,\n/static/890cda0232daedb61712c95e7439834e/fcda8/1705296008128-87ff30dc-52ad-4c45-bbb7-58db43986ca5.png 590w,\n/static/890cda0232daedb61712c95e7439834e/efc66/1705296008128-87ff30dc-52ad-4c45-bbb7-58db43986ca5.png 885w,\n/static/890cda0232daedb61712c95e7439834e/c83ae/1705296008128-87ff30dc-52ad-4c45-bbb7-58db43986ca5.png 1180w,\n/static/890cda0232daedb61712c95e7439834e/81ebd/1705296008128-87ff30dc-52ad-4c45-bbb7-58db43986ca5.png 1868w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=NwFfW></a></p>\n<h3>BFF 层</h3>\n<p>尽管纯前端对接身份认证服务是完全可行的，但是属于“不得已”而为之。如果有服务器端，还是应该在服务器端对接身份认证服务。如果在前端进行对接，就要使用公开客户端，因为将密钥保存在前端，非常容易泄露，从而使用保密客户端没有意义。在不得已要在纯前端中对接身份认证时，就一定要对跳转链接进行验证，并且一定要开启 PKCE。详见《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/652900498%5D(https://zhuanlan.zhihu.com/p/652900498)\">抛弃隐式许可，拥抱 PKCE - Jeff Tian的文章 - 知乎</a> 》中的论述。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.5945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA8ElEQVR42pWSiY7DIAxE+/+/2SpKK8imFAhgw1uRSum5R5EGIcueGWPvAELwWGuZpolpspzP8/q2xnA8Htnv9wzDwOl0whiDc45xHIkx9nJaaxt2/RKp5Cw3FFljRRRRpdb6FvdEtbY1tlOtxKiEKPhQ8CETYiblRkxKFuG/Z3PYWsVdEmeX0JxQf6Hm9JL8Gx4Iu92Lz3zNC8tSKDGSvUeK0DvouC96J/RC6NyVsKM7DYtgbMb7/gXlR8L72EpIH4pWDsPMYXAYGzBGSElJiVXso5b7ZEQEUVmLrwnPDj4YSidU1SfFuq3CX84eV6fyDewRxKgxy9TOAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/e15d59ca32d5db990ab6cad8465c2fda/fcda8/1705296289848-10df8bd6-91b5-46ce-b38b-af31db63cf35.png\"\n        srcset=\"/static/e15d59ca32d5db990ab6cad8465c2fda/12f09/1705296289848-10df8bd6-91b5-46ce-b38b-af31db63cf35.png 148w,\n/static/e15d59ca32d5db990ab6cad8465c2fda/e4a3f/1705296289848-10df8bd6-91b5-46ce-b38b-af31db63cf35.png 295w,\n/static/e15d59ca32d5db990ab6cad8465c2fda/fcda8/1705296289848-10df8bd6-91b5-46ce-b38b-af31db63cf35.png 590w,\n/static/e15d59ca32d5db990ab6cad8465c2fda/efc66/1705296289848-10df8bd6-91b5-46ce-b38b-af31db63cf35.png 885w,\n/static/e15d59ca32d5db990ab6cad8465c2fda/c83ae/1705296289848-10df8bd6-91b5-46ce-b38b-af31db63cf35.png 1180w,\n/static/e15d59ca32d5db990ab6cad8465c2fda/78363/1705296289848-10df8bd6-91b5-46ce-b38b-af31db63cf35.png 1522w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />关于 BFF，我也有一些个人观点，甚至杜撰了一些名词，详见《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/571585321%5D(https://zhuanlan.zhihu.com/p/571585321)\">BFF 进化 - Jeff Tian的文章 - 知乎</a> 》中的陈述。<br />如果是使用 Java Spring Boot 写 BFF 层，则可以使用 spring-security-oauth2-client，基本上只需要配置一下。\nyaml\nspring:\nsecurity:\noauth2:\nclient:\nregistration:\nidp:\nclientId: xxx\nclientSecret: yyy\nredirectUri: zzz\nauthorizationGrantType: authorization_code\nscope: [openid, email, offline_access]\nprovider:\nidp:\nauthorizationUri: xxx/connect/authorize\ntokenUri: xxx/connect/token\njwkSetUri: xxx/.well-known/openid-configuration/jwks\nissuerUri: xxx\nuserNameAttribute: email</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 114.86486486486487%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/4f33ee729bd22585cd5101a2bf290a48/fcda8/1705296431914-1aceba69-048b-4919-b92e-32829fc990ee.png\"\n        srcset=\"/static/4f33ee729bd22585cd5101a2bf290a48/12f09/1705296431914-1aceba69-048b-4919-b92e-32829fc990ee.png 148w,\n/static/4f33ee729bd22585cd5101a2bf290a48/e4a3f/1705296431914-1aceba69-048b-4919-b92e-32829fc990ee.png 295w,\n/static/4f33ee729bd22585cd5101a2bf290a48/fcda8/1705296431914-1aceba69-048b-4919-b92e-32829fc990ee.png 590w,\n/static/4f33ee729bd22585cd5101a2bf290a48/efc66/1705296431914-1aceba69-048b-4919-b92e-32829fc990ee.png 885w,\n/static/4f33ee729bd22585cd5101a2bf290a48/c83ae/1705296431914-1aceba69-048b-4919-b92e-32829fc990ee.png 1180w,\n/static/4f33ee729bd22585cd5101a2bf290a48/81ebd/1705296431914-1aceba69-048b-4919-b92e-32829fc990ee.png 1868w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=A0fMa></a></p>\n<h3>后端领域服务层</h3>\n<p>在前面我们介绍了前端代理服务器 BFF（Backend For Frontend）的概念和作用。它是一个位于前端应用与后端领域服务之间的中间层，负责聚合和转换数据，提供定制化的接口给前端应用使用。<br />而领域服务是运行在服务器上的后端服务，它们负责处理特定领域的业务逻辑和数据持久化。领域服务通常被组织为一组微服务或模块，每个服务或模块负责处理特定的领域功能。<br />尽管领域服务和 BFF 都运行在服务器上，但它们在功能和定位上有一些区别：</p>\n<ul>\n<li><strong>领域服务的职责</strong>：领域服务是负责处理具体领域业务的服务，它们关注业务逻辑、数据持久化和领域模型的实现。领域服务通常是面向内部系统和后端业务流程的。</li>\n<li><strong>BFF 的职责</strong>：BFF 是前端应用与后端领域服务之间的中间层，它负责为前端应用提供定制化的接口和数据聚合。BFF 的目标是提供更好的用户体验和前端开发效率，它关注的是前端应用的需求和数据交互。</li>\n<li><strong>数据处理的角度</strong>：领域服务更关注业务逻辑和数据持久化，它们会对数据进行处理、验证和持久化。而 BFF 则更关注数据的聚合和转换，将多个后端服务的数据整合成前端需要的形式。</li>\n</ul>\n<p>总的来说，领域服务和 BFF 在职责和关注点上有所不同。领域服务负责处理具体的领域业务逻辑，而 BFF 则负责为前端应用提供定制化的接口和数据聚合，以满足前端的需求。<br /><strong>在后端领域服务层对接身份认证，与纯前端和 BFF 层有着非常大的不同！纯前端也好，BFF 层也好，在对接身份认证时，主要偏向于用户交互，通过用户的授权，实现对用户令牌的_获取_。而在后端领域服务层中对接身份认证，主要目的是直接或者间接地通过身份认证服务来_验证_令牌。</strong><br />这个不同，还体现在它们在身份认证流程中的角色不同。首先，前端或者BFF，都充当了第三方应用的角色；而后端领域服务，往往是资源服务器的角色。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABTklEQVR42l2RbWvcMBCE/f9/W2mh/R4o5XKxLGlfJNmyz/KU3XBJyMIgyQzP7qwnSq+Y74Lb31fcf/wCx4RSC1QimBm1Vmxbx3EMpLih9weIVoh0jPNCCBWtHYhLQykrphQFb7eAf7eAVAJqM0OF0k8QLWhtxbquDi2lQURQSsXjMWBl5xiXn713TKICk5ryHwhHiChE2GUTjjFwjQvbtvnbGqgqSlGHPGvfOyZmcQDn30jxjpwZRORxbRoDfC9rwERYloAYFxzHgfN8YN93AzKIFUQzVMnhOWdXSsknOY4T53mBueM8AdWOonYfmGdrumOeGa1tmJgKhG4QekHO4pCvQFMIAZYk54Jam/tM67qBqPpul4WhUjClRcHpDZxfwPzcnXhk0xNu0d4VkXP68NnuzZdS9Pek/lMKRKt/+C6L/LwTfTb4TPGexKDm/Q+jLGSsS8XWbQAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/f29eb8055d206e824555170c4858b19e/fcda8/1705297074251-fcad9d2b-ec75-441e-8994-cc6a02bfaa25.png\"\n        srcset=\"/static/f29eb8055d206e824555170c4858b19e/12f09/1705297074251-fcad9d2b-ec75-441e-8994-cc6a02bfaa25.png 148w,\n/static/f29eb8055d206e824555170c4858b19e/e4a3f/1705297074251-fcad9d2b-ec75-441e-8994-cc6a02bfaa25.png 295w,\n/static/f29eb8055d206e824555170c4858b19e/fcda8/1705297074251-fcad9d2b-ec75-441e-8994-cc6a02bfaa25.png 590w,\n/static/f29eb8055d206e824555170c4858b19e/efc66/1705297074251-fcad9d2b-ec75-441e-8994-cc6a02bfaa25.png 885w,\n/static/f29eb8055d206e824555170c4858b19e/c83ae/1705297074251-fcad9d2b-ec75-441e-8994-cc6a02bfaa25.png 1180w,\n/static/f29eb8055d206e824555170c4858b19e/ed358/1705297074251-fcad9d2b-ec75-441e-8994-cc6a02bfaa25.png 2904w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />如果使用 Java Spring-Boot 做后端领域服务的开发，可以使用 spring-security oauth2 resource server （<strong>spring-boot-starter-oauth2-resource-server</strong>）来对接身份认证服务。\nyaml\nsecurity:\noauth2:\nresource:\nurl: xxx\njwk:\nkey-set-uri: <a href=\"https://yyy/.well-known/openid-configuration/jwks\">https://yyy/.well-known/openid-configuration/jwks</a>\ntoken-type: Bearer\ntoken-info-uri: <a href=\"https://yyy/connect/token\">https://yyy/connect/token</a></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 114.86486486486487%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFTElEQVR42o2R6W9UVRjGLxSMogiUpWVTCQj+BaKRaExkR0ARtAS3GMi0QGOCphYsm+xlKyAVGxqhnXtnpp3lznSBUpaWpQUaIICpRQIpIHSjs7Qz95x73vu+5swULcQPfnjynHPuvb/7Ps9RkGsvI1MnINPGIdNeQ6a9ikx7BZk2Fpk2Bpk2Gpk2Cpk6EpmaikxLQeYaQcw1HA3HMBF1DGURe3IsWJQcai18XkGmLUWmETItgkzr7qWuXor8KzWMzBFG5gwRd4WkW4ajA6IqRDuPZEvgcuISqApkqoVMxf8njdBwkBVzkISJbjtF2gu3KsS1FchUIq4xMjVBXBNxNx2J9bMyNfnjxFo4BRqaEN12ZnYVU7itcJuCTM2UE1qGykW0WFiGCixSBNHgEZBriNlBfizX0s1oMZBwSCiE2g4DjxSBFVMZCxfJCXMVES3+ltBF1xp28HI9G05VrYMLNZvA78mCk8fXwonKHLh6aTtU+FeDS1tl1Z7aEN/XVK+HSv/q+Hnj9d0conLCw7sVy1BXkXBQx8MCXn1sLfxxYw+0PjgE9+8chLqzm6Cq/EcItRdC0829cOv3vdB8+wA03dwDd5v2Q/tfv8L5Mz/Jcy6HigV/y1OIO79H5iCyXIzAJQh7ZDnjPcpoRCWCRY6CiBaD2V0MT87i7wiH7JXJ2iBmP6AgK8kiXkLIXMwynIK4SxjhYqg/twUqA2vgzIn1ICcPeH+A6sqceCV3mvYDWS4h+5VwZCpL3IM9X0HmzkZWSsRKGbISQbxUiKgT7t7Kh6uXdkLj9Ty4cjEXmv88CI+aD8G1htz4hT2Z/hlggYLcuwa5h4h7GHG3QOYGEh5B6BNEuiB64rog9Aiy3ILMkngSZA4gLsFaD1AtVJD7ctD0EXIfQ+4VZPrE5bpdUBlYB1UVG6D21BY4X7MNaqo3Q+3JzdBQtxMq/DnQcv8wkOURyFwg6yLuJMtwHFWQ6+uR64RcZ2TqArkPHt47Ak0386HxxkG4ejkv7vXncqH5dgHcbsyHG1fyoDuoxpMgKwVkpUzeg2W4VAncSKZOZPoN5H6B3A+EZYKsMkFUIYiOC6JyQXSsZ18uCPR4EuQeIO6RLusiyyh1SuBmMv2E3G+QKYE6kAiIrk4XnKraApVlG+Hs6R1Qd3YXVAQ2QPWxzRALlwIJfzwNmj6QdRH3ksU8bnkpWyneoW4g1/8Bsi431J/bBRdqd8Kje0eh8cYv0FC/N+7yuUwjB+gZQtZFFvPpisW82yWQTK8hYyQUB/dElRF74mO5IKtcEA+ArKaXmExpMb1MAnOR+wiZ17CYVyTkSbjhEWDIvS/hhk9YTH9KyP2mrAt5gCzmr5DAfcR1IqFbJPxEVoAI/P8h/em9CPQWSkfuPy2B68DwhLuDzgfhDq2js1UNPm6xhzta7OHHCYUSXhzqbLUHg21qZ6hdfSzfjTx2tHeHXC2sy33PjHo7RczrUKIh54DCgsyxs2e9+d70aZMXTJ361tJpU9/OmDH9nfSZM6YsmzljyjdzZr/7xfx576d9suCDhZ8umv7R4rSZH36+ZPasr7+aOzVzxaLJuduXjdfda0ZdPL9zsBILuxQiUhRFSVKUIQNHpExIGTV64sgxY99IHTV6UkpK6sThKamTkoePmDRk6LCJgwcnvz5o4KDxA194cdxLSp8xAxQl6Tn5PVGDEmrXFIXopBJss/f5eZ+tb3bWl0mZK5f0z0hP659u+6z/yuVp/TJXLu6Xkb6wX7ptQb9028dJ6bb5SRm2eUkZtrlJGbY5SZkr5vTN+m5u34b63X3IKlP+Bq3ro87RXR5EAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/daadc378295ed4d9bd5f27cf4f2f340a/fcda8/1705297139536-91b78e0f-bdb3-479d-ab11-48db47687f4e.png\"\n        srcset=\"/static/daadc378295ed4d9bd5f27cf4f2f340a/12f09/1705297139536-91b78e0f-bdb3-479d-ab11-48db47687f4e.png 148w,\n/static/daadc378295ed4d9bd5f27cf4f2f340a/e4a3f/1705297139536-91b78e0f-bdb3-479d-ab11-48db47687f4e.png 295w,\n/static/daadc378295ed4d9bd5f27cf4f2f340a/fcda8/1705297139536-91b78e0f-bdb3-479d-ab11-48db47687f4e.png 590w,\n/static/daadc378295ed4d9bd5f27cf4f2f340a/efc66/1705297139536-91b78e0f-bdb3-479d-ab11-48db47687f4e.png 885w,\n/static/daadc378295ed4d9bd5f27cf4f2f340a/c83ae/1705297139536-91b78e0f-bdb3-479d-ab11-48db47687f4e.png 1180w,\n/static/daadc378295ed4d9bd5f27cf4f2f340a/81ebd/1705297139536-91b78e0f-bdb3-479d-ab11-48db47687f4e.png 1868w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />当然，不使用<strong>spring-boot-starter-oauth2-resource-server</strong>也是可以的，只是代码量会很大，详见《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/644394539%5D(https://zhuanlan.zhihu.com/p/644394539)\">不使用 spring-boot-starter-oauth2-resource-server，如何使用 OIDC Server 保护 API？ - Jeff Tian的文章 - 知乎</a> 》中的讨论。<br />能够使用<strong>spring-boot-starter-oauth2-resource-server</strong>尽量使用，但有时，需要一些特殊的用法而又难以对它进行扩展时，就不得不自己写代码了。这些特殊用法，这里《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/626130631%5D(https://zhuanlan.zhihu.com/p/626130631)\">通过 Bean 的方式扩展 Spring 应用，使其同时支持多个授权服务颁发的令牌。 - Jeff Tian的文章 - 知乎</a> 》有一个实际例子。</p>\n<p><a name=GhbaE></a></p>\n<h1>总结</h1>\n<p>用一张脑图总结今天的内容吧：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fb03d18f0bc0f24bc0746381802e40b9/8d294/1705311015473-aae1230f-d630-4437-b52b-3809c3e145c5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1ElEQVR42mWS3WoTQRiGcxu9qp57EQrehYgHgkapoCAUFAVJoQee9AerrUiKTQtqhPzUZDdZdutOJpOdnZ2dR3a2pE38YNlZvm/eeZ99p+Gcw7mSqopiRFkKnGOlbmb+YG0X5waAvZ5bHW7c/pjNjrA28msp2wTBDkqdXXctcfyEXu8ecfwQ0F6wOqg+sH4a1iZIeQIYtO4i5SmQIMQ3RqMWUtaC1mZofYXWAVrPcM7+R+IdGhMRx/uVP++o338DLNaQF4Tha6Joi8nkBZPJM4zp+V6eX5FlU7IsxFqxilyV1qfE8Y7/nzWS829jZuT5JXn+G2PU0p0Qe4zHDxiPm0h5QCOOPzIcbpMku97ZbNYminYpih9VTJUH7z5JtgmCp4xGj1ks9nFuynD4DiEOgfIGWakOaXqCUm2cU8tGlh1zfn6Xi4v7FMXxGoejLM/odu+g1JZPPUk+IOXRbeSU8fg5l5ePyLJOJUmed9C6jzFdptP3TKctguAteT7wO3q9Pp1OWIEjxAHz+XcadewlZVmgdYYxhjQ9ZDB4yWDwCiE+efE0/YIQXxHiM8aEXnBzc87Gxl+UWruHbi3/oghR6idK/Vq6WU29xm61NM3mwq/ra1TyDxsL9IAaHSpBAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/fb03d18f0bc0f24bc0746381802e40b9/fcda8/1705311015473-aae1230f-d630-4437-b52b-3809c3e145c5.png\"\n        srcset=\"/static/fb03d18f0bc0f24bc0746381802e40b9/12f09/1705311015473-aae1230f-d630-4437-b52b-3809c3e145c5.png 148w,\n/static/fb03d18f0bc0f24bc0746381802e40b9/e4a3f/1705311015473-aae1230f-d630-4437-b52b-3809c3e145c5.png 295w,\n/static/fb03d18f0bc0f24bc0746381802e40b9/fcda8/1705311015473-aae1230f-d630-4437-b52b-3809c3e145c5.png 590w,\n/static/fb03d18f0bc0f24bc0746381802e40b9/efc66/1705311015473-aae1230f-d630-4437-b52b-3809c3e145c5.png 885w,\n/static/fb03d18f0bc0f24bc0746381802e40b9/c83ae/1705311015473-aae1230f-d630-4437-b52b-3809c3e145c5.png 1180w,\n/static/fb03d18f0bc0f24bc0746381802e40b9/8d294/1705311015473-aae1230f-d630-4437-b52b-3809c3e145c5.png 2706w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}