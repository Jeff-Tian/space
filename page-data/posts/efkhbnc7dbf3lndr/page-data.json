{"componentChunkName":"component---src-templates-post-js","path":"/posts/efkhbnc7dbf3lndr/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/efkhbnc7dbf3lndr","relativePath":"posts/efkhbnc7dbf3lndr","frontmatter":{"title":"Keycloak 自定义验证提供者程序示例","stackbit_url_path":"posts/efkhbnc7dbf3lndr","date":"2023-03-29T11:54:23","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a name=xHSPY></a></p>\n<h1>验证器 SPI</h1>\n<p>Keycloak 包含了一系列不同的验证机制：kerberos、密码、一次性密码及其他。当这些机制都不能满足你的需求时，你需要将自定义的验证机制集成进入 key cloak 中。Keycloak 提供的验证 SPI 能让你写新的插件，然后可以通过管理控制台对新的验证机制进行应用、排序和配置。</p>\n<p>Keycloak 还支持简单注册表单。这种表单可以用不同的形式开启和关闭，比如，开启和关闭 Recaptcha。也可以用它在注册流程中添加额外的页面甚至重新实现整个流程。当然，也有额外的微调过的 SPI 可以用来添加专门的验证以及向内置的注册表单中添加用户扩展。</p>\n<p>Keycloak 中的强制操作是当用户通过验证后必须执行的操作。Keycloak 有一些内置的强制操作，比如“重置密码”。该操作迫使用户在登录之后修改密码。你也可以写自定义的强制操作并且插入到 Keycloak 中。</p>\n<blockquote>\n<p>需要注意的是，如果验证器程序或者强制操作的实现使用了用户属性作为链接/建立用户身份的元数据属性，那就得保证用户不能编辑这些属性，并且需要将相关的属性都设置了只读。比如 LDAP_ID属性，被 Keycloak 内置的 LDAP 提供者用作存储用户在 LDAP 服务器侧的 ID。</p>\n</blockquote>\n<p><a name=sljxL></a></p>\n<h1>术语</h1>\n<p><a name=pRoBQ></a></p>\n<h2>验证器流程</h2>\n<p>一个流程是一个特殊的容器，在该容器里装着所有在登录注册中会被执行到的验证器程序。在管理控制台的验证选项卡中，可以看到所有定义好的流程，以及组成这些流程的验证器程序。流程可以嵌套。也可以为浏览器登录、直接授权登录以及注册绑定新的不同的流程。\n<a name=wXC55></a></p>\n<h2>验证器</h2>\n<p>一个验证器是一个可插拔的组件，它包含着执行某个流程中的验证或者操作步骤的逻辑。一般是一个单例。\n<a name=nQZWR></a></p>\n<h2>执行者</h2>\n<p>一个执行者是一个对象，它将验证器绑定到流程上，以及将验证器绑定到它自己的配置上。一个流程包含着执行的条目。\n<a name=hI511></a></p>\n<h2>执行规格</h2>\n<p>每个执行者都定义了一个验证器在流程中如何表现。而执行规格定义了该验证器是否开启、是否禁用、是否条件启用、是否必需，或者是否是一个备用选项。一个备用规格意味着验证器于它所在的流程中足够完成校验，但却不是必须的。举个例子，在内置的浏览器流程中，cookie 验证、身份提供者跳转、以及表单子流程中所有的验证器集合都是备用选项，因为它们以一个顺序的自顶向下方式执行，只要其中一个成功，整个流程就成功了，其他还没有运行的执行者就不用再运行。\n<a name=zD5No></a></p>\n<h2>验证器配置</h2>\n<p>这个对象定义了某个流程中验证器为某个执行者所做的配置。每个执行者都可以有不同的配置。\n<a name=rahKC></a></p>\n<h2>强制操作</h2>\n<p>当验证完成，用户可能需要完成一些一次性的操作才能被允许登录成功。比如用户被要求设置一个一次性密码标记生成器、或者重新过期的密码、或者接受一些条款。\n<a name=okiLh></a></p>\n<h1>算法概览</h1>\n<p>来看一下浏览器登录是怎么工作的。假设有如下的流程、执行者以及子流程：\njava\nCookie - ALTERNATIVE\nKerberos - ALTERNATIVE\nForms subflow - ALTERNATIVE\nUsername/Password Form - REQUIRED\nConditional OTP subflow - CONDITIONAL\nCondition - User Configured - REQUIRED\nOTP Form - REQUIRED</p>\n<p>在上面的表单中的顶层级别中定义了 3 个执行者，它们全是备用的。这意味着只要其中之一成功，其他的就不需要运行了。如果 SSO Cookie 被设置或者 Kerberos 登录成功，那么其中的用户名/密码表单就不会执行。</p>\n<p><a name=DrJof></a></p>\n<h1>代码示例</h1>\n<p>完整的代码提交见： <a href=\"https://github.com/Jeff-Tian/keycloak-heroku/commit/ed8359fbba8245c029baf661379882dd30b928ca\">https://github.com/Jeff-Tian/keycloak-heroku/commit/ed8359fbba8245c029baf661379882dd30b928ca</a></p>\n<p>它包含一个 ProviderFactory，以及一个 Provider 实现。并且通过 resources/META-INF/services 下面的文件声明该 ProviderFactory。</p>\n<p>将代码打包成 jar 文件，并且拷贝到 Keycloak 的 providers 目录下，Keycloak 就能扫描到，并且通过 resources/META-INF/services/ 下的文件加 provider 加载到系统中。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/66848f358dfc9b19731e6984e6a56542/29007/1680090114948-88af7951-155c-481e-9a2c-dcf1b9395af0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABCklEQVR42pWR70rDMBTF+xTaTZTZuG6sdTrxAfpZ59T3/1oLTf9A2qSRNu2RZJswmWt34BC44f44l2N5j0+4nUxgj0ZwCIHjOMaEkEF2XdfY930EQQDLIVNc2GO8rDeIwxA0isCKAlmWgVKKoihQlqV5T5nzEnmew5ot7mFf3WD9/olWKexVVRWSJIEQAkPVNA2s5eoZl+NrvL59oK7r30+dSgOllFBKoeu6Xut9azr3TMK/QJ1MAxljaNvWzE7BtAzwbrY4CiwZQxx9QQqxXehJ1wsUjCELQ0jOe9MdAOfecgvcHAI550jS1JysdmUNAvoPq6OlaGC6L6U5A/hfKZUQoHEM+S3POvkH6Nef44IbhH0AAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/66848f358dfc9b19731e6984e6a56542/fcda8/1680090114948-88af7951-155c-481e-9a2c-dcf1b9395af0.png\"\n        srcset=\"/static/66848f358dfc9b19731e6984e6a56542/12f09/1680090114948-88af7951-155c-481e-9a2c-dcf1b9395af0.png 148w,\n/static/66848f358dfc9b19731e6984e6a56542/e4a3f/1680090114948-88af7951-155c-481e-9a2c-dcf1b9395af0.png 295w,\n/static/66848f358dfc9b19731e6984e6a56542/fcda8/1680090114948-88af7951-155c-481e-9a2c-dcf1b9395af0.png 590w,\n/static/66848f358dfc9b19731e6984e6a56542/efc66/1680090114948-88af7951-155c-481e-9a2c-dcf1b9395af0.png 885w,\n/static/66848f358dfc9b19731e6984e6a56542/c83ae/1680090114948-88af7951-155c-481e-9a2c-dcf1b9395af0.png 1180w,\n/static/66848f358dfc9b19731e6984e6a56542/29007/1680090114948-88af7951-155c-481e-9a2c-dcf1b9395af0.png 1600w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABKUlEQVR42qWQ0U7CMBSG+xQyEBXXbSzgiBoviISESxVBuTAhJD694g0mNunY1q3jNz0RxbksITb50p729Os5Zd3zS5y2WrCsOmzOwTmH4zgE/4qr8DyPCIIzjEYjMNtxUbMauLmb4OV1ibflEqvVCkJ8IAxDSCkrMTkGIQTFrN0JYB0eY/IwQxiukShFZDrHPmOz2dDMehdXqDWOcD+d4V1IrGOFMMkh4wwyyqC1RpZlyPO8EiM0MNfvUoXj6SOSJEGaptDaCLR5l5KjOP51yVCMv4VOuwOreUJCpRRVFEURrbdtmEdUqkhizg1mr0zKbNfHQb2J2/GUkor/spXuxj97JRX2r4fwuz3MF8/0V2UXi+Jizu456w+GMG0/zRelwn1h3Pvb8n+En4lyo3+mQNwSAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/b6b641bd1391750e7bdf1ed76511d9b1/fcda8/1680090135554-074d3977-68f3-4408-b669-8e4de31b21f9.png\"\n        srcset=\"/static/b6b641bd1391750e7bdf1ed76511d9b1/12f09/1680090135554-074d3977-68f3-4408-b669-8e4de31b21f9.png 148w,\n/static/b6b641bd1391750e7bdf1ed76511d9b1/e4a3f/1680090135554-074d3977-68f3-4408-b669-8e4de31b21f9.png 295w,\n/static/b6b641bd1391750e7bdf1ed76511d9b1/fcda8/1680090135554-074d3977-68f3-4408-b669-8e4de31b21f9.png 590w,\n/static/b6b641bd1391750e7bdf1ed76511d9b1/efc66/1680090135554-074d3977-68f3-4408-b669-8e4de31b21f9.png 885w,\n/static/b6b641bd1391750e7bdf1ed76511d9b1/c83ae/1680090135554-074d3977-68f3-4408-b669-8e4de31b21f9.png 1180w,\n/static/b6b641bd1391750e7bdf1ed76511d9b1/29007/1680090135554-074d3977-68f3-4408-b669-8e4de31b21f9.png 1600w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=HwzxA></a></p>\n<h1>效果展示</h1>\n<p>我们定义的 MyAuthentication 实现了 org.keycloak.authentication.Authenticator 验证器，并且写了用户登录时打印日志的逻辑如下：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2401ac8665169b7242035234434e82c8/e53e8/1680090161689-14db2944-1bb7-4a84-9130-3a90aa420af3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.513513513513516%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABIUlEQVR42p2R227DIBBE/f+f2Eq5uEkcO9wMqQ0YOBUkfUnVPnSlIy1aGGagm5THuIDUDiEmlJKN2S6MJiLngLUOpRRaa4wxra/M84yUEiUFzjlyznSr3+jPBjVHzH1jvie0cW3jIlfC3aO0ehxUCiEEt9utrXUTte1SHyK1unW5Y60ghIWUCjlB3jI5JUhAgZxyI6VEjLERQsB7TwgRH1KblVLolnVlnKpti7Sf3JxldJb+MrI/Dhz7kf1hYHe4cDoJjLEtehV8rVIdZsCohf5toP84897v2E09gxkZ9MRkBGc5cFFXpNHE8HBX36s6eqWr0VKqtldiDATvW+T/Vvct8mq+lPzktf+bzq8ON19ZF0POhZQL2/aT9mHPeSX/whc1rG3sZpjfFgAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/2401ac8665169b7242035234434e82c8/fcda8/1680090161689-14db2944-1bb7-4a84-9130-3a90aa420af3.png\"\n        srcset=\"/static/2401ac8665169b7242035234434e82c8/12f09/1680090161689-14db2944-1bb7-4a84-9130-3a90aa420af3.png 148w,\n/static/2401ac8665169b7242035234434e82c8/e4a3f/1680090161689-14db2944-1bb7-4a84-9130-3a90aa420af3.png 295w,\n/static/2401ac8665169b7242035234434e82c8/fcda8/1680090161689-14db2944-1bb7-4a84-9130-3a90aa420af3.png 590w,\n/static/2401ac8665169b7242035234434e82c8/efc66/1680090161689-14db2944-1bb7-4a84-9130-3a90aa420af3.png 885w,\n/static/2401ac8665169b7242035234434e82c8/c83ae/1680090161689-14db2944-1bb7-4a84-9130-3a90aa420af3.png 1180w,\n/static/2401ac8665169b7242035234434e82c8/e53e8/1680090161689-14db2944-1bb7-4a84-9130-3a90aa420af3.png 1982w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>在用户登录时，可以从后台终端看到预期的日志打印输出：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b21d0d4c90c598fc461b4011f2f925dc/9dbdb/1680090216660-098dca36-35cc-4dab-af42-cb90ece13c97.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8.783783783783782%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAaklEQVR42k2MSw6DMAwFQUmDRO04duIsQdD7n/FVWKrUxWzmfZZ+XWjnCb8/kOPAawys2wYWwZwTqhr03mFmGGMEzByu1orWGogo3MKqeIsEuwiaO3YiqFkMnvJz7O5x+M8vL6UgpYScM74VIS+oeI6OhwAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/b21d0d4c90c598fc461b4011f2f925dc/fcda8/1680090216660-098dca36-35cc-4dab-af42-cb90ece13c97.png\"\n        srcset=\"/static/b21d0d4c90c598fc461b4011f2f925dc/12f09/1680090216660-098dca36-35cc-4dab-af42-cb90ece13c97.png 148w,\n/static/b21d0d4c90c598fc461b4011f2f925dc/e4a3f/1680090216660-098dca36-35cc-4dab-af42-cb90ece13c97.png 295w,\n/static/b21d0d4c90c598fc461b4011f2f925dc/fcda8/1680090216660-098dca36-35cc-4dab-af42-cb90ece13c97.png 590w,\n/static/b21d0d4c90c598fc461b4011f2f925dc/efc66/1680090216660-098dca36-35cc-4dab-af42-cb90ece13c97.png 885w,\n/static/b21d0d4c90c598fc461b4011f2f925dc/c83ae/1680090216660-098dca36-35cc-4dab-af42-cb90ece13c97.png 1180w,\n/static/b21d0d4c90c598fc461b4011f2f925dc/9dbdb/1680090216660-098dca36-35cc-4dab-af42-cb90ece13c97.png 2622w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=GBw4T></a></p>\n<h1>配置注意事项</h1>\n<p><a name=bp1KS></a></p>\n<h2>确保流程是启用状态</h2>\n<p>需要为指定的客户端启用使用了自定义验证器的流程：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/78fb441038bdae643366c90b37df8dce/161ec/1680090353135-8df508d4-f590-4929-bc28-8235a4bed985.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.675675675675674%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABDUlEQVR42i2Qy07CUABE+f9vcqMbExMXCgIixCel9/1uS2/sMVQWk9mdzJnFcv1CrBMidajc8918o4xEhAahjlgnkbrFhsAEpFxw1mKvSSkRQsAYg9aaxd3zDU2WvIp3DvoLdxbEKtnbDTv9ycG1vLVLhsdbpu2S8PWO1AYhBFLKORdQrZVxHFk8rO4xQ+THC5qgMFkQBoMpAt0ZQk34X8dviVAyw/lM6XpKzpRSyNe+wGbgy3pHGkHFEZMqp1OLd57cDbjNirp5go890/ETjCRtV+jmiLF21rxoXxYqpf6VV+sNpYKMIzYWTqeGYRgofYcXLaO3EBxTCtAXei2xSuG8xzmH937+MMY4A/8Akcd5d4ve6ZUAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/78fb441038bdae643366c90b37df8dce/fcda8/1680090353135-8df508d4-f590-4929-bc28-8235a4bed985.png\"\n        srcset=\"/static/78fb441038bdae643366c90b37df8dce/12f09/1680090353135-8df508d4-f590-4929-bc28-8235a4bed985.png 148w,\n/static/78fb441038bdae643366c90b37df8dce/e4a3f/1680090353135-8df508d4-f590-4929-bc28-8235a4bed985.png 295w,\n/static/78fb441038bdae643366c90b37df8dce/fcda8/1680090353135-8df508d4-f590-4929-bc28-8235a4bed985.png 590w,\n/static/78fb441038bdae643366c90b37df8dce/efc66/1680090353135-8df508d4-f590-4929-bc28-8235a4bed985.png 885w,\n/static/78fb441038bdae643366c90b37df8dce/c83ae/1680090353135-8df508d4-f590-4929-bc28-8235a4bed985.png 1180w,\n/static/78fb441038bdae643366c90b37df8dce/161ec/1680090353135-8df508d4-f590-4929-bc28-8235a4bed985.png 1840w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>这需要在客户端的配置页面里选中高级选项卡，并且在 Authentication Flow overrides 子选项卡中，选择自定义的验证器流程。比如打开 <a href=\"http://localhost:8080/admin/master/console/#/master/clients/aa3aadca-803d-4ec9-9cfb-cab53f02be99/advanced\">http://localhost:8080/admin/master/console/#/master/clients/aa3aadca-803d-4ec9-9cfb-cab53f02be99/advanced</a> 页面，在浏览器流程中选择基于内置的浏览器流程修改过的副本流程。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABy0lEQVR42lWRy2pTURSG8xp6mjSJpWnSNLFUKrSmCV6qWMG5jyA+gCMH0knfwqEU53XowBQMSi4SEMTEpLY1CcnJ6bnvc/nk7CNBNyz2/tfe6+Nfaycy2RXSmSxLyRTJ1DKKskRuLc/JyXu63S6tVot2uy2j0+nIvdlsLvL1+imNRkPeRblEbq1AvlBEkcA015UkhWKJ8/MLXNdlMpmgqiqGYTCbzTBNk3+X8Dxsx1noRKV2n91Kjc2t29za3mFza1vqfv8nuq4zGo0Yj8dyj+BR6FcGQRDg+z66bmBZ1kIn9g+e8vDRAXu1e1Sqd9m5U+XB/mMGw6EERgAhBK7rMJ1OpUvdnhMGEIYh0+lMRgSTDtc3yuzuVSmUSqQyWZLpDPniBr1+T7Y8n88XDiIdCOg5X5iIgQSYlonjuBIugYX1m+RWy6SUHJnlPMq1FVZvlPn+rY/neWiaFs9NFsRFYRgwFG3MUMXQLTnfOB+SePbkOe9et3jz6gNvj+ocH33i+PAzPz7q/w3f8QI028cWAbaIcyPRR7M0hCtkB9LhyxeHGF/h19kl6m8Log9zwFTjR+FfZ8IPsdwAz4/OcbHrBQwuLjkbDrnSYwN/ADl9COExeuauAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/17dd060ef2df20483721128c94dfe528/fcda8/1680090515806-d591b0ca-bb35-474f-97ef-1ccbe21fc1c1.png\"\n        srcset=\"/static/17dd060ef2df20483721128c94dfe528/12f09/1680090515806-d591b0ca-bb35-474f-97ef-1ccbe21fc1c1.png 148w,\n/static/17dd060ef2df20483721128c94dfe528/e4a3f/1680090515806-d591b0ca-bb35-474f-97ef-1ccbe21fc1c1.png 295w,\n/static/17dd060ef2df20483721128c94dfe528/fcda8/1680090515806-d591b0ca-bb35-474f-97ef-1ccbe21fc1c1.png 590w,\n/static/17dd060ef2df20483721128c94dfe528/efc66/1680090515806-d591b0ca-bb35-474f-97ef-1ccbe21fc1c1.png 885w,\n/static/17dd060ef2df20483721128c94dfe528/c83ae/1680090515806-d591b0ca-bb35-474f-97ef-1ccbe21fc1c1.png 1180w,\n/static/17dd060ef2df20483721128c94dfe528/9dbdb/1680090515806-d591b0ca-bb35-474f-97ef-1ccbe21fc1c1.png 2622w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a name=qjJoZ></a></p>\n<h2>根据情况覆盖流程</h2>\n<p>以上的例子，是针对用户通过 Keycloak 页面登录的，即用户通过类似这样的链接登录： <a href=\"https://keycloak.jiwai.win/auth/realms/UniHeart/protocol/openid-connect/auth?client_id=UniHeart-Client&#x26;state=d70e525d-c59e-4e49-8240-240df9bb910d&#x26;redirect_uri=http%3A%2F%2Falpha-jeff-tian.cloud.okteto.net%2Fkeycloak%2Flogin%3Fauth_callback%3D1&#x26;scope=openid&#x26;response_type=code\">https://keycloak.jiwai.win/auth/realms/UniHeart/protocol/openid-connect/auth?client_id=UniHeart-Client&#x26;state=d70e525d-c59e-4e49-8240-240df9bb910d&#x26;redirect_uri=http%3A%2F%2Falpha-jeff-tian.cloud.okteto.net%2Fkeycloak%2Flogin%3Fauth_callback%3D1&#x26;scope=openid&#x26;response_type=code</a></p>\n<p>如果是提供接口给到别的服务来调用，那么就需要配置直接授权登录流程（上图中的 Direct Grant Flow）。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/75f332fbb105160a9371b2d884e1b246/29007/1680090784993-292189a8-f5c8-495a-a082-b28c8f9d7602.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABdElEQVR42oVSa0/CMBTdj1ARX3FMEIVg8BPRKB81KOIjxg/GxF+PiVDXde0eXbtjWgaIEL3Jye1dT889d63TaJ/CdV2Uy2VUKhV4nmfzdP0XDKdWq1k0m010u104+66HtfUSrq578H0fkRD48ikI8RGGHGEYroThEkKKmoNzDkopnM75JRqtNl7f3qG1holMA6nCnzHl/v7mdM4u4FbreHp+gZTSbuR5XmRtSauQpqlFFMfIsszyTe14tSNslHfQ6w+s/YAGYIxZmIP5CjHTSMoMcRwjThIkaWpNGEPOweExNrf3cHv3AC4ERBTZbCCLzqtCJHLCkXI2/oJgf/CI8XAITgiU4GCjTyRBAB0JWyshCnAoHkJLiUwpO+6CYL3RQqlwGHwMEROCjDHw0RiSUuiQQTEGFbLJ2oBSIE2WXBtxp3nSRmlrFzf9eyg1udpUaiQyn13OUuSTvZ8wYf6pU6037MhGMIoi28VY/w/zlzAXNG/xG7QUn4iuzEHXAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/75f332fbb105160a9371b2d884e1b246/fcda8/1680090784993-292189a8-f5c8-495a-a082-b28c8f9d7602.png\"\n        srcset=\"/static/75f332fbb105160a9371b2d884e1b246/12f09/1680090784993-292189a8-f5c8-495a-a082-b28c8f9d7602.png 148w,\n/static/75f332fbb105160a9371b2d884e1b246/e4a3f/1680090784993-292189a8-f5c8-495a-a082-b28c8f9d7602.png 295w,\n/static/75f332fbb105160a9371b2d884e1b246/fcda8/1680090784993-292189a8-f5c8-495a-a082-b28c8f9d7602.png 590w,\n/static/75f332fbb105160a9371b2d884e1b246/efc66/1680090784993-292189a8-f5c8-495a-a082-b28c8f9d7602.png 885w,\n/static/75f332fbb105160a9371b2d884e1b246/c83ae/1680090784993-292189a8-f5c8-495a-a082-b28c8f9d7602.png 1180w,\n/static/75f332fbb105160a9371b2d884e1b246/29007/1680090784993-292189a8-f5c8-495a-a082-b28c8f9d7602.png 1600w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7b1332951c3b53f0d3ee8f2d55f1172b/d43b4/1680090769827-da6545a4-a046-4b84-b73c-96b2822e225e.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABc0lEQVR42o1SW44cIQzk0nubHCOXyBkizcdqlBltlIHG5mHAXSszzWjV+xOkwqb8BOO2bUNKCSa993h4Dx/C1EMIE2bPOX9DyhlSEm4+4+0n4cevBFdKgcGCOCVQDCCOYH4mMV5EoKoYY0yYvs6qA60rfv8deH8MOAuwhL0JWmuQWqc0EPFMdl7mv/h9P7ZR0WqCu1wuIKLDuL+CrAO7rnVh/FesTtdZJ6cgZrjr9Qpm/hakQ+eV9cR/LXrmrHN3v9+nMpOovoymz4R6KqSK3vvrLYeO2V0fO0qpcDH4OYxsg8nHe/Y2YQHnZUOoUiFN0Eeffq0PcO7oQ+EiERIRMvP8BikXcMrIpU4Hg01x6YahzzdbME5ah0iDGwBqCIi3Gx6BsKWKVDooN1AWxCQIXLEdiEumJ8zfzuaTisB13VG8x/bnho9/EY9Y4KlOaY4rqckFPopxeUo67EU6XK6CwoQUCYEyPNl1ZVar0l5f5H9gf/MTbCtaU4CnORAAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/7b1332951c3b53f0d3ee8f2d55f1172b/fcda8/1680090769827-da6545a4-a046-4b84-b73c-96b2822e225e.png\"\n        srcset=\"/static/7b1332951c3b53f0d3ee8f2d55f1172b/12f09/1680090769827-da6545a4-a046-4b84-b73c-96b2822e225e.png 148w,\n/static/7b1332951c3b53f0d3ee8f2d55f1172b/e4a3f/1680090769827-da6545a4-a046-4b84-b73c-96b2822e225e.png 295w,\n/static/7b1332951c3b53f0d3ee8f2d55f1172b/fcda8/1680090769827-da6545a4-a046-4b84-b73c-96b2822e225e.png 590w,\n/static/7b1332951c3b53f0d3ee8f2d55f1172b/efc66/1680090769827-da6545a4-a046-4b84-b73c-96b2822e225e.png 885w,\n/static/7b1332951c3b53f0d3ee8f2d55f1172b/c83ae/1680090769827-da6545a4-a046-4b84-b73c-96b2822e225e.png 1180w,\n/static/7b1332951c3b53f0d3ee8f2d55f1172b/d43b4/1680090769827-da6545a4-a046-4b84-b73c-96b2822e225e.png 1202w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}}}},"staticQueryHashes":[],"slicesMap":{}}