{"componentChunkName":"component---src-templates-post-js","path":"/posts/ASP-发送邮件的代码/","result":{"data":{"sitePage":{"id":"SitePage /posts/ASP-发送邮件的代码/"}},"pageContext":{"url":"/posts/ASP-发送邮件的代码/","relativePath":"posts/ASP-发送邮件的代码.md","relativeDir":"posts","base":"ASP-发送邮件的代码.md","name":"ASP-发送邮件的代码","frontmatter":{"title":"ASP 发送邮件的代码","stackbit_url_path":"posts/ASP-发送邮件的代码","date":"2010-03-09 03:00:48","excerpt":"","comments_count":0,"positive_reactions_count":0,"tags":[null],"canonical_url":"https://be-net.azurewebsites.net/post/2010/03/09/ASP-发送邮件的代码","template":"post"},"html":"<pre><code>    &#x3C;div style=\"text-indent: 2em; font-size: larger;\">\n</code></pre>\n<p>使用ASP发送邮件的代码示例：</p>\n<p>首先，建立一个Email的类文件，用来封装相关的邮件发送准备操作（如建立CDO.Message对象，以及做一些邮件服务器的配置工作等），命名为 CEmail.asp。</p>\n<div style=\"text-indent: 0;\">\n<pre class=\"brush: vb\">&lt;%\n    Class CEmail\n        Private sFromEmail\n        Private sToEmail\n        Private sMessage \n        Private sBCCEmail\n        Private sSubject\n        Private sBody\n        ' 配置\n        Private sOrigSenderEmail\n        Private lSendUsing\n        Private lSmtpServerPort\n        Private sSmtpServer\n        Private lSmtpAuthenticate\n        Private sSendUserName\n        Private sSendPassword\n        Private bSmtpUseSSL\n<pre><code>    Private Function bValidateExp(ByRef sPattern, ByRef s)\n        Dim regEx\n        Set regEx = Server.CreateObject(\"VBScript.RegExp\")\n        regEx.Global = True\n        regEx.IgnoreCase = True\n        regEx.Pattern = sPattern\n        bValidateExp = regEx.Test(s)\n        Set regEx = Nothing\n    End Function \n    \n    Private Sub Class_Initialize()\n        sOrigSenderEmail = \"***@myfootprints.cn\"\n        ' 2 - cdoSendUsingPort\n        lSendUsing = 2\n        lSmtpServerPort = 25\n        sSmtpServer = \"smtp.qq.com\"\n        ' 1 - cdoBasic\n        lSmtpAuthenticate = 1\n        sSendUserName = \"***@myfootprints.cn\"\n        sSendPassword = \"***\"\n        bSmtpUseSSL = False\n    End Sub\n    \n    Public Sub GetRequest()\n    End Sub\n    \n    Public Function SendTextMail()\n        Dim oMail\n        On Error Resume Next\n        Set oMail = Server.CreateObject(\"CDO.Message\")\n        ' 设置\n        With oMail.Configuration.Fields       \n            'Original sender email address \n            .Item(\"http://schemas.microsoft.com/cdo/configuration/sendemailaddress\") = Me.OrigSenderEmail\n\n            'SMTP settings - without authentication, using standard port 25 on host smtp\n            ' 2 - cdoSendUsingPort \n            .Item(\"http://schemas.microsoft.com/cdo/configuration/sendusing\") = Me.SendUsing\n            .Item(\"http://schemas.microsoft.com/cdo/configuration/smtpserverport\") = Me.SmtpServerPort\n            .Item(\"http://schemas.microsoft.com/cdo/configuration/smtpserver\") = Me.SmtpServer\n\n            'SMTP Authentication\n            ' 0 - cdoAnonymous \n            ' 1 - cdoBasic \n            .Item(\"http://schemas.microsoft.com/cdo/configuration/smtpauthenticate\") = Me.SmtpAuthenticate                 \n            .Item(\"http://schemas.microsoft.com/cdo/configuration/sendusername\") = Me.SendUserName\n            .Item(\"http://schemas.microsoft.com/cdo/configuration/sendpassword\") = Me.SendPassword\n            .Item(\"http://schemas.microsoft.com/cdo/configuration/smtpusessl\") = Me.SmtpUseSSL\n\n            .Update\n        End With\n        \n        oMail.To = Me.ToEmail\n        oMail.From = Me.OrigSenderEmail\n        oMail.BCC = Me.BCCEmail\n        oMail.Subject = Me.Subject\n        oMail.Textbody = Me.Body\n        oMail.Send\n        Set oMail = Nothing\n        If Err.number = 0 Then\n            SendTextMail = True\n        Else            \n            AddInfo2 \"发生错误：\" &#x26;amp; Err.Description, \"ssnInfo_SendToFriend\"\n            SendTextMail = False\n        End If\n        On Error Goto 0\n    End Function\n    \n    Public Function Validate()\n        Validate = True\n        If Len(Me.FromEmail) &#x26;lt;= 0 Then\n            AddInfo2 \"发送Email不能为空\", \"ssnInfo_SendToFriend\"\n            Validate = False\n        End If\n        If Len(Me.ToEmail) &#x26;lt;= 0 Then\n            AddInfo2 \"接收Email不能为空\", \"ssnInfo_SendToFriend\"\n            Validate = False\n        End If\n    End Function\n    \n    Public Property Get FromEmail()\n        FromEmail = sFromEmail\n    End Property\n    \n    Public Property Let FromEmail(ByRef s)\n        sFromEmail = s\n    End Property\n    \n    Public Property Get ToEmail()\n        ToEmail = sToEmail\n    End Property\n    \n    Public Property Let ToEmail(ByRef s)\n        sToEmail = s\n    End Property \n    \n    Public Property Get Message()\n        Message = sMessage\n    End Property\n    \n    Public Property Let Message(ByRef s)\n        sMessage = s\n    End Property\n    \n    Public Property Get BCCEmail()\n        BCCEmail = sBCCEmail\n    End Property\n    \n    Public Property Let BCCEmail(ByRef s)\n        sBCCEmail = s\n    End Property\n    \n    Public Property Get Subject()\n        Subject = sSubject\n    End Property\n    \n    Public Property Let Subject(ByRef s)\n        sSubject = s\n    End Property\n    \n    Public Property Get URL()\n        URL = sURL\n    End Property\n    \n    Public Property Let URL(ByRef s)\n        sURL = s\n    End Property\n    \n    Public Property Get Body()\n        Body = sBody\n    End Property\n    \n    Public Property Let Body(ByRef s)\n        sBody = s\n    End Property\n    \n    Public Property Get OrigSenderEmail()\n        OrigSenderEmail = sOrigSenderEmail\n    End Property\n    \n    Public Property Let OrigSenderEmail(ByRef s)\n        sOrigSenderEmail = s\n    End Property\n    \n    Public Property Get SendUsing()\n        SendUsing = lSendUsing\n    End Property\n    \n    Public Property Let SendUsing(ByVal l)\n        lSendUsing = l\n    End Property\n    \n    Public Property Get SmtpServerPort()\n        SmtpSErverPort = lSmtpServerPort\n    ENd Property\n    \n    Public Property Let SmtpServerPort(ByVal l)\n        lSmtpServerPort = l\n    End Property\n    \n    Public Property Get SmtpServer()\n        SmtpServer = sSmtpSErver\n    End Property\n    \n    Public Property Let SmtpServer(ByRef s)\n        sSmtpServer = s\n    End Property\n    \n    Public Property Get SmtpAuthenticate()\n        SmtpAuthenticate = lSmtpAuthenticate\n    End Property\n    \n    Public Property Let SmtpAuthenticate(ByVal l)\n        lSmtpAuthenticate = l\n    End Property\n    \n    Public Property Get SendUserName()\n        SendUserName = sSendUserName\n    End Property\n    \n    Public Property Let SendUserName(ByRef s)\n        sSendUserName = s\n    End Property\n    \n    Public Property Get SendPassword()\n        SendPassword = sSendPassword\n    End Property \n    \n    Public Property Let SendPassword(ByRef s)\n        sSendPassword = s\n    End Property \n    \n    Public Property Get SmtpUseSSL()\n        SmtpUseSSL = bSmtpUseSSL\n    End Property\n    \n    Public Property Let SmtpUseSSL(ByVal b)\n        bSmtpUseSSL = b\n    ENd Property\nEnd Class\n</code></pre>\n<p>%>\n</pre></p>\n</div>\n<p>然后就可以使用CMail来发送邮件了。比如在一个网页界面上提供一个填写发件人姓名，收件人邮件地址，以及消息内容的表单，表单提交后，可以使用类似如下的后台代码来利用CEmail来发送邮件：</p>\n<div style=\"text-indent: 0;\">\n<pre class=\"brush: vb\">&lt;!--#include file=\"CEmail.asp\"--&gt;\n&lt;%\n    Class CBeanSendToFriend\n        Private sFromEmail\n        Private sToEmail\n        Private sMessage \n        Private sBCCEmail\n        Private sSubject\n        Private sURL\n        Private sHeader\n        Private sFooter\n        Private sBody\n<pre><code>    Private Function bValidateExp(ByRef sPattern, ByRef s)\n        Dim regEx\n        Set regEx = Server.CreateObject(\"VBScript.RegExp\")\n        regEx.Global = True\n        regEx.IgnoreCase = True\n        regEx.Pattern = sPattern\n        bValidateExp = regEx.Test(s)\n        Set regEx = Nothing\n    End Function \n    \n    Private Sub Class_Initialize()\n        Me.GetRequest\n    End Sub\n    \n    Public Sub GetRequest()\n        Me.FromEmail = Replace(Trim(Request.Form(\"FromEmail\")), \"'\", \"\")\n        Me.ToEmail = Replace(Trim(Request.Form(\"ToEmail\")), \"'\", \"\")\n        Me.Message = Trim(Request.Form(\"Message\"))\n        Me.URL = Trim(Request.Form(\"URL\"))\n        Me.BCCEmail = \"***@myfootprints.cn\"\n        Me.Subject = Trim(Request.Form(\"Subject\"))\n        Me.Header = (Request.Form(\"Header\"))\n        Me.Footer = Request.Form(\"Footer\")\n    End Sub\n    \n    Public Function Validate()\n        Validate = True\n        If Len(Me.ToEmail) &#x26;lt;= 0 Then\n            AddInfo2 \"接收Email不能为空\", \"ssnInfo_SendToFriend\"\n            Validate = False\n        End If\n        If Validate Then\n            Dim oEmail\n            Set oEmail = New CEmail\n            oEmail.FromEmail = Me.FromEmail\n            oEmail.ToEmail = Me.ToEmail\n            oEmail.BCCEmail = Me.BCCEmail\n            oEmail.Subject = Me.Subject\n            'Me.Body = \"您的朋友 \" &#x26;amp; Me.FromEmail &#x26;amp; \" 推荐您访问［我的涂鸦］网站：\" &#x26;amp; vbCrLf &#x26;amp; vbCrLf &#x26;amp; Me.URL &#x26;amp; vbCrLf &#x26;amp; vbCrLf &#x26;amp; Me.Message &#x26;amp; vbCrLf &#x26;amp; vbCrLf &#x26;amp; \"此页面由涂鸦发送链接服务发送。您的 Email 地址没有被添加到任何清单里，也没有被记录到我的网站里。\"\n            Me.Body = \"您的朋友 \" &#x26;amp; Me.FromEmail &#x26;amp; \" \" &#x26;amp; Me.Header &#x26;amp; vbCrLf &#x26;amp; vbCrLf &#x26;amp; Me.Message &#x26;amp; vbCrLf &#x26;amp; Me.Footer\n            oEmail.Body = Me.Body\n            If oEmail.SendTextMail() Then\n            Else\n                Validate = False\n            End If\n            Set oEmail = Nothing\n        End If\n    End Function\n    \n    Public Property Get FromEmail()\n        FromEmail = sFromEmail\n    End Property\n    \n    Public Property Let FromEmail(ByRef s)\n        sFromEmail = s\n    End Property\n    \n    Public Property Get ToEmail()\n        ToEmail = sToEmail\n    End Property\n    \n    Public Property Let ToEmail(ByRef s)\n        sToEmail = s\n    End Property \n    \n    Public Property Get Message()\n        Message = sMessage\n    End Property\n    \n    Public Property Let Message(ByRef s)\n        sMessage = s\n    End Property\n    \n    Public Property Get BCCEmail()\n        BCCEmail = sBCCEmail\n    End Property\n    \n    Public Property Let BCCEmail(ByRef s)\n        sBCCEmail = s\n    End Property\n    \n    Public Property Get Subject()\n        Subject = sSubject\n    End Property\n    \n    Public Property Let Subject(ByRef s)\n        sSubject = s\n    End Property\n    \n    Public Property Get URL()\n        URL = sURL\n    End Property\n    \n    Public Property Let URL(ByRef s)\n        sURL = s\n    End Property\n    \n    Public Property Get Body()\n        Body = sBody\n    End Property\n    \n    Public Property Let Body(ByRef s)\n        sBody = s\n    End Property\n    \n    Public Property Get Header()\n        Header = sHeader\n    End Property\n    \n    Public Property Let Header(ByRef s)\n        sHeader = s\n    End Property\n    \n    Public Property Get Footer()\n        Footer = sFooter\n    End Property \n    \n    Public Property Let Footer(ByRef s)\n        sFooter = s\n    End Property\nEnd Class\n</code></pre>\n<p>%>\n</pre></p>\n</div>\n</div>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}