{"componentChunkName":"component---src-templates-post-js","path":"/posts/brrgda9w8f9fr2kf/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/brrgda9w8f9fr2kf","relativePath":"posts/brrgda9w8f9fr2kf","frontmatter":{"title":"三步开发社交账号登录（以钉钉登录举例）","stackbit_url_path":"posts/brrgda9w8f9fr2kf","date":"2023-11-12T08:09:14","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p>最近这些年，我分别在不同的系统中对接过不同的社交身份源，它们一般都是遵循 OIDC 标准，或者是不太标准的 OIDC 标准，但是看着又有点像。今天写一个总结吧！</p>\n<blockquote>\n<p>开发一个社交账号登录功能，只需要三步。</p>\n</blockquote>\n<p><a name=SqxnS></a></p>\n<h1>不要自行实现！</h1>\n<blockquote>\n<p>三步虽好，0 步最佳！</p>\n</blockquote>\n<p>三思而后行，千万不要一上来就想自己写代码来实现，或者引入一个额外的第三方库。如果是一个 OIDC 标准的产品，很可能不用写一行代码，就能像拼搭积木一样集成完毕。<br />举个例子，曾经接到一个<a href=\"https://www.zhihu.com/consult/conversation/1695009218397102081/archive\">咨询</a>，希望在 Keycloak 中集成 Twitch 登录，于是找到了 GitHub 上的一个 Keycloak-Twitch 插件： <a href=\"https://github.com/intricate/keycloak-twitch\">https://github.com/intricate/keycloak-twitch</a>，但是碰到了问题。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB9UlEQVR42o1U2a7aMBDNj/YH+k997NdUArEVgVgEZHHCmtVJbOdUZ4DockuvauloPGN75sySeFrXyPICfhhh7wcIwghhpBBECqGKRT8EoZz3CEI5u9xS5GUl79MHPGstjLEoyhIqjnG93qDrGlrrO+oaRVEiThJUD9tTtsYgLwq50xoruocPy/d9JEmCd8sY89Zuxd71uuecA1l2XYembWHaBo6srRX7/yDXFoW2ElQc5nmO/X4PpSIExxxOAnYShBCt617g5FKHX1vg248O338C472517CWmtUSoTFOLhvTiv4VnDXISoNlZLCODbKigWedQ9NUSC8BprPf2KxXuFwuf9XqlZ3rgc4BuMOa9p5yXWuUZQalYpxOJ2RZJqybpull27YCcfKP1Xf5eDxKhzebDbbbLZbLpcj1ei0yDEM5p32320mQ2+0mgQn24Hq93pvCFNI0xWw2w3A4xGg0kj2xWq3EyWAwED2OY5zP595RWZaoqkocEn2XecCH0+kU4/FYWLDrk8lEQBsdPtlzVumI5SEz7sm6Z8iofPR8OJ/PsVgsJFXWjxnQCVkwOCUZ0sYGFvxatH51SFZMkXWkQ+5pOxwOAjJVSuGr1adM76T+LDT3ZEXJYJQEmb0bcjriPHMKHj8H8zJvH+XnWfz82fEt6/fEH8FDfioay1N7AAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/71659ce14d7225a0f251b54e77608525/fcda8/1699772022103-68d4367d-c656-4689-92ef-a5f54fef2c6d.png\"\n        srcset=\"/static/71659ce14d7225a0f251b54e77608525/12f09/1699772022103-68d4367d-c656-4689-92ef-a5f54fef2c6d.png 148w,\n/static/71659ce14d7225a0f251b54e77608525/e4a3f/1699772022103-68d4367d-c656-4689-92ef-a5f54fef2c6d.png 295w,\n/static/71659ce14d7225a0f251b54e77608525/fcda8/1699772022103-68d4367d-c656-4689-92ef-a5f54fef2c6d.png 590w,\n/static/71659ce14d7225a0f251b54e77608525/efc66/1699772022103-68d4367d-c656-4689-92ef-a5f54fef2c6d.png 885w,\n/static/71659ce14d7225a0f251b54e77608525/c83ae/1699772022103-68d4367d-c656-4689-92ef-a5f54fef2c6d.png 1180w,\n/static/71659ce14d7225a0f251b54e77608525/4719e/1699772022103-68d4367d-c656-4689-92ef-a5f54fef2c6d.png 1330w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />我去看了一下这个开源库，发现是针对一个很老的 Keycloak 版本，如果要升级它以适配新的 Keycloak，代价蛮大的。于是我去看一下 Twitch，发现它是一个标准的 OIDC，通过 <a href=\"https://id.twitch.tv/oauth2/.well-known/openid-configuration\">https://id.twitch.tv/oauth2/.well-known/openid-configuration</a> 可以查看它的 OpenId 配置信息。于是建议提问者，扔掉那个开源库，直接通过 OIDC 的方式来完成：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.94594594594595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC0klEQVR42n2Ty27bRhiF9QRNs0iAKI4lWVeSshLVtmzJEtBNF0EXWRgJ+kSJlNhJVgm6aoo8Sp+g6K7opnZ1o+ZGDWc4nGtBynaAuO6HweDfHPyHZw4Lv3z69Ovnzx8+fDw7e3t6djYeTyaTyavxZDx5nY2v37x8NX5zevru3fubp3Dv3v1iufKgWPzmzp27d7/1/MALOkG77eX4vtcOgsD/bwqNll+rNx6Vyg8ebvWPhwuA5oCEKxCGy1WOMcbdQmG3u98KOuVa82FppzcYIQgJRpRSuqY4J0kSkbMZlFJSSptTCDrdVvtxpe4VS9Vefwgh4pwbawBZLcEiRCG8AgAAIYzjmFJ6ufnxXu/g6Lja9IvblV5/iBBSUgmb/pX8OdUXwIY33VprL8Xe7pNaK7i0nW2GJIq01s45Y42xxt7gOoXCdwdH7Sd7pWoj/+ZhGGY+WQZXStlbuBQ3/d1qw7vejBCKoggjhCEQQrj/peB3un6nu9PwtsrVw8EIIUTpWhn7+4xxJZRT10fnt3RSOmmc2TzV3t5hv+4FWWCD0Xwxxwhzyf9mcywwTjFKEU7zQSAscWxjpBAxOBM/fXZy8uKnH57+2BuMnp08JxFhMadifcHOz/Hsn/V0tp7Nsns6jaaLeBGZaJkukYaZuN3d3z8c+J1uqdoYjL7nPDHGaK3XQgCWJlkfMofWWeuscUY7ra22Lsus8KhS2ypXS9VGcbtycHQMIYyiiLGYi5gyQiiJk1hZJY00m5itM/rqqcq1ZrnWrNRbxTxtQohKJXMsTJaAr2K7ZpYyS7EB3LKNhS9pfyWGCMU0JoosKQVrSRKDuMbcznm84DHljjDLuHAb21/E21lJluESrACXfErnF2R2TqahgEhFQGGupdIu1TaV8pbNECKEGGNGW6ON0ea6T/k2m1f7qmE7Da9Sb21K0usPhUizVhv782/oj5nIf4NbG/YvQIo4uJqQTH0AAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/f2cb555505a253dc03436ea99caa1b04/fcda8/1699772178558-26e62809-e6a5-4cab-9c96-def90ad28121.png\"\n        srcset=\"/static/f2cb555505a253dc03436ea99caa1b04/12f09/1699772178558-26e62809-e6a5-4cab-9c96-def90ad28121.png 148w,\n/static/f2cb555505a253dc03436ea99caa1b04/e4a3f/1699772178558-26e62809-e6a5-4cab-9c96-def90ad28121.png 295w,\n/static/f2cb555505a253dc03436ea99caa1b04/fcda8/1699772178558-26e62809-e6a5-4cab-9c96-def90ad28121.png 590w,\n/static/f2cb555505a253dc03436ea99caa1b04/efc66/1699772178558-26e62809-e6a5-4cab-9c96-def90ad28121.png 885w,\n/static/f2cb555505a253dc03436ea99caa1b04/c83ae/1699772178558-26e62809-e6a5-4cab-9c96-def90ad28121.png 1180w,\n/static/f2cb555505a253dc03436ea99caa1b04/d5f92/1699772178558-26e62809-e6a5-4cab-9c96-def90ad28121.png 2150w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>还有一个例子，就是在 Keycloak 中对接阿里云登录，也是不需要写一行代码的：详见《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/644635209%5D(https://zhuanlan.zhihu.com/p/644635209)\">【多图超详细】用 oidc 方式在 keycloak 中集成阿里云登录方式 - Jeff Tian的文章 - 知乎</a> 》。<br />有一些产品，尽管看上去不是一个标准的 OIDC，但也可能通过配置完成，只是没有那个发现端点，从而需要单独配置一些接口，它们分别是：</p>\n<ul>\n<li>授权接口地址，通过它，可以得到一个授权码</li>\n<li>换取令牌接口地址，通过它，可以通过授权码换取到令牌</li>\n<li>用户信息接口地址，通过它，可以使用令牌获取到用户个人资料</li>\n</ul>\n<p>如果换取令牌时，在身份令牌中就包含了用户的唯一身份标识，甚至 Email 等信息，那么以上第三个接口都是可以省略的。\n<a name=OLrNC></a></p>\n<h1>自行实现的一般套路</h1>\n<p>尽管建议不要自行实现，但总有需要自行实现的时候，比如对接一些非 OIDC 标准的产品时。这时候，不要慌，只要有套路，实现起来非常简单。这个套路，其实在上一节已经透露出来了，它是在配置 OIDC 提供者时需要填写的一些关键信息，其实也是自行实现社交登录插件时的关键步骤，分别是：</p>\n<ul>\n<li><strong>构建授权链接</strong>，将用户重定向至身份源的授权页面，只要用户授权，你的应用就会得到一个授权码</li>\n<li><strong>使用授权码换取令牌</strong>，做得好一点可以为其实现一个缓存，以在一定时间窗口内，减少用户授权的麻烦</li>\n<li><strong>使用令牌换取用户个人资料</strong>，以用户的身份信息，为其在你的应用中创建持久化的会话</li>\n</ul>\n<p><a name=MTXkR></a></p>\n<h1>以钉钉登录举例</h1>\n<p>钉钉登录似乎有一些特别，一是我没有从官方文档中找到其 OIDC 发现端点，很可能是没有。另外，它有上面说的那三个关键接口，但返回的字段名称，却和标准有差异，比如命令风格不是 snake_case，而是 camelCase。总之，没能成功地在 Keycloak 中通过配置的方式实现钉钉登录，不得不写了一个自定义插件。这里就以它举例，来说明一下在 Keycloak 里实现自定义的社交登录插件的方法。</p>\n<p>源代码见：<a href=\"https://github.com/Jeff-Tian/keycloak-services-social-dingding\">https://github.com/Jeff-Tian/keycloak-services-social-dingding</a> 。</p>\n<p>在介绍开发套路前，先看一下如何在 Keycloak 中引入它：\n<a name=Qgboo></a></p>\n<h2>在 Keycloak 中引入的两种方式</h2>\n<p><a name=jrUTE></a></p>\n<h3>通过手动拷贝到 /providers 目录</h3>\n<p>这需要你从源码执行 mvn clean install，在 target目录找到相应的 jar 包，然后拷贝到 Keycloak 的 providers 目录下。<br />当然也可以不用从源码自行编译，而是直接下载我编译好的，地址是： <a href=\"https://github.com/Jeff-Tian/keycloak-services-social-dingding/packages/1982789\">https://github.com/Jeff-Tian/keycloak-services-social-dingding/packages/1982789</a>\n<a name=VnMgD></a></p>\n<h3>通过 pom 方式引入</h3>\n<p>在 Keycloak 项目中的 pom 中引入，然后在 Dockerfile 里编译整个项目，顺带会将该插件编译出来，并统一拷贝。可以参考 <a href=\"https://github.com/Jeff-Tian/keycloak-heroku/blob/master/pom.xml\">https://github.com/Jeff-Tian/keycloak-heroku/blob/master/pom.xml</a> 以及 <a href=\"https://github.com/Jeff-Tian/keycloak-heroku/blob/master/Dockerfile\">https://github.com/Jeff-Tian/keycloak-heroku/blob/master/Dockerfile</a> 。然而，由于以上 package 发布到了 GitHub 的仓库，尽管可以手动下载，但是通过 pom 方式引入时却需要一个 token。不过我有计划将它发布到 Maven 中央仓库，这样就不需要 token 了，敬请期待。</p>\n<p>通过 pom 方式引入后，还需要在 META-INF/services 里列出对它的引用，参考 <a href=\"https://github.com/Jeff-Tian/keycloak-heroku/blob/master/src/main/resources/META-INF/services/org.keycloak.broker.social.SocialIdentityProviderFactory\">https://github.com/Jeff-Tian/keycloak-heroku/blob/master/src/main/resources/META-INF/services/org.keycloak.broker.social.SocialIdentityProviderFactory</a> ：</p>\n<p>org.keycloak.social.dingding.DingDingIdentityProviderFactory</p>\n<p><a name=q6vAX></a></p>\n<h2>开发步骤</h2>\n<p>先创建仓库，并建立 pom 文件如 <a href=\"https://github.com/Jeff-Tian/keycloak-services-social-dingding/blob/main/pom.xml\">https://github.com/Jeff-Tian/keycloak-services-social-dingding/blob/main/pom.xml</a>\n<a name=xV4Rd></a></p>\n<h3>（1）构建授权链接</h3>\n<p>这是将用户从你的应用，重定向到钉钉的授权页面，即 <a href=\"https://login.dingtalk.com/oauth2/auth\">https://login.dingtalk.com/oauth2/auth</a> 。这个方法，要做的不多，就是拼接一些参数：\njava\n@Override\nprotected UriBuilder createAuthorizationUrl(AuthenticationRequest request) {\nfinal UriBuilder uriBuilder;</p>\n<pre><code>String ua = request.getSession().getContext().getRequestHeaders().getHeaderString(user-agent);\n\nuriBuilder = UriBuilder.fromUri(getConfig().getAuthorizationUrl());\n\nuriBuilder\n\t.queryParam(OAUTH2_PARAMETER_CLIENT_ID, getConfig().getClientId())\n\t.queryParam(OAUTH2_PARAMETER_REDIRECT_URI, request.getRedirectUri())\n\t.queryParam(OAUTH2_PARAMETER_RESPONSE_TYPE, DEFAULT_RESPONSE_TYPE)\n\t.queryParam(OAUTH2_PARAMETER_SCOPE, getConfig().getDefaultScope())\n\t.queryParam(OAUTH2_PARAMETER_STATE, request.getState().getEncoded());\n\nreturn uriBuilder;\n</code></pre>\n<p>}</p>\n<p>详见 <a href=\"https://github.com/Jeff-Tian/keycloak-services-social-dingding/blob/main/src/main/java/org/keycloak/social/dingding/DingDingIdentityProvider.java#L224\">https://github.com/Jeff-Tian/keycloak-services-social-dingding/blob/main/src/main/java/org/keycloak/social/dingding/DingDingIdentityProvider.java#L224</a>。\n<a name=Z8CTK></a></p>\n<h3>（2）使用授权码换取令牌</h3>\n<p>其实就是对钉钉的令牌接口进行一个调用，该接口地址是 <a href=\"https://api.dingtalk.com/v1.0/oauth2/userAccessToken\">https://api.dingtalk.com/v1.0/oauth2/userAccessToken</a> 。之所以不能通过配置方式进行对接，最大的原因之一是这个接口返回的字段名称，相比 OIDC 标准来说有些奇怪，所以通过自行写代码就能解决。<br />由于令牌返回后，可以在 2 小时内重复使用，所以可以实现一个缓存机制，于是代码看上去有些多，但本质上就是一个 HTTP call。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.4054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACRUlEQVR42oWT2Y7cOAxF6/+/KR8y8xBgqsvlTZKtffNyArtr0uVMMCFwQcMgji4p6vYYHd9by10E7jJyFxGhE6NODHOknz9zOyVaYfloWh5tf2qUEy4kZuOwPqG05aaNQY6Cqe0ww8ijafhonnTDQNsNpFiodaEuh1aWbWdZD22nrA8INZ3Zhcit1HoW7iFStWHSGj1bjHEY7XEmkWKEfeeIfd/Ztu3U/vr3HjcfArkUWBZk2zEpixIBMQZGoelHxSBmhDxcRNbtgHyBDui7bt6/gEAJkb7rafsBNQXMHLGmoEymVw5lEiHVE/gr6AIsL+ARyXu6tqcbHLNMOJ2Z1Iz37tLa2e5LF6A7HObyVfRyqvsZNUyoaUbNBhcyPmZcKqS6fNa/Nf9vvoUYLw7XdUVrQ3TpnNmxDtpGtA0YW0jKsFrL7gyECNaw5wQpsNfCLaZEKfUnUE2K7ikYu0DTHJeiaYaJtpt5Tg1/q29k/QF6ppqOdfiA9sEu+lO3GK/AWSm6ViCF5zlMjFIzSovoDXIw2BAwMSNtQSfBfv8L7t/ZgwNn/gvcSkH1E1070o8Tz2GmF4lBJJSMzMKi5EQ3yM8VM5ml1p9z/O0MRTPSPiTPVqJ9xsYFlxZSKeeKHauTU8SGgov1so8Xh9u6stVKjIVt2anLTq4bMa+ksp51h3JdyTkT83J+v2/IxWFxjvHecP+nPW96Wep5yJ/i/QneQvgCZu+R0uF0wbuE9/50sv/mib3r2nJK1Fo/H3wuLMv2vw7+FD8ASaHaFmlQDxcAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/cbcd82ff957a2ecca2bc07e913db41bd/fcda8/1699774169834-b8815548-e955-4bc2-983a-9a4d19ce4df0.png\"\n        srcset=\"/static/cbcd82ff957a2ecca2bc07e913db41bd/12f09/1699774169834-b8815548-e955-4bc2-983a-9a4d19ce4df0.png 148w,\n/static/cbcd82ff957a2ecca2bc07e913db41bd/e4a3f/1699774169834-b8815548-e955-4bc2-983a-9a4d19ce4df0.png 295w,\n/static/cbcd82ff957a2ecca2bc07e913db41bd/fcda8/1699774169834-b8815548-e955-4bc2-983a-9a4d19ce4df0.png 590w,\n/static/cbcd82ff957a2ecca2bc07e913db41bd/efc66/1699774169834-b8815548-e955-4bc2-983a-9a4d19ce4df0.png 885w,\n/static/cbcd82ff957a2ecca2bc07e913db41bd/c83ae/1699774169834-b8815548-e955-4bc2-983a-9a4d19ce4df0.png 1180w,\n/static/cbcd82ff957a2ecca2bc07e913db41bd/ee787/1699774169834-b8815548-e955-4bc2-983a-9a4d19ce4df0.png 2022w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a name=oudom></a></p>\n<h3>（3）获取用户资料</h3>\n<p>由于钉钉在令牌阶段，没有给出用户的识别信息，只能再次调用 <a href=\"https://api.dingtalk.com/v1.0/contact/users/me\">https://api.dingtalk.com/v1.0/contact/users/me</a> 接口拿到用户的 openId、unionId 以及手机号、邮箱等信息。这本质上也是一个 HTTP call，但是令牌需要通过 x-acs-dingtalk-access-token头部携带，非常特别，这也是不能通过配置来实现对接的原因之一。</p>\n<p>java</p>\n<p>@Override\nprotected BrokeredIdentityContext extractIdentityFromProfile(\nEventBuilder event, JsonNode profile) {\nlogger.info(profile.toString());\nBrokeredIdentityContext identity =\nnew BrokeredIdentityContext((getJsonProperty(profile, unionId)));</p>\n<pre><code>identity.setUsername(getJsonProperty(profile, nick).toLowerCase());\nidentity.setBrokerUserId(getJsonProperty(profile, unionId).toLowerCase());\nidentity.setModelUsername(getJsonProperty(profile, nick).toLowerCase());\nString email = getJsonProperty(profile, email);\nif (email != null) {\n    identity.setFirstName(email.split(@)[0].toLowerCase());\n    identity.setEmail(email);\n}\nidentity.setLastName(getJsonProperty(profile, nick));\n// 手机号码，第三方仅通讯录应用可获取\nidentity.setUserAttribute(PROFILE_MOBILE, getJsonProperty(profile, mobile));\n\nidentity.setIdpConfig(getConfig());\nidentity.setIdp(this);\nAbstractJsonUserAttributeMapper.storeUserProfileForMapper(\n        identity, profile, getConfig().getAlias());\nreturn identity;\n</code></pre>\n<p>}</p>\n<p>public BrokeredIdentityContext getFederatedIdentity(String authorizationCode) {\nlogger.info(getting federated identity);</p>\n<pre><code>String accessToken = getAccessToken(authorizationCode);\nif (accessToken == null) {\n    throw new IdentityBrokerException(No access token available);\n}\nBrokeredIdentityContext context = null;\ntry {\n    JsonNode profile;\n    profile =\n            SimpleHttp.doGet(PROFILE_URL, session)\n                    .header(x-acs-dingtalk-access-token, accessToken)\n                    .asJson();\n    logger.info(profile in federation  + profile.toString());\n\n    context = extractIdentityFromProfile(null, profile);\n    context.getContextData().put(FEDERATED_ACCESS_TOKEN, accessToken);\n} catch (Exception e) {\n    logger.error(e);\n    e.printStackTrace(System.out);\n}\nreturn context;\n</code></pre>\n<p>}</p>\n<p>完成这三步，一个社交账号登录功能就开发成功了。虽然是以在 Keycloak 中开发钉钉登录举例，但其实所有系统中的社交账号登录功能都是这样的套路。</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}