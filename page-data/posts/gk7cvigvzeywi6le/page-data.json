{"componentChunkName":"component---src-templates-post-js","path":"/posts/gk7cvigvzeywi6le/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/gk7cvigvzeywi6le","relativePath":"posts/gk7cvigvzeywi6le","frontmatter":{"title":"负载测试的 RED 和 USE 指标","stackbit_url_path":"posts/gk7cvigvzeywi6le","date":"2023-12-01T11:23:22","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p>在《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/352141293%5D(https://zhuanlan.zhihu.com/p/352141293)\">负载测试应由开发完成 - Jeff Tian的文章 - 知乎</a> 》中，介绍了如何使用 k6 进行负载测试，掌握了工具的使用方法之后，还需要知道怎么查看和分析结果，即需要找一些指标来衡量系统在负载测试中的表现。为了方便记忆，不妨将这些指标的英文首字母连起来，当做单词来记忆。它们分别是： RED 和 USE。\n<a name=Qxt9H></a></p>\n<h1>RED</h1>\n<p>RED 指标用来监控 HTTP 请求。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABI0lEQVR42p1RW04DMQzcy3MBLgF/ICRAVN12u7RwC0Slig+6D+h24zzsDLJbnp9EGmWUUcZju5iWNS5uK1xe3WA6q1DfP6BaLLGoV1iuHg3KP6F6Oa9RzhaYlBWuJ3OUZYXT8zucnNUo3nYj9iOBWSCS8d/DAPoAFE3Totk2aNsO26ZB1/WIMcJ7D++D8b8gIoQQkVIyxJQgnJBCQEHeg/N3MqXj6MyQmZFz/gXtwjk1DMYTM0QEjryhGIngUkCWbII69n1vH77aYQarZgXV0NmITBOBxtG30RGKwTlsx8FEyVpRjkkOt55orfEPQwKRR4wBe09wRKrYGAofIl7aDu/D3jAcF6Sz0eoih2XJkVtaFuyHHV7Wz9isn/C6WYNTRIgJH+0gFwyaDp93AAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/30f83b87b4fecf0f43f372749231e75f/fcda8/1701426685396-e6ed76db-9db3-47c6-ad2e-8252e5d62095.png\"\n        srcset=\"/static/30f83b87b4fecf0f43f372749231e75f/12f09/1701426685396-e6ed76db-9db3-47c6-ad2e-8252e5d62095.png 148w,\n/static/30f83b87b4fecf0f43f372749231e75f/e4a3f/1701426685396-e6ed76db-9db3-47c6-ad2e-8252e5d62095.png 295w,\n/static/30f83b87b4fecf0f43f372749231e75f/fcda8/1701426685396-e6ed76db-9db3-47c6-ad2e-8252e5d62095.png 590w,\n/static/30f83b87b4fecf0f43f372749231e75f/efc66/1701426685396-e6ed76db-9db3-47c6-ad2e-8252e5d62095.png 885w,\n/static/30f83b87b4fecf0f43f372749231e75f/c83ae/1701426685396-e6ed76db-9db3-47c6-ad2e-8252e5d62095.png 1180w,\n/static/30f83b87b4fecf0f43f372749231e75f/ed904/1701426685396-e6ed76db-9db3-47c6-ad2e-8252e5d62095.png 3838w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=ByNns></a></p>\n<h2>Rate 请求速率</h2>\n<p>系统在 1 秒的时间窗口内所处理的请求个数。\n<a name=S2fWX></a></p>\n<h2>Error 错误率</h2>\n<p>系统在 1 秒的时间窗口内处理失败的请求个数。\n<a name=Wa7EW></a></p>\n<h2>Duration 时延</h2>\n<p>处理 1 个请求所消耗的时延。\n<a name=lYeZd></a></p>\n<h1>USE</h1>\n<p>USE 指标用来监控系统的资源消耗情况，比如数据库、缓存等等。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABGklEQVR42qWQ0UoDMRBF9+v9AX9Cn0QEC5aubddW/ZRi6W6y3WySmeRIIi2Cj1443JmE3EnSrNqOh8Wax6cFq3ZD9/bOtttX3+0/2e0/an+hrLfrjvZ1y7Ld8Lxc13O39y/c3HU0ZnQESWjK/EcC9B6ar68jh8OBvu+x1mKMueK9J8ZICIHzeWKeZ2IURP6SVJEYaCbnEIlAImetfiUrIXh8CDjnanhKCdVUXVSr5wzGWPrB0JSJRTnn6+ZviqIIs/fkWieiKJJy/SYp4RmssQzGlsAy9SescAm/UKSquMmhUm6kqERyUnJOSPC1LwpRaMp0Ozkm7xndTG/H6qU/z/76rNnNmH5gHAaG04nT8Vjr0VrsMKAieB/4Bo2OF3hxpRjVAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/4cd0623ca4d1f0e2d9d7f7b01749c5ea/fcda8/1701426720628-614fdb9d-9a58-49cf-99e8-87a35084a8a9.png\"\n        srcset=\"/static/4cd0623ca4d1f0e2d9d7f7b01749c5ea/12f09/1701426720628-614fdb9d-9a58-49cf-99e8-87a35084a8a9.png 148w,\n/static/4cd0623ca4d1f0e2d9d7f7b01749c5ea/e4a3f/1701426720628-614fdb9d-9a58-49cf-99e8-87a35084a8a9.png 295w,\n/static/4cd0623ca4d1f0e2d9d7f7b01749c5ea/fcda8/1701426720628-614fdb9d-9a58-49cf-99e8-87a35084a8a9.png 590w,\n/static/4cd0623ca4d1f0e2d9d7f7b01749c5ea/efc66/1701426720628-614fdb9d-9a58-49cf-99e8-87a35084a8a9.png 885w,\n/static/4cd0623ca4d1f0e2d9d7f7b01749c5ea/c83ae/1701426720628-614fdb9d-9a58-49cf-99e8-87a35084a8a9.png 1180w,\n/static/4cd0623ca4d1f0e2d9d7f7b01749c5ea/ed904/1701426720628-614fdb9d-9a58-49cf-99e8-87a35084a8a9.png 3838w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=JaorG></a></p>\n<h2>Utilisation 使用率</h2>\n<p>被使用的资源占所有资源的百分比。100% 意味着系统不能再接受额外的工作请求了。\n<a name=sAN6t></a></p>\n<h2>Saturation 饱和率</h2>\n<p>指资源额外的工作量超出其能力范围的程度；通常可以用队列的排队长度来衡量。\n<a name=XgcEG></a></p>\n<h2>Errors 错误数</h2>\n<p>资源侧的错误数量。</p>\n<p><a name=KzdUD></a></p>\n<h1>负载测试小提示</h1>\n<p>负载测试通过大量的 HTTP 请求打向系统，来尝试暴露一些平时发现不了的问题。为了事后分析方便，建议：\n<a name=zD4cP></a></p>\n<h2>特殊的 HTTP 标头</h2>\n<p>通过为每一个发出的 HTTP 请求中添加一个特殊的 HTTP 标头，可以在事后分析时，非常简单地筛选出哪些请求是负载测试发出的，哪些不是。一般不太建议单独构造一个环境仅让负载测试的流量进来，更常见的做法是在 QA 环境进行，那么在负载测试时，也可能会有普通的测试流量，所以添加这个标头非常有用！\n<a name=X7IlE></a></p>\n<h2>用户的准备</h2>\n<p>通过一个用户名、密码列表准备的用户数量（比如只有几十个）可能远远不足以模拟真实的流量峰值。尽管可以为同一个用户反复生成相同的大量请求，但是和用户相关的缓存可能会造成潜在问题不会被暴露出来。<br />因此建议每一个测试用例都通过真实的注册流程或者某种方式生成新用户，这样会更贴近真实情况。\n<a name=R8Nia></a></p>\n<h2>资源压力</h2>\n<p>如果观察到负载测试中，数据库的 CPU 或者内在使用率没有突增，就需要想各种办法来压到它。\n<a name=HVQ25></a></p>\n<h2>负载测试的时间长度</h2>\n<p>最好能够适当延长，比如几个小时等等。10 秒钟或者 1 分钟之类的，可能会造成一些诸如内在泄露的问题不会被暴露出来。\n<a name=cCIfK></a></p>\n<h1>总结</h1>\n<p>这篇文章总结了使用 k6 或者其他工具进行负载测试时需要注意的关键指标。重点包括 RED 和 USE 指标。RED 指标用于监控 HTTP 请求（请求速率、错误率、时延），而 USE 指标用于监控系统资源的消耗情况（使用率、饱和率、错误数）。<br />在进行负载测试时，还提供了一些建议，包括添加特殊的 HTTP 标头以便后续分析、准备足够数量的用户、观察资源压力以及延长测试时间等。这些建议可以帮助更好地模拟真实环境中的负载情况，以便发现潜在的问题。<br />总的来说，通过这些关键指标和建议，可以更全面地评估系统在负载测试中的表现，及时发现潜在问题，并提供了实用的解决方案。</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}