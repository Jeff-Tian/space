{"componentChunkName":"component---src-templates-post-js","path":"/posts/如何在升级数据表的同时保留原数据/","result":{"data":{"sitePage":{"id":"SitePage /posts/如何在升级数据表的同时保留原数据/"}},"pageContext":{"url":"/posts/如何在升级数据表的同时保留原数据/","relativePath":"posts/如何在升级数据表的同时保留原数据.md","relativeDir":"posts","base":"如何在升级数据表的同时保留原数据.md","name":"如何在升级数据表的同时保留原数据","frontmatter":{"title":"如何在升级数据表的同时保留原数据","stackbit_url_path":"posts/如何在升级数据表的同时保留原数据","date":"2012-02-13 04:44:00","excerpt":"","comments_count":0,"positive_reactions_count":0,"tags":["BlogEngine.NET","SQLite"],"canonical_url":"https://be-net.azurewebsites.net/post/2012/02/13/如何在升级数据表的同时保留原数据","template":"post"},"html":"<h1><span style=\"color: #800080;\">一、问题</span></h1>\n<p>项目做到后期，或者项目版本升级时，有时不得不更新原来的数据库设计。比如有一张表，可能需要增加字段、修改字段等。在某些情况下，ALTER TABLE命令不能完成这个任务，比如更换主键。这时只能用全新的设计替换掉原来的设计。但是，如果让新设计的表格中，包含原来的数据呢？</p>\n<h1><span style=\"color: #800080;\">二、解决方案</span></h1>\n<p>其实很简单，分4步：</p>\n<ol>\n<li>创建新表</li>\n<li>将原表数据插入到新表中</li>\n<li>删除原表</li>\n<li>将新表重命名为原表名</li>\n</ol>\n<h1><span style=\"color: #800080;\">三、实例</span></h1>\n<p>知名开源项目BlogEngine.NET就是这样做的！比如以下是它从2.0版本升级到2.5版本时，所使用的SQLite数据库升级脚本的一部分，对be_Posts表做了升级。</p>\n<pre class=\"brush: sql\">--\n-- Update be_Posts\n--\nCREATE TABLE be_PostsNew (\n[PostRowID] INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,\n[BlogID] VARCHAR(36) NOT NULL,\n[PostID] VARCHAR(36) NOT NULL,\n[Title] VARCHAR(255) NOT NULL,\n[Description] TEXT NOT NULL,\n[PostContent] TEXT NOT NULL,\n[DateCreated] DATETIME NOT NULL,\n[DateModified] DATETIME NOT NULL,\n[Author] VARCHAR(50) NOT NULL,\n[IsPublished] BOOLEAN NOT NULL,\n[IsCommentEnabled] BOOLEAN NOT NULL,\n[Raters] INTEGER NOT NULL,\n[Rating] REAL NOT NULL,\n[Slug] VARCHAR(255) NOT NULL,\n[IsDeleted] BOOLEAN NOT NULL\n);\n<p>INSERT INTO be_PostsNew\n(BlogID, PostID, Title, Description, PostContent, DateCreated,\nDateModified, Author, IsPublished, IsCommentEnabled, Raters,\nRating, Slug, IsDeleted)\nSELECT '27604f05-86ad-47ef-9e05-950bb762570c', p.PostID, p.Title, p.Description, p.PostContent, p.DateCreated,\np.DateModified, p.Author, p.IsPublished, p.IsCommentEnabled, p.Raters,\np.Rating, p.Slug, p.IsDeleted\nFROM be_Posts p;</p>\n<p>DROP TABLE be_Posts;\nALTER TABLE be_PostsNew RENAME TO be_Posts;</pre></p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"本站源码","url":"https://github.com/Jeff-Tian/space","style":"link","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[]}