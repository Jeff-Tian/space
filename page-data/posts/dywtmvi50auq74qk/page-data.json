{"componentChunkName":"component---src-templates-post-js","path":"/posts/dywtmvi50auq74qk/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/dywtmvi50auq74qk","relativePath":"posts/dywtmvi50auq74qk","frontmatter":{"title":"调用 AWS Bedrock 服务，为微信公众号消息提供自动回复功能。","stackbit_url_path":"posts/dywtmvi50auq74qk","date":"2024-01-19T11:04:50","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a href=\"https://github.com/Jeff-Tian/bedrock\">https://github.com/Jeff-Tian/bedrock</a></p>\n<hr>\n<blockquote>\n<p>调用 AWS Bedrock 服务，为微信公众号消息提供自动回复功能。</p>\n</blockquote>\n<p><a name=7b659241></a></p>\n<h2>体验</h2>\n<p>关注“哈德韦”公众号，发送任意消息即可体验。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ab05a3dbf26b2ff65d14f0be0a5ed300/09ede/mp-hardway.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.486486486486484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAACB0lEQVR42l2PXUiTcRTG36KPmy4KTZLuuuuyi+jCKMgo1hc4IcuZmpVObVJEQUaZ5ZqWmrpalCQKC+1CcEuTdLjZXj+mc5v2bnM6QsRiI7MsLDH4/2IvXXXg4RwOnPP8HmnXyNVVw3QrpaEWcX2ugytRK9dmrOz23EBy6tjgymWdM0eVNJCt7lT9mze6chNdSM5sNg/mr0jaYCN+t0d0tL6iz97La2s7o/YBiqOtSO9O8nShH2tMZuewgRNTtRzw3edIoBrN5EMO+qvY8v4C+333OBwwCdU0I9Qg3nb3cPNWuWhsqqe6tgZ7eycF0y+Q+jPQfmhgZHmWM4qZPWPl7PPeIW2ikvSAiTRfZYKKvd7b4pDfmEghpMxwE29sdqqMRvp6bZhqTHS2tXNx9iVSf6Z6lBOykBd5ztmIBd30M3RhC1mKmaygmdOKGV3IQnrgAZtceUjacJPottkxlJWJioq75J7Pp+1JM4XRFiRHJt6lKKzAl08xgmMBlPEAXxfi/Fdi6ud8glZIp5R6JjzjwuFwMCTLdNltzE4oFESa1Ydd8XHiP5YIxj4yOjOJby7MzOI8sbXvfF79xsLqEst/ftGz6BcqYbKsXzuqPEITqhOacB3HI485FqojdaiU9c5zbHMXsn2omJSRElI9BnaMXiZluIQkdxFJsp4kuYhkWS+2ui8lIv/+C/6UgMixBPLKAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"mp hardway\"\n        title=\"mp hardway\"\n        src=\"/static/ab05a3dbf26b2ff65d14f0be0a5ed300/fcda8/mp-hardway.png\"\n        srcset=\"/static/ab05a3dbf26b2ff65d14f0be0a5ed300/12f09/mp-hardway.png 148w,\n/static/ab05a3dbf26b2ff65d14f0be0a5ed300/e4a3f/mp-hardway.png 295w,\n/static/ab05a3dbf26b2ff65d14f0be0a5ed300/fcda8/mp-hardway.png 590w,\n/static/ab05a3dbf26b2ff65d14f0be0a5ed300/efc66/mp-hardway.png 885w,\n/static/ab05a3dbf26b2ff65d14f0be0a5ed300/c83ae/mp-hardway.png 1180w,\n/static/ab05a3dbf26b2ff65d14f0be0a5ed300/09ede/mp-hardway.png 1710w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>效果如下图所示：</p>\n<p><span>fallback node</span><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.21621621621621%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADMUlEQVR42o2U228bRRSH/X/xxAtKH6BCQeU/4IEXREGqQAGVUCjl8gRNkXhBLbQRJakTqFRBAaWpQ2jYuI7s1PFlfff6ut6dnb3YSf2hGScmEJCy0qc5Z3d15pzfzDkxz/NotVoUi0Wq1Sr1en2KlJJut0s6ncY0Te0LIf4Tx3HIZDLElNNsNslms+RyOXL5HE+yT8jl9/CkR6vdYsvY0u89KXCFcwLPE1iWRSq1Mwmodg7DkCAIOIjGsA9PIxjKffaDp3AA4+HEH8qDKSN/skrho55CvjAJqHBdF+n5rDWXWTQ/Y9W6Rrx+lRVrgTv1LzQrzQXtxxtXNUuVz1ltLWDU/uDO6iqbxp+HAV0XV7iEQcSXmbd45ednuLD1PK8/nOHNzTOcfzjD+cQMb2yc4bW153h75wXeK8wylz7LxeKLrNfusv0oxdbjJDE/CAiHI9ThDMMRv3UXuVGf51btI27WLmu+KX3ADfNDblYvc71widvdj1lyPmHJ+ZTbgyuU3F1dcj6fJ5ZKPmZ58VuElFjNJlazRbfTw7ZtTa+n7D6NRoN2u61P3bYHREGEcD2kkFoupf9eLkdsN2nww/Vr9GybcqlEdi9LoVjAqrfpWn2a1TZWrUMuU6BmNmhULFr1LuMRRHKk8T3/7wyPSvZ9SRhFhFHIKBqx46xzv3GLhB1nvbvMxmCF390VEoM4CSfOr9Z3mge979m10jxIbGCklIa+TxRF05N2XIdARnxdvsirPz3L/O7LzG3P8k5ylvnsOS5snGUuqfyXmDNmeT93jrXKj9y/9wubhkGsUqmybRioTNV9VBtIT9KXbXpRk37YouM36MgGvcCa2nrVdp2BazMeH5b8aH2Nr668y8B1KZkmpVJJt6BZKFEpVrWWhT2TfLbIMNzH90J8ERwjRLiCKAp1p8WE69DvdSaZHfaqspWm0pe6rZTtB75uRSHcEyiphsPhJKByhPAY2DYTe6LlEcf9/xsM6ptKQs2DmCqzUilTq9X01CmXy/onddFPw9EsmAyHFLFW32XgiOlHNYaO7NOiMlQ3RZfcdzxc4Wmtju962gwV/9BQ6kAndz1t4H9n+Bc/Exk6VG1rBgAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"WX20240116-181835@2x.png\"\n        title=\"WX20240116-181835@2x.png\"\n        src=\"/static/851df8d1d192b43069e4dfa24912a9cb/fcda8/1705574148756-087982e2-6ecc-4a73-a82c-81e37c983d45.png\"\n        srcset=\"/static/851df8d1d192b43069e4dfa24912a9cb/12f09/1705574148756-087982e2-6ecc-4a73-a82c-81e37c983d45.png 148w,\n/static/851df8d1d192b43069e4dfa24912a9cb/e4a3f/1705574148756-087982e2-6ecc-4a73-a82c-81e37c983d45.png 295w,\n/static/851df8d1d192b43069e4dfa24912a9cb/fcda8/1705574148756-087982e2-6ecc-4a73-a82c-81e37c983d45.png 590w,\n/static/851df8d1d192b43069e4dfa24912a9cb/efc66/1705574148756-087982e2-6ecc-4a73-a82c-81e37c983d45.png 885w,\n/static/851df8d1d192b43069e4dfa24912a9cb/ecf19/1705574148756-087982e2-6ecc-4a73-a82c-81e37c983d45.png 948w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 216.89189189189187%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/9bbf5835279467153511038f9aa17222/fcda8/1705574185473-dae43a2c-330e-4e9c-8488-7507addda976.png\"\n        srcset=\"/static/9bbf5835279467153511038f9aa17222/12f09/1705574185473-dae43a2c-330e-4e9c-8488-7507addda976.png 148w,\n/static/9bbf5835279467153511038f9aa17222/e4a3f/1705574185473-dae43a2c-330e-4e9c-8488-7507addda976.png 295w,\n/static/9bbf5835279467153511038f9aa17222/fcda8/1705574185473-dae43a2c-330e-4e9c-8488-7507addda976.png 590w,\n/static/9bbf5835279467153511038f9aa17222/efc66/1705574185473-dae43a2c-330e-4e9c-8488-7507addda976.png 885w,\n/static/9bbf5835279467153511038f9aa17222/d9199/1705574185473-dae43a2c-330e-4e9c-8488-7507addda976.png 960w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 216.89189189189187%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAIAAAD3xz8iAAAACXBIWXMAAAsTAAALEwEAmpwYAAAInElEQVR42m2VW4wb5RXHvw2UQm9UqIRNIAn0CfWhT30lbBJoi5BoaEtIyCYFAiVpAjxBRSTUSpWqlksh0BL1QgmEJnuxveus17tee9d3j28z9qxnfF977fHMeGa+b66etdfrXVfehahCPfrp6Mycc+b/1zcjDUgJyJcvBfJldwIv1hsCROJ2NIVBiDdDkiBCNYaJL9N4gQxks0QTgZQAHQliNk6MOV30SlVEsvDl8s19SYKiJMmKki+V3KFonArNJ2I4jwDeRCTSKNmotjqrUGZEkRMlThB5UeJEiRXEpgR5CTYh4iFqyiqnt4qKScstQpABzja9dCEjKbQAKxJiJNgQJR4pS/7A1aufX7lyBYsnJE3nIOSR3IByDSl4ZdWBxSmoAg8jzFdYb0MKsFKEFeOsGG8IOCe6skULkbFThaWVGs5LcU5McGKMFaO8tFCuTWUKHkYAdzsS98wm756J3TODDc9gw47oHkf0rhvYQW/qXBA/608+tIjfNRPZ48CGB0R3z8T2zibunSd234gBMBkCE9uMRcH1AUNjMfAf7EE78cvpyFNT4QenkuAaNjQWBWMxMBEbzE+GwWQEWCJgyBoZskZ2WcP3eqwH/JP7vZP7fZb7fZP7ApY9gam9Adt9PssBn2W/z3LAO7F7fupbNmzfxOK+ycU7bGEArGEwiX19xvcyc/TC8siF3CMX6CPnqSMvRg6eI0bO4iPnycPn6SMvFx59vfHoOXT8h86Fd999+/d/eG3PlB8AGwYssdsd/rOVX4zOPzS6eOhXgcMn3SOnfYdOLow8M//wqGfkBfzHz2GPnCOO/Bqd+pF9Mjhtmfj4wwemIwBYtpXt3nO1p17AHz0xN3Laf+TpmYOvcj87HXjk2PTBZ1yHRpcOnyEeew0+8SL/3Hcn3Ydd+OM++k5LGAwNbEfvmPGdrz75vO+h5/0jr5Yee6X4099KT1w0jl7Ujl7Uj76hHb1o/PzN1hMXhNHb7EEwHgHjgcHJDZQnwrdNeZ+tnnk2e+x0/sSZ+uiZ+skXuVM3eYEbPcOeeok/eWL1N7fa/Lus2C02bMgaAV+zYXdOR79pi9xu9+9dCH1/EdvvCj+wGD3gxg4sRO53Rw94Btzvie5zhe+bw749HR1oWsPAGgE/cBKvvPm7l15/7dBiZonXizzKQz3NiBSPKB6lGIFkJbIhkqyURy241r280gQToSHLzvJUeOaNs9dfOvoTy/yKbiYDPiIe8y64Elg4GcW8C64kFgn7fd4FF50h+y3dwspgPPjF8vBU+OVPrjz59h+/d9VR1NdKuazH66Wy2fTyMhaNxZPJDE3X6vViuewPh9mVspVXB8o2bPCOd9mwIXsSTCe+4ySyAoxjWJJI+QPBUDjs8/uDodCS15uhqAiGkRTV39ocZyRgCd9qw26xhgGYDA88WMLfsMcKsiZwLJTl1VqtVC43WJZhmGKpJKsqy3GrDNPv96/VRXDdv2vwhYfAsCO+14kPOxLDjsTjkfwJfOVYvHQcr5wgqsfxyqDAK8fixeOJ8tPx0olo4WE/tdsR3zs3WAFxqAcbUgLpZWMto7bSyg7GNtuFPCiWlVYE6s4G9DZRAulBVoxDHSSqzNjCYqra4Dpye6PT/3+xtZ3Vbm/c5Zla8scrdet2BilRdmWypCjLG521zY3uVn99a+srdLa2Nvp9odtzpil3JpeW1KVciRAQWIXaqqTVoV6HWh1qNah+iVL730tJXYVqXWnVZKMKtRVJWUUa4FlJ0rSaKDYYgfmSer3J8xBBmeekZhOqisrzsMlDGckcJyKotgyTZUUgC+oNvRhVGbGBag2BaYhMQ6zVm0jWqpUVCSqyorMso6hGU4Qs24BI0/VWu91uCjKoMwIPZVFUVuvNao2vrnKDXONrTLMpQKYh1hlBgkqNaTZYkW/COiMIooxkjWkIIJqk/GF8KZikcitmq9PaRpJURWlpmqlpJkK6JCmG0VZUQ9NNOlfx+GNubzSapIDHH5tyeq2OJWI53+/3IZTb7Xa7s97rbZqmqWlar7fV7qx3Oh1JlPr9PkmV//7J2J/f+2jBGwWLgYTTHZpxBRIEramGLGuqaggC2v43aUhWIVQEAUFJRkjVtBZJFecXw7MLgRCWAkvBxI15n33en0zn2u2ubpgtsy2Isqa1DMM0zQ6SNYRU02wrim60zHSm6HD559zBAJYaKNvnfNNzvh3bumZsbPRMs7211ec4TlGUra3+2lq7t7Gpa0a/3yeW83/567/+9o/PXEsYWAomLTfcU05vDKcgUlWtpWotptHkeEmCiiQpHC8xjaaqtjR9DUIlRea8oWQgQoSjaeDxx2fdoRvzgWQ61+l0S6UVhmFlRTeMtfXuxnq3p6qGohqShOr1Rqu1lqaKYzbn5+PT3lASeAJx64zHNjs47e76RjAYqqxUTLPTbq9v9jY7nfX19Q3DWOM4jiQz650uSZf/+en4B5f/7fHHQQhL+cO4N5hIEjSEqqqZTQE1WIHjRUFETQEObLNNlhORrIuSgqdoXyjpjxChaAq4vdGPPx2/cs2WpkocxxeLKxCpvd5Wb7NvrnXMtU5vs9/t9iBSY/GkomgkVbpunR23zbm9UeBainx6zfbZ9Wk8nUNIrtcbCKnd7ka322u1TMMwu93e+vqGrOiShDTNwMncmNU5bnO6FsMgjtM4mcfJfDKVLZRrhXKdpEp0vkLnK9lCNVuo7tQkVcoVqrliFU/n4jidILJxggbL2ZUYToWiKZIuJ7efQmSK+HJhALnNdv3FTbJA0uU4QSfTOZIuD5avXrf96d0Pk+lcmiqlMkViMJT/CsRyIZUppjJFki5b7fNz7kAmVwEkXV70R+2znp3eTjuTq3wFki7vdNN0ye2N7DgFN6d3NKl81Wafe+udS+9/cPm9Sx+9d+mj9z+4/NY7l2z2OSpf3dEn6fKOx/8COzO+VfmqdLIAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/2d3db6526d3bf6bf695cad44f2200e4a/fcda8/1705574192340-01975e23-b340-4a10-971a-ef9227485f71.png\"\n        srcset=\"/static/2d3db6526d3bf6bf695cad44f2200e4a/12f09/1705574192340-01975e23-b340-4a10-971a-ef9227485f71.png 148w,\n/static/2d3db6526d3bf6bf695cad44f2200e4a/e4a3f/1705574192340-01975e23-b340-4a10-971a-ef9227485f71.png 295w,\n/static/2d3db6526d3bf6bf695cad44f2200e4a/fcda8/1705574192340-01975e23-b340-4a10-971a-ef9227485f71.png 590w,\n/static/2d3db6526d3bf6bf695cad44f2200e4a/efc66/1705574192340-01975e23-b340-4a10-971a-ef9227485f71.png 885w,\n/static/2d3db6526d3bf6bf695cad44f2200e4a/d9199/1705574192340-01975e23-b340-4a10-971a-ef9227485f71.png 960w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=c12fc246></a></p>\n<h2>为什么有这个库</h2>\n<p>微信公众号提供了自动回复功能，但是不够智能，只能根据关键字进行回复。这个库可以让你的公众号更加智能，可以根据用户的消息内容，调用 AWS Bedrock 服务，得到更加智能的回复。当然，关键字回复也是同时支持的，即使 AWS Bedrock 服务没有响应，也会回复提前设置好的关键字回复。</p>\n<p>即该库在微信公众号自动回复的基础上，<strong>增加</strong>了智能回复的功能。是一个 AI 增强的微信公众号自动回复库。</p>\n<p><a name=b83ba5d7></a></p>\n<h2>难点</h2>\n<p>调用 AWS Bedrock 服务本身并不难，难点在于微信服务器的限制。微信服务器只等待 5 秒，如果超过 5 秒没有响应，就会重试。而最多重试 3 次，如果 3 次都没有响应，用户就会收不到回复。而微信服务器等待 5 秒的时间，是包括网络传输的时间的，所以，实际上，从接收到微信服务器发来的消息，一次只有不到 5 秒的时间来响应。而 AWS Bedrock 服务的响应时间很可能超过 5 秒，所以，这里使用了缓存，如果是同一消息，就不再调用 AWS Bedrock 服务，而是等待上次的调用结果。如果到第 3 次还没收到 AWS Bedrock 服务的响应，那就只能回复提前设置好的关键字回复了（当然，在这时，可以带上一个链接，允许用户稍后查看回复结果）。</p>\n<p><a name=51ae9800></a></p>\n<h2>时序图</h2>\n<p>有时候，AWS Bedrock 服务的响应很快，时序图如下：</p>\n<p>有时候，AWS Bedrock 服务的响应很慢，引起了微信服务器的一次重试，时序图如下：</p>\n<p>如果再慢一点，就会引起两次重试，时序图如下：</p>\n<p>以上是终于在微信服务器的重试次数内得到了回复的情况。如果 AWS Bedrock 服务的响应时间超过了微信服务器 3 次重试等待的总时间，那么，就只能回复提前设置好的关键字回复了。时序图如下：</p>\n<p><a name=db06c78d></a></p>\n<h2>测试</h2>\n<p>bash\nyarn test</p>\n<p><a name=a9f94dcd></a></p>\n<h2>部署</h2>\n<p>可以部署到任意 Kubernetes 集群。注意如果采用了内存缓存，replica 就需要设置成 1，如果设置成多个 Pod，会导致缓存失效。</p>\n<p>如果采用了 Redis 缓存，可以设置成多个 Pod，但是，需要注意，如果 Pod 重启，缓存会丢失，所以，需要设置成多个 Pod 的时候，需要使用 Redis 缓存。</p>\n<p>本来本项目部署在 Okteto 提供的免费 Kubernetes 集群上，域名是 <a href=\"https://bedrock-backstage-jeff-tian.cloud.okteto.net/message\">https://bedrock-backstage-jeff-tian.cloud.okteto.net/message</a> ，但是在 2024 年 1 月 15 日，Okteto 关闭免费服务。于是对本项目进行了重新部署，选择 cyclic，它是一个无服务器平台，不能再使用内存缓存，因为微信服务的消息重试会打在不同的实例上。好在，cyclic 提供了方便的 DynamoDb 存储，于是，将缓存从内存缓存改成了 DynamoDb 缓存。</p>\n<p><a name=e80c310e></a></p>\n<h2>缓存</h2>\n<p>由于微信公众号消息只等待 5 秒，而调用 AWS Bedrock 服务很可能在超过 5 秒后才能得到响应。超时后微信会再重试请求，为了避免重复调用 AWS Bedrock 服务，这里使用了缓存，如果是同一消息，就不再调用 AWS Bedrock 服务，而是等待上次的调用结果。</p>\n<p><a name=1965d14e></a></p>\n<h2>公众号后台配置</h2>\n<p>如何让你的微信公众号支持自动回复功能？只需要将该项目部署，然后在公众号后台配置即可。</p>\n<p><span>fallback node</span><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2b541d670ae17a8ba828710537638675/6e20d/1705574232662-66ed0481-192c-4da8-9900-6847109c4196.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKUlEQVR42nVR6UoGMQzc939K8Zd+22t75W6l3QVFdAhhEjLN0aNiv3I5XTp9Ol08XfTh8uEKMYeUQ8y5dAABkNaoMZEoM8UMbx/9eE8v5wMgsQgRIQIi5VwWJ2wdADoi9t4QYQUbCKCqR0r5dB6QtlzMjEiYRVVlNRGRh8vyshM7Z3bEKzsfOhIQD7M5JzO31oiIeJXyhoiskAXpCc3GEWIKMcEWswguDYuajfFtNtSWtzHUTNTUhqgezofP19n30rVW51ytddX9wBhjzrndJKJSmxGp6HHlEmLqgMiCuBqLPOQGItpe58bYuMnhQ/QhAq4NSyk5ZwBord1P8NbPv7DEoWZXns6t1Rij8JLsC993ln/FPsb7q4B4z8rEy8aYe/M15E1+map9ATbbRvR7HMdpAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"WX20240112-115802@2x.png\"\n        title=\"WX20240112-115802@2x.png\"\n        src=\"/static/2b541d670ae17a8ba828710537638675/fcda8/1705574232662-66ed0481-192c-4da8-9900-6847109c4196.png\"\n        srcset=\"/static/2b541d670ae17a8ba828710537638675/12f09/1705574232662-66ed0481-192c-4da8-9900-6847109c4196.png 148w,\n/static/2b541d670ae17a8ba828710537638675/e4a3f/1705574232662-66ed0481-192c-4da8-9900-6847109c4196.png 295w,\n/static/2b541d670ae17a8ba828710537638675/fcda8/1705574232662-66ed0481-192c-4da8-9900-6847109c4196.png 590w,\n/static/2b541d670ae17a8ba828710537638675/efc66/1705574232662-66ed0481-192c-4da8-9900-6847109c4196.png 885w,\n/static/2b541d670ae17a8ba828710537638675/c83ae/1705574232662-66ed0481-192c-4da8-9900-6847109c4196.png 1180w,\n/static/2b541d670ae17a8ba828710537638675/6e20d/1705574232662-66ed0481-192c-4da8-9900-6847109c4196.png 2902w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=6860b943></a></p>\n<h2>依赖</h2>\n<p><a name=c27b8d8d></a></p>\n<h3>代码依赖</h3>\n<p>本项目基于 Koa js 和 AWS 的 Bedrock SDK，并依赖 Cyclic 提供的对 AWS SDK 的上层封装。</p>\n<p><a name=69c92de1></a></p>\n<h3>基础设施依赖</h3>\n<p>本项目依赖 AWS Bedrock 服务，并且需要 Cyclic 平台 或者 AWS DynamoDb 和任意的 Kubernetes 平台。</p>\n<p><a name=9d36daea></a></p>\n<h2>相关文章</h2>\n<p><a href=\"https://zhuanlan.zhihu.com/p/674125115\">欢迎来调戏我：在公众号里对接 AWS Bedrock 服务</a></p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}}}},"staticQueryHashes":[],"slicesMap":{}}