{"componentChunkName":"component---src-templates-post-js","path":"/posts/af1puf","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/af1puf","relativePath":"posts/af1puf","frontmatter":{"title":"在 Keycloak 里集成 GitHub 登录","stackbit_url_path":"posts/af1puf","date":"2022-04-07T14:43:50","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p>Keycloak 是一个开源的身份认证系统，可以对接各种第三方的身份认证提供者，之前有展示过如何对接微信登录、企业微信登录，今天再展示一下如何对接 GitHub 登录，并将通过 GitHub 登录的用户链接到 Keycloak 已有有用户。</p>\n<p><a name=YWmn0></a></p>\n<h1>首先，在 GitHub 里申请一个应用</h1>\n<p>其实就是在 GitHub 里备个案，拿到 appid 和 appsecret，以便后续填写在 Keycloak 的 GitHub 身份提供者配置中。</p>\n<p>打开浏览器浏览至： <a href=\"https://github.com/settings/developers\">https://github.com/settings/developers</a> 开发者设置页面，新建一个 OAuth 应用：<br /><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1649338585555-66f6ae92-f2db-4186-afb2-d675f9026c8d.png#clientId=u24918144-4deb-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=473&#x26;id=u1794ad1e&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=946&#x26;originWidth=2238&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=219816&#x26;status=done&#x26;style=none&#x26;taskId=u3ec9a7a5-fe13-45e6-8251-57294bb0a95&#x26;title=&#x26;width=1119\" alt=\"image.png\"></p>\n<p>复制 ClientID 和 ClientSecret：<br /><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1649338622627-49c02be1-1fbe-4651-82eb-60f63c5f0d9f.png#clientId=u24918144-4deb-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=403&#x26;id=u62c901f7&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=806&#x26;originWidth=2246&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=172368&#x26;status=done&#x26;style=none&#x26;taskId=u3cef5121-c78f-4692-b026-cded3e45454&#x26;title=&#x26;width=1123\" alt=\"image.png\"></p>\n<p><a name=gXo27></a></p>\n<h1>然后，在 Keycloak 控制面板添加一个 GitHub 身份提供者</h1>\n<p>添加提供程序，并选择 GitHub：<br /><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1649338240890-920e3307-ae21-405a-8ec3-88c6190fdf0c.png#clientId=u24918144-4deb-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=592&#x26;id=u56fd00e8&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1184&#x26;originWidth=2566&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=376459&#x26;status=done&#x26;style=none&#x26;taskId=udb5f5d9c-f1b3-4562-82c5-90cb83e0bd4&#x26;title=&#x26;width=1283\" alt=\"image.png\"><br />随后，填入上一步申请好的 Client ID 和 Client Secret。 Account Linking Only 可以根据需求来勾选：<br /><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1649340299483-7e63077d-f48e-4c00-a044-0b5ace5efd70.png#clientId=u24918144-4deb-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=764&#x26;id=ua06c11dc&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1528&#x26;originWidth=1756&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=247796&#x26;status=done&#x26;style=none&#x26;taskId=ud080b6b7-0908-4bfb-bcd1-da8e244b622&#x26;title=&#x26;width=878\" alt=\"image.png\"><br />复制上图中的重定向 URI，并将它更新到第一步申请的 GitHub OAuth 应用中：<br /><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1649340501103-9c32a485-10c4-43f7-8380-81ab47690376.png#clientId=u24918144-4deb-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=637&#x26;id=u52c37f34&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1274&#x26;originWidth=1760&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=228842&#x26;status=done&#x26;style=none&#x26;taskId=u3a44c7f2-1561-4fa8-843c-7071afddf70&#x26;title=&#x26;width=880\" alt=\"image.png\"></p>\n<p><a name=LZMwW></a></p>\n<h1>接着，找一个用户验证链接是否有效</h1>\n<p>比如，我在 Keycloak 中的用户详情，是之前通过微信登录的，可以看到身份提供者是微信：<br /><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1649340674003-4b6dd0e7-2e2d-4cc0-b2ae-936d83a7b749.png#clientId=u24918144-4deb-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=506&#x26;id=u368c50f7&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1012&#x26;originWidth=2674&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=207222&#x26;status=done&#x26;style=none&#x26;taskId=uffa570d6-cffd-480f-a9e6-77bdc8b77fe&#x26;title=&#x26;width=1337\" alt=\"image.png\"><br />打开浏览器并浏览至： <a href=\"https://uniheart.pa-ca.me/keycloak/login\">https://uniheart.pa-ca.me/keycloak/login</a>，选择通过 GitHub 登录：<br /><a href=\"https://player.bilibili.com/player.html?bvid=BV1f94y1o7bW\">点击查看【bilibili】</a></p>\n<p>注意到，登录过程中，会提醒，已经有邮箱为 <a href=\"mailto:jeff.tian@outlook.com\">jeff.tian@outlook.com</a> 的用户了，如果要链接到该用户，需要通过邮箱验证。</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1649341767481-22ed5f49-d1a6-4d53-aa3e-350859b422ca.png#clientId=u24918144-4deb-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=606&#x26;id=ub7aab778&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1212&#x26;originWidth=1784&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=227620&#x26;status=done&#x26;style=none&#x26;taskId=ucf61e80a-3077-4ae7-9a39-834c0da6c63&#x26;title=&#x26;width=892\" alt=\"image.png\"></p>\n<p>验证完后，就会登录成功，跳回到登录前的应用 <a href=\"https://uniheart.pa-ca.me/keycloak/login%EF%BC%8C%E5%B9%B6%E8%BF%9B%E5%85%A5%E7%99%BB%E5%BD%95%E6%80%81%EF%BC%8C%E5%8D%B3%E6%8B%BF%E5%88%B0\">https://uniheart.pa-ca.me/keycloak/login，并进入登录态，即拿到</a> access token。<br /><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1649341792564-fca4971e-d2e7-437e-ba80-a60b884a71fe.png#clientId=u24918144-4deb-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=435&#x26;id=u63da1fc5&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=870&#x26;originWidth=2686&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=713211&#x26;status=done&#x26;style=none&#x26;taskId=u28670d24-7274-4991-a568-67c27e112ba&#x26;title=&#x26;width=1343\" alt=\"image.png\"></p>\n<p>这时，再加到 Keycloak 控制面板，找到该用户，即可看到该用户的身份提供者，除了微信，还多了一个 GitHub。</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1649341691593-37b1820f-ac16-4099-8f04-b4bef3e92ba6.png#clientId=u24918144-4deb-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=464&#x26;id=ua34ba2ba&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=928&#x26;originWidth=2630&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=250119&#x26;status=done&#x26;style=none&#x26;taskId=uff5d0096-33fd-466b-b510-713234d3f2c&#x26;title=&#x26;width=1315\" alt=\"image.png\"></p>\n<p>这说明 GitHub 登录集成成功了！</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","description":"Full Stack Developer, good at OAuth 2.0","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"本站源码","url":"https://github.com/Jeff-Tian/space","style":"link","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[]}