{"componentChunkName":"component---src-templates-post-js","path":"/posts/Excel-e5a49ae8a1a8e59088e5b9b6e4b98b-VBA-e8a7a3e586b3e696b9e6a188/","result":{"data":{"sitePage":{"id":"SitePage /posts/Excel-e5a49ae8a1a8e59088e5b9b6e4b98b-VBA-e8a7a3e586b3e696b9e6a188/"}},"pageContext":{"url":"/posts/Excel-e5a49ae8a1a8e59088e5b9b6e4b98b-VBA-e8a7a3e586b3e696b9e6a188/","relativePath":"posts/Excel-e5a49ae8a1a8e59088e5b9b6e4b98b-VBA-e8a7a3e586b3e696b9e6a188.md","relativeDir":"posts","base":"Excel-e5a49ae8a1a8e59088e5b9b6e4b98b-VBA-e8a7a3e586b3e696b9e6a188.md","name":"Excel-e5a49ae8a1a8e59088e5b9b6e4b98b-VBA-e8a7a3e586b3e696b9e6a188","frontmatter":{"title":"Excel 多表合并之 VBA 解决方案","stackbit_url_path":"posts/Excel-e5a49ae8a1a8e59088e5b9b6e4b98b-VBA-e8a7a3e586b3e696b9e6a188","date":"2010-12-06 18:11:00","excerpt":"","comments_count":0,"positive_reactions_count":0,"tags":["Excel","VBA","多表合并"],"canonical_url":"https://be-net.azurewebsites.net/post/2010/12/06/Excel-e5a49ae8a1a8e59088e5b9b6e4b98b-VBA-e8a7a3e586b3e696b9e6a188","template":"post"},"html":"<h1><font color=\"#9b00d3\"><font style=\"font-weight: bold\">一、单文件多工作表合并</font></font></h1>  <p>情况一：<strong>单文件多工作表合并</strong>，即在一张工作薄中，有多个工作表格，每个表格的内容都一致，只是所属的类别不同。现在要将所有类别表格里的内容全部合并到一张工作表格里。如以下表格（诺基亚零配件清单），一共有200多种型号，每种型号一个清单，现在要将它们全部合并到一张工作表格里。</p>  <p><a href=\"https://raw.githubusercontent.com/Jeff-Tian/blogengine.net/master/Source/BlogEngine/BlogEngine.NET/App_Data/files/image_92.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px 10px 0px 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"https://raw.githubusercontent.com/Jeff-Tian/blogengine.net/master/Source/BlogEngine/BlogEngine.NET/App_Data/files/image_thumb_91.png\" width=\"623\" height=\"479\" /></a></p>  <p>&#160;</p>  <h1><font color=\"#9b00d3\"><font style=\"font-weight: bold\">二、情况一解决方案</font></font></h1>  <p>解决方案：插入一张工作表格，命名为“汇总”。按Alt+F11，进入VBA编辑器，写上如下代码：</p>  <pre class=\"brush: vb\">Option Explicit\n<p>' 后面要用的，开始粘贴的行号\r\nPrivate beginRowNo As Long</p>\n<p>' 此过程启动汇总\r\nPrivate Sub CommandButton1_Click()\r\nDim sheetCount As Integer\r\nsheetCount = ThisWorkbook.Worksheets.Count</p>\n<pre><code>Dim i As Integer\r\nbeginRowNo = 1\r\n' 以下循环遍历每个表格，将需要汇总的表格里的内容一一粘贴到“汇总”表格里\r\nFor i = 1 To sheetCount\r\n    Dim sheetName As String\r\n    sheetName = ThisWorkbook.Worksheets(i).Name\r\n    \r\n    Select Case LCase(sheetName)\r\n        Case &#x26;quot;summary&#x26;quot;:\r\n            MsgBox &#x26;quot;跳过 &#x26;quot; + sheetName\r\n        Case &#x26;quot;update record&#x26;quot;:\r\n            MsgBox &#x26;quot;跳过 &#x26;quot; + sheetName\r\n        Case &#x26;quot;汇总&#x26;quot;:\r\n            MsgBox &#x26;quot;跳过 &#x26;quot; + sheetName\r\n        Case Else:\r\n            DoSubtotal (sheetName)\r\n    End Select\r\nNext i\n</code></pre>\n<p>End Sub</p>\n<p>' 此过程用来将指定表格名称的表格内容，复制粘贴到“汇总”表格里。\r\nPrivate Sub DoSubtotal(ByVal sheetName As String)\r\nDim sourceSheet As Worksheet\r\nDim destSheet As Worksheet</p>\n<pre><code>Set sourceSheet = ThisWorkbook.Worksheets(sheetName)\r\nSet destSheet = ThisWorkbook.Worksheets(&#x26;quot;汇总&#x26;quot;)\r\n\r\nsourceSheet.UsedRange.Copy 'destSheet.Range(&#x26;quot;A&#x26;quot; &#x26;amp; beginrowno)\r\ndestSheet.Range(&#x26;quot;A&#x26;quot; &#x26;amp; beginRowNo).PasteSpecial xlPasteValues, xlPasteSpecialOperationNone, True\r\nbeginRowNo = beginRowNo + sourceSheet.UsedRange.Rows.Count\r\n\r\nSet sourceSheet = Nothing\r\nSet destSheet = Nothing\n</code></pre>\n<p>End Sub</pre></p>\n<p>然后，将光标放置在 CommandButton1_Click 过程中的任意位置，按F5运行即可。</p>\n<h1><font color=\"#9b00d3\"><font style=\"font-weight: bold\">三、多文件合并</font></font></h1>\n<p>情况二：<strong>多文件合并</strong>，即在一个文件夹里，有多个工作薄文件，它们的第一个表格里的内容形式都一样，现在要将它们全部合并到一个工作薄里。如一个文件夹内，有每天的订单Excel文件，现在要将全部订单数据合并到一个Excel文件内。</p>\n<h1><font style=\"font-weight: bold\" color=\"#9b00d3\">四、多文件合并解决方案</font></h1>\n<p>解决方案：新建一个Excel工作薄，按Alt+F11，进入VBA编辑器，输入如下代码：</p>\n<pre class=\"brush: vb\">Sub 合并工作簿()\r\n    Dim FilesToOpen\r\n    Dim x As Integer\r\n\r\n    On Error GoTo ErrHandler\r\n    Application.ScreenUpdating = False\r\n\r\n    FilesToOpen = Application.GetOpenFilename _\r\n      (FileFilter:=&quot;Microsoft Excel Files (*.xls), *.xls&quot;, _\r\n      MultiSelect:=True, Title:=&quot;Files to Merge&quot;)\r\n\r\n    If TypeName(FilesToOpen) = &quot;Boolean&quot; Then\r\n        MsgBox &quot;No Files were selected&quot;\r\n        GoTo ExitHandler\r\n    End If\r\n\r\n    x = 1\r\n    Dim currentWorkSheet As Worksheet\r\n    Dim rng As Range\r\n    Set currentWorkSheet = ActiveWorkbook.ActiveSheet\r\n    Set rng = currentWorkSheet.Range(&quot;A1&quot;)\r\n    Dim wkb As Workbook\r\n    Dim wks As Worksheet\r\n    ' 以下循环分别将每个工作薄中的第一个工作表里的内容，复制粘贴到当前工作薄的第一张工作表里。\r\n    While x &lt;= UBound(FilesToOpen)\r\n        Set wkb = Workbooks.Open(Filename:=FilesToOpen(x))\r\n        Set wks = wkb.Worksheets(1)\r\n        \r\n        rng.Offset(0, 10).Value = wkb.Name\r\n        \r\n        wks.UsedRange.Copy rng\r\n        \r\n        Set rng = rng.Offset(wks.UsedRange.Rows.Count, 0)\r\n        wkb.Close False\r\n        \r\n        x = x + 1\r\n    Wend\r\n    Set wks = Nothing\r\n    Set rng = Nothing\r\n    Set wkb = Nothing\r\n    Set currentWorkSheet = Nothing\r\n\r\nExitHandler:\r\n    Application.ScreenUpdating = True\r\n    Exit Sub\r\n\r\nErrHandler:\r\n    MsgBox Err.Description\r\n    Resume ExitHandler\r\nEnd Sub</pre>\n<p>将光标放在过程“合并工作薄”的任意位置，按F5运行，在弹出的打开文件框中，选择需要合并的全部文件，确定即可。</p>\n<h1><font color=\"#9b00d3\"><font style=\"font-weight: bold\">五、多文件合并之二</font></font></h1>\n<p>情况三：<strong>多文件合并。</strong>类似情况二，但是，只将多个工作薄里的工作表复制到同一个工作薄里，不需要到同一个工作表。</p>\n<h1><font color=\"#9b00d3\"><font style=\"font-weight: bold\">六、多文件合并之二的解决方案</font></font></h1>\n<p>解决方案：类似情况二，代码只有一点点区别：</p>\n<pre class=\"brush: vb\">Sub 合并工作簿2()\r\n    Dim FilesToOpen\r\n    Dim x As Integer\r\n\r\n    On Error GoTo ErrHandler\r\n    Application.ScreenUpdating = False\r\n\r\n    FilesToOpen = Application.GetOpenFilename _\r\n      (FileFilter:=&quot;Microsoft Excel Files (*.xls), *.xls&quot;, _\r\n      MultiSelect:=True, Title:=&quot;Files to Merge&quot;)\r\n\r\n    If TypeName(FilesToOpen) = &quot;Boolean&quot; Then\r\n        MsgBox &quot;No Files were selected&quot;\r\n        GoTo ExitHandler\r\n    End If\r\n\r\n    x = 1\r\n    ' 主要就是这里，这个循环处理代码与情况二稍有不同！\r\n    While x &lt;= UBound(FilesToOpen)\r\n        Workbooks.Open Filename:=FilesToOpen(x)\r\n        \r\n        Sheets().Move After:=ThisWorkbook.Sheets _\r\n          (ThisWorkbook.Sheets.Count)\r\n          \r\n        x = x + 1\r\n    Wend\r\n\r\nExitHandler:\r\n    Application.ScreenUpdating = True\r\n    Exit Sub\r\n\r\nErrHandler:\r\n    MsgBox Err.Description\r\n    Resume ExitHandler\r\nEnd Sub</pre>\n<h2><font color=\"#9b00d3\"><em>注：如果先做情况三，再做情况一，那么就等于情况二。</em></font></h2>\n<p>[donate: <a href=\"http://www.zizhujy.com\">www.zizhujy.com</a>]</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","description":"Full Stack Developer, good at OAuth 2.0","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"本站源码","url":"https://github.com/Jeff-Tian/space","style":"link","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[]}