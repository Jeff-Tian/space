{"componentChunkName":"component---src-templates-post-js","path":"/posts/rqmz7r","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/rqmz7r","relativePath":"posts/rqmz7r","frontmatter":{"title":"“在线剪贴板”服务开发实录——逃不过的霍夫施塔特定律","stackbit_url_path":"posts/rqmz7r","date":"2022-06-10T12:19:13","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p>昨天的视频《<a href=\"https://www.zhihu.com/zvideo/1518236539352440833\">扫二维码登录一定安全吗？</a>》里，现场演示了通过截获网站 Cookie 的方式，可以轻易盗用别人的账号。其中有个环节，盗取的 Cookie 是手动获取的，要改进成自动上传是很容易的。比如在设置 Cookie 到 LocalStorage 的同时，上传保存到服务器，然后再自动粘贴到目标网站进行用户身份顶替。所以做为用户，要千万当心，不要随便扫描二维码（确认是官方的才行）。</p>\n<p><a href=\"https://player.bilibili.com/player.html?bvid=BV1f94y1m7qG\">点击查看【bilibili】</a></p>\n<p><a name=AZfyV></a></p>\n<h1>在线剪贴板</h1>\n<p>在红客思维状态下，提醒完用户小心后，我又切换回开发者的思维，认识到在一个客户端将复制的内容保存到云端，然后在另一端取出云端保存的内容，然后进行粘贴的这一场景，其实是很有应用价值的。只要用途正当，可以非常方便用户的日常工作和生活。是的，这其实就是“跨设备拷贝”。</p>\n<p>用过 iPhone 和 Mac 的同学很熟悉，只要在手机和电脑上都登录同一个 Apple ID，那么，在手机上拷贝的内容，可以直接在电脑上粘贴，反之亦然。不仅是文字，图片也可以。（还不知道的同学赶紧试一下，别再用微信文件助手了，根本用不着那么麻烦！）</p>\n<p>但遗憾的是，如果你用 iPhone，再用 Windows 电脑，就享受不到自带的“跨设备拷贝”的便利性了，在这样的情况下，还是得用微信文件助手。</p>\n<p>如果要共享 iPhone 和 Windows 这样的不同厂商的设备的剪贴板，就得有个“在线剪贴板”这个的服务，然后在端上安装相关的应用，能够和这个“在线剪贴板”打交道。我一搜，“在线剪贴板”应用数不胜数，看来果然是一个很有价值的应用，已经是一片红海。看了好几个动态返回 ID（key） 的实现后，找到了一个可以指定 ID（key）的实现，这个最方便实现“跨设备拷贝”功能。把玩了一下人家开发好的，虽然完全符合我的使用需求，但却是一个国外站点，不太方便直接拿来使用（比如微信小程序的后端服务域名，不仅需要设置白名单，还需要 ICP 备案才行）。</p>\n<p>于是我决定自己实现一个。只需要两个接口，一个保存，一个读取即可，为了快速整完，可以在我的<a href=\"https://zhuanlan.zhihu.com/p/412196725\">万能 BFF 项目</a>里迭代添加这两个接口。</p>\n<p><a name=IiK0F></a></p>\n<h1>霍夫施塔特定律</h1>\n<p>你觉得完成两个接口需要多久？我一拍脑袋，20 分钟！我信心满满地开始写起来，觉得甚至可能 10 分钟就能搞定！为了计时，我将写代码的全过程录制下来了，最后被啪啪打脸，从开始写，到最后发布成功，花了足足 2 个小时！！</p>\n<p>果然是逃不过著名的霍夫施塔特定律呀，这个定律很有意思，它是说：</p>\n<blockquote>\n<p>即使你考虑到了霍夫施塔特定律，项目的实际完成时间总是比预期的要长。</p>\n</blockquote>\n<p>这是一个递归的说法。这个定律就是说，项目的实际完成时间总是比预期的要长，哪怕你已经提前考虑到了这一点，预留了“足够”的 Buffer 时间，然而到最后那点儿时间还是不够！</p>\n<p><a name=aDLpB></a></p>\n<h1>GraphQL</h1>\n<p>本服务提供了两个 GraphQL 接口，在视频里，穿插讲解了 GraphQL 设备指南。这个设计指南很早就写了，详见：</p>\n<p>另外，后来为了演讲专门做了一个演示文稿，借此机会也分享一下：</p>\n<p><a name=I9pXw></a></p>\n<h1>TDD</h1>\n<p>开发的时候，我还是想着要使用 TDD 的，实际上也使用了，不过步子迈得不够小，算是糙版的 TDD 。</p>\n<p><a name=MIOIy></a></p>\n<h1>最终成果</h1>\n<p>实现了支持文本内容的“在线剪贴板”，可以通过 cURL 体验一把：\nshell</p>\n<h1>复制内容到剪贴板</h1>\n<p>curl --request POST\n--header content-type: application/json\n--url <a href=\"https://sls.pa-ca.me/nest/graphql\">https://sls.pa-ca.me/nest/graphql</a>\n--data {query:mutation CopyToClipboard($clipboard: ClipboardInput!) {n  copyToClipboard(clipboard: $clipboard) {n    keyn    valuen  }n},variables:{clipboard:{key:test2,value:UniHeart2}}}</p>\n<h1>读取剪贴板内容</h1>\n<p>curl --request POST\n--header content-type: application/json\n--url <a href=\"https://sls.pa-ca.me/nest/graphql\">https://sls.pa-ca.me/nest/graphql</a>\n--data {query:query Clipboard($key: String!) {n  clipboard(key: $key) {n    keyn    valuen  }n},variables:{key:test}}</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1654863377597-07df13e2-fecf-4fbb-8239-4baa2c999d17.png#clientId=u881cb958-49df-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=772&#x26;id=ue3dec060&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1544&#x26;originWidth=2386&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=298058&#x26;status=done&#x26;style=none&#x26;taskId=ucb986bab-9def-4fd5-835a-1bc1f1f354e&#x26;title=&#x26;width=1193\" alt=\"image.png\">\n<a name=tWGiF></a></p>\n<h1></h1>\n<p><a name=O8VXS></a></p>\n<h1>开发实录</h1>\n<p><a href=\"https://player.bilibili.com/player.html?bvid=BV1yY4y1G7ac\">点击查看【bilibili】</a></p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[]}