{"componentChunkName":"component---src-templates-post-js","path":"/posts/giptcw","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/giptcw","relativePath":"posts/giptcw","frontmatter":{"title":"ç»™ Java gradle å·¥ç¨‹æ·»åŠ  git hooks","stackbit_url_path":"posts/giptcw","date":"2021-06-08T11:56:24","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p>æ¥ã€Š<a href=\"https://zhuanlan.zhihu.com/p/376821879\">åç«¯å·¥ç¨‹åœ£æ®¿å½¢è±¡çš„å´©å¡Œä»¥åŠé‡å»º</a>ã€‹ï¼Œä»Šå¤©è®°å½•ä¸€ä¸‹ä½¿ç”¨åœŸåŠæ³•ç»™ Java gradle å·¥ç¨‹æ·»åŠ  git hooks çš„æ­¥éª¤ï¼Œå¹¶ä¸”åˆ›å»ºäº†ä¸€ä¸ªæ ·ä¾‹é¡¹ç›®å’Œæäº¤è®°å½•æ”¾åœ¨äº† GitHubï¼š<a href=\"https://github.com/Jeff-Tian/securing-web-with-wechat-mp/commit/2a844e890cb0d91eaf5b5684f9d750cf586613a2\">https://github.com/Jeff-Tian/securing-web-with-wechat-mp/commit/2a844e890cb0d91eaf5b5684f9d750cf586613a2</a>ã€‚æ¬¢è¿ğŸ‘ å›´è§‚å’Œæ‰¹è¯„ï¼Œæ¯•ç«Ÿè¿™æ˜¯ä¸€ä¸ªå¾ˆåœŸçš„åŠæ³•ã€‚</p>\n<p><a name=EwTxM></a></p>\n<h1>èƒŒæ™¯ç®€ä»‹</h1>\n<p>Git é’©å­å¯ä»¥åœ¨æŸäº›äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰§è¡ŒæŒ‡å®šçš„ä»»åŠ¡ã€‚æ¯”å¦‚æˆ‘å¸Œæœ›åœ¨è‡ªå·±çš„å·¥ç¨‹é‡Œï¼Œå½“è¿›è¡Œ git commit å’Œ push å‰ï¼Œè·‘ä¸€è¾¹æµ‹è¯•ï¼Œç¡®ä¿æ–°çš„ä»£ç æ”¹åŠ¨æ²¡æœ‰å¸¦æ¥é—®é¢˜ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ†åˆ«æ·»åŠ  pre-commit å’Œ pre-push ä¸¤ä¸ªé’©å­äº‹ä»¶ä»»åŠ¡ã€‚</p>\n<p>é»˜è®¤çš„ Git é’©å­ç›®å½•æ˜¯ .git/hooksã€‚è¿™ä¸ªç›®å½•å°±æ˜¯ Git ä¼šåœ¨é¡¹ç›®çš„äº‹ä»¶å‘ç”Ÿæ—¶å»æ£€æŸ¥å¯èƒ½éœ€è¦æ‰§è¡Œçš„è„šæœ¬çš„åœ°æ–¹ã€‚</p>\n<p><a name=OaKcj></a></p>\n<h1>æ€è·¯</h1>\n<p>è¿˜æ˜¯å› ä¸ºå¯¹ Java çš„ä¸–ç•Œä¸ç†Ÿæ‚‰ï¼Œå› æ­¤èµ°äº†åœŸåŠæ³•é€”å¾„ã€‚å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œç›´æ¥å†™ä¸¤ä¸ªè„šæœ¬ï¼Œåˆ†åˆ«å¯¹åº” pre-commit å’Œ pre-pushï¼Œæ”¾åœ¨ .git/hooks ç›®å½•ä¸‹ã€‚ä½†è¿™æ ·åšçš„ç¼ºç‚¹æ˜¯ï¼Œå½“ä½ æ¢ä¸€å°æœºå™¨æ—¶ï¼Œè¿™ä¸ªä¿¡æ¯å°±ä¸¢å¤±äº†ï¼Œå› ä¸ºè¿™ä¸ªæ”¹åŠ¨æ²¡æœ‰çº³å…¥åˆ°æºä»£ç ç®¡ç†ä¸­ã€‚</p>\n<p>æ‰€ä»¥æƒ³åˆ°çš„æ”¹è¿›æ–¹æ¡ˆæ—¶å°†è„šæœ¬å†™åœ¨æºä»£ç é‡Œï¼Œç„¶åå‘ build.gradle æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªå®‰è£…é’©å­çš„ä»»åŠ¡ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰æ‹‰å»æ”¹é¡¹ç›®çš„æœºå™¨ï¼Œéƒ½å¯ä»¥ä¸€é”®å®‰è£…é’©å­ã€‚</p>\n<p><a name=qkqw2></a></p>\n<h1>å®ç°</h1>\n<p><a name=Rcuy9></a></p>\n<h2>åˆ›å»ºè„šæœ¬</h2>\n<p>é’ˆå¯¹èƒŒæ™¯ç®€ä»‹é‡Œçš„éœ€æ±‚ï¼Œä¸€å…±éœ€è¦åˆ›å»ºä¸¤ç§é’©å­ï¼Œåˆ†åˆ«æ˜¯ pre-commit å’Œ pre-pushã€‚ä¸ºäº†æ”¯æŒ macOS å’Œ windows å¼€å‘æœºï¼Œå¯¹æ¯ç§é’©å­åˆ†åˆ«åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ã€‚ä»¥ pre-push ä¸ºä¾‹ï¼Œåˆ†åˆ«åˆ›å»º pre-push-macos å’Œ pre-push-windows ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p>\n<p><a name=LYMB9></a></p>\n<h3>pre-push-macosï¼š</h3>\n<p>shell\n#!/bin/bash</p>\n<p>echo è¿è¡Œæµ‹è¯•...</p>\n<p>./gradlew test --info</p>\n<p>status=$?</p>\n<h1>å¦‚æœæµ‹è¯•å¤±è´¥ä¼šè¿”å›ç ç½®ä¸º 1</h1>\n<p>[ $status -ne 0 ] &#x26;&#x26; exit 1\nexit 0</p>\n<p><a name=BxoXM></a></p>\n<h3>pre-push-windowsï¼š</h3>\n<p>shell\n#!C:/Program Files/Git/usr/bin/sh.exe</p>\n<p>echo è¿è¡Œæµ‹è¯•...</p>\n<p>./gradlew test --info</p>\n<p>status=$?</p>\n<h1>å¦‚æœæµ‹è¯•å¤±è´¥ä¼šè¿”å›ç ç½®ä¸º 1</h1>\n<p>[ $status -ne 0 ] &#x26;&#x26; exit 1\nexit 0</p>\n<p>ä¸¤ä¸ªæ–‡ä»¶å‡ ä¹ä¸€è‡´ï¼Œåªæ˜¯ç¬¬ä¸€è¡Œ She bang line æœ‰åŒºåˆ«ï¼Œå› ä¸ºè¿™ä¸¤ç§ç³»ç»Ÿå¯¹åº”çš„å¯ä»¥æ‰§è¡Œçš„ sh æ–‡ä»¶æ‰€åœ¨ç›®å½•æœ‰åŒºåˆ«ã€‚</p>\n<p><a name=j2ub1></a></p>\n<h2>å‘ build.gradle æ–‡ä»¶æ·»åŠ å®‰è£…é’©å­çš„ä»»åŠ¡</h2>\n<p>groovy\nimport org.apache.tools.ant.taskdefs.condition.Os</p>\n<p>task installGitHooks(type: Copy) {\ndef suffix = macos\nif (Os.isFamily(Os.FAMILY_WINDOWS)) {\nsuffix = windows\n}\nfrom new File(rootProject.rootDir, scripts/pre-commit-$suffix)\ninto { new File(rootProject.rootDir, .git/hooks) }\nrename(pre-commit-$suffix, pre-commit)</p>\n<pre><code>from new File(rootProject.rootDir, scripts/pre-push-$suffix)\ninto { new File(rootProject.rootDir, .git/hooks) }\nrename(pre-push-$suffix, pre-push)\n\nfileMode 0775\n</code></pre>\n<p>}</p>\n<p>tasks.getByPath(:build).dependsOn installGitHooks</p>\n<p>è¿™ä¸ªä»»åŠ¡ä¼šåˆ¤æ–­ç³»ç»Ÿçš„ç±»å‹ï¼Œå¹¶æ‹·è´ç›¸åº”çš„è„šæœ¬æ–‡ä»¶åˆ° .git/hooks ç›®å½•ä¸‹ã€‚è¿™æ ·å½“æ‰§è¡Œ\nshell\n./gradlew installGitHooks</p>\n<p>å‘½ä»¤æ—¶å°±ä¼šå®‰è£… Git é’©å­ã€‚æ³¨æ„è¿™é‡Œè¿˜æŒ‡å®š build ä»»åŠ¡ä¾èµ– installGitHooks ä»»åŠ¡ï¼Œäºæ˜¯å³ä½¿æ‰§è¡Œ ./gradlew build ä¹Ÿä¼šè§¦å‘è‡ªåŠ¨å®‰è£… Git é’©å­ã€‚</p>\n<p><a name=Te6zg></a></p>\n<h2>CI/CD</h2>\n<p>å½“ç„¶ï¼Œåœ¨æäº¤å‰è¿è¡Œ Git é’©å­ç¡®ä¿æµ‹è¯•é€šè¿‡æ˜¯å¾ˆå¥½çš„å®è·µï¼Œä½†æ˜¯ä¸æ’é™¤ä»ç„¶å¯ä»¥ç»•è¿‡ï¼Œä»¥è‡³äºæ²¡æœ‰æµ‹è¯•å°±æ¨é€äº†ä»£ç åˆ°ä»“åº“ã€‚ä¸ºäº†é¿å…å°†ä¸å·¥ä½œçš„ä»£ç éƒ¨ç½²åˆ°çº¿ä¸Šï¼ˆè¿™é‡Œå¼€å‘ç¯å¢ƒä¹Ÿå±äºçº¿ä¸Šï¼Œ<a href=\"https://github.com/Jeff-Tian/egg-error-display#%E7%BA%BF%E4%B8%8A--%E7%94%9F%E4%BA%A7\">çº¿ä¸Šä¸å•æŒ‡ç”Ÿäº§ç¯å¢ƒ</a>ï¼‰ï¼Œé‚£ä¹ˆæœ‰å¿…è¦åœ¨ CI/CD ç¯èŠ‚ä¹ŸåŠ ä¸Šè¿è¡Œæµ‹è¯•æ­¥éª¤ã€‚å¦‚æœä½¿ç”¨ GitHub Actionsï¼Œä½ å¯ä»¥å†™ä¸€ä¸ªå¦‚ä¸‹çš„ .github/workflows/gradle.yml æ–‡ä»¶ï¼Œæ³¨æ„ï¼Œä¸‹é¢çš„ç¤ºä¾‹è¿˜åœ¨ Github Action é‡Œé›†æˆäº† Sonar æ‰«ææ­¥éª¤ï¼š</p>\n<p>yaml\nname: Java CI with Gradle</p>\n<p>on:\npush:\nbranches: [ master ]\npull_request:\nbranches: [ master ]</p>\n<p>jobs:</p>\n<p>sonar-build:\nname: Build\nruns-on: ubuntu-latest\nsteps:\n- uses: actions/checkout@v2\nwith:\nfetch-depth: 0  # Shallow clones should be disabled for a better relevancy of analysis\n- name: Set up JDK 11\nuses: actions/setup-java@v1\nwith:\njava-version: 11\n- name: Cache SonarCloud packages\nuses: actions/cache@v1\nwith:\npath: ~/.sonar/cache\nkey: ${{ runner.os }}-sonar\nrestore-keys: ${{ runner.os }}-sonar\n- name: Cache Gradle packages\nuses: actions/cache@v1\nwith:\npath: ~/.gradle/caches\nkey: ${{ runner.os }}-gradle-${{ hashFiles(**/*.gradle) }}\nrestore-keys: ${{ runner.os }}-gradle\n- name: Build and analyze\nenv:\nGITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # Needed to get PR information, if any\nSONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}\nrun: ./gradlew build sonarqube --info</p>\n<p>build:</p>\n<pre><code>runs-on: ubuntu-latest\n\nsteps:\n- uses: actions/checkout@v2\n- name: Set up JDK 11\n  uses: actions/setup-java@v2\n  with:\n    java-version: 11\n    distribution: adopt\n- name: Grant execute permission for gradlew\n  run: chmod +x gradlew\n- name: Build with Gradle\n  run: ./gradlew build\n- name: Test with Gradle\n  run: ./gradlew test\n</code></pre>\n<p>è¿™æ ·ä½ å°±å¯ä»¥åœ¨æäº¤å†å²é‡ŒæŸ¥çœ‹æ¯æ¬¡æäº¤çš„æµ‹è¯•ç»“æœå’Œä»£ç æ‰«æç»“æœäº†ï¼š<br /><img src=\"https://cdn.nlark.com/yuque/0/2021/png/221736/1623153288082-cb73eb59-104c-4fd1-8136-932886a2faf5.png#clientId=u91a6ec18-68c9-4&#x26;from=paste&#x26;height=708&#x26;id=ubfc92f75&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=708&#x26;originWidth=1602&#x26;originalType=binary%E2%88%B6=1&#x26;size=169430&#x26;status=done&#x26;style=none&#x26;taskId=u57b95a4c-fd61-46aa-9534-e962ca56ef7&#x26;width=1602\" alt=\"image.png\"></p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"å…³äº","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"å½å½æ­ªæ­ª","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"çŸ¥ä¹","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"ç´«ç«¹å½æ­ª","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[]}