{"componentChunkName":"component---src-templates-post-js","path":"/posts/nql1gfknw00t58uc/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/nql1gfknw00t58uc","relativePath":"posts/nql1gfknw00t58uc","frontmatter":{"title":"Free Arch: GraphQL Federation 初体验（成功，且丝滑！）","stackbit_url_path":"posts/nql1gfknw00t58uc","date":"2022-11-13T15:22:25","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a name=S3u7t></a></p>\n<h1>前情提要</h1>\n<p><a name=DKIGv></a></p>\n<h2>uni-orders</h2>\n<p>在《  <a href=\"https://zhuanlan.zhihu.com/p/580043578\">Free Arch: 个人开发者也能做到支付闭环 - Jeff Tian的文章 - 知乎</a> 》一文中，我用一个 Web 在线演示项目，展示了个人支付也能做到闭环。这个 Web 演示项目 v，是前端界面，它依赖的后端服务，我命名为 uni-orders，它的来历，以及目前的部署，《<a href=\"https://zhuanlan.zhihu.com/p/580160351\">Free Arch: 狡兔三窟，多处部署 - Jeff Tian的文章 - 知乎</a>》已经做了详细描述。</p>\n<p><a name=aI7r8></a></p>\n<h2>万能 BFF</h2>\n<p>现在，我想在自己的个人小程序里也集成这个支付功能。如果要直接对接 uni-orders，不太可行。因为 uni-orders 部署在国外的免费 Kubernetes 集群中，同时对外提供 Restful 和 gRPC 接口，默认的公网地址，是没有做域名备案的，而没有备案的域名，没法加入小程序的可信域名中。目前，我的个人小程序，后端由万能 BFF 提供。成能 BFF 也是我杜撰的名字，关于它的来历，详见：《<a href=\"https://zhuanlan.zhihu.com/p/416697232\">在小程序里接入 GraphQL - Jeff Tian的文章 - 知乎</a>》和《<a href=\"https://zhuanlan.zhihu.com/p/412196725\">一顿操作猛如虎，部署一个万能 BFF - Jeff Tian的文章 - 知乎</a> 》。</p>\n<p><a name=igOus></a></p>\n<h2>GraphQL Federation</h2>\n<p>一个前端对接多个后端不太好，既然有了 BFF，那理应由 BFF 来转发请求。不过，既然，万能 BFF 是以 GraphQL 为前端提供服务的，而且小程序的网络请求已经使用了 Apollo GraphQL Client，那么，看起来，只需要在万能 BFF 里加几个 Resolvers 去调用 uni-orders 即可。但是这种开发听上去不仅代码量大，且枯燥无趣。何必手写代码做 restful 到 graphql 的转换呢？</p>\n<p>我在之前整理过一个 《<a href=\"https://reveal-js-lac.vercel.app/#/5/2\">GraphQL API 使用指引与设计原则</a>》，其中提到了“联邦”，但只是一笔带过，没有给出实际例子。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.51351351351351%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACv0lEQVR42o2Sy08TaxjG+0epKwUtFk7LtLgTaKczvYB4OZ6VGjUcdkY3Jy4U40IXR413xa2Jxhir2NaK2Ioo6iG0eGHoXGlpx/Rn5sMGXHkmeTLfPE/e3/dm3tfX0xkk5JeQusKEAxG8744t29m2uZOOzZ0b3h1s3dQhso1++9y5ZTuBrd34UuEEQpJKUlJJSyrDkYTQUF+K4V1p1GCc8RNnmLh8l9Nj/5AOJxjuS4l8o9KRJD61N05bibCC2pci3pdG8SQpwpf/iHJk6BBjB0c5GPsTJSSj9P6qNsOX6FVI/Cwc3pVElo+yWxmjXxlDjqRRglEBiAb6GejaTax7ADW03kRaSuAx4sHYGlCR4nhSwwqx7kEmrtzhXWmW1y+mKRZeU3xZFCpNlShNFZmZnuFltkA285zJJ5Pcf/SAp4+fMjfznvGTZ/HtCSYY9e9nJJQkGhhgOv+K3z2aprFqrvDFtejVzjPrVIR/69+b+I779/FXzxCjXQdI+WWymawI6/U635sujUYD13VptVqYpont2Ni6RbWyhGFbvKsuUDV0UXP9wjV8x/z7iIdlAUz7ZXLP8iJc/PyVha9l9OoSK7WauKBWq4ms6TYxbQtDNykvGlR1Q/g3Ll7Hd2jnCH/vOMDhwF6UnVHyP4Ery2XO5e4xb7uU//tIuVIRQK/DykIF49sS85pN6JLG9PyyqLnmAeOSzEgwiRKJMxjop/DshQiNj58olmZZNFZxLAPLsrEsS2Q108H4sozp2HzSHAzLXu/QG7k3ZW+pvaHkM7k1oG7RbDSoORau+114HtBxHOqrdXTToKppGAvv0Ze19X/Y3sNkWP1fU27RQvu2hGU6NE2d1UuncD7Pi+y2N2UP1lasZ5B7VyeYm5kTu/dmqrSmV57eiPPb4lsKT/LkHk5SyBbIP8qQy2T5MPuBc6fG+QHOtvlbxUrujAAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/8b33efc155d799297d418952bcc950d2/fcda8/1668344544748-c3a707e2-c43a-4f4e-81ab-26411ffa6219.png\"\n        srcset=\"/static/8b33efc155d799297d418952bcc950d2/12f09/1668344544748-c3a707e2-c43a-4f4e-81ab-26411ffa6219.png 148w,\n/static/8b33efc155d799297d418952bcc950d2/e4a3f/1668344544748-c3a707e2-c43a-4f4e-81ab-26411ffa6219.png 295w,\n/static/8b33efc155d799297d418952bcc950d2/fcda8/1668344544748-c3a707e2-c43a-4f4e-81ab-26411ffa6219.png 590w,\n/static/8b33efc155d799297d418952bcc950d2/efc66/1668344544748-c3a707e2-c43a-4f4e-81ab-26411ffa6219.png 885w,\n/static/8b33efc155d799297d418952bcc950d2/c83ae/1668344544748-c3a707e2-c43a-4f4e-81ab-26411ffa6219.png 1180w,\n/static/8b33efc155d799297d418952bcc950d2/410b4/1668344544748-c3a707e2-c43a-4f4e-81ab-26411ffa6219.png 2102w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>今天，正好可以使用万能 BFF 做为实际例子，将 uni-orders 的订单服务，联邦进来，既减少了代码量，又给自己之前写的文章，补上实际运行中的示例。\n<a name=ehVMP></a></p>\n<h1>成果演示</h1>\n<p>已有的万能 BFF，其访问地址是： <a href=\"https://sls.pa-ca.me/nest/graphql\">https://sls.pa-ca.me/nest/graphql</a>。 最终将 uni-orders 联邦进来后，使用了 /gateway 这个路由，其执行效果如下截图：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5klEQVR42o3Ry28SURTH8Vm4UWCQ0jLDc4AypQzvQoyUalIXxoWbbmxi48KNK+MrJG7cuDDuXbXaYrBNE+OfZgMKDMwMM3zNDPjYGL3Jybl3cT/5nXsFtdxEyZdRVI1ENo+UXCcSzxBJ/C4pkSUsp7gSkvCtyPjcHpIIRuLIikpOq1OuVsioKoK0eY1QtkYgsUkwpXE5qiKmNHzxPP54nkCywKXVDM07dzn7/IXj3hndT+d0T8/5cNLjfbfH4UmPo4+nvDs8Rgjn6qypDcK5LdY2Guw9eITa3CWqXUcutIiVdvClqtx/1uFfa2aZCFc3qoSyFUSlTFAp0bq9R6p6k2j1FtHaLvHaDfzpGvuvOswsg9HwG7quM9Z1ptMJxnSCZc1wHIevFxcIwfUKYsbFyohKEV+yhKRtI2tt5FKbWHkHf7bOw6PX4MzQx0Msy8SyLAzDwjYNYO4lHAwGCKJS8pIF0y5YYlVtEC22kQotr2LFNoF0ncdv3i7GMqYwt729ObPR9RH2zPTO/X4fQUwvsJ/gSm4LWdv2MLe7b+hXahx0XnqXHGfOfBEI07IZjsdMDTelvQSVv4PS8lP8qSr3njz3ENu2mS9Fw3IYjUZgDv5I+J/g/tMXS9D5Bbojfx9PcKb9JTjgB0Vrr2Zuq8jFAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/55a13b8bbf129285a281dd961d0ab70c/fcda8/1668349904996-b0f1acef-ebb8-4d16-aad0-9dac63a6dd57.png\"\n        srcset=\"/static/55a13b8bbf129285a281dd961d0ab70c/12f09/1668349904996-b0f1acef-ebb8-4d16-aad0-9dac63a6dd57.png 148w,\n/static/55a13b8bbf129285a281dd961d0ab70c/e4a3f/1668349904996-b0f1acef-ebb8-4d16-aad0-9dac63a6dd57.png 295w,\n/static/55a13b8bbf129285a281dd961d0ab70c/fcda8/1668349904996-b0f1acef-ebb8-4d16-aad0-9dac63a6dd57.png 590w,\n/static/55a13b8bbf129285a281dd961d0ab70c/efc66/1668349904996-b0f1acef-ebb8-4d16-aad0-9dac63a6dd57.png 885w,\n/static/55a13b8bbf129285a281dd961d0ab70c/c83ae/1668349904996-b0f1acef-ebb8-4d16-aad0-9dac63a6dd57.png 1180w,\n/static/55a13b8bbf129285a281dd961d0ab70c/d185f/1668349904996-b0f1acef-ebb8-4d16-aad0-9dac63a6dd57.png 2686w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=Qvrso></a></p>\n<h1>在万能 BFF 中联邦 uni-orders 的步骤</h1>\n<p><a name=a3DnH></a></p>\n<h2>在 uni-orders 中增加 GraphQL 接口</h2>\n<p>本来，uni-orders 是以 restful 和 gRPC 同时对外提供服务，其采用的是 nestjs 框架。其 swagger 如下图所示：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8bf6d81c9fd6529f814ff173f4104416/5bd27/1668350148656-2f85a736-da59-48bf-8287-d815d96e123c.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAADMklEQVR42pXU+09bdRjH8fOveFl0vSyuPW1h7RZ6AZReDuwH2Ri0IzHR4GVOSAzrykWYTv8CI8liDE4oGxsMhWk02abRZZmX34wbxW30ToEW6L17G06BweyY/vDK8+Q53/PJk5NvjuBwNrHO6WrCYq2jwe7C6WrEbndhd0g4nBIuqYkGuxOrrR6brR6rtQ6LpVY+L/fWWqqqTeirjAjBeJJAOLVlNpTcEgiVZ3eDSe4Et822k99JMRdOcT+aREjnSgxdX6ZjOELXWIxO/04nR6MMTiX46JsE7/ljss6NutmfGIlx5kqEuXASYWk1x4PFPIF4ntlolrvRzL/8Hc9yb6Hys02BWIboUhphJZ1jPhQhGAqRyWYolYoUi4VHSgUKxbLiU+QKhfKGidUiq3nIliBPWW6bSrNK1s8I4cQq/svT+Mev4J/4mvP+Cc6PXpbrV+vGHnNhgpGLk4xcqEy4F1rAIbmosuow2HRoTC+xf4Nap0KtVaIWlag0CtSiCuV+BXv2PM9zzz5TkRBJrHBueIyh4S/xT01x6eoM41dnuPTtDP7JqfJG45OMXJyQjcr9kwnzsWUGPvyEzq736T7Vg/d0H6e8PXR3+/Ce7sXX24/X14vX10dP3wDvnuyi4613ePPtExUJ0cU1vrt2k8npH5j+/gY/3fqDGzd/48eKfuf6L79y7efbTyQspLLceZBgce0h8wtrRJayrJUgldsmvyEHK/ndCfFkhr/ux4kncwSCi/w5F2F2PkFkKUN0Ofu/CYmVHOGlLOmH8OnQ5/KPoflICy2tblrbPI+4j9PmPi7X3WwEZuSL2dM/iMVcg81cg8GkRTSJ6A6KGMx61PtU7H3hRRSKvbvaCswCH5w5iyRJtLs9NDkdvOy0Y645hNFUjb7agKHagE6vQxRFRJ2uoh2B/YNncTodeNweXqmzYak/hNFixGg1csB8AJPFJAdqNBq0Wm1Fj234MY2ShNvt4XCzi0apFp2oQ6sVy1tt1l3s+Ia+vgGsVguHJQe1DTVUH9SzT6VCoVCgVCpQKp5ODly/e+kSfHbuC5qPHOX1Nzpob3+NtmOttLQc49Xmo/L8v/gHDhRn7xyS+JsAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/8bf6d81c9fd6529f814ff173f4104416/fcda8/1668350148656-2f85a736-da59-48bf-8287-d815d96e123c.png\"\n        srcset=\"/static/8bf6d81c9fd6529f814ff173f4104416/12f09/1668350148656-2f85a736-da59-48bf-8287-d815d96e123c.png 148w,\n/static/8bf6d81c9fd6529f814ff173f4104416/e4a3f/1668350148656-2f85a736-da59-48bf-8287-d815d96e123c.png 295w,\n/static/8bf6d81c9fd6529f814ff173f4104416/fcda8/1668350148656-2f85a736-da59-48bf-8287-d815d96e123c.png 590w,\n/static/8bf6d81c9fd6529f814ff173f4104416/efc66/1668350148656-2f85a736-da59-48bf-8287-d815d96e123c.png 885w,\n/static/8bf6d81c9fd6529f814ff173f4104416/c83ae/1668350148656-2f85a736-da59-48bf-8287-d815d96e123c.png 1180w,\n/static/8bf6d81c9fd6529f814ff173f4104416/5bd27/1668350148656-2f85a736-da59-48bf-8287-d815d96e123c.png 1432w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>现在想将它联邦进入万能 BFF，首先得给它再增加一个以 GraphQL 对外提供接口的能力。由于采用了 nestjs 框架，因此很容易实现。\n<a name=DYR5M></a></p>\n<h3>code first</h3>\n<p>NestJs 提供了两种开发 GraphQL 服务的方式，code first 和 schema first。这里选型了 code first 方式，因为一再提到希望减少编码量，code first 实在是太香了。首先，restful 在接入 swagger 时，已经定义了一套 Schema，通过 code first，只需要使用 GraphQL 注解，即可完美重用已经定义好的 Schema。</p>\n<p>提交 <a href=\"https://github.com/Jeff-Tian/uni-orders/commit/f461503cfa4ee35c86deca562339b98fb363aca7\">https://github.com/Jeff-Tian/uni-orders/commit/f461503cfa4ee35c86deca562339b98fb363aca7</a> 展示了这种改动是多么轻松：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACrUlEQVR42lWTa2/bNhSG/T+cOLbuPBRFiRIlWU6iOU6cdk3gNcOarVmDdViBdgP2bb//GawWGfbhBQ94yIfnxpnzG8pmje8vqJo1uW0oqpaibLCupag8uqjRhSO39eRX2hLGQphowkReFKWaWWoapOzJ3YCuepRtyd2G3O8wzRV5fUmgHKE0BJn7KvFE2k92qByBql80S/NmgiR5zSoxBKkhzAoSZTh59Yxf3zC0A932Na0f6C/29DcPVJs9sXaspCJQlvCbZqYeaIarybmMDbGyKCXE447lz39iXUNee5RrENeQ+DWZ86TNmvT4QGmJ84KVsYTGMssKP6WbmYYgLQjTgiTLWR4+Mn/8m2q8pRsu8LXnN4k4pBGvVMxeEjaSsZWMVmsqnaN0wSwWh6k3EzDSjjBSBP0181//Ifj+EVM19OM19TBSupZrER6yiHcSca8T3ks42Y8Ssxb5CnTrLUWzIc3rqX6nD19Y3H9ErCUrG6r1iLielXHskpjLNCGUgivJ+F2t2KsUrzRWcmaRqr51tyOKhNPvHjh5+4XEVmT1QN4fo7sk77fobkfSbYnakYOkPGUBTypES86JlKzE/hdh5c9J/Zb54TOJcWTGIK5GVR1FP5L7c5LCo+uB1Dg2SvGLCrlTCZEUL5rFqkSOB3XF4v4Ti/EHItezHA+c/vQXyfVbmv4cVR7n7jhSOXNleaMSHlXIqDIWYifYsQyzsN0Rnt9xZjpOuz3z/RMntx84e/2e5OKGzPXY7gJVNgTKTJei46oKflQRpdIsxU77E/Bk+4757TOLzRuCSLGSmjN/Rbi94+zhD+L7Z/wwIsdU3Yas6pHNNV3V8CFbsZDyJboJuDQdy6JnpSqC409JDGEkUw2Vc6RVi25H0mpNVnVT1wNtETFYlbPU9n/AfwFbiZjT0lbQUgAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/48bf5a8f37e3244db8d3da39c035318d/fcda8/1668350582704-80cfc02a-4dbb-4dee-b16f-d434ddcb4772.png\"\n        srcset=\"/static/48bf5a8f37e3244db8d3da39c035318d/12f09/1668350582704-80cfc02a-4dbb-4dee-b16f-d434ddcb4772.png 148w,\n/static/48bf5a8f37e3244db8d3da39c035318d/e4a3f/1668350582704-80cfc02a-4dbb-4dee-b16f-d434ddcb4772.png 295w,\n/static/48bf5a8f37e3244db8d3da39c035318d/fcda8/1668350582704-80cfc02a-4dbb-4dee-b16f-d434ddcb4772.png 590w,\n/static/48bf5a8f37e3244db8d3da39c035318d/efc66/1668350582704-80cfc02a-4dbb-4dee-b16f-d434ddcb4772.png 885w,\n/static/48bf5a8f37e3244db8d3da39c035318d/c83ae/1668350582704-80cfc02a-4dbb-4dee-b16f-d434ddcb4772.png 1180w,\n/static/48bf5a8f37e3244db8d3da39c035318d/9e7e4/1668350582704-80cfc02a-4dbb-4dee-b16f-d434ddcb4772.png 2056w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a name=l9tku></a></p>\n<h3>在原有 OrderModules 中添加 OrdersResolver</h3>\n<p>原有 OrdersService 完全不用动，完美从 OrdersController 复用到新的 OrdersResolver 中：\ntypescript\nimport { Args, Int, Query, Resolver } from @nestjs/graphql;\nimport { Order } from ../db/entities/orders.entity;\nimport { OrdersService } from ./orders.service;</p>\n<p>@Resolver((of) => Order)\nexport class OrdersResolver {\nconstructor(private readonly ordersService: OrdersService) {}</p>\n<p>@Query((returns) => Order)\nasync order(@Args(id, { nullable: false, type: () => Int }) id: number) {\nreturn this.ordersService.getById(id);\n}\n}</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.48648648648649%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACG0lEQVR42m2T2XLbOBBF+SljcQVA7ARJSaREy54kKk+Vk5r//5aTIuzIL3k41VgKF42+jcLGmWFasWFCu5Sj8RMuHjFhQmqP1OEDExG9p2r7v9IISyHdjPJHhBnpzIhyM0JHlEvse6VKlMJTC8c/tco8Nf2DQ0Zn9nnRmUQlHE+Npmw1pXA04ZXav1CbI33aEGGl82uOMlzyeI9t2KjNmYNMDwo/XT/VDa3Q+Vnq+B/6/IaMV9SwPZDDFeF38SWLfrE8KJo+PjI87HVQEbv+wj3/xJ/+JS4/GNZ7juH8DTu/oscbZnrBTLd8kQiXfPlOYdOCdBOHzlJ1mkZ5Gn+jtjeiPeHSlbD8wJ2/48KCSc/Y6zvu+k7YfqLSjUpNHMSQKXax3ZBahlzDRhmaZDkPhl9O85Y8b6eZ+5S4e8236Pl+Xrgfj7iYaONI5yOl6ql6TRGPG8pNlH8ylI7GLwi3Z3fBjRvG74fPGD/j0oLoI41w2cBSeioZqFTM5AzbPlJ2jrLtqVVEHP+nnd4p/UZ/fkOf7rTDC83wghhutOGZxl/pPmnc+oFdP1wO88aHOZrOWGrrkT6QpGKdLtxOK8/jzDhtiHFDpCv9dMHPC2Y8IXyilIaD0BSNCtnhp9Z8mmJpY0Snkdk6Zhc4DSOj8zilKZWlVOZBpSxV/7VWZLFHp++tY2hkpJYRoROyj3RmQvgTjU7U+dd8UX3yZ/4baA52gSLNso0AAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/17ceedb71603d2c8e82fc61af3c6211f/fcda8/1668350771816-b4aa31b8-d21a-4960-ab96-13dffe8d5e42.png\"\n        srcset=\"/static/17ceedb71603d2c8e82fc61af3c6211f/12f09/1668350771816-b4aa31b8-d21a-4960-ab96-13dffe8d5e42.png 148w,\n/static/17ceedb71603d2c8e82fc61af3c6211f/e4a3f/1668350771816-b4aa31b8-d21a-4960-ab96-13dffe8d5e42.png 295w,\n/static/17ceedb71603d2c8e82fc61af3c6211f/fcda8/1668350771816-b4aa31b8-d21a-4960-ab96-13dffe8d5e42.png 590w,\n/static/17ceedb71603d2c8e82fc61af3c6211f/efc66/1668350771816-b4aa31b8-d21a-4960-ab96-13dffe8d5e42.png 885w,\n/static/17ceedb71603d2c8e82fc61af3c6211f/c83ae/1668350771816-b4aa31b8-d21a-4960-ab96-13dffe8d5e42.png 1180w,\n/static/17ceedb71603d2c8e82fc61af3c6211f/6e52c/1668350771816-b4aa31b8-d21a-4960-ab96-13dffe8d5e42.png 1948w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=GFgHe></a></p>\n<h3>选型 MercuriusDriver</h3>\n<p>最终要在 AppModule 中导入 GraphQLModule，让应用对外提供 GraphQL 服务。由于 uni-orders 没有使用 express 服务器，而是使用了 Fastify，从而在 GraphQL 的 Driver 选型上，没有采用 Apollo Driver，而是使用了 MercuriusDriver。通过引用它，uni-orders 项目就可以成功地对外暴露 GraphQL 接口了。</p>\n<p>但是，考虑到要将 uni-orders 的 GraphQL 服务联邦至万能 BFF，因此它需要以一个子图的形式运行，这时需要使用 MercuriusDriver 对应的 MercuriusFederationDriver：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.10810810810811%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACOElEQVR42m2Ry27bSBBF9SF5WDYlspv9JJvdfOvtWHLGGMDIIlllO///AWcgxwkMOIuDuquDW1ULH3p86AhpRLuI8RFta6yPlKZGKo/Ub1DuNVeUpkLZmlwalKlp+w2LXAeETUjX8pJdSxH2iLAjVw1rnchtx6psWKnIyo1kOpHJwOfc82ntuCmql/xxZVmoqkOYhuVas1wrMmFwbsCqmsE19O2GbjzSxomUtoT5guvv8dNXqnrEXgvkGlEYhHAsqm6LjROFaViXHmkq+suWzT8T2/3MeNzRH3e0+w11H9klS9rvWX3/j+LfH6j7C+U8U04TOtUsrqJCBzLhyISluN5sblGbhrrvSLsD6fSFaprwXcu3YHjSK45yyVgbVF1RxIRoGnJnWXzKytd1X8ktRfNIXt2jwxbhJ1a6Za1a1nbgs5vJzIA1HbOuaaWnFZ5eOIRsWCzXhtv8F1fhbWER4UTuNgg/EuczutlyV0byMiKvzykbPpaRZdkQpWMUhpWoWcrA4o/oz7Sc+4nHpmYMiYfDA8/HB77tTzwOA6dhZI4tT7rkh8o565JGO6J2JG2vDfW7hn43EQ4DOrWE44XhfGG6fKG97DjvIj87zSUYROXJKk/xhsVv2Vth0USK2lP4gExbijhzYxvGouA5vyEvJB+k4VZqMqm5e8NfhSKdyesDuZtZVxtENSPqDWU1kdUbMjuQqcidSu94L8wNqn/CH56x8wO2P6PSibI5UMYjKh5fsgx7ZDi8439XEnq8mdMriwAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/35065a9ee5b6f13559c35836cc7aba62/fcda8/1668351174357-0f19bef8-9f94-4875-a616-f4eaf95454a5.png\"\n        srcset=\"/static/35065a9ee5b6f13559c35836cc7aba62/12f09/1668351174357-0f19bef8-9f94-4875-a616-f4eaf95454a5.png 148w,\n/static/35065a9ee5b6f13559c35836cc7aba62/e4a3f/1668351174357-0f19bef8-9f94-4875-a616-f4eaf95454a5.png 295w,\n/static/35065a9ee5b6f13559c35836cc7aba62/fcda8/1668351174357-0f19bef8-9f94-4875-a616-f4eaf95454a5.png 590w,\n/static/35065a9ee5b6f13559c35836cc7aba62/efc66/1668351174357-0f19bef8-9f94-4875-a616-f4eaf95454a5.png 885w,\n/static/35065a9ee5b6f13559c35836cc7aba62/c83ae/1668351174357-0f19bef8-9f94-4875-a616-f4eaf95454a5.png 1180w,\n/static/35065a9ee5b6f13559c35836cc7aba62/6c9f4/1668351174357-0f19bef8-9f94-4875-a616-f4eaf95454a5.png 2326w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=Z7dKt></a></p>\n<h3>创建订单的 Mutation</h3>\n<p>以上的 OrdersResolver，只放了一个订单查询的 Query。正如通常的 HTTP 接口，GET 请求也可以对服务器的数据做修改，但是 restful 规范建议 GET 请求只做数据的读取，对于数据修改操作，放在非 GET 请求中。GraphQL 的 Query 也可以对服务器的数据做修改，但是不建议这样做，而是将数据修改放在 Mutation 中。于是可以将创建订单的操作做为 mutation 放在 OrdersResolver 中（详见另一个 commit）。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d5f2bead54fcc7e735fd9cd46c8af586/8963a/1668351511779-bc7f1844-a6e6-405f-a887-0a9871c0e4c1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACr0lEQVR42m3SyYrkVhCF4XwQg6sqBynvPOlqlnKsEVP2wtgb+/3f4jepTtMNXYuPIEA6BHFjFaqOmHvqdsK4CuPzNy5jfY1QAWUi2iZ2JlHeCMt6K1hv5b1+txKuQYUWFTr2Ni9Vp5bQDbi6Z6s9G+V4KjVtURL2kkfheJCejXSLtXQ83ftVoRM7GdnsHY87zeNWs5GGwmsKZ+kPB8bzCVd3/Bs0/+gtn3LDUZYoqSilwkhJkoJCKla+nnnYyCXsqTA87RQb3VHmTzb+ivATJl8Q8cgvbqYSkT/3kk9heBeGN2FoZWSQESFrVib1KN8iXL1MuS0lhWkx3Qe2eUbGCZkmVJoxdyIM7MOAvCvDyDZMS125PKFjx95kngrLbq/ZCYe0CZdrXB4I9fRNMy299A3C5W9sRrrvlh3epjSx56l0lEIi/Eic/yacfsf1F0L3im+fsfUFmy/odESGGRmPd/O9P7Ba9vaDh63Chpbz+Z1puHJuRobxTD+eGU9XxpcP+vHCOL8wzK/0p9/I/YWUJ5zPrJaXvbsF3upWWcrKoWKii4nYDeTpSOp6qvFAPL2Rzu/Y/kDhAjsb2BrHRpmfJ7wFbqSl8JbSe6yv0DGjqw4VMoU07GyiuB26TcuJrfeKtdCLLwJvZ9Ozb/6gSK+EfCbWF/xtj/0bhZ/Z2IGdHZbzWi/6xe2/rwNFReGPywdCJmKYsO0VUV3Q+Urbv6PSAWU7CtMgTIOxLaVuvgjcagrvMacKM2VklRApIKpImRIyRSqvme2eoym5moKLLemcRHnD6mGn+d9tf7+uFWUTyX9NVJ8z1aFj+nhl+HjHHUf2h5GhC5w6hxozcarRXaRoPGUbWBXS86Pd3qHqiupjoHqZCH3DdDnTPL/gjxf84cR0PNLOA7pvcEOHbjOqTov/ALdb2Qud4qLCAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/d5f2bead54fcc7e735fd9cd46c8af586/fcda8/1668351511779-bc7f1844-a6e6-405f-a887-0a9871c0e4c1.png\"\n        srcset=\"/static/d5f2bead54fcc7e735fd9cd46c8af586/12f09/1668351511779-bc7f1844-a6e6-405f-a887-0a9871c0e4c1.png 148w,\n/static/d5f2bead54fcc7e735fd9cd46c8af586/e4a3f/1668351511779-bc7f1844-a6e6-405f-a887-0a9871c0e4c1.png 295w,\n/static/d5f2bead54fcc7e735fd9cd46c8af586/fcda8/1668351511779-bc7f1844-a6e6-405f-a887-0a9871c0e4c1.png 590w,\n/static/d5f2bead54fcc7e735fd9cd46c8af586/efc66/1668351511779-bc7f1844-a6e6-405f-a887-0a9871c0e4c1.png 885w,\n/static/d5f2bead54fcc7e735fd9cd46c8af586/c83ae/1668351511779-bc7f1844-a6e6-405f-a887-0a9871c0e4c1.png 1180w,\n/static/d5f2bead54fcc7e735fd9cd46c8af586/8963a/1668351511779-bc7f1844-a6e6-405f-a887-0a9871c0e4c1.png 1918w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=PfVKK></a></p>\n<h3>最终效果</h3>\n<p>uni-orders 有 GraphQL 服务了：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d03b4c5f55ac74e78528be488d3de6e9/799f3/1668351632341-62c5b85a-728e-416a-ad86-dbd3bde17278.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAACjElEQVR42oVU2W7bMBD0lyS+dFAHKZuUZMnWZfmumxRBC7RpC+Rv+mP9ryl2bat20cAPgyVFcXZml9jeLC+hJjGiSYx0NodJMsRJjiTNEac5gkjD9SRGlouRJe6i58gStizhqgoiquGoCm5UdftZskM4XcKNaohJcxc9KyzhRktQHAUFxkGJcVBgGBRwgxK/f/zCz+Y7xrqFMmuE8QZhvD1jcxVP6NmygjdtQVFMlvD1Cm7UIDBr/pYnByi9hsoOEOUz/GyP0Kz5nOBfrQm9C5E3XXEGRzUc6ZBU9/05bFVDJlsEzWeY/Rt0+QKV7KDSLaJ0C5VsuzudQkfVrIgui0nLScg6fSPFbEmvYdpXJLs3yOyIqj7i4/EFy9UTAkOW11TDE6ElKzzYKWxZwyXrpFBWGPkFJyNCKodpv0G3XxEuDvCLPWSyOau7qiH9SGrILqmhPYEI+27GKulnsq3yI6L5M8LZDl61R3C2emOZ2O2owTgsWQ3ZJWKq4UDkTEh1UukOoVkh0CtujNRrjmS1s8xNiZbw/RIjkWPgZug7GSt7dFKOlCRI9xBmAxFvb+BRKai+1GWyTLbCSYu5PkDFB/RVjaEsWO2jnZwsqxqFadDoCrWusdQVWl1hdd6npu1Ie5fuDlQD2bxClF8wIMKguCGsTIODLnDUC+x0wWuKsWkxpTJcCO0z4VDkELMnWLJh2wMx7wgpqU/2zIYtXsP/1/JJYY2hv4BIj7CiFTdi6N0ShudL7+GvQlnDiRqMvDn6zqwj+x9hcIeM3yEPAi/HgxUz2QVEeFlfE94DP5u4/ARTPPPDnmQf+E1dk1Kdw+R2qryHnh0WPPcItix4FjqqhBUuQGcUae/xvKvv4g/ky0V0RwRpSgAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/d03b4c5f55ac74e78528be488d3de6e9/fcda8/1668351632341-62c5b85a-728e-416a-ad86-dbd3bde17278.png\"\n        srcset=\"/static/d03b4c5f55ac74e78528be488d3de6e9/12f09/1668351632341-62c5b85a-728e-416a-ad86-dbd3bde17278.png 148w,\n/static/d03b4c5f55ac74e78528be488d3de6e9/e4a3f/1668351632341-62c5b85a-728e-416a-ad86-dbd3bde17278.png 295w,\n/static/d03b4c5f55ac74e78528be488d3de6e9/fcda8/1668351632341-62c5b85a-728e-416a-ad86-dbd3bde17278.png 590w,\n/static/d03b4c5f55ac74e78528be488d3de6e9/efc66/1668351632341-62c5b85a-728e-416a-ad86-dbd3bde17278.png 885w,\n/static/d03b4c5f55ac74e78528be488d3de6e9/c83ae/1668351632341-62c5b85a-728e-416a-ad86-dbd3bde17278.png 1180w,\n/static/d03b4c5f55ac74e78528be488d3de6e9/799f3/1668351632341-62c5b85a-728e-416a-ad86-dbd3bde17278.png 1642w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=JKx56></a></p>\n<h3>自动发布至 Apollo Studio</h3>\n<p>由于万能 BFF 的 GraphQL 已经发布在了 Apollo Studio，因此想将新的 uni-orders 的 GraphQL 服务也发布在这里，方便统一查看和管理。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a5f66fec8cb20db722df5ad3af31de63/ad00e/1668351863313-584de1f5-3f8a-4582-940d-0d4f9771052a.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAADaUlEQVR42n1UW28VVRg9/0Fjghov9CBaRC1CLxZbStMWiJdEgyGSFI0XEt94MOGF/wDxxfhs4gtPxEd/ADEkPlkMTHtqMRxOT+e+7zOzl/m+mTk9xcSdrNmX7P3N+r619u5Mzy5iZm4R782fRffoW5ieeR9z82ewuLSK0wvLPD5xcg5vT01j6t1ZvHNiBkeOHkf3tWPoHjnW9JM43H0DLx+eRGdq9hOcOn0R3TfX8PkX32NicgWvvL6MZ16YHeHZF+f+g+demsfzE0s49OoCDk2cxcTxCzh5ahWdi5ev4bPL1/DBp9/h+o2bOPfRt1j78Bssrl7Zx8r62HwdCyvrOLN2BcsXvsbSuS+xdP4rnP/4Ki5duoqO1gYEqRTCMILWGsZYXqOeYK1Du89aC+vG5w7G0HmNXCh00LQ0zfHnxkMkacbzvTBCFCXIhYD3HnGSIoxi/gHNaUygJqREmmaoqhIdpS0fDnqP8fsf2wh6fWhrIYm1NlAEY0H7eKztCFKZA+tCanRyqTEYhoxhGOLJ7hBprpCJg+A1qZErg0waZMogp17qep1h6oCuKBnGFfA42CoP+GaxKAo4reGMhdMGzjo+V5QlrCs4aCcVijf/dudX/PLzbeR5hgcPHqLX20YQbKLf7yMIAgRbPajhAHj8N9B/VMOapv4ZCyWUQScTmln1t3fQC3ooywJJkiDLMsRxDCEEojhGFMVwznEAX1UsDI+9R9GwzNsaEt222cKjfDrv8RJUHmUTkH5AfckpNwwpIEWPMo2dQYZ/hgKPBhkUK6gZVVURF+6dKxhsnTDinyRJyvaS2u6LwgV3DlVZoCjc6CAZt2oYKamQ54LNTax040ljLVxR1AzpI5QepaSM4xLUKGGsq31Gt6UCdFFBuxLK1QHJf+0ermHWqHz33gbu3rsP7ysIISGlZDZcJ0pYCvidTfhwCB/uwu8NmB0zNGMMW9vc+vE2fvjpDvI8xeZmD1tbPWzc/wvD4V6tZuGALAG0AowGtBwpnWY5l2YkCtXw/5qvPLOsnkJrm1b9kW2Ibq5L7KYWT2KDQWLYW1T4VpBx39F+avQy0ZxKlFOZWpXJNiRGnEm+s3EqmyetfsraRiIIoTi9NhC/NkJCG7OfsjZu5Pa2r+93rXZrId28kxSQ1knd1lo0ppT/BflljGc7qk0YAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/a5f66fec8cb20db722df5ad3af31de63/fcda8/1668351863313-584de1f5-3f8a-4582-940d-0d4f9771052a.png\"\n        srcset=\"/static/a5f66fec8cb20db722df5ad3af31de63/12f09/1668351863313-584de1f5-3f8a-4582-940d-0d4f9771052a.png 148w,\n/static/a5f66fec8cb20db722df5ad3af31de63/e4a3f/1668351863313-584de1f5-3f8a-4582-940d-0d4f9771052a.png 295w,\n/static/a5f66fec8cb20db722df5ad3af31de63/fcda8/1668351863313-584de1f5-3f8a-4582-940d-0d4f9771052a.png 590w,\n/static/a5f66fec8cb20db722df5ad3af31de63/efc66/1668351863313-584de1f5-3f8a-4582-940d-0d4f9771052a.png 885w,\n/static/a5f66fec8cb20db722df5ad3af31de63/c83ae/1668351863313-584de1f5-3f8a-4582-940d-0d4f9771052a.png 1180w,\n/static/a5f66fec8cb20db722df5ad3af31de63/ad00e/1668351863313-584de1f5-3f8a-4582-940d-0d4f9771052a.png 1366w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>于是在已有的 uni-orders GitHub Actions 中增加了一个 workflow，每当代码提交后自动同步最新的 GraphQL 元信息到 Apollo Studio。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ba50a13f14562585c7aefb9b2e8bff0b/10ab7/1668351952845-4a0e98e8-4b3f-4b8e-976d-1bebc75046a9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.54054054054055%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2UlEQVR42n1T6W7yMBDMY1QtbSGHj8RXbEISAgUBqirR93+d+eRNaIOovh+jPViP1zMhyaUFd3uwcAH3R7Bwhui+wW0PVtZYMU1YFuouzhF7t36SCgOu1uAqgFUBpetQVAHSbqDqHkXlwXUz9T0q19Es12sCqzzNlralPMm4RSFrKoqyRi4d3ZQJSwQZNzDao3Yb2jhePs5O89QL1I91wpyHP3zAt0fYZg8dBijfQ/stRVV3kKZBLuzDU/9CkikNt9+h3X2iGc7YX77RfXxid75id7qiP37RRdm0eTodTHmEwSqCjXlEwk1PuuiwpfVvP674ePAtK0nwVFiSgSDdSMAUxdj7IWS6JcKb2NEYAuUeKbcQKmDdj5KY9Q7Kb2me2QErMWrouyOdSwrtIH1DRTTkr88imlFGR1WAMA2ZJWJtemQymuPGCyJhrkbC2IhPvq0+x7LQtGnMX1NJMsT4mgrKf+sSSS5rVK4ny9/z6oHspmndHiDNBi9L/l8kUWDfH9EMJ9Li17HJTWHxlpZ4WuR4WmR4fiumwwzP74zyxUr8IIkORe3y2Uf9sKG02JwvGE5XdIcvuPZACNszhNkQ8YzQ3Bkwf+Y8qqaHjg6Hgf6GEVUdTanvCP8BLpSGYN42YmAAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/ba50a13f14562585c7aefb9b2e8bff0b/fcda8/1668351952845-4a0e98e8-4b3f-4b8e-976d-1bebc75046a9.png\"\n        srcset=\"/static/ba50a13f14562585c7aefb9b2e8bff0b/12f09/1668351952845-4a0e98e8-4b3f-4b8e-976d-1bebc75046a9.png 148w,\n/static/ba50a13f14562585c7aefb9b2e8bff0b/e4a3f/1668351952845-4a0e98e8-4b3f-4b8e-976d-1bebc75046a9.png 295w,\n/static/ba50a13f14562585c7aefb9b2e8bff0b/fcda8/1668351952845-4a0e98e8-4b3f-4b8e-976d-1bebc75046a9.png 590w,\n/static/ba50a13f14562585c7aefb9b2e8bff0b/efc66/1668351952845-4a0e98e8-4b3f-4b8e-976d-1bebc75046a9.png 885w,\n/static/ba50a13f14562585c7aefb9b2e8bff0b/c83ae/1668351952845-4a0e98e8-4b3f-4b8e-976d-1bebc75046a9.png 1180w,\n/static/ba50a13f14562585c7aefb9b2e8bff0b/10ab7/1668351952845-4a0e98e8-4b3f-4b8e-976d-1bebc75046a9.png 1552w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>这使用了 rover 工具，它依赖一个 apollo key，可以配置在 Secrets 里：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/709f288f2d5b3f605501369e0a627da9/4ca46/1668352136398-a902240d-2d1b-4a9d-93d0-b532f2d35af6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACFElEQVR42pWTW2/UMBSE8zOAFjbNxZfYjhMn8V6hW6kVoEoghEC89AWJ//8TPhTvdimoVPAwOlZ0PJ6Zc5Jt3tzQDWvi+hIfVoS4oxvX6dwNS3yI9OMK102YdkSZHttFtA0YP6LakTEs8X2kFJasanqkHbmQLRfCUUhPIdtUK7s+wK2R7RLTrxK0myiUZ6E61tqwbRx106c7WW0C2sdEdiBsKeaqPCpeoaY9cthjwpYuvqYbd4g2pp4rKVlKzULMYtp0NxN2SI3zy6XyR+KWUnv00FN7R6ENi7IhLxuel4am1rwTNa1oeCmOAo6CkkI3bBOS9aTSUTUBE/ZUzYQwkcpGXtklG9Nz21iUGclNpDYT5QNks/fZ8kx2yO7wYq56Vk3HeykYpGUhPW+l5EbKdM6lpzxmfbo3W56Jwmp/slvcD0f3KDNQCIuRlk+iYiMU58InB/cW/0QmTMCGzYno4qiw0j1nTWSqFV9FkfI6m7MV9lGiE6FqJ+LuGj/t0odSOnLhOFc9t87zxSpqFx/N6zEkwn55yVwr6Xg5759wfJMFn6895uMOuRkp6jat0iGzvyOrm4AwA3nV8Ex4gmz4LnI2UvNCd1TaU6j2SZu/WZZ2wI876rDlg/f80AVaWM6Ep3zQ+HCSTyFTbqLbXnPnLXeqTCsxozr9iu2vyf8Loe42+GlLtJ7CBGo7oOxApbv/UnZP+BNR06WoamwLjgAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/709f288f2d5b3f605501369e0a627da9/fcda8/1668352136398-a902240d-2d1b-4a9d-93d0-b532f2d35af6.png\"\n        srcset=\"/static/709f288f2d5b3f605501369e0a627da9/12f09/1668352136398-a902240d-2d1b-4a9d-93d0-b532f2d35af6.png 148w,\n/static/709f288f2d5b3f605501369e0a627da9/e4a3f/1668352136398-a902240d-2d1b-4a9d-93d0-b532f2d35af6.png 295w,\n/static/709f288f2d5b3f605501369e0a627da9/fcda8/1668352136398-a902240d-2d1b-4a9d-93d0-b532f2d35af6.png 590w,\n/static/709f288f2d5b3f605501369e0a627da9/efc66/1668352136398-a902240d-2d1b-4a9d-93d0-b532f2d35af6.png 885w,\n/static/709f288f2d5b3f605501369e0a627da9/c83ae/1668352136398-a902240d-2d1b-4a9d-93d0-b532f2d35af6.png 1180w,\n/static/709f288f2d5b3f605501369e0a627da9/4ca46/1668352136398-a902240d-2d1b-4a9d-93d0-b532f2d35af6.png 1944w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=KG5iS></a></p>\n<h2>在万能 BFF 中联邦 uni-orders Sub Graph</h2>\n<p>万能 BFF 即 serverless-space 库，它的主要服务也是使用 NestJs 开发，将以 Serverless 形式部署在 AWS 上。和 uni-orders 除了有 serverless 这个区别外，其 web 服务也不一样，采用的是常见的 express；对应的 GraphQL Driver 是 Apollo，而不是 mercurius。但是 Apollo GraphQL 主图联邦 Mercurius GraphQL 子图，一点问题也没有，非常丝滑，详见 <a href=\"https://github.com/Jeff-Tian/serverless-space/commit/ac3510b0b2a7ffcba78bc5e571b11462d7ec5760\">https://github.com/Jeff-Tian/serverless-space/commit/ac3510b0b2a7ffcba78bc5e571b11462d7ec5760</a> 这个提交：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.35135135135135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB20lEQVR42kWS2W7bMBBF9SdNbG0kRVIiqX1J6thOiqJFgAJ9aP7/O04h1nEfDu7gznBAXDKxfqIOE75fMW7E+hEbZqqmJ5eWXNZ3ClVTyBuqIStN9Pczp8t3lm0jyZWn0IGjqDkUhqxqUdM7sr1Q1AtFs5HZhczMkdQspHaJuvv57unp5s0kqhlo+if2xYdcUdqBanjDjlfM9C2i+guyO6O6M3X3gr2xe3l3oeyucUb1V5JMurhQ1j2HvEKaQC48edncKYQjFw4hGoKweGGpRU0nLIvQ1KUhK/Z4AknlJrSbOJSWQ6ExbmAdV9ZhZh3/s41L1GVa2caN+dZ/Hzr+eMPcdrS+J1Fuxo3P8Ya5bChMS1p5siqQ6Y5Mt1HTavfDneymj7rly+ec6UmEDvF1y8qTFppSe8z8Ez+94qYrYXmjGc+Y4YwKz5Gq/Yr0T3eU36IKt5Ko0qCLiipXpHlFKh1Fc+JoZh5Ux9GfEHvodkTWM6pZKKqeTLUcRSCVLakMpLH2JI+5Zmf/Mg+5JkjNx1DzO9T80pKPquDar8zLC+v4zPPTG9vTKy+XHwzDxjqfYq9vAk5bkn3RJ/viVFisGwh+xSvLoCxS1Rz3SJSL+d4z3nNUe/2vd5QNfwHcwDseCsBJOQAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/ce1cfe891992bc215090f6e653533deb/fcda8/1668352697296-9c522fbe-9a18-4f55-b710-bd2767209c51.png\"\n        srcset=\"/static/ce1cfe891992bc215090f6e653533deb/12f09/1668352697296-9c522fbe-9a18-4f55-b710-bd2767209c51.png 148w,\n/static/ce1cfe891992bc215090f6e653533deb/e4a3f/1668352697296-9c522fbe-9a18-4f55-b710-bd2767209c51.png 295w,\n/static/ce1cfe891992bc215090f6e653533deb/fcda8/1668352697296-9c522fbe-9a18-4f55-b710-bd2767209c51.png 590w,\n/static/ce1cfe891992bc215090f6e653533deb/efc66/1668352697296-9c522fbe-9a18-4f55-b710-bd2767209c51.png 885w,\n/static/ce1cfe891992bc215090f6e653533deb/c83ae/1668352697296-9c522fbe-9a18-4f55-b710-bd2767209c51.png 1180w,\n/static/ce1cfe891992bc215090f6e653533deb/dd13c/1668352697296-9c522fbe-9a18-4f55-b710-bd2767209c51.png 2572w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a name=ppIXb></a></p>\n<h1>最终效果</h1>\n<p>如前面的成果演示，新联邦进来的 GraphQL 工作在 /gateway 路径，与原有 GraphQL 服务并行不悖。</p>\n<p><a name=rchUG></a></p>\n<h1>下一步待做事项</h1>\n<p>哈德韦小程序可以顺利对接 uni-orders 服务了！并且这篇文章的链接可以补充回 <a href=\"https://reveal-js-lac.vercel.app/#/5/2\">https://reveal-js-lac.vercel.app/#/5/2</a> 了，是一个活生生的例子。</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}