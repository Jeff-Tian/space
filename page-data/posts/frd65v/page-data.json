{"componentChunkName":"component---src-templates-post-js","path":"/posts/frd65v/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/frd65v","relativePath":"posts/frd65v","frontmatter":{"title":"在自托管 GitLab 实例中集成 Keycloak 登录","stackbit_url_path":"posts/frd65v","date":"2021-08-31T07:43:49","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a name=xwrvB></a></p>\n<h1>背景</h1>\n<p>在知乎上收到一个付费咨询（<a href=\"https://www.zhihu.com/consult/conversation/1413515497665662976/archive\">https://www.zhihu.com/consult/conversation/1413515497665662976/archive</a>），他已经在自己部署好的 GitLab 实例上集成了 Keycloak 登录，想更进一步，在用户选择 keycloak 登录 GitLab 后，其身份信息也自动带过去。</p>\n<p>这个功能其实正好是 GitLab 近期实现的 SAML Group Sync 功能，不过只对 GitLab 托管的部分客户开放。这位咨询者搭建的是自托管 GtiLab 企业版，目前的版本不支持这个功能。不过，为了重现这位咨询者碰到的实际问题，我也搭建了一个自托管的 GitLab 企业版，进行了 Keycloak 登录集成，过程好挺有趣的，因此记录下来。</p>\n<p><a name=ur2Qz></a></p>\n<h1>效果展示</h1>\n<p>录了一个视频，展示了如何通过薅 GitHub CodeSpace 羊毛的方式启动了一个 GitLab 企业版实例，然后点击 Keycloak 登录，重用了自己开发的关注微信公众号即登录的方式，成功登录 GitLab。</p>\n<p><a href=\"https://www.zhihu.com/zvideo/1416018136143802369\">https://www.zhihu.com/zvideo/1416018136143802369</a></p>\n<p><a name=DS5pb></a></p>\n<h1>步骤详解</h1>\n<p><a name=W35XC></a></p>\n<h2>部署 Keycloak</h2>\n<p>Keycloak 是一个开源的认证授权系统，基于 Java 开发。部署方式有多种，详见《<a href=\"https://zhuanlan.zhihu.com/p/349504145\">基于 keycloak 的关注公众号即登录功能的设计与实现</a>》中 5.1 的介绍。我按照其中介绍的部署到 Heroku 的方式，部署了一个实例：<a href=\"https://keycloak.jiwai.win/\">https://keycloak.jiwai.win/</a>，部署到 Heroku 的优势是简单、免费。</p>\n<p><a name=uGRT0></a></p>\n<h2>部署 GitLab</h2>\n<p>GitLab 官网介绍了多种部署方式，但是对于我的演示目的，各有优劣：</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>SaaS</th>\n<th>部署到云（Google、AWS，Azure）上虚拟服务器上</th>\n<th>部署到云提供的 Kubernetes 集群</th>\n<th>本地部署</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>好处</td>\n<td>最简单</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>能外网访问</p>\n<p>我最想采用的方式 | 能外网访问 | 能外网访问 | 部署简单</p>\n<p>免费 |\n| 坏处 | 要钱！</p>\n<p>没有超级管理员权限 | 要钱！</p>\n<p>配置工作量大 | 要钱！</p>\n<p>配置工作量大 | 配置外网访问复杂</p>\n<p>耗本地机器资源 |</p>\n<p>基于一定要免费的原则，似乎只能本地部署。本地部署最简单的方式就是 docker-compose 启动，但是这样会有个问题，就是现在的浏览器（Chrome、Safari 等）都打不开页面，原因是 GitLab 实例的自签发证书不被信任！要设置信任特别复杂，再加上需要 Keycloak 回调 GitLab 实例，部署在本地有诸多不便。</p>\n<p>但是本地使用 docker-compose 启动 GitLab 实例的方式实在是太香了，有没有办法把本地 docker-compose 部署的方式移植到线上呢？想到这里，我把目光投向了 GitHub 的 CodeSpace，CodeSpace 在我炯炯有神的坚毅的不薅羊毛到底绝不罢休的眼神中瑟瑟发抖。</p>\n<p><a name=JiDmM></a></p>\n<h3>docker-compose</h3>\n<p>首先，我按照官网的知道说明，创建了 docker-compose.yml 文件，并将它提交到了 GitHub 代码仓库：<a href=\"https://github.com/Jeff-Tian/gitlab\">https://github.com/Jeff-Tian/gitlab</a> 。然后打开 GitHub 仓库主页，按下了句点键，GitHub 切换进入了网页编辑器界面：<a href=\"https://github.dev/Jeff-Tian/gitlab\">https://github.dev/Jeff-Tian/gitlab</a>。熟悉的 VsCode 编辑器出现了，就凭这，足以回答知乎上的这个问题了：《<a href=\"https://www.zhihu.com/question/363365943/answer/953401788?utm_source=wechat_session&#x26;utm_medium=social&#x26;utm_oi=60808105033728&#x26;utm_content=group3_Answer&#x26;utm_campaign=shareopn\">Visual Studio Code 可以翻盘成功主要是因为什么？</a>》。</p>\n<p><a name=Vdjle></a></p>\n<h3>VsCode 网页编辑器</h3>\n<p>接着，我打开 Terminal，想运行 docker-compose up -d 以像在本地启动 GitLab 实例一样在网页编辑器中启动 GitLab，看到了 Terminal 不被支持，但是不要慌，点击“继续”按钮就打开了 CodeSpace。（当然，后来知道了可以直接输入 <a href=\"https://github.com/codespaces\">https://github.com/codespaces</a> 打开已经新建过的项目，而不用每次重新创建）</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/18e7c1931b398b781585fa97647d93b1/798d4/1630392461366-a585cad8-ce48-4d3a-8b60-60a056da0321.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3ElEQVR42n2R227TQBRFLUHTxjP2+Dq+x47TpEmb0DRRQbxUAvG3IB6gqFBa4hYVPmshuxcqQDwsrRlptGcfHaO5+k5zdc3Z53PevnvPh4+nnH464+zLOZvmmstNQ9Ncc3Pz844fbJorvl5+4+Jyw0Xn3xhJVpEPRkxmC8KkQNgecVxQVGOycpcoLVFOSJJWJEVNUoxQXoxUwT8x0nxIWU2YLlbs704JwwTLidB5RbWYUe0dMRgvSYf7BGmNdDTKT3CCFCfIHvkWw9U5plRsC5vIspm6ir6j8XROvZwxWa8op88oxgf4cYntJSg/xXKjLrz1Yww/KjCFwhQ2PaF4qX0CP0J6EUk9ZrI6ppofMpqvqaYrhrM15d4SVxeYto90QoS6RaoQQ6dV11BIxRPTZs9zeJNnKF0RBAWum5FnY4JggHIS3DDr2rtB+hft+EaYlF1g27AvbSyheFHnTE8OmJ3MWbw+Yv7qsLvXz8f4OibQKX6Y4Os/CBOMdmumdOgLG1Pa9IWDqTXxIqVa1YyOJ9TrXbLlgGiWdJ9u9yU7psWOKe+wHmwE8aBr2Aa2CMtFWh69p4KtDrOjtyXZ7snbaf6D0W7qcaBpuQjld21NSyEs1fmBu7f3Affne/8CzGshLe3NBCoAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/18e7c1931b398b781585fa97647d93b1/fcda8/1630392461366-a585cad8-ce48-4d3a-8b60-60a056da0321.png\"\n        srcset=\"/static/18e7c1931b398b781585fa97647d93b1/12f09/1630392461366-a585cad8-ce48-4d3a-8b60-60a056da0321.png 148w,\n/static/18e7c1931b398b781585fa97647d93b1/e4a3f/1630392461366-a585cad8-ce48-4d3a-8b60-60a056da0321.png 295w,\n/static/18e7c1931b398b781585fa97647d93b1/fcda8/1630392461366-a585cad8-ce48-4d3a-8b60-60a056da0321.png 590w,\n/static/18e7c1931b398b781585fa97647d93b1/efc66/1630392461366-a585cad8-ce48-4d3a-8b60-60a056da0321.png 885w,\n/static/18e7c1931b398b781585fa97647d93b1/798d4/1630392461366-a585cad8-ce48-4d3a-8b60-60a056da0321.png 976w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>点击“继续”按钮后，就来到了 CodeSpace，仍然是熟悉的 VsCode 编辑器。但是这里的 Terminal 可以使用。运行 docker-compose up -d 。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9225a8a38876d8e6d1077457f42c4101/1790f/1630392591908-87be1bb4-1983-47cc-b4ab-8f754b61980b.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.10810810810811%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACJElEQVR42p2S227TQBRF/dCSxPF1fLfHduzETS9uGkCU8sBfFlBVUAkJbZNSfnEhT9pUvCEelrZmNLO1t87R1psHrq6/cfnpC5efvyi9uv7K4seK2/sNy9Utm80jD79+s948cnt3z3p9x3L1U71ZLFfcLJbcfF9wc32FJmJJlBXs93R6A0OpaXl4kSRISiwnxPVivFCimx79oY1hOfR0m72+yf4Oi33dQWuTmFFe4kUpXpDgiECZxKMJk/mMsmlp2neMpjPk+Jh8fEKQVvhx9ydXiPAF7WPosdfT6esGfd1kMLSw3AgRSsrZAfVZS318Tla3ZNUJoZxgOAFDe4vhhJhutEM7r2psP8ayBbphKywR4QYZcVUxvZgzao+Q0wOyulEpXIVERAWWSF5MnRBNBiFeLLFdX6V7TugGKX5aMD59T3FwRnX0hmZ2wbg9p5l9oDp6q9RPa4a2/5JQ101eDQxl1KXr1BYRfjIiyGvyyQlJOcUSMaaIsb1tos6kq67SOeFOtTSvKKsGy/GeDG38KEDWFdl4TtGckhVjDqWkLQrmVUUZhOimu2ukeAqjGZaLYQuGpqMMewOTtMiZHE+ppmdUh6/J5IgiLymLGl/4xLHE9SOEH2HaAtPxlHphgtZNttu/5wkPdAvHD3CjCBEXBFlNFEv12bA9hpar6IIosye6c9dSk2VNkhXqshtMl3Rbw/y70j9hbg1lUZPKkVrq59X5X/4ArNRKr4MzU6UAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/9225a8a38876d8e6d1077457f42c4101/fcda8/1630392591908-87be1bb4-1983-47cc-b4ab-8f754b61980b.png\"\n        srcset=\"/static/9225a8a38876d8e6d1077457f42c4101/12f09/1630392591908-87be1bb4-1983-47cc-b4ab-8f754b61980b.png 148w,\n/static/9225a8a38876d8e6d1077457f42c4101/e4a3f/1630392591908-87be1bb4-1983-47cc-b4ab-8f754b61980b.png 295w,\n/static/9225a8a38876d8e6d1077457f42c4101/fcda8/1630392591908-87be1bb4-1983-47cc-b4ab-8f754b61980b.png 590w,\n/static/9225a8a38876d8e6d1077457f42c4101/efc66/1630392591908-87be1bb4-1983-47cc-b4ab-8f754b61980b.png 885w,\n/static/9225a8a38876d8e6d1077457f42c4101/c83ae/1630392591908-87be1bb4-1983-47cc-b4ab-8f754b61980b.png 1180w,\n/static/9225a8a38876d8e6d1077457f42c4101/1790f/1630392591908-87be1bb4-1983-47cc-b4ab-8f754b61980b.png 1189w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>实例启动后，就可以在网页端打开了，记住 docker-compose.yml 中配置了 8929 这个端口。按下 Cmd+Shift+P 键，选择 docker 容器插件提供的在浏览器打开功能，依次选择应用，端口：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e06159af26fa9430da8ba2d32e52b411/68947/1630392747369-7dd62f04-adde-4390-9d91-1ecfa86dd68a.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.7027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZElEQVR42j2O227aUBBF/dBSMPh+O/axDRiwCbEhSWnoS3+yRVRtFEUqjiFB+cZV2ZHysLQ0W6M9o5xfLvx5eOTn/sCv/YH94Td/Hx75VzfUzZm6PnG5vHF6eePYvFI3rxyfW194Pr3zdDxzrBua5oziixg/jPnUG9DrD/n8RUUzPBwR44kEzXAxLZ/r6YJvqw13y4oyK5iHKRMvYuxFjKwQO5gQjgsUw3IJogQviLA9QTvrliBIp6TLnGhyRTwryfKS7e4Hm6/fEXKK48c4vuxseRIhJ8yLEqWv6vT6Kn1VY9Ay1DFsgScnLLYl8/UNs9WOJFtSlHdkRYVuC0amj2YLNCvoaLMWJYjG2G7ASLdRR0aH4YjuanKVk99vkPmCdL5ktd4yKyrkeIHpRu+lVvBhN0hQTNvDFxLddLrvBkOjW7Z8SZQVzMp7knzNNC+pbneUtzuyvCKQUwwn/CgzPYkrUv4DJpS8UL7vEU4AAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/e06159af26fa9430da8ba2d32e52b411/fcda8/1630392747369-7dd62f04-adde-4390-9d91-1ecfa86dd68a.png\"\n        srcset=\"/static/e06159af26fa9430da8ba2d32e52b411/12f09/1630392747369-7dd62f04-adde-4390-9d91-1ecfa86dd68a.png 148w,\n/static/e06159af26fa9430da8ba2d32e52b411/e4a3f/1630392747369-7dd62f04-adde-4390-9d91-1ecfa86dd68a.png 295w,\n/static/e06159af26fa9430da8ba2d32e52b411/fcda8/1630392747369-7dd62f04-adde-4390-9d91-1ecfa86dd68a.png 590w,\n/static/e06159af26fa9430da8ba2d32e52b411/efc66/1630392747369-7dd62f04-adde-4390-9d91-1ecfa86dd68a.png 885w,\n/static/e06159af26fa9430da8ba2d32e52b411/c83ae/1630392747369-7dd62f04-adde-4390-9d91-1ecfa86dd68a.png 1180w,\n/static/e06159af26fa9430da8ba2d32e52b411/68947/1630392747369-7dd62f04-adde-4390-9d91-1ecfa86dd68a.png 1281w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/91c7c65521da5f9e05bf56b23e806f35/844cc/1630392774772-eb525e20-4a29-4342-a7c4-3e4dfdba516d.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7UlEQVR42lXM207CQACE4YJSDltquz2sFrZiIlIiMYYb4+t5AMKVQG2hlKhP+huREL34kskkM8Z6s2Uym/P8OuXpZcJ0NudtkZJvSlZpRlHsKHdfbLaf5MUHq7z8Z/FesFymZFmx3xmOF9KyHIzKKUa1RvWkQcuStF1FQ7jUmzYdGRJLhRCSmvAxhXdUt3xMK8C0fCo18XMYoCJNoCKkr7DdEKk0vdsE3U+4SsbE1yOiywFK9znzzg8u/vjtHD/CaAqbRqt9JGyJG3TpjRKGj2Nu7h6IB/fEw/H+0A06eErjqRgv1IeskWEXx+/wDV+ugQZQptdYAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/91c7c65521da5f9e05bf56b23e806f35/fcda8/1630392774772-eb525e20-4a29-4342-a7c4-3e4dfdba516d.png\"\n        srcset=\"/static/91c7c65521da5f9e05bf56b23e806f35/12f09/1630392774772-eb525e20-4a29-4342-a7c4-3e4dfdba516d.png 148w,\n/static/91c7c65521da5f9e05bf56b23e806f35/e4a3f/1630392774772-eb525e20-4a29-4342-a7c4-3e4dfdba516d.png 295w,\n/static/91c7c65521da5f9e05bf56b23e806f35/fcda8/1630392774772-eb525e20-4a29-4342-a7c4-3e4dfdba516d.png 590w,\n/static/91c7c65521da5f9e05bf56b23e806f35/efc66/1630392774772-eb525e20-4a29-4342-a7c4-3e4dfdba516d.png 885w,\n/static/91c7c65521da5f9e05bf56b23e806f35/c83ae/1630392774772-eb525e20-4a29-4342-a7c4-3e4dfdba516d.png 1180w,\n/static/91c7c65521da5f9e05bf56b23e806f35/844cc/1630392774772-eb525e20-4a29-4342-a7c4-3e4dfdba516d.png 1306w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/83ee6c45f99f75a9cca8c83fea413f32/f87c7/1630392786680-046c1d6a-44a1-4089-b649-06badf2b07d7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.243243243243242%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA80lEQVR42k3NSU/CQABA4R4MYXFaOl2mLV1YigKRCBdu/koVQzRRqK1tgd/4TMaLhy/v+Iyqbti/HXh+2f953XN4/+BYlJQ/Daei5NxeadorVX2hrC98V61WVGftVLV8FjWnryNGlIyRXsBNp0enO9A1LRfpj/CCFGF5CNtnFiY8TnKWyZjFKGMexvgqRQZjLDdGyAjhxBi26xPFGZ6KcP2QofQwbYVKJ2TLe8JsTpKvibI7wiTXdfyYoQywZICpKYSt9Njo9gXd3i26fUFvYGI5AW6YMduuyDcbFtsnpg87Jusdo+kK24uRfoyjkn9S3CDlF9RAhsfGHnH+AAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/83ee6c45f99f75a9cca8c83fea413f32/fcda8/1630392786680-046c1d6a-44a1-4089-b649-06badf2b07d7.png\"\n        srcset=\"/static/83ee6c45f99f75a9cca8c83fea413f32/12f09/1630392786680-046c1d6a-44a1-4089-b649-06badf2b07d7.png 148w,\n/static/83ee6c45f99f75a9cca8c83fea413f32/e4a3f/1630392786680-046c1d6a-44a1-4089-b649-06badf2b07d7.png 295w,\n/static/83ee6c45f99f75a9cca8c83fea413f32/fcda8/1630392786680-046c1d6a-44a1-4089-b649-06badf2b07d7.png 590w,\n/static/83ee6c45f99f75a9cca8c83fea413f32/efc66/1630392786680-046c1d6a-44a1-4089-b649-06badf2b07d7.png 885w,\n/static/83ee6c45f99f75a9cca8c83fea413f32/c83ae/1630392786680-046c1d6a-44a1-4089-b649-06badf2b07d7.png 1180w,\n/static/83ee6c45f99f75a9cca8c83fea413f32/f87c7/1630392786680-046c1d6a-44a1-4089-b649-06badf2b07d7.png 1247w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e9ff29f0806ee517d5689d23df7180e4/46115/1630392802571-d42696f6-a428-48c3-af4c-4c85405a1da1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.62162162162162%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5klEQVR42nXJ2UrDQACF4dDVxsxMMpMmKU1Loyh1qwriQ4kLRZTGJN1MUfvSvzR40RsvPs7hHOsjX5DPlzy9THl4fK5MX99IszlZsSRNC8pVybb8Zrv5oVx/kS02pMVnZZavmWUL8mLF+6zAqrcFuhshlKHRsqk1D6g3bDrSoPyItqORQjPsDQl1hCd8mrb+4+11Q60lsPwwRigP5flI1yCVRuqQIB6RXI1Jxjccnd8TDE5Q3T5CR7im9y/LRAm2o7AdWWXnUCK8LiYckEzGnN5dMzqbMLq8JT6+QAdxZffv222u3+cX/KF7C/co4uQAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/e9ff29f0806ee517d5689d23df7180e4/fcda8/1630392802571-d42696f6-a428-48c3-af4c-4c85405a1da1.png\"\n        srcset=\"/static/e9ff29f0806ee517d5689d23df7180e4/12f09/1630392802571-d42696f6-a428-48c3-af4c-4c85405a1da1.png 148w,\n/static/e9ff29f0806ee517d5689d23df7180e4/e4a3f/1630392802571-d42696f6-a428-48c3-af4c-4c85405a1da1.png 295w,\n/static/e9ff29f0806ee517d5689d23df7180e4/fcda8/1630392802571-d42696f6-a428-48c3-af4c-4c85405a1da1.png 590w,\n/static/e9ff29f0806ee517d5689d23df7180e4/efc66/1630392802571-d42696f6-a428-48c3-af4c-4c85405a1da1.png 885w,\n/static/e9ff29f0806ee517d5689d23df7180e4/c83ae/1630392802571-d42696f6-a428-48c3-af4c-4c85405a1da1.png 1180w,\n/static/e9ff29f0806ee517d5689d23df7180e4/46115/1630392802571-d42696f6-a428-48c3-af4c-4c85405a1da1.png 1290w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>这样就在新窗口中打开了： <a href=\"https://jeff-tian-gitlab-wq766wrh9r57-8929.githubpreview.dev/users/sign_in\">https://jeff-tian-gitlab-wq766wrh9r57-8929.githubpreview.dev/users/sign_in</a></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0318c5f62dea72236aaa5ff48488c3c3/fbfd6/1630392848266-19e9e952-f29a-43b6-868e-9fd1209666d6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA50lEQVR42o2R0UrEQAxF+/+foR8g+AH7Kr4KPou2tLbQ1VY7M5mZzJF0d6HLLuqFSxKS3CQzlfOR4cOt7I80/32/sJ8DKRdi0gMzyPKN+ICXjPeeJAGJQlgCSYSKP1CKUkoxxyIoevSvo7Lic0LKmb4fcM7zH5x6rflC0JBzpq5rmqah6zratsU5R4wREUFVCSEwz/MaW31Kiax6fvJWcBiGVcgEx3FkmqZVwGjNNsAusNotrwqaPW1j1gRsqy0keIL7AhTVTIyJlPLlp5RfHtxyqof808snt7tX7h877h46bnY1z28zP3soI1fUEUgWAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/0318c5f62dea72236aaa5ff48488c3c3/fcda8/1630392848266-19e9e952-f29a-43b6-868e-9fd1209666d6.png\"\n        srcset=\"/static/0318c5f62dea72236aaa5ff48488c3c3/12f09/1630392848266-19e9e952-f29a-43b6-868e-9fd1209666d6.png 148w,\n/static/0318c5f62dea72236aaa5ff48488c3c3/e4a3f/1630392848266-19e9e952-f29a-43b6-868e-9fd1209666d6.png 295w,\n/static/0318c5f62dea72236aaa5ff48488c3c3/fcda8/1630392848266-19e9e952-f29a-43b6-868e-9fd1209666d6.png 590w,\n/static/0318c5f62dea72236aaa5ff48488c3c3/efc66/1630392848266-19e9e952-f29a-43b6-868e-9fd1209666d6.png 885w,\n/static/0318c5f62dea72236aaa5ff48488c3c3/c83ae/1630392848266-19e9e952-f29a-43b6-868e-9fd1209666d6.png 1180w,\n/static/0318c5f62dea72236aaa5ff48488c3c3/fbfd6/1630392848266-19e9e952-f29a-43b6-868e-9fd1209666d6.png 1357w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>GitLab 实例就这样部署好了，而且连 https 以及证书，都被 CodeSpace 搞定了，外网也可以访问！</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b027fe217c37b01c60ad06b57aa9fe21/b6e34/1630393013936-96d3a1b5-100e-479f-80de-35c069be35d9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.48648648648649%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB00lEQVR42pWRe2/TMBTF8/0/BAgJEBL8UaE+WBFb1zR+xLGbSkwC+hgtdHWblpY1zwE6yA5dM5gQWDo698ryz8fXDj99A96qg3S78BiHRxk8z4PnERBCQSgF4xyc++DWjzUjnq0pZWCMgTMKJwgCKK+H8KSJsN2EpARBGCJQCoEQpYKgUh97wWhZV+QIsyGllXTPEdZrCBs1yJ4Lv2/A/TtgIYyE9bIXd+SIyu1CKSvV7WBQew769BHcV00L9qWyB2wSKUvZVBJSljK1cwv7DewrhV6rAfHkIfzHD9Br1XF6dmbnSykFIQQeKefcdV10Oud2z7l9/wH2y33fh0soXMZBGy/hv3iGD6MxJpMxhsMRJpMJ5vPPWC41tF5Aa43x5bQCDI4zObhJQk0S85OCg11EaPobvJZrtNVXNIMY7TDHST9DS2V4P7v+O7AqnxEMp0sMPm4xeDeDenuJi5HG6NMWUx3jalNgdhX9CaxCq+KMYRlF0JsICz1HtFogS/f4VmS4yVMAP6CXq39LaHrz/N1uh6IosI9jJEmKOI7xZbdHkn+HWavV6v6E911wAGZZZj1OEqRpgut9ipuSh+12+39A85MGmOc5iiI/epbZtOv1Gj8Bo749Ata+aIUAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/b027fe217c37b01c60ad06b57aa9fe21/fcda8/1630393013936-96d3a1b5-100e-479f-80de-35c069be35d9.png\"\n        srcset=\"/static/b027fe217c37b01c60ad06b57aa9fe21/12f09/1630393013936-96d3a1b5-100e-479f-80de-35c069be35d9.png 148w,\n/static/b027fe217c37b01c60ad06b57aa9fe21/e4a3f/1630393013936-96d3a1b5-100e-479f-80de-35c069be35d9.png 295w,\n/static/b027fe217c37b01c60ad06b57aa9fe21/fcda8/1630393013936-96d3a1b5-100e-479f-80de-35c069be35d9.png 590w,\n/static/b027fe217c37b01c60ad06b57aa9fe21/efc66/1630393013936-96d3a1b5-100e-479f-80de-35c069be35d9.png 885w,\n/static/b027fe217c37b01c60ad06b57aa9fe21/b6e34/1630393013936-96d3a1b5-100e-479f-80de-35c069be35d9.png 1103w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=fJQPc></a></p>\n<h2>配置 KeyCloak</h2>\n<p>接下来，需要在 Keycloak 中配置 GitLab 客户端，因为我们的目的是在 GitLab 中启用 Keycloak 登录，那么 Keycloak 就是一个 IDP 了，而 GitLab 是其一个 OAuth 2 客户端应用。要将 Keycloak 当作 IDP，一般有两种形式，OIDC 形式和 SAML 形式。</p>\n<p>使用 OIDC 的形式集成，有两篇文章做过详细的介绍：</p>\n<ul>\n<li>《<a href=\"https://zhuanlan.zhihu.com/p/360846976\">使用 OIDC 在一个 Keycloak 中集成另一个 Keycloak 用户认证</a>》</li>\n<li>《<a href=\"https://zhuanlan.zhihu.com/p/359057316\">在 eggjs 中集成 Keycloak 用户认证</a>》</li>\n</ul>\n<p>如果对这种集成方式感兴趣，可以详细参考。这里准备采用 SAML 方式集成，以便补充这种集成方式的实战。实际上，网上已经有一些 GitLab 和 Keycloak 采用 SAML 集成的文章了，但是采用了非常复杂的方法，因此整篇文章都在讲集成细节。这里采用了一个简单的方式，只需要一小节介绍即可。</p>\n<p><a name=SU46z></a></p>\n<h3>导出 GitLab 的 SAML 元数据 xml 定义</h3>\n<p>对于支持 SAML 集成的应用，可以访问其 /users/auth/saml/metadata 获得其 SAML 源数据信息。将其保存到本地：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0d40c4ead37af166be61ab05084aeda0/776d3/1630393978383-f25cc4eb-148c-47b6-8a18-b570c86cf85e.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1ElEQVR42j2O22qDUBBF/f8/imA81zmeS2pjxJLLB+ShT4XSBsRVFOnAYjMDs2YqaxxaGZRStK3eUZi6xhwOiDGIdHgfcD5sKRIQL8jeey84JwQRKrGCrjWmOaKahrZR6KNGa4vWbk+PNcJ63Bq7SULoiDGRUiLFSE6ZXApV5zts4xDrCd5v3wTp6HNieD8zTTfG8QPXXSj9yDCMXK83Ho87fd+Tc6aUspOpNvP/8EQ5FVLKXN7OfD6frDXPM1/fv/y8Zl4zsCwsy8I0TcQYt93VsfIHJukPqiDZxHAAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/0d40c4ead37af166be61ab05084aeda0/fcda8/1630393978383-f25cc4eb-148c-47b6-8a18-b570c86cf85e.png\"\n        srcset=\"/static/0d40c4ead37af166be61ab05084aeda0/12f09/1630393978383-f25cc4eb-148c-47b6-8a18-b570c86cf85e.png 148w,\n/static/0d40c4ead37af166be61ab05084aeda0/e4a3f/1630393978383-f25cc4eb-148c-47b6-8a18-b570c86cf85e.png 295w,\n/static/0d40c4ead37af166be61ab05084aeda0/fcda8/1630393978383-f25cc4eb-148c-47b6-8a18-b570c86cf85e.png 590w,\n/static/0d40c4ead37af166be61ab05084aeda0/efc66/1630393978383-f25cc4eb-148c-47b6-8a18-b570c86cf85e.png 885w,\n/static/0d40c4ead37af166be61ab05084aeda0/c83ae/1630393978383-f25cc4eb-148c-47b6-8a18-b570c86cf85e.png 1180w,\n/static/0d40c4ead37af166be61ab05084aeda0/776d3/1630393978383-f25cc4eb-148c-47b6-8a18-b570c86cf85e.png 1814w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=pyXQ5></a></p>\n<h3>在 Keycloak 中导入 GitLab 的 SAML 元信息</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d2aeb199fb6559b15de75d6949ca95b5/58fee/1630394128380-da47a69a-1281-45b4-8e71-06a645a19dd1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABsklEQVR42nWQS08aYRhG5+eKJqzKZa4wJk1d9QcIDImucNHGkhrbpjht1e8bZpgBI9pU0k1LIgOM1AQvleQ0gLvq4uTZvDl5nlep7exQq9XY2t7Gcao4joNTrVIqV9gsldksl5dZKlGuVB5vnkfJ5FVeZLOk02lW19ZYWUmRSq1iqzlemQYvdZX1goVt2wuKc4rFZ1F0s4BqWORUA1U3yesmlm7y5cM+QRgRiGM6UhB1OrTDkE6rRTuKaLfbT6JouoGu6qiqTk7VyeQ1NN2k8b6O/9Wl6TYWUs/3aX7+hNirI90GwvMQQiCEXKSUHkJKlA3T4rVpsGEYaLpFXjMxLBvXdYlaLQLfR0qJJz3Og4CuOOJX74KrSUIcXzIaDhiNhvT7vxnFl/OGJsZ8tmYsGmbnDQ2LgwOXMAzxfZ/Dw2+IY4/v3R/8PD8jHoy5mtwyHE9JJnckU+iPbhgktyjqo9AsFMlrBpmc+p9QSIEUHt3OKb3TE4Lggr39M97snrD7scfboyF1mfBOJkuhWbAp2OvLHz4hnNP0fKJmSNuTjOOY6c2U6+s/3N/fMZs9MHv4u8h/3DjlRKBrxEEAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/d2aeb199fb6559b15de75d6949ca95b5/fcda8/1630394128380-da47a69a-1281-45b4-8e71-06a645a19dd1.png\"\n        srcset=\"/static/d2aeb199fb6559b15de75d6949ca95b5/12f09/1630394128380-da47a69a-1281-45b4-8e71-06a645a19dd1.png 148w,\n/static/d2aeb199fb6559b15de75d6949ca95b5/e4a3f/1630394128380-da47a69a-1281-45b4-8e71-06a645a19dd1.png 295w,\n/static/d2aeb199fb6559b15de75d6949ca95b5/fcda8/1630394128380-da47a69a-1281-45b4-8e71-06a645a19dd1.png 590w,\n/static/d2aeb199fb6559b15de75d6949ca95b5/efc66/1630394128380-da47a69a-1281-45b4-8e71-06a645a19dd1.png 885w,\n/static/d2aeb199fb6559b15de75d6949ca95b5/58fee/1630394128380-da47a69a-1281-45b4-8e71-06a645a19dd1.png 1051w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=vf56e></a></p>\n<h3>在 Keycloak 中添加 GitLab 客户端的 email 映射</h3>\n<p>你可以添加更多的映射，以便把 Keycloak 中的用户信息映射到 GitLab 系统。但是只有 email 是必须的。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/64440414ee194fa3d0843d8e512540a5/339e3/1630394247926-3e67153d-8063-4d4e-879c-97372aceb80a.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.810810810810814%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACHklEQVR42m2S3W/SYBTGX3Y3L9SEKx2FVQWZjPExPgYyBoRpohf+X5vLjHfS4pj389aI/49SDYMC/aCUPuacWiILJ3nynjQ9vz7neSu+fe+j3/+Bm5uvuOpd4/NVD73rL3wqigpFVflU1a7fq9TT2YXS7aKjqPhE6ijoKAqEnEzhafw5wuEwtrfvIbS1BREK4f6Dh4jGZOxIUTyK+HocCXoJzyQJe7KMlLyLRExCLBZjiVKljkK5hlSmgP1sEdlCBXL8BS4uP4JqZjswHQ+2C5a58GC5gKPrmI91uONbwJgiKJEv15AtvUQqW2LgQb6M6JMkzt9fAvAwm/ovuwsHS9flZ/A8f9pbcu95HpbLJUu06y28azRwetLCQaGCXHHdoeu6PG9ZNmzbhmGYGI/HmEwm0Em6jtlsBsMwWKLZOMWb9is0T1pI58vIFauQE6k1IBV93XEcHrodjRg6Io1GDKfnBBa0av7oGNlilVemLHdicZzxyj6IoMPhkAcsy2KIaZrck6gPJDKHR6get9B+/RaHlGWmAElO4Pziw5pDchQMTadTzOfzjRJ0q6QARi4juwmcXfgOKXB6kVxRhrZl8UkfogjuStAlUG4E20vnkc6VGBg4JGeapmEwGPg5GQZMy8JisWDoXfHKlVqTf5dNQALYnJWNBd2y9hPTP7/ZzaYSBCpW6iBwcj+3Av6/8qqcOebaL8y0wSpb799/GOgvUbLJpcNN50cAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/64440414ee194fa3d0843d8e512540a5/fcda8/1630394247926-3e67153d-8063-4d4e-879c-97372aceb80a.png\"\n        srcset=\"/static/64440414ee194fa3d0843d8e512540a5/12f09/1630394247926-3e67153d-8063-4d4e-879c-97372aceb80a.png 148w,\n/static/64440414ee194fa3d0843d8e512540a5/e4a3f/1630394247926-3e67153d-8063-4d4e-879c-97372aceb80a.png 295w,\n/static/64440414ee194fa3d0843d8e512540a5/fcda8/1630394247926-3e67153d-8063-4d4e-879c-97372aceb80a.png 590w,\n/static/64440414ee194fa3d0843d8e512540a5/efc66/1630394247926-3e67153d-8063-4d4e-879c-97372aceb80a.png 885w,\n/static/64440414ee194fa3d0843d8e512540a5/339e3/1630394247926-3e67153d-8063-4d4e-879c-97372aceb80a.png 977w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=KKhoP></a></p>\n<h2>配置 GitLab</h2>\n<p>现在，Keycloak 中已经有了我们新部署的 GitLab 实例信息，现在需要配置 GitLab，让它知道我们部署好的 Keycloak 实例信息。</p>\n<p>首先，需要记下 Keycloak 应用对应的 Realm 的 url，以及拷贝一下它的证书信息：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bd2021141030afb83a6a42e93017e770/064b2/1630394430134-13831937-2f44-4c40-ae14-9ef628bbfb55.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.351351351351354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABW0lEQVR42k3MP08aYQCA8RvUzT8kqIkWbaJp9HtUnVQoohygrjaxjQrv3QHHve8JhsEvYHSSyYLITkxY2OtEFJbewARMdX+MDMbhNzzLo+l6jK3NLdbWNwiGQkSjUXYjEQ4OD7m9LXFfrVKuVIb+lMvUHqo4UhLZ2eUgkSAejxPTdfS9PfYTCbRlv5+vvilGR8b4vraOaQiSP4/ImCZ/n57odDq0Wi3a7TYvz8/88zzuSiV+/zrmVAhOk0nOPtFWl7+xsrTEzPQsP8IRCoUClmmSz+fxPI/BYEC326Xf79Pr9fj/+spjtcLFyTGXaZNiNo3M2bhSoqREm/uywFxgkfFJH9vB4HBkWRa2bVOr1ajX60ONRmOo2WxydX2DIQyylsV5Jo0rkrimQJoCbf59OB9gYtJHOLxDsVjEcRyklBiGQSqVQgjx4b2zmQzKdXGUQipFTimU43BuZ3kDAlf1YgIlLfoAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/bd2021141030afb83a6a42e93017e770/fcda8/1630394430134-13831937-2f44-4c40-ae14-9ef628bbfb55.png\"\n        srcset=\"/static/bd2021141030afb83a6a42e93017e770/12f09/1630394430134-13831937-2f44-4c40-ae14-9ef628bbfb55.png 148w,\n/static/bd2021141030afb83a6a42e93017e770/e4a3f/1630394430134-13831937-2f44-4c40-ae14-9ef628bbfb55.png 295w,\n/static/bd2021141030afb83a6a42e93017e770/fcda8/1630394430134-13831937-2f44-4c40-ae14-9ef628bbfb55.png 590w,\n/static/bd2021141030afb83a6a42e93017e770/efc66/1630394430134-13831937-2f44-4c40-ae14-9ef628bbfb55.png 885w,\n/static/bd2021141030afb83a6a42e93017e770/c83ae/1630394430134-13831937-2f44-4c40-ae14-9ef628bbfb55.png 1180w,\n/static/bd2021141030afb83a6a42e93017e770/064b2/1630394430134-13831937-2f44-4c40-ae14-9ef628bbfb55.png 1874w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>然后，回到 CodeSpaces，进入到 GitLab docker 镜像里：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5c842e8e5d1e52b32f0534aba4b7627b/d52e5/1630394489329-33078b63-559e-4688-ad5e-246ed193d2cd.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.24324324324324%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC4klEQVR42mWTWW/bRhSFBbSJbInivg453FeZEm0nkuPE8EMfCjRA3/rD46UNghYFasvpz/gK0m3aoA8Hw7m4/HDPnJnZ0+c/eTw88cvHT9zc3fPh9o6b23s+3Nxxe//zVPv1t995fPrMHw8HHh4OjP/8o8NYfzxweHrWzA8T8rLB8QSaYX+RqlvYbkCW18i0JC1aorTA9yVVuaaoT2i6LUW1xgtT8iKlLhNmpiPo+lOak4H5UuNI0VmsDBTNZKXZmJbAEQlJ0SLTGtuXWF40rarpM18aHCkmR4rFsWo/Ay1PkGY1F/t3XL65pmk2CFlg2AErw8PyJbKtsIIRlOJFJZ4scUSO5SfYIsNw5dQ7G619O1/gmTbvLy75YbfntFmjWh5HCxXDCTGdiHTT0r0dSJqB8+sfKU52yHogbs+I6wE3LKaJZ7ojeTk/RjVdTndXrIcdTX+O6QQsFB3dHh3ExG1N9aon6zuSekAWPcnJa5J+R5itMV2JYQtmblhSlA1C5mxfXVK2W+K8+wo4NrtxTLXf0L07o95viNqSbOgIkgzNDFBtge5JZrrpYlguY9rd5jVVNyCzFtMOOFZ0NGucUKKoNlGxodpeUvR7kvaUanhLv/+O7vya+uyK3fc/MVMNl29ezJkfK2iGg2rYrDSL5UpnoWjYXoAX5RiiQyQlYX1BXHQEUUaU1qRVP9XLpp/2M1fEiCjB9UOOl+oE+Vc6VRORNxlxfUYzXJCt98RJifCDyVUQJvhC4gchmm4xs1xBmlekRYMv4q+BS420baj6E2Te0Z5eTonGaUngByRFQ5QUkyvNdAiidLTs8PJoOVn+34QjsKmRZYEb5iT1Fi9pCGWG67hEIzhKUVRzOi5PxOPFDngxX3yBjet/lbY19bYnrbesz6+otm9o1wN5VpCWHVXbk1fd9DyFzJjZXkQoU2xXTIDnMJ4DGb+Xqo6iGax0e9LoaHwMo5aqwUoz/w7SnPr/Agr3nuzFxCe6AAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/5c842e8e5d1e52b32f0534aba4b7627b/fcda8/1630394489329-33078b63-559e-4688-ad5e-246ed193d2cd.png\"\n        srcset=\"/static/5c842e8e5d1e52b32f0534aba4b7627b/12f09/1630394489329-33078b63-559e-4688-ad5e-246ed193d2cd.png 148w,\n/static/5c842e8e5d1e52b32f0534aba4b7627b/e4a3f/1630394489329-33078b63-559e-4688-ad5e-246ed193d2cd.png 295w,\n/static/5c842e8e5d1e52b32f0534aba4b7627b/fcda8/1630394489329-33078b63-559e-4688-ad5e-246ed193d2cd.png 590w,\n/static/5c842e8e5d1e52b32f0534aba4b7627b/d52e5/1630394489329-33078b63-559e-4688-ad5e-246ed193d2cd.png 848w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>在 shell 里，进入到 /etc/gitlab 目录，输入 vi gitlab.rb 命令，贴入一段 Keycloak 相关的配置：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fcafa8bc8f271073a1dd3975231a47a5/b9024/1630394663792-9505dd3d-fc81-4430-94d2-ae547965cab8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/klEQVR42m2SWW/TQBSF/UDbJN63jB2Pd6dZnEJaWlT6gFSJ30k3oUIX1wTx+z6UEaUgePh0pXtn5pxzNVr3tOGx67m4uubTxRUXl9dcXt1w8/mWh67n/vGJvt+w+f5D0fUb+m89j90Tdw8d9w+dqrdfvtLd36G5wYS83mccpwx0m52hqWooJFFaEYgU14sQkwI3TBgaHo7roVsueyP7Bd1RaEGUEkaSWBbkec379THL6QJ/LJH7U+R0SlofIKslY9ko7FBiOALTizBd8RdaGJfsDnRe7Q4IAsH52Qc+vn6DH+XEVc30eEVzcEIxf0u2OCKpWuV0m8wLEyXsi5QgyhRalM2YyAIvEASRZHF4yuG85TQvcERCsW5pjlbI+Yx8uWKcVPhJRSgbwqTGHafKmeVFCi2MUgzLxXYD3CCibBb4SclSZpxLSVm3VKtT8umK6cE7mvaY+eEZZXtCPlsj0oaR6WE4IYYdouXlPq4vcLyQkWH/xhaSdTOnyUqsYBstVrsWsWSSZHi+UKn8MFKzramhbqGJSU40SRnHEt10VNMwbLJJSlnPSGROLGI8x8MwLIa6rc78Kf7M0LDRRFKwszdkMDJVc6BbuJZDW5Qsiop5XlLGCann45u2+lLqsm79w7avxbJSDrc7VEqmo5yahoWpW1jGL8yXh/7n7nn2E3PrIDPLH88SAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/fcafa8bc8f271073a1dd3975231a47a5/fcda8/1630394663792-9505dd3d-fc81-4430-94d2-ae547965cab8.png\"\n        srcset=\"/static/fcafa8bc8f271073a1dd3975231a47a5/12f09/1630394663792-9505dd3d-fc81-4430-94d2-ae547965cab8.png 148w,\n/static/fcafa8bc8f271073a1dd3975231a47a5/e4a3f/1630394663792-9505dd3d-fc81-4430-94d2-ae547965cab8.png 295w,\n/static/fcafa8bc8f271073a1dd3975231a47a5/fcda8/1630394663792-9505dd3d-fc81-4430-94d2-ae547965cab8.png 590w,\n/static/fcafa8bc8f271073a1dd3975231a47a5/efc66/1630394663792-9505dd3d-fc81-4430-94d2-ae547965cab8.png 885w,\n/static/fcafa8bc8f271073a1dd3975231a47a5/c83ae/1630394663792-9505dd3d-fc81-4430-94d2-ae547965cab8.png 1180w,\n/static/fcafa8bc8f271073a1dd3975231a47a5/b9024/1630394663792-9505dd3d-fc81-4430-94d2-ae547965cab8.png 1203w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n配置的文本内容如下，注意替换相关 url 和具体证书内容。</p>\n<p>ruby\ngitlab_rails[omniauth_enabled] = true\ngitlab_rails[omniauth_allow_single_sign_on] = [saml]</p>\n<h1>gitlab_rails[omniauth_auto_sign_in_with_provider] = saml</h1>\n<p>gitlab_rails[omniauth_block_auto_created_users] = false</p>\n<h1>gitlab_rails[omniauth_auto_link_ldap_user] = false</h1>\n<p>gitlab_rails[omniauth_auto_link_saml_user] = true\ngitlab_rails[omniauth_providers] = [\n{\nname: saml,\nargs: {\nassertion_consumer_service_url: <a href=\"https://jeff-tian-gitlab-wq766wrh9r57-8929.githubpreview.dev/users/auth/saml/callback\">https://jeff-tian-gitlab-wq766wrh9r57-8929.githubpreview.dev/users/auth/saml/callback</a>,\nidp_cert:  -----BEGIN CERTIFICATE-----\nn MIIC...WWDcIuuyzUn -----END CERTIFICATE----- n,\nidp_sso_target_url: https://keycloak.jiwai.win/auth/realms/UniHeart/protocol/saml/clients/jeff-tian-gitlab-wq766wrh9r57-8929.githubpreview.dev,\nissuer: jeff-tian-gitlab-wq766wrh9r57-8929.githubpreview.dev,\nname_identifier_format: urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\n},\nlabel: KEYCLOAK 登录\n}\n]</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/570905d98aca49e9a2d63741ec5b7ba4/5bd27/1630394725556-26dd3283-e7a3-461a-828e-56aa82d6a97a.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.86486486486486%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWUlEQVR42n2Ry5KbMBBF2SRjQK+WEC+DDTbYkEwlqfz/v50U2K7xKotTrb5aqPsokVAR6pGym2iHlW64cZ4+GeZPqn4iHkeMr0i1kBpP9kb6JH8jiU3H+brQDRPdMBPrjqI64kMkOME7Qawg2uC1xSqD0w+2fsuz3JA+SfqmY52XnR/3lctp4Fi1NM7zMwg3L8xe+FV4/kbP3QtLENYg/C48fwqP05ZDbsmUJTm1Hdd5ZZpXxsuN/nShrjuM9Xykio9M73xP1c4rO2Sab5nGKINWhsNrwmA9ZXui7Ueqpt9XlqJidxsbivKLva/a/c66gHaB4DxiN3+CMkLijcNXR8Z5ZbgujzotnK93TuO8P1Q2PaFqd7cvx6FskbKhDCVFiBgfsRJJSitE56lDpNjkq4fsYOxDujKI0rhcI/lXfWWFNqjc7ArSXJNsY+bq8VP5hrJP3s//J3vjH3QjxGFQRgsYAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/570905d98aca49e9a2d63741ec5b7ba4/fcda8/1630394725556-26dd3283-e7a3-461a-828e-56aa82d6a97a.png\"\n        srcset=\"/static/570905d98aca49e9a2d63741ec5b7ba4/12f09/1630394725556-26dd3283-e7a3-461a-828e-56aa82d6a97a.png 148w,\n/static/570905d98aca49e9a2d63741ec5b7ba4/e4a3f/1630394725556-26dd3283-e7a3-461a-828e-56aa82d6a97a.png 295w,\n/static/570905d98aca49e9a2d63741ec5b7ba4/fcda8/1630394725556-26dd3283-e7a3-461a-828e-56aa82d6a97a.png 590w,\n/static/570905d98aca49e9a2d63741ec5b7ba4/efc66/1630394725556-26dd3283-e7a3-461a-828e-56aa82d6a97a.png 885w,\n/static/570905d98aca49e9a2d63741ec5b7ba4/c83ae/1630394725556-26dd3283-e7a3-461a-828e-56aa82d6a97a.png 1180w,\n/static/570905d98aca49e9a2d63741ec5b7ba4/5bd27/1630394725556-26dd3283-e7a3-461a-828e-56aa82d6a97a.png 1432w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p><strong>小提示</strong>：这里是在网页中操作 vi，进入编辑模式后，要退出到普通模式，不能采用一般的 Esc 或者 Ctrl + [ 键，因为这只会让浏览器编辑器失去焦点。这应该是 VsCode 网页编辑器可以进一步优化的点，目前绕过这个问题的方式是，Ctrl + C ，退出插入模式的同事，不失去焦点。</p>\n</blockquote>\n<p>输入 :wq 保存并退出配置文件，然后重启 GitLab：<strong><em>gitlab-ctl reconfigure</em></strong>。</p>\n<p>重新打开 GitLab，就会看到登录框下多了一个 “Keycloak 登录” 选项：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5ac63ed9a9d3c32de603d38608703378/ae2f8/1630395353012-bc57a4e5-54ad-40aa-8b62-4e32ca69e04a.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeklEQVR42o2S2W7bMBBF/f+/04ciaN8aIEFQFHnokgZB2tqxY1kbJYqkKC6nIJ0oi2s0A1xRGJCHc6+0cM4xKEXdNJRVRVnVe5UVdSsYpMTqASNqZCcxrcLakWlyKKUZtWRQmqFt0V3LIsbIWyo6m5779xg5dm4Geu9Zr9c0TXMcesCIB5fMwBBCBi6XS3a73QxP/XRZUqpBGRrRofTI5AJ28oyTJ4R4OGFVVRRFwXa7zTAhBH3f51VKiXOeshYUZYvoNUJqOqlpOoX34SUwreM4YoxBa421Nuu1ZWcN0Znk6UEeop8zfQI+QNPoeWvcb8/9ELL1VD9XgvcXK86uas6uWj5elnz6VmX7GXjw1bwjyo44GqJWGcYcPXz93fLu/I6TzxtOvhR8uNxx+r1+Aj7CnivIHl9s8Pcr/OoX7vYad/MDv10zaUmwam/1VR5ppsV//780sVaEQeL/3NCXJXebe6QcMsCHmPUiw38rZLvxmV0es039I+f+ArnEWhLl9JpHAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/5ac63ed9a9d3c32de603d38608703378/fcda8/1630395353012-bc57a4e5-54ad-40aa-8b62-4e32ca69e04a.png\"\n        srcset=\"/static/5ac63ed9a9d3c32de603d38608703378/12f09/1630395353012-bc57a4e5-54ad-40aa-8b62-4e32ca69e04a.png 148w,\n/static/5ac63ed9a9d3c32de603d38608703378/e4a3f/1630395353012-bc57a4e5-54ad-40aa-8b62-4e32ca69e04a.png 295w,\n/static/5ac63ed9a9d3c32de603d38608703378/fcda8/1630395353012-bc57a4e5-54ad-40aa-8b62-4e32ca69e04a.png 590w,\n/static/5ac63ed9a9d3c32de603d38608703378/efc66/1630395353012-bc57a4e5-54ad-40aa-8b62-4e32ca69e04a.png 885w,\n/static/5ac63ed9a9d3c32de603d38608703378/c83ae/1630395353012-bc57a4e5-54ad-40aa-8b62-4e32ca69e04a.png 1180w,\n/static/5ac63ed9a9d3c32de603d38608703378/ae2f8/1630395353012-bc57a4e5-54ad-40aa-8b62-4e32ca69e04a.png 2496w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=MlIk3></a></p>\n<h2>体验</h2>\n<p>如展示小节的视频展示，登录成功后可以对比一下用户资料，匹配！</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ce37dee5ba1f313711ebcff69aa2acde/d8ced/1630395559662-23732adc-e706-4e5c-99f9-61ed232817cb.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.86486486486486%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjklEQVR42m2R7UsbQRCH8/9/KCKVBhotbY1paERNbYt9M+oHY2xNFIxCPBOuJEFiL3fp5V72dvcpt7mzCA78dlhmeeY3O4Va5ROv1/dYKW7xbKnC0nKV5efvF3mlRvFFjdLLHUpru6y/+kKt+oN31e+UN76yUf7M6uoupeIma6Vt3r75SKFS3uJDvcHe9jearSsah23q9X32G784bl5y3OzSODjj8KhD59wyOmv3aBvd0DzpcnDUofXzmtZpl8Kt1WcymeDfjcC5AySxFCgZA5o0pIyJowBQaJ2gtTR6KgqWZTEajZh6M6K/M+TvAdp1TFHrxeH7c3zfJ45jwjAyWQiBlAqlUuksqxR4y3g8Zuo4CLnomgxtksENWi3uYRDgeR5hGBIEAVEUGaDWOmv8PxuHw+EQ13XNozzU9A/i6hztTQmFwMvqqbskSZBSGqWucpgB9vt9A0wd5ECdP0oE8voCzx4wmwfM5/4jlzn8EbDX62HbNk46cg40RZWtBHzPZXJ//zB2Lpl9UT5yupR/KUhPpAi0zDMAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/ce37dee5ba1f313711ebcff69aa2acde/fcda8/1630395559662-23732adc-e706-4e5c-99f9-61ed232817cb.png\"\n        srcset=\"/static/ce37dee5ba1f313711ebcff69aa2acde/12f09/1630395559662-23732adc-e706-4e5c-99f9-61ed232817cb.png 148w,\n/static/ce37dee5ba1f313711ebcff69aa2acde/e4a3f/1630395559662-23732adc-e706-4e5c-99f9-61ed232817cb.png 295w,\n/static/ce37dee5ba1f313711ebcff69aa2acde/fcda8/1630395559662-23732adc-e706-4e5c-99f9-61ed232817cb.png 590w,\n/static/ce37dee5ba1f313711ebcff69aa2acde/efc66/1630395559662-23732adc-e706-4e5c-99f9-61ed232817cb.png 885w,\n/static/ce37dee5ba1f313711ebcff69aa2acde/c83ae/1630395559662-23732adc-e706-4e5c-99f9-61ed232817cb.png 1180w,\n/static/ce37dee5ba1f313711ebcff69aa2acde/d8ced/1630395559662-23732adc-e706-4e5c-99f9-61ed232817cb.png 2652w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/788253bc56e61b9cc1cd50188d82db9b/92a6b/1630395608464-2e1277ea-205c-4120-8431-4cdbfc4cde44.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABKElEQVR42p2Q2UoDQRRE5/tDNqMmmmi2cTqLxAc/wr8QRHGyzBCcfelJH+k2BH0R8cKhiuZS3Gpr+fCIvVgxGNkMRlNuxrbxw6nDdHbPxHYQYsadmDMcC6a3AmexRCxXTJwFE9tmZAscZ8FcOFiX130mYs5Ft0et0aRWb1JvtqjVG0bbnfNvdGhpzr4wb9q323R7V1z1B1glsE0kIRABgeI4B/4zVhAEuOsNSZIQxwlRHJMVBeXeJ964hGsX//WFwH0n9XZHtqT+jsR9I9P7WUaapqRZjqWN5/nkeU5RFEallKAUVVmSRBGyKKhkaVSWR4wvza6UFUodTCsrSVPCMDyFnQIB3f6g1K8orVXF2tvz9LzH0gH6ZB3440IdqNTfPk4pU3f9kfEJacT31dF2W7AAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/788253bc56e61b9cc1cd50188d82db9b/fcda8/1630395608464-2e1277ea-205c-4120-8431-4cdbfc4cde44.png\"\n        srcset=\"/static/788253bc56e61b9cc1cd50188d82db9b/12f09/1630395608464-2e1277ea-205c-4120-8431-4cdbfc4cde44.png 148w,\n/static/788253bc56e61b9cc1cd50188d82db9b/e4a3f/1630395608464-2e1277ea-205c-4120-8431-4cdbfc4cde44.png 295w,\n/static/788253bc56e61b9cc1cd50188d82db9b/fcda8/1630395608464-2e1277ea-205c-4120-8431-4cdbfc4cde44.png 590w,\n/static/788253bc56e61b9cc1cd50188d82db9b/efc66/1630395608464-2e1277ea-205c-4120-8431-4cdbfc4cde44.png 885w,\n/static/788253bc56e61b9cc1cd50188d82db9b/c83ae/1630395608464-2e1277ea-205c-4120-8431-4cdbfc4cde44.png 1180w,\n/static/788253bc56e61b9cc1cd50188d82db9b/92a6b/1630395608464-2e1277ea-205c-4120-8431-4cdbfc4cde44.png 2334w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=Ep1IC></a></p>\n<h1>总结</h1>\n<p>通过薅 CodeSpace 羊毛的方式，部署了 GitLab 企业版实例，并通过配置的方式，对接 Keycloak 登录。</p>\n<p><a name=ZedTO></a></p>\n<h1>后期工作</h1>\n<p>目前通过 Docker-compose，使用了 GitLab 官方镜像，在对接 Keycloak 时还有些手动步骤。后面可以把配置好的 GitLab 打包成自定义镜像，以实现 0 配置对接。</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}