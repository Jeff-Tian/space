{"componentChunkName":"component---src-templates-post-js","path":"/posts/iuq5zl/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/iuq5zl","relativePath":"posts/iuq5zl","frontmatter":{"title":"基于 Authing.cn 的关注微信公众号登录的实现方案，以及和其他方案的对比","stackbit_url_path":"posts/iuq5zl","date":"2023-03-05T06:19:17","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a name=J2AJx></a></p>\n<h1>为什么会有关注微信公众号登录的需求？</h1>\n<p>在如今的互联网时代，微信公众号被越来越多的企业用于与用户之间的交流和沟通，其中包括用户的登录认证。通过关注公众号登录，不仅可以给公众号引流，而且能够将用户与公众号粉丝一一对应。最后，这种方式对于用户来说，也更加方便快捷。对于已经关注过公众号的用户来说，扫码后就直接进入登录状态了；对于新用户来说，仅需要多点一次关注的操作。\n<a name=YaGII></a></p>\n<h1>本文内容</h1>\n<p>本文将介绍如何使用 <a href=\"http://authing.cn/\">Authing.cn</a> 来实现关注微信公众号登录的方案，并和我自己之前的几个实现方案做一个对比。\n<a name=jVLWj></a></p>\n<h1>最终方案展示</h1>\n<p>可以访问： <a href=\"https://taro.jefftian.dev/pages/subpages/auth/authing\">https://taro.jefftian.dev/pages/subpages/auth/authing</a>（或者 <a href=\"https://taro.pa-ca.me/pages/subpages/auth/authing\">https://taro.pa-ca.me/pages/subpages/auth/authing</a> ），在登录框中选择“微信公众号关注”：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.02702702702703%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACQklEQVR42mPw8vb38PJz9/R1cnb39vH38vZ3cfO0d3RxcHJ1dHJzcHS1d3S1sLI1t7SBIzNLGwtLW0srO4aW5sa2lqbmpvpJE/tmTp88c/rkWWA0e8aUyRN6ejpbZ8FEZk6bNGfW9ObGuuqq8skT++pqKhmis+pisuricpuSitrDMhqDU+uCU+tC0kAoKKUmIKk6NK0+NL0+JK0+LL0+MrMhLK02MrMusbA9KquBQcO3Xt27RsOvWTeorXX2jrnrT85Zf2raykPTVh6evvLI9JVHpi4/NHHJ/inLDvYtPty54LBn5jR1v1btwHbtwHYG/ZB2g9BO3aBWk7C2F28+f3j3+tb1y///////799/KPj3/duXf39+fvz+/+jt/5lNS1S86w1D2/WC2xj0gtv0g9t0glqNQltfffh+5dTxxRPbP3z99vPHzx8/fn7+/PXXr9///v378+ffv7///v77n9awRMW7wQBNs3FY24u3n168eHng0PGDh0/cufvg9p27+w4cfvP2HdgdUJdkNGLTbBLe/uQlSN23b9+/ffv26/ffj1//fPjy58fv/79+/vr589d/AppfIDT//PX3xce/zz/+/fjt36+fIC9ArCagGeLAw4cPbQGBrdu2bXv3DiFOlOYlS5ZUVFQ0NDRUVla+fPmSNM0rVqyorKysrq5ua2v79OkTaZqXLVvW1dU1adKknp6eDx8+EKv5L1jRw4cPL168eOfOnXv37v39+xeWYIiz+e/fvz9Bgfzj9+/f/5EAsmYAEUQyI9xLw28AAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/938cd80f766943a69c36a6fe0947ec9d/fcda8/1677996843811-0782ecd3-6f1a-4bd8-a6d5-469d1fd74f19.png\"\n        srcset=\"/static/938cd80f766943a69c36a6fe0947ec9d/12f09/1677996843811-0782ecd3-6f1a-4bd8-a6d5-469d1fd74f19.png 148w,\n/static/938cd80f766943a69c36a6fe0947ec9d/e4a3f/1677996843811-0782ecd3-6f1a-4bd8-a6d5-469d1fd74f19.png 295w,\n/static/938cd80f766943a69c36a6fe0947ec9d/fcda8/1677996843811-0782ecd3-6f1a-4bd8-a6d5-469d1fd74f19.png 590w,\n/static/938cd80f766943a69c36a6fe0947ec9d/efc66/1677996843811-0782ecd3-6f1a-4bd8-a6d5-469d1fd74f19.png 885w,\n/static/938cd80f766943a69c36a6fe0947ec9d/c83ae/1677996843811-0782ecd3-6f1a-4bd8-a6d5-469d1fd74f19.png 1180w,\n/static/938cd80f766943a69c36a6fe0947ec9d/e8950/1677996843811-0782ecd3-6f1a-4bd8-a6d5-469d1fd74f19.png 2000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />使用微信扫描二维码后，会发现这是我的测试公众号。选择关注，网页就会自动登录；而如果之前已经关注过，在扫码后，网页会直接进入登录状态。如果是第一次扫码登录本网站（哈德韦的个人小程序），那么会出现如下的页面，允许你创建一个新账号，或者绑定到已有账号。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 121.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAIAAAB1KUohAAAACXBIWXMAAAsTAAALEwEAmpwYAAADHElEQVR42p2TS2/TWBSA81tAYgN1KYW/AIqYkZomaWCB0ExZTAcxCEoprWhCSWwnDUKiSVuVkRADgg2PHRuWSEg8hEjTR+IESpXYSdo0D/v6+hVfn5HjIQwqJQjr0/XV8f18zrF8XLVao15vbtfqBb60vJZdzXAr7TXD5bNcPvfhYzZnb/hSRShvCuXNzWqtvFl1cLFMhKUjLEPfiMcW5pLzyYTDwnzy5o14lKXn5xLzc4mFuaTD5bHRWJSNz0RjUcY1Nnl9dOLahcvBscnpUCQeDM84hCLx8avh0SuhTsThzB/nL02ELk2ELo4HXX2eYO+v430DU/1DbL+fPuSnD/naq58+PMQeOcE6+w6HA9H+oWh/wMZFeZmeQXr/QPjhszfcRiXN8St5YTkvLHHFVLaQyhbSuWI6x6dzfIorchuVx8/fUV66Z5CmvIyr18fYvif8Jr0OALquKxgT04QdFyEWACxli73eSI+X+SIf8IRfpT4CgKYZum4AQKMpfdoo8kIZIQwAFkDLJADwPlPoHYxQ/5c7mTXdaIoSxsr6p8LySmZ1jeOFsowVWcbOS5eyu8uKqlW3642GWOBLQmlLKFWLfEUUpaYoqZreRXYaAwDTNAnRAAxC9HbVnZ53l01iEcs+JCJrKgmTs9arlApgf8HuMiGWZYGuqw3JGIkqw0HtxVsTwCLkh2UAQ9gyJ26as0/Rw7U6EL1lEqeirrIFLbWypXj+Mo6dNR68lHVQTdP6UZmYJsbyk+fy7UewwRO7bGv3sg98lrFiqFpL1VoNUVZUudWSJYSwakewYnTNrAHoAHqzVmpsl+VmVWxUnEj70bfk/QPh96vrdQWOx6WjMeSOo9OLePhv/NsiPrWA3XF0LIbcM1JJhMyHAuXZIb9bWa9jOJGQfLdQIIHO3UUX76Pzd9Gfd1BgFvlvocCsVBZhNV+gdvb8+us/bPepssv+aqp6BiOB0cWR6/d/n/pnuM2Z4BeGPwdHpu+dHLtNtYfZlp0b5WX2/TK9xx3c6w59hz3u0L7j1zrKf5kpL3PQx/b5o1056GO/If8E/wLny56dTdk+vAAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/4545fed52ff1dfce24b652d515a5abc0/fcda8/1677996852477-c76971a4-f6e8-47b2-8597-8c4b325763d5.png\"\n        srcset=\"/static/4545fed52ff1dfce24b652d515a5abc0/12f09/1677996852477-c76971a4-f6e8-47b2-8597-8c4b325763d5.png 148w,\n/static/4545fed52ff1dfce24b652d515a5abc0/e4a3f/1677996852477-c76971a4-f6e8-47b2-8597-8c4b325763d5.png 295w,\n/static/4545fed52ff1dfce24b652d515a5abc0/fcda8/1677996852477-c76971a4-f6e8-47b2-8597-8c4b325763d5.png 590w,\n/static/4545fed52ff1dfce24b652d515a5abc0/efc66/1677996852477-c76971a4-f6e8-47b2-8597-8c4b325763d5.png 885w,\n/static/4545fed52ff1dfce24b652d515a5abc0/c83ae/1677996852477-c76971a4-f6e8-47b2-8597-8c4b325763d5.png 1180w,\n/static/4545fed52ff1dfce24b652d515a5abc0/e8950/1677996852477-c76971a4-f6e8-47b2-8597-8c4b325763d5.png 2000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />同时，手机可以收到微信公众号发来的欢迎信息。这一块儿可以做更多事情，目前我的示例程序写得很简单，会发一条简单的欢迎信息：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 216.89189189189187%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/a2fe0d08e70af17b78ef791a1660e28b/fcda8/1677996934942-775ab2ec-704d-440d-8175-ce026be5ba1e.png\"\n        srcset=\"/static/a2fe0d08e70af17b78ef791a1660e28b/12f09/1677996934942-775ab2ec-704d-440d-8175-ce026be5ba1e.png 148w,\n/static/a2fe0d08e70af17b78ef791a1660e28b/e4a3f/1677996934942-775ab2ec-704d-440d-8175-ce026be5ba1e.png 295w,\n/static/a2fe0d08e70af17b78ef791a1660e28b/fcda8/1677996934942-775ab2ec-704d-440d-8175-ce026be5ba1e.png 590w,\n/static/a2fe0d08e70af17b78ef791a1660e28b/efc66/1677996934942-775ab2ec-704d-440d-8175-ce026be5ba1e.png 885w,\n/static/a2fe0d08e70af17b78ef791a1660e28b/c83ae/1677996934942-775ab2ec-704d-440d-8175-ce026be5ba1e.png 1180w,\n/static/a2fe0d08e70af17b78ef791a1660e28b/29114/1677996934942-775ab2ec-704d-440d-8175-ce026be5ba1e.png 1920w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />但是，由于<strong>测试公众号</strong>的限制，只能有100个粉丝。因此本演示只对前100名新用户有效。注意，如果是真正的服务号，就不用担心粉丝数量的限制了，但是申请微信的服务号，需要企业资质，个人开发者暂时没有办法申请。\n<a name=CHVos></a></p>\n<h1>关注公众号登录的核心要件</h1>\n<p><a name=eJDSF></a></p>\n<h2>带参二维码</h2>\n<p>这是服务号才有的能力，由微信提供。带参二维码本质上是一个动态生成的随机信息，用来标识当前会话。一旦有用户扫码，那么，该会话就和一个身份绑定起来了。<br />这些都是微信服务和开发者服务之间进行的后端信息交换。首先，开发者服务需要通过凭据获取带参二维码；其次，在用户扫码后，开发者服务会接收到微信的消息通知。\n<a name=tE5hk></a></p>\n<h2>扫码状态的维护</h2>\n<p>开发者服务需要对扫码状态进行维护，其键值是带参二维码对应的临时票据，其值可能是待扫码、已扫码和超时等。一旦某个临时会话收到了微信发来的有用户扫码的消息通知，就应将该会话转为已登录状态，而一个超时没有收到用户扫码消息通知的会话，应该通过某种方式标记出来。<br />因为这个关注公众号登录的场景，一般用在 Web 端。所以常见的对扫码状态的更新查询，都是使用了定时轮询的方式。一旦扫码完成，就会在下一次轮询时得到状态更新，这个 HTTP 的响应，不仅在负载中携带了已扫码的状态，而且往往通过 HTTP 标头带上了 set-cookie 来将已验证的会话标识传给客户端。客户端（即 Web UI）会更新页面。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.432432432432435%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACG0lEQVR42l3SS2sTURQA4Pk7dedC/0MxFjeC+AOqKYFgwbZIwUVsQolCsVIxYLtwUxd2K4gLWymJMmKTTCbJTGYmj5nMI3MnSZOZuUnuvUcnFokezuJuPs7rconHqeRWOrmVfvjoaWIjtb69m9xMPUg+2dzOKHXZGwVdxzNMs6V3Gy2jazsOQj3kuV6/P7zksoefDo5PD45PX78/23v3+fnhx523X2KJN9fvZr5fVJvtttpsi3VZVrS2bnSMrt41Laendy3DtDndsErfvjIARimjFBidMVjPniytpDoWopSEk4mPJ3iC8XSKMQ7DMAiCIAxDjDnDQkK50jFspWW63nA6IwCw8eLD0kpKqGsIIcO0eggh19N10+4hpz8c+f7YD8Z+wHnDMQCMxoHhhm5/jDGe45Nrd54VfggXJeG8wJfFmu+NbcXBCNHBgA2HUY5GnNu/BACe5zPpnaOjI0rpX/xTkOSGUixXZFUFAg0i28QECpTMYD7jFc7n8/H4Wi6XIwu4KDYUVS0JVUXTgIJEpQEbwEJw3iBq27IsnuclSaKULWB5jkW12QQKBtNDFv6L5zMzxqJtz2MRNxSlJIiK1qSEEDpljEJ0EXaF0WAEAISQEGNC6H9tq5omiDWtY1DHAVkC5EKtBlIdSHQUbnn1ZSy+H4vvL6/u3YpH79trr27c2715P8sXa2WhcnZeqNbl6AsQEpWl5I/8jX8BVfsmWqemQzEAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/2229f26d50181c61273810acd06b3304/fcda8/1677996907921-9178788d-71ea-4e74-abc5-da29d204fe2b.png\"\n        srcset=\"/static/2229f26d50181c61273810acd06b3304/12f09/1677996907921-9178788d-71ea-4e74-abc5-da29d204fe2b.png 148w,\n/static/2229f26d50181c61273810acd06b3304/e4a3f/1677996907921-9178788d-71ea-4e74-abc5-da29d204fe2b.png 295w,\n/static/2229f26d50181c61273810acd06b3304/fcda8/1677996907921-9178788d-71ea-4e74-abc5-da29d204fe2b.png 590w,\n/static/2229f26d50181c61273810acd06b3304/efc66/1677996907921-9178788d-71ea-4e74-abc5-da29d204fe2b.png 885w,\n/static/2229f26d50181c61273810acd06b3304/c83ae/1677996907921-9178788d-71ea-4e74-abc5-da29d204fe2b.png 1180w,\n/static/2229f26d50181c61273810acd06b3304/e8950/1677996907921-9178788d-71ea-4e74-abc5-da29d204fe2b.png 2000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />对于多次轮询后，碰到超时的情况，页面往往更新为“请刷新二维码”之类的提示。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.45945945945947%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsTAAALEwEAmpwYAAADd0lEQVR42m2R629TdRjHz7+iJihz2VaFN1JmskRnVpgOetkInc7oDKy0qwUznAhW1na3yPS18Y2BhaCSYILOTWAdW3obPb2fC+ectjvd6Tlt1/bcWtpzfqarEIl8833xvPk8l+8DmYymD0dHzadPnxoZMRmNw6Zhg94w9MHQMZ1uYGBg8PjgxFmL1X7+jGXSYp202uxWm/3MhNVinTxrsUL2KadjesYx7bpwyW05//XnF69OXZ770jlvcUw7Ln7z1WUXhWByQymJDbZYZgtFmmHxdI4tlkvlCmSe+mn6h98d87ds7mX77E2be3nC+fO5meVPrtw4ZHK/afJsBGIIhhEUhT0mIvEkTlDp7A69y1CZLLQJUzSWYPMM2JeiKEK1Um+oMFXTmhe6TrpJmpNlWZJrkizzovik0RBESVVVQZSgzQgV8W1417175QpJUoVisd1FlOva0YVuvTuGZVVVkWt1ud4yLwhVnt+rVPZ4AdoIYQAArlASa40S35TqSr1eBwDwkqwdne8xugPbSJaiMZRKxFFml6uwZTyeYWmmyLCQdx+WZXl17cH1W3d/u/Mny7CtyVLt6Knv3tDPeWPhcCa8TcL3Ug98eV9R5EpkSSgVQLkMeYMoAKDK871HtZ2dB1956eWVrZVdkFvnN7ouWV67cG45ducu8scK9vd92IunCQBAsVnwN/wAAMgbasG8IPT29vZoNB0HOm5v3sYAmhV2j3zs6R65CscIboej8J1UCme4QutGhc0qWaA+hUVRGhsb6+vr0+l00Wi01U6UteZFjWHWF06kUCSSTAZ9ftrvByz3JE8rFAkYBlrfX7vRbIKnaiqKClReko+YFzQGTyiKpjMZ5DGV9Ae4hxsqQYC1NXX9PggF/w2sqSjPYFVVn71KY/AE4BSO4zEUg7d8hRvXAUGAe2sASYECB/21GVcVpcpLVUHKF/Z4QeIFWZbrXLHylnleY/QEIwhBkgkUiwa32dXVFpaj20Ogtz9afO+z7/vHl/rHl94dv9Yu+seX3vn0WteJmUPDcwEYpdIZBCPgWJLOc+A/gg6+/+2B487/+9VBZ+fQzOGR2a1wKoXjkSQaisQzNPMc3KN39ejdL3TnkOuwfjH8iMiRuRSCw9H4Dp17Du466Xqhu0+4Xx++0vGF7cfwzV/wXx8m/NuPYghOtuNsw/8Ajfbjhpk2HscAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/89ed56514a8669779e3854794dd41727/fcda8/1677996923425-8ebb29a8-5fc7-43fe-adeb-fdefe569d32b.png\"\n        srcset=\"/static/89ed56514a8669779e3854794dd41727/12f09/1677996923425-8ebb29a8-5fc7-43fe-adeb-fdefe569d32b.png 148w,\n/static/89ed56514a8669779e3854794dd41727/e4a3f/1677996923425-8ebb29a8-5fc7-43fe-adeb-fdefe569d32b.png 295w,\n/static/89ed56514a8669779e3854794dd41727/fcda8/1677996923425-8ebb29a8-5fc7-43fe-adeb-fdefe569d32b.png 590w,\n/static/89ed56514a8669779e3854794dd41727/efc66/1677996923425-8ebb29a8-5fc7-43fe-adeb-fdefe569d32b.png 885w,\n/static/89ed56514a8669779e3854794dd41727/c83ae/1677996923425-8ebb29a8-5fc7-43fe-adeb-fdefe569d32b.png 1180w,\n/static/89ed56514a8669779e3854794dd41727/e8950/1677996923425-8ebb29a8-5fc7-43fe-adeb-fdefe569d32b.png 2000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=bAJ2H></a></p>\n<h1>其他方案及其与 <a href=\"http://Authing.cn\">Authing.cn</a> 方案的对比</h1>\n<p>先说结论，采用 <a href=\"http://Authing.cn\">Authing.cn</a> 开发量最少，仅需要做一些配置即可。以上对核心要件的分析截图中，都没有任何自己的代码，全是 <a href=\"http://Authing.cn\">Authing.cn</a> 实现的。尽管看不到 <a href=\"http://Authing.cn\">Authing.cn</a> 的源码，但是从表现上看，却能够完全推测出其大致思路，这是由于无论采用具体方案去实现，只要是对接微信公众号关注登录，其核心要件是没有区别的。<br />当然也可以看出，所谓低代码，甚至无代码，其实是在另外的地方产生了更多的代码。复杂性无法凭空消失，但是可以转移或者隐藏。在掌握了微信公众号关注登录的核心要件后，至于是自己写，还是用别人写的，都不会再有神秘感了。\n<a name=pHDVE></a></p>\n<h2>基于 Keycloak 的微信公众号关注即登录方案实现</h2>\n<p>详见《基于 keycloak 的关注公众号即登录功能的设计与实现 - Jeff Tian的文章 - 知乎 <a href=\"https://zhuanlan.zhihu.com/p/349504145\">https://zhuanlan.zhihu.com/p/349504145</a>》，该方案基于开源的身份认证系统 Keycloak，魔改了一个微信 OAuth 2.0 的登录插件而实现，它将关注公众号插件作为 Keycloak 的一个身份提供者程序。<br />当时写这个方案前，<a href=\"http://Authing.cn\">Authing.cn</a> 还没有正式推出微信公众号关注登录的方案（也许内部已经实现了，但文档中没有体现）。后来我在一篇对比 Keycloak 和 <a href=\"http://Authing.cn\">Authing.cn</a> 的文章中指出了这一点，他们立即就更新了文档，正式推出了微信公众号关注登录的方案，反应十分迅速，必须点赞。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 145.27027027027026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/9f95086fe35c2f951ff8a3d010a62534/fcda8/1677996966955-aea681d0-008c-4246-bdae-4eaf46b1b45e.png\"\n        srcset=\"/static/9f95086fe35c2f951ff8a3d010a62534/12f09/1677996966955-aea681d0-008c-4246-bdae-4eaf46b1b45e.png 148w,\n/static/9f95086fe35c2f951ff8a3d010a62534/e4a3f/1677996966955-aea681d0-008c-4246-bdae-4eaf46b1b45e.png 295w,\n/static/9f95086fe35c2f951ff8a3d010a62534/fcda8/1677996966955-aea681d0-008c-4246-bdae-4eaf46b1b45e.png 590w,\n/static/9f95086fe35c2f951ff8a3d010a62534/efc66/1677996966955-aea681d0-008c-4246-bdae-4eaf46b1b45e.png 885w,\n/static/9f95086fe35c2f951ff8a3d010a62534/c83ae/1677996966955-aea681d0-008c-4246-bdae-4eaf46b1b45e.png 1180w,\n/static/9f95086fe35c2f951ff8a3d010a62534/29114/1677996966955-aea681d0-008c-4246-bdae-4eaf46b1b45e.png 1920w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />这个方案的难点是必须学习一下 Keycloak，并且基于其提供的接口做二次开发。我的实现基于另一个开源插件进行了魔改，其中扫码状态维护在了内存中，因此只适合于一个服务器实例的 Keycloak。<br />基于 Keycloak 做开发也有好处，那就是登录 UI 等等已经有现成的可以直接利用，账号绑定等等也有系统中现有的整套流程。\n<a name=WVxqf></a></p>\n<h2>基于 Java Spring Security 的微信公众号关注即登录方案实现</h2>\n<p>详见《基于 Java Spring Security 的关注微信公众号即登录的设计与实现 - Jeff Tian的文章 - 知乎 <a href=\"https://zhuanlan.zhihu.com/p/393360806\">https://zhuanlan.zhihu.com/p/393360806</a>》。该方案需要结合 Spring Security，通过自定义的方式实现登录态。<br />之所以做这个方案，是由于收到了一些知乎上的咨询。给我的感觉，国内用 Java、或者说 Spring 框架非常多，有一个团队使用了 Spring Security，希望能加入微信公众号关注即登录的功能，于是我做了一个最小的示例。同时，为了避免单实例服务的限制，将扫码状态维护到了外部存储。这个工程会依赖 Apache Pulsar。<br />这个方案的难点在于一切从 0 开始，所以 UI 上特别简陋，另外还需要学习一下 Spring Security。<br />以上是对自己在微信公众号关注即登录做的一个简要回顾，下面详述如何使用 <a href=\"http://Authing.cn\">Authing.cn</a> 来实现它。\n<a name=hcTIe></a></p>\n<h1>什么是 <a href=\"http://authing.cn/\">Authing.cn</a>？</h1>\n<p><a href=\"http://authing.cn/\">Authing.cn</a> 是一家提供身份认证与授权服务的云平台，拥有完善的身份认证、授权管理等功能。通过 <a href=\"http://authing.cn/\">Authing.cn</a>，您可以快速搭建安全可靠的用户认证和授权系统。\n<a name=f9oWb></a></p>\n<h1>实现方案</h1>\n<p><a name=SFfA2></a></p>\n<h2>步骤一：注册 <a href=\"http://authing.cn/\">Authing.cn</a> 账号</h2>\n<p>首先，我们需要在 <a href=\"http://authing.cn/\">Authing.cn</a> 上注册账号，步骤非常简单，只需要填写一些基本的信息即可。\n<a name=LkQmI></a></p>\n<h2>步骤二：创建应用</h2>\n<p>在注册成功后，我们需要创建一个应用，应用是一个集成了身份认证、授权管理等功能的单元。在创建应用时，需要填写应用名称、应用回调地址等信息。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABV0lEQVR42p1SPWtUQRR9f9LWP5KfILY2BmyChYidTar0KQRBCIog6iZZs3mZj3tn3v2W93ZNit1tPByYYYZz77lnZjh/d/bl86efv1cppZubWyKO46i1plQawtcVvvzYh4f16nZTx2rMRMy0XUT7RO4eEapmZluxL1g2wRrD+s8mFdheRPiRlofPh/vxAQBExPYQ7ix69f3HJpfD4jGVCjhNZOaq9kgRjYjrsZw8f/b29NXc/Z/5J3GDVEpG7CLGrI8kkvAYC1y8fnH+/o0d7Pzhkn/dkSnv295lczyJ4fIbjoXivzCM92vEOW1ZYHuDLU/l5qH2RJnTjKFP86/ovacFtdaJpFHY4tXMSgViwS4ZOAMX5Nq10VxiwNbNnYgAoLXWWxO1iXdiEU25qCoilJxKTrVkEdnZroDM3Nkzam26VPVOjpOTzLNga+6Bk9U+E7rB5NvSfwF5MbmShvBFwQAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/e63b85dc9f33bb34e519fc8d7f61983e/fcda8/1677996939101-3730c77b-c701-418d-996b-b73d13d646f1.png\"\n        srcset=\"/static/e63b85dc9f33bb34e519fc8d7f61983e/12f09/1677996939101-3730c77b-c701-418d-996b-b73d13d646f1.png 148w,\n/static/e63b85dc9f33bb34e519fc8d7f61983e/e4a3f/1677996939101-3730c77b-c701-418d-996b-b73d13d646f1.png 295w,\n/static/e63b85dc9f33bb34e519fc8d7f61983e/fcda8/1677996939101-3730c77b-c701-418d-996b-b73d13d646f1.png 590w,\n/static/e63b85dc9f33bb34e519fc8d7f61983e/efc66/1677996939101-3730c77b-c701-418d-996b-b73d13d646f1.png 885w,\n/static/e63b85dc9f33bb34e519fc8d7f61983e/c83ae/1677996939101-3730c77b-c701-418d-996b-b73d13d646f1.png 1180w,\n/static/e63b85dc9f33bb34e519fc8d7f61983e/e8950/1677996939101-3730c77b-c701-418d-996b-b73d13d646f1.png 2000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=bDam5></a></p>\n<h2>步骤三：配置微信公众号登录</h2>\n<p>接下来，我们需要在 <a href=\"http://authing.cn/\">Authing.cn</a> 上配置微信公众号登录，具体操作如下：</p>\n<ol>\n<li>在社会化身份源中添加一个微信身份源。<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bccceaf42ea5bfb97f0c8964b792d409/e8950/1677996951412-f34d3872-ab5a-412e-b22b-60d825c4ab95.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAp0lEQVR42l2Qy07DQBAE/f//B4oAcQMTwOxmvZ7peS6SFaOEOk1LU4fuaVkKxIhFzUupp6fnh8fTPJ/HGO4eO+5xnJGZ42D6+FwYyhCIiWi9tL4RMZhBDIhsxH2j/UEBAWQc/vT2bedixMrQiBTRcY+IEvFfBMTMrvLLu77O9lWjrGHphavgzidCRNzGdd1a623t00/tl0YMJWhmenpG3sr/eu4TXPkFDAsj+U/dB3EAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/bccceaf42ea5bfb97f0c8964b792d409/fcda8/1677996951412-f34d3872-ab5a-412e-b22b-60d825c4ab95.png\"\n        srcset=\"/static/bccceaf42ea5bfb97f0c8964b792d409/12f09/1677996951412-f34d3872-ab5a-412e-b22b-60d825c4ab95.png 148w,\n/static/bccceaf42ea5bfb97f0c8964b792d409/e4a3f/1677996951412-f34d3872-ab5a-412e-b22b-60d825c4ab95.png 295w,\n/static/bccceaf42ea5bfb97f0c8964b792d409/fcda8/1677996951412-f34d3872-ab5a-412e-b22b-60d825c4ab95.png 590w,\n/static/bccceaf42ea5bfb97f0c8964b792d409/efc66/1677996951412-f34d3872-ab5a-412e-b22b-60d825c4ab95.png 885w,\n/static/bccceaf42ea5bfb97f0c8964b792d409/c83ae/1677996951412-f34d3872-ab5a-412e-b22b-60d825c4ab95.png 1180w,\n/static/bccceaf42ea5bfb97f0c8964b792d409/e8950/1677996951412-f34d3872-ab5a-412e-b22b-60d825c4ab95.png 2000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>在这个身份源中添加微信公众号关注：<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5e058fc7dd3e201f3e0580b2df5273f8/e8950/1677996965802-f5c6a4f2-76f2-4b26-a2e7-25f87870833c.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.810810810810814%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA90lEQVR42oWQy1LDMAxF8/9/xr6LFGY6FNq0SYljO7ZlW9I1hOkwPBZIWt4zOlJnFktEtUiQ+LqcvQsAVBXQ9l91xvHNciSpUlMOpdRSmVm2FvkLAKi13uHJlJeRUtIh6HEpUss91GACs2LLN3yDm8hdqvNrWJwDyzGm/WwpJq8rKTU059u2Gz8GgAAqCqAzi1+sZ1Zr/TBMkeiR9zve9dw/2L7PTwc5XHmMkqKkJESSQ05+jaLopttsFldFnVmnq6GcP501tPDsreGVWpwxn/V00WHC+NZuFz95Fzdt69YQUq7IaXbmlHL9OnJ2oILfD2tNsDl/wO+GSZbRK7DyHAAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/5e058fc7dd3e201f3e0580b2df5273f8/fcda8/1677996965802-f5c6a4f2-76f2-4b26-a2e7-25f87870833c.png\"\n        srcset=\"/static/5e058fc7dd3e201f3e0580b2df5273f8/12f09/1677996965802-f5c6a4f2-76f2-4b26-a2e7-25f87870833c.png 148w,\n/static/5e058fc7dd3e201f3e0580b2df5273f8/e4a3f/1677996965802-f5c6a4f2-76f2-4b26-a2e7-25f87870833c.png 295w,\n/static/5e058fc7dd3e201f3e0580b2df5273f8/fcda8/1677996965802-f5c6a4f2-76f2-4b26-a2e7-25f87870833c.png 590w,\n/static/5e058fc7dd3e201f3e0580b2df5273f8/efc66/1677996965802-f5c6a4f2-76f2-4b26-a2e7-25f87870833c.png 885w,\n/static/5e058fc7dd3e201f3e0580b2df5273f8/c83ae/1677996965802-f5c6a4f2-76f2-4b26-a2e7-25f87870833c.png 1180w,\n/static/5e058fc7dd3e201f3e0580b2df5273f8/e8950/1677996965802-f5c6a4f2-76f2-4b26-a2e7-25f87870833c.png 2000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>填写相应的 AppID 和 AppSecret，并保存。这个 ID 和 Secret 以及令牌，都要和微信公众号后台配置一一对应。<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/122affd5e6a43f94c14c85732e525a69/e8950/1677996970539-437771f5-14b7-41cd-84e9-a658dac8d45c.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMklEQVR42o2R3WrDMAyF/c57sr3ILnazMii0aZq0y5w6dhJZsn5GWpbSscE+DsKCc4SR3FsLaZwAYJwmZrZ/oLrUYy/u6Tm8bra7/X7zvu0vgagA5JwRqeDyRoAsN/s3cu1eduy2nc14HacmqvIIizCLPoZXXNX4THpL/2X6FVF1vvelECIxsz6yOEQBUFhMzdR+GFwIcUxTHFKGrGLCKqxclh+bGSkNU5pwzozIxCyrRMS1/hwhohJwXjUzsDIZdfKx8/sqVHWqG2qWufewutofe/BJUpIUOa4KcilWTnyqpqqG+gCHtrS3/d3DcRzDGPs0XGKAkjNjZoSSPXk07ErXhLaD/lJii+eZMrMWlsLLIdzus2rTOUoceEiabooaZ53NDJWGHAeIicaJZr4uYj3VF1RcRjt6O4GHAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/122affd5e6a43f94c14c85732e525a69/fcda8/1677996970539-437771f5-14b7-41cd-84e9-a658dac8d45c.png\"\n        srcset=\"/static/122affd5e6a43f94c14c85732e525a69/12f09/1677996970539-437771f5-14b7-41cd-84e9-a658dac8d45c.png 148w,\n/static/122affd5e6a43f94c14c85732e525a69/e4a3f/1677996970539-437771f5-14b7-41cd-84e9-a658dac8d45c.png 295w,\n/static/122affd5e6a43f94c14c85732e525a69/fcda8/1677996970539-437771f5-14b7-41cd-84e9-a658dac8d45c.png 590w,\n/static/122affd5e6a43f94c14c85732e525a69/efc66/1677996970539-437771f5-14b7-41cd-84e9-a658dac8d45c.png 885w,\n/static/122affd5e6a43f94c14c85732e525a69/c83ae/1677996970539-437771f5-14b7-41cd-84e9-a658dac8d45c.png 1180w,\n/static/122affd5e6a43f94c14c85732e525a69/e8950/1677996970539-437771f5-14b7-41cd-84e9-a658dac8d45c.png 2000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>由于我没有公司，申请不了服务号。但是好在微信提供了测试公众号，拥有和服务号相同的能力，只是有 100 个粉丝的上限。以下截图中的 appID、appsecret 以及 Token 对应上图中框出来的值。<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/12e87095c564b9f939fe23f40fd22869/e8950/1677996983767-8982af4a-47b1-41d4-8828-696fb16d76dd.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.70270270270271%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKUlEQVR42oWPb2+DIBCH/f7faq+X7N2SrX9s66qCinAcgoLAosSua9L0yRNyRyC/u+yj+Py6Hr/LfFedDuSS058jKRZpceWkFPTmQ1v0VfZWvneMNbzrRD+MZlMv5/SoTtrR2JFLkWllJCoARBzU6n3xoAAEITkHkEpKlYUQGOvO55MxJr5CryDiaGcf4vJZa805N8ZM0zSOo36OWUlvgvdZjLFt291+X5Zlnud1XQshAEA+B1bmeV6SnXPGGESklCKi1tpa+3KFEMKSLIQ4HHPag9Z6GAalFG781VKihC11S44xIuLlUlSEUErrFUpp0zTVCiGEsa7tGBG6k8vCCe/9MnZqEKXYSItxzvu+BwDnrPd+9nEO/8cOIdgV51wIId0mbnV6m7znFyfjdU6MwTcUAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/12e87095c564b9f939fe23f40fd22869/fcda8/1677996983767-8982af4a-47b1-41d4-8828-696fb16d76dd.png\"\n        srcset=\"/static/12e87095c564b9f939fe23f40fd22869/12f09/1677996983767-8982af4a-47b1-41d4-8828-696fb16d76dd.png 148w,\n/static/12e87095c564b9f939fe23f40fd22869/e4a3f/1677996983767-8982af4a-47b1-41d4-8828-696fb16d76dd.png 295w,\n/static/12e87095c564b9f939fe23f40fd22869/fcda8/1677996983767-8982af4a-47b1-41d4-8828-696fb16d76dd.png 590w,\n/static/12e87095c564b9f939fe23f40fd22869/efc66/1677996983767-8982af4a-47b1-41d4-8828-696fb16d76dd.png 885w,\n/static/12e87095c564b9f939fe23f40fd22869/c83ae/1677996983767-8982af4a-47b1-41d4-8828-696fb16d76dd.png 1180w,\n/static/12e87095c564b9f939fe23f40fd22869/e8950/1677996983767-8982af4a-47b1-41d4-8828-696fb16d76dd.png 2000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>另外，接口配置信息里，有一个 URL，这个后面我们进行详解。这个接口，是用来接收微信发来的消息的。</li>\n</ol>\n<p><a name=aEEoD></a></p>\n<h2>步骤四：集成登录功能</h2>\n<p>在完成上述步骤后，我们需要在应用中集成登录功能。具体集成方式可以参考 <a href=\"http://authing.cn/\">Authing.cn</a> 提供的文档。<br />如果仔细查看 <a href=\"http://Authing.cn\">Authing.cn</a> 的文档，已经 GitHub 上的代码示例，会发现，他们提供了两种集成的方式。第一种方式，是在上图中的 URL 直接填入 <a href=\"http://Authing.cn\">Authing.cn</a> 提供的接口地址。这样有一些弊端，一是只能使用 <a href=\"http://Authing.cn\">Authing.cn</a> 来进行微信公众号关注登录了；二是，微信发送的其他消息也都会被该接口接收，如果还有其他业务需求，就不太好做了。<br />第二种方式，就是在上图中的 URL 填入自己的接口地址，而在自己的接口中，将收到的扫码信息，转发给 Authing 的服务器即可。非常推荐这个方式，而如上图所示，我填入的也是自己的服务接口，采用的就是这个转发的方案。所以，除了最开头的效果展示中的集成了 <a href=\"http://Authing.cn\">Authing.cn</a> 的微信公众号关注登录可以正常运行外，几年前实现的基于 Keycloak 的微信公众号关注登录以及基于 Spring Security 的微信公众号关注登录，都能继续工作。<br />采用第二种方式，最关键的是要将微信发来的消息，原封不动地转发给 Authing，这个转发目的地址，官方文档也有说明，对于我来说，这个地址就是： <a href=\"https://core.authing.cn/connections/social/brickverse-public/620097b69a9dab5e967d0c44/events\">https://core.authing.cn/connections/social/brickverse-public/620097b69a9dab5e967d0c44/events</a> 。\n<a name=bOj0j></a></p>\n<h1>总结</h1>\n<p>通过上述步骤，我们可以快速实现关注微信公众号登录的功能，而且不需要过多的开发工作。借助 <a href=\"http://authing.cn/\">Authing.cn</a>，我们可以快速搭建安全可靠的用户认证和授权系统，为企业的用户管理提供了有力的支持。</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}