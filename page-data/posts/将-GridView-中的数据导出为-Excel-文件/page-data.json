{"componentChunkName":"component---src-templates-post-js","path":"/posts/将-GridView-中的数据导出为-Excel-文件/","result":{"data":{"sitePage":{"id":"SitePage /posts/将-GridView-中的数据导出为-Excel-文件/"}},"pageContext":{"url":"/posts/将-GridView-中的数据导出为-Excel-文件/","relativePath":"posts/将-GridView-中的数据导出为-Excel-文件.md","relativeDir":"posts","base":"将-GridView-中的数据导出为-Excel-文件.md","name":"将-GridView-中的数据导出为-Excel-文件","frontmatter":{"title":"将 GridView 中的数据导出为 Excel 文件","stackbit_url_path":"posts/将-GridView-中的数据导出为-Excel-文件","date":"2010-05-13 06:25:17","excerpt":"","comments_count":0,"positive_reactions_count":0,"tags":[null],"canonical_url":"https://be-net.azurewebsites.net/post/2010/05/13/将-GridView-中的数据导出为-Excel-文件","template":"post"},"html":"<pre><code>    &#x3C;p>假设在 .aspx 文件中，已有一个名为 GridView_Warehousing 的GridView控件，现在要加入将它导出为Excel文件的功能。&#x3C;/p>\n</code></pre>\n<p>一、首先设置aspx页面EnableEventValidation=\"false\"，如下：</p>\n<p>C# 代码：</p>\n<pre class=\"brush: csharp\">&lt;%@ Page Title=\"入库 - 嘉里大通诺基亚仓库管理系统\" Language=\"C#\" MasterPageFile=\"~/MasterPage/Operator.master\" AutoEventWireup=\"true\" CodeFile=\"Warehousing.aspx.cs\" Inherits=\"Operator_Warehousing\" EnableEventValidation=\"false\" %&gt;\n</pre>\n<p>二、在页面中加入一个按钮，如下：</p>\n<p>C# 代码：</p>\n<pre class=\"brush: csharp\">&lt;asp:Button id=\"btnExport\" runat=\"server\" Text=\"以Excel文件格式导出\" onclick=\"btnExport_Click\" /&gt;\n</pre>\n<p>三、后台关键代码：</p>\n<p>C# 代码：</p>\n<pre class=\"brush: csharp\">    /// &lt;summary&gt;\n    /// 以 Excel 文件格式导出 按钮按下事件\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"sender\"&gt;&lt;/param&gt;\n    /// &lt;param name=\"e\"&gt;&lt;/param&gt;\n    protected void btnExport_Click(object sender, EventArgs e)\n    {\n        Export(\"application/ms-excel\", \"入仓储确认单.xls\");\n    }\n<pre><code>/// &#x26;lt;summary&#x26;gt;\n/// 以 Excel 文件格式导出\n/// &#x26;lt;/summary&#x26;gt;\n/// &#x26;lt;param name=\"fileType\"&#x26;gt;&#x26;lt;/param&#x26;gt;\n/// &#x26;lt;param name=\"fileName\"&#x26;gt;&#x26;lt;/param&#x26;gt;\nprivate void Export(string fileType, string fileName)\n{\n    // 以下三行可选，如果没有的话导出的只是当前页数据，没有其他页数据\n    //this.GridView_Warehousing.AllowPaging = false;\n    //this.GridView_Warehousing.AllowSorting = false;\n    // 绑定 GridView\n\n    // 导出时隐藏操作列\n    this.GridView_Warehousing.Columns[0].Visible = false;\n    // 隐藏分页行\n    this.GridView_Warehousing.BottomPagerRow.Visible = false;\n    Response.Clear();\n    Response.Buffer = true;\n    Response.ContentEncoding = System.Text.Encoding.GetEncoding(\"GB2312\");\n    Response.AppendHeader(\"Content-Disposition\", \"attachment;filename=\" + HttpUtility.UrlEncode(fileName, System.Text.Encoding.UTF8).ToString());\n    // 设置输出文件类型为excel文件\n    Response.ContentType = \"application/ms-excel\";\n    System.IO.StringWriter stringWriter = new System.IO.StringWriter();\n    System.Web.UI.HtmlTextWriter htmlTextWriter = new System.Web.UI.HtmlTextWriter(stringWriter);\n    this.GridView_Warehousing.RenderControl(htmlTextWriter);\n    Response.Output.Write(stringWriter.ToString());\n    Response.Flush();\n    Response.End();\n}\n\n/// &#x26;lt;summary&#x26;gt;\n/// 这个方法是配合导出 Excel 功能的，内容不用写\n/// &#x26;lt;/summary&#x26;gt;\n/// &#x26;lt;param name=\"control\"&#x26;gt;&#x26;lt;/param&#x26;gt;\npublic override void VerifyRenderingInServerForm(Control control)\n{\n}\n</code></pre>\n</pre>\n<p>四、如果发现点击按钮出现 JavaScript 错误，则可能是由于页面中加入了 UpdatePanel 所致，如果是这个原因，就需要给 UpdatePanel 添加 Triggers 节点，如下：</p>\n<p>C# 代码：</p>\n<pre class=\"brush: csharp\">        &lt;Triggers&gt;\n            &lt;asp:PostBackTrigger ControlID=\"btnExport\" /&gt;\n        &lt;/Triggers&gt;\n</pre>\n<p>&nbsp;</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","description":"Full Stack Developer, good at OAuth 2.0","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"本站源码","url":"https://github.com/Jeff-Tian/space","style":"link","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[]}