{"componentChunkName":"component---src-templates-post-js","path":"/posts/tbclv3hgf07lfovs/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/tbclv3hgf07lfovs","relativePath":"posts/tbclv3hgf07lfovs","frontmatter":{"title":"选择 Pulumi 做为 IaC 框架","stackbit_url_path":"posts/tbclv3hgf07lfovs","date":"2024-03-13T12:25:00","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a name=t78rW></a></p>\n<h1>背景</h1>\n<p>之前发了一篇《<a href=\"%5Bhttps://zhuanlan.zhihu.com/p/684830618%5D(https://zhuanlan.zhihu.com/p/684830618)\">Pulumi 惊艳到我了（还可以无限免费薅 AI 羊毛） - Jeff Tian的文章 - 知乎</a> 》，有人留言希望我分享一下我们对 Pulumi 和别的方案做过的对比。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.21621621621622%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABDUlEQVR42n2R627CMAxG+/5vtxt/GOs2Nia60httncRJztQgLh0IS5b9ScnxLQNwGinawG8X+SwjX7vIeheT3raRbmRmMcZTvPTJMiYBiAOxkf2oDMbTi2ec4qgY63GqOKd4H65gl4WyKWn3PYvXNWKVpu0wxmKdQ4xhGCXpfpDk1unN7s4dAmW143nxhEwf+wFV5Z6dIdedZsdE5AC7tav/oMlCCFRVTV23WGvnI4fgeXl8IM9zvjc/NE2TRvUh4JxDvU8rmCCX4EmHEAmpyOEW2fFBWWxZLlesVm/k7x9sN590dUlVNfR9T1EUiMgMKMahwwjWJhjHDuejxXRNgoOgd/YXEetwYoiqJ+Af+mpzQLuGow0AAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/b6c46d7376f79d8920358cd5e4ced33e/fcda8/1710328380287-dcb4d26b-9f2e-4a26-a316-d906905fe284.png\"\n        srcset=\"/static/b6c46d7376f79d8920358cd5e4ced33e/12f09/1710328380287-dcb4d26b-9f2e-4a26-a316-d906905fe284.png 148w,\n/static/b6c46d7376f79d8920358cd5e4ced33e/e4a3f/1710328380287-dcb4d26b-9f2e-4a26-a316-d906905fe284.png 295w,\n/static/b6c46d7376f79d8920358cd5e4ced33e/fcda8/1710328380287-dcb4d26b-9f2e-4a26-a316-d906905fe284.png 590w,\n/static/b6c46d7376f79d8920358cd5e4ced33e/efc66/1710328380287-dcb4d26b-9f2e-4a26-a316-d906905fe284.png 885w,\n/static/b6c46d7376f79d8920358cd5e4ced33e/c83ae/1710328380287-dcb4d26b-9f2e-4a26-a316-d906905fe284.png 1180w,\n/static/b6c46d7376f79d8920358cd5e4ced33e/9ce1c/1710328380287-dcb4d26b-9f2e-4a26-a316-d906905fe284.png 1886w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />今天就来分享一下这个对比，希望有参考作用。</p>\n<p>正如前文所说，我们之前用过 CloudFormation 甚至纯脚本的基础设施即代码，但是终于有一天受不了了，希望能够转而使用现代化的、更易于维护的方案。这种改变的主要原因有：</p>\n<ul>\n<li>使用 CloudFormation 或者其他的基于yaml 或者 json之类的方案，非常难以阅读和维护</li>\n<li>抽象级别太低，要使用 CloudFormation 进行稍微复杂一些的构建会非常麻烦。\n<ul>\n<li>比如，在 CloudFormation 中写一个条件表达式会非常混乱；又比如，要引用另外一个堆栈也很不直观；再比如，当需要在两个堆栈中共享一些代码时，又或者当需要在多个环境（开发、测试、生产等）中创建相同类型但是在不同环境中属性值不同的多个资源时，也非常困难。所有这些难点，在一种能够使用编程语言的 IaC 框架中，那都不是事儿。</li>\n</ul>\n</li>\n</ul>\n<p><a name=ZUA1L></a></p>\n<h1>考虑过的方案对比</h1>\n<p>一共对比了 4 种方案，分别是：</p>\n<ul>\n<li>Pulumi</li>\n<li>Terraform CDK</li>\n<li>AWS CDK</li>\n<li>CloudFormation</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Pulumi</th>\n<th>Terraform CDK</th>\n<th>AWS CDK</th>\n<th>CloudFormation</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>参考链接</td>\n<td><a href=\"https://www.pulumi.com/docs/\">Documentation</a></td>\n<td>[CDK for Terraform</td>\n<td>Terraform</td>\n<td>HashiCorp Developer](<a href=\"https://developer.hashicorp.com/terraform/cdktf\">https://developer.hashicorp.com/terraform/cdktf</a>)</td>\n</tr>\n<tr>\n<td>优势</td>\n<td><br />- 直观的 API 接口<br />- 庞大的社区群体，良好的文档<br />- 支持多个云厂商<br />- 多种编程语言可供选择，你可以选择你喜欢的<br />- 对自动化测试友好<br /></td>\n<td><br />- 支持多个云厂商<br />- 多种编程语言可供选择<br />- 对漂移检测支持得很好<br />- 对自动化测试友好<br /></td>\n<td><br />- 对自动化测试友好<br />- 新特性更新及时<br />- 多种编程语言可供选择<br />- 良好的文档<br /></td>\n<td><br />- 声明式<br />- 良好的文档<br /></td>\n</tr>\n<tr>\n<td>劣势</td>\n<td><br />- 新特性可能会有滞后<br />- 使用 Pulumi Cloud 的价格不够透明<br /></td>\n<td><br />- 还在 Beta 阶段<br />- 不够成熟<br />- 新特性可能会有滞后<br /></td>\n<td><br />- AWS 专有<br />- 漂移检测不是最好的<br />- 自定义规则写起来太琐碎了<br />- 底层还是使用了 CloudFormation<br /></td>\n<td><br />- 漂移检测不是最好的<br />- AWS 专有<br />- 慢<br />- 只能用 yaml/json<br />- 很难抽象<br /></td>\n</tr>\n<tr>\n<td>风险</td>\n<td>学习曲线有点陡峭</td>\n<td>学习曲线有点陡峭</td>\n<td>基于了 CloudFormation，从而拥有 CloudFormation 的劣势</td>\n<td>团队陷入了yaml/json的泥潭</td>\n</tr>\n</tbody>\n</table>\n<p>经过比较后，我们对其进行了采纳的优先级排序：</p>\n<ol>\n<li>Pulumi</li>\n<li>Terraform CDK</li>\n<li>AWS CDK</li>\n<li>CloudFormation</li>\n</ol>\n<p><a name=vd2ZC></a></p>\n<h1>其他人对 Pulumi 的意见</h1>\n<p>我们也咨询了社区里其他使用 Pulumi 的团队，得到如下反馈：\n<a name=vCd5a></a></p>\n<h2>好的方面</h2>\n<ul>\n<li>易于测试</li>\n<li>周围越来越多的人开始使用 Pulumi 了</li>\n<li>只需要少量 yaml 代码，就能在诸如 GitHub Actions 的 CI/CD 流水线中运行起来<br />一个例子：<a href=\"https://github.com/Jeff-Tian/okteto-infra/actions/runs/7524112949/job/20478431724\">https://github.com/Jeff-Tian/okteto-infra/actions/runs/7524112949/job/20478431724</a><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVR42qWT6W6DMBCEeY7m4jS+sLE5o6rv/1hT7UYg2iYkan6M1kL4086ON4n9jNBP8GGAa3s0bQcXerTdBOsjf7MuQEiDUiiUQu8qkX4EKRMOWe3WWjcDzoVhHVLJOmYKx0zuKlFxhm5HVDpAmMj1Ut5AaWWRVg3OhcYhrV9SIpsBpp2RieaHdDtD+RG6nVCqwNCbzOb8V0mlIwia136F5bWDjVc03SdL2A6FbFGo50roMlnbwsgyzaPUAbn0fP64iNcsE2DRFnjKNQcj3cghPQtjDWULWip1TLMStofyEyoT12D+DaQuK9MxkJKmnxfgHngXWOrI0GWmb3VIIss0R0rvlKs3LVcWys9wwxekn3Auzesp/waSxVwFCHdFbkakssOpsDhmDzrMFa8luXgIpO242Q08S5YKvAA0AnqfS102iO7dB1aWQbQhFAptCb/NQt/tcGv5G5F5sO4SvlMRAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/6b2ba815527615d68973860f6213f6ca/fcda8/1710330672289-500e7229-d2a9-4257-8edd-a432972a3f09.png\"\n        srcset=\"/static/6b2ba815527615d68973860f6213f6ca/12f09/1710330672289-500e7229-d2a9-4257-8edd-a432972a3f09.png 148w,\n/static/6b2ba815527615d68973860f6213f6ca/e4a3f/1710330672289-500e7229-d2a9-4257-8edd-a432972a3f09.png 295w,\n/static/6b2ba815527615d68973860f6213f6ca/fcda8/1710330672289-500e7229-d2a9-4257-8edd-a432972a3f09.png 590w,\n/static/6b2ba815527615d68973860f6213f6ca/efc66/1710330672289-500e7229-d2a9-4257-8edd-a432972a3f09.png 885w,\n/static/6b2ba815527615d68973860f6213f6ca/c83ae/1710330672289-500e7229-d2a9-4257-8edd-a432972a3f09.png 1180w,\n/static/6b2ba815527615d68973860f6213f6ca/f45e2/1710330672289-500e7229-d2a9-4257-8edd-a432972a3f09.png 2628w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></li>\n<li>在简单场景下并不需要使用 Pulumi Cloud</li>\n<li>可以将已经存在的基础设施资源及状态导入到自己喜欢的编程语言中</li>\n<li>可以使用 AWS S3 作为状态的备份</li>\n<li>可以和代码仓库做深度集成，比如每次提交 PR 后，自动预览变化。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7b90e87f6e5c74e3f817c6a35819ecb2/60ab9/1710331025258-d29a08fd-222b-4840-a917-d50fe7b24823.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.10810810810811%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABy0lEQVR42nVSyZabMBD0n4wNZhOSkAQCjNm8YTuz2bnkmh/I/x8rTwLPcyb2oV63Wk11daGZSnN0mz2UztFWr9jWV1R1h1SX4CIFlxkSqcFEhjBOEBKOiDAEEUUQxXegCAnFbOEzvCwpXjyC3fo3Xjd/IMseiW7AszWY7sDyDajeIpA9gmSNkGl4RGEZCSwjaeGECeY+w8wJOG6gUiJWKVTZg6UVmKrGmFaIRYGIa4Qss4QhvwPTIFwjL/tR4Y1w7jEwuULRHEZ1qkKia8RyBTdMJgi4kfg6G5ULn4MmGX6cL/8qnHvUflx2J+TNAVm1tWpF3k4W1GDpGlRVNr+dDZZEwiXyf0IiCjT7d2zPV/SnC5r9m43D+y9sTj/RHD7RH6/ojxd0wwX17g2r7gSPSCx8+lhhN3xa0m74sCjaI9rDhyXMmwFld0ReHyyy9c6qH1dnDwhFaQmLZgARJahafa1phpl7U7e5vMXVc0LTbNRVm/M4PW9Hn4xfk2/fYT18RGgKfpwiYBn8WNknYfKATmDfcKvT1P7xJ4TKGuxGyj5WU3enaO7v4QQMTsht33NCIhAnOWgxIOClJffsEIX7XsfncKMEHpeTgHHlv12Id/wR+PBfAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/7b90e87f6e5c74e3f817c6a35819ecb2/fcda8/1710331025258-d29a08fd-222b-4840-a917-d50fe7b24823.png\"\n        srcset=\"/static/7b90e87f6e5c74e3f817c6a35819ecb2/12f09/1710331025258-d29a08fd-222b-4840-a917-d50fe7b24823.png 148w,\n/static/7b90e87f6e5c74e3f817c6a35819ecb2/e4a3f/1710331025258-d29a08fd-222b-4840-a917-d50fe7b24823.png 295w,\n/static/7b90e87f6e5c74e3f817c6a35819ecb2/fcda8/1710331025258-d29a08fd-222b-4840-a917-d50fe7b24823.png 590w,\n/static/7b90e87f6e5c74e3f817c6a35819ecb2/efc66/1710331025258-d29a08fd-222b-4840-a917-d50fe7b24823.png 885w,\n/static/7b90e87f6e5c74e3f817c6a35819ecb2/c83ae/1710331025258-d29a08fd-222b-4840-a917-d50fe7b24823.png 1180w,\n/static/7b90e87f6e5c74e3f817c6a35819ecb2/60ab9/1710331025258-d29a08fd-222b-4840-a917-d50fe7b24823.png 2450w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n</ul>\n<p><a name=ZJyFy></a></p>\n<h2>不好的方面</h2>\n<ul>\n<li>Bug 比 Terraform 多 —— Pulumi 尝试集中力量赶上 Terraform 所拥有的功能，所以可能在 BUG 修复上慢了一些</li>\n<li>Pulumi Cloud 可能并不便宜，起码价格并不透明（听说有的团队在使用，需要一年支付 1 万美元）</li>\n<li>听到有人说 Pulumi 其实比 CloudFormation 更慢，可能是由于不像其他的 IaC 框架，它的堆栈状态验证发生在操作之间，而不是在所有的操作开始之前。</li>\n</ul>\n<p><a name=ZpB4G></a></p>\n<h1>关于 Pulumi Cloud</h1>\n<p>Pulumi Cloud 有一些很好的功能：</p>\n<ul>\n<li>一目了然的资源可视化<br />比如这是 Pulumi 的资源地图：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/347f551f06b02560e3e8f7cdcd9965b7/e8dc9/1710332029291-9f955607-1527-4716-bd1f-e8efd2ba811e.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB3ElEQVR42q1STW/TQBD1n0kjFcUFidIKKn4uF8SBhrQptVEOReJUDtzSAxVO6uDa8a6/dtcf+8qOZddKe2Sk0axn1m/evFnr7fExXh8ewrZt2PYBxclkgvF4jL29593URqMRJraNN0dH2N9/gYNXL/Hu/Qms+dk5ZtM5pp/PMPsyw9eLORzHIXddF47j9rH1tnZ56WCxWODq6jtc9xumn07x8cMpLKUk/oexZYj1LwYrjmMwxpHyAqKQKMsSQggopZDnOZQsIYsapaooX1UV6rruY3fWBKthFUWBjCv8OF8jDsSTzlIIRNsIUj5OorV+ck83mtxK05QSddVQNCyyNCMAxhhWfzzcLG9wH4ZIEw7P88A574GH4OZsZVnWFtAWuzGMJ0kCFjNq0jQNwuAvfl5f4/ftLX0PQTtgy2iWZzmEkM+O0pmRhkX3UFKiEAIpj9GYxk2DUkmsPI+msoygw069yFoTi6oqKcc4B4sCupukGcLNHZQUqOoaUhRYLpfUiBgOhaYtF+1yDJDIM5Rm42Z5CUdTVxBSIgw2YPGWtmsYbnyfXoZlfurAdgUemnlCSRyhrkpiEvgrbKOwB1yvV0SGlrIr7q4/Ms9JBgMYBRukSYJGawL0/Tuof4APkxFrTlqewdYAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/347f551f06b02560e3e8f7cdcd9965b7/fcda8/1710332029291-9f955607-1527-4716-bd1f-e8efd2ba811e.png\"\n        srcset=\"/static/347f551f06b02560e3e8f7cdcd9965b7/12f09/1710332029291-9f955607-1527-4716-bd1f-e8efd2ba811e.png 148w,\n/static/347f551f06b02560e3e8f7cdcd9965b7/e4a3f/1710332029291-9f955607-1527-4716-bd1f-e8efd2ba811e.png 295w,\n/static/347f551f06b02560e3e8f7cdcd9965b7/fcda8/1710332029291-9f955607-1527-4716-bd1f-e8efd2ba811e.png 590w,\n/static/347f551f06b02560e3e8f7cdcd9965b7/efc66/1710332029291-9f955607-1527-4716-bd1f-e8efd2ba811e.png 885w,\n/static/347f551f06b02560e3e8f7cdcd9965b7/c83ae/1710332029291-9f955607-1527-4716-bd1f-e8efd2ba811e.png 1180w,\n/static/347f551f06b02560e3e8f7cdcd9965b7/e8dc9/1710332029291-9f955607-1527-4716-bd1f-e8efd2ba811e.png 3408w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br />比以下 AWS 自己提供的好多了：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a74bca6e2b8772eafb74516571907678/e8649/1710332175760-fa2e0b2b-9e8e-4c6c-83e5-3ab658731b3e.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACCElEQVR42mVR25aiQAzkI3a8iwIi16aBprnYiiLuzO7/f1DtSWRmnLMPOTldSVVSaes2DDDDO6raQOYVMllBSoVKt2hbg3M/wPQj2suI5jyimXLV9tCnG/RpQHt+oOt/M26V1YD89AeZHpBVA4S6odCEjZCFgdBXyOoMeXogbR+IdQ+h7ijrO4rLX4j6A0XzAVGPSPUIy48EVGOQyApxphCmBWRtUN/eEUvNeCQUiraHaC6MRaJAkmuUZkDe9fwOkxxBlMHywwyFNpBVx8QwLZHmNaTqkJUtMvXEVXOBqs9Tj+IcT/HJ8wIByzumCMsO7jGF68dwD89Y2wesNi5WWw/rrYeN7WO7PzK+njCKZ/3Zu3NDWK6fICsaeKHE1glgOyFsJ2Dydh98xWZHYv4PnDAK4lHeexGsIM4h2yvivOa1nUOMSJTQ3RVUi7OKB5TawFwf3EMWSbgxN3SXO/eFSQEvSGEdI4lQKPZP9mntKC35Zn4kESQFDyECOaEt6E1D6H70B8QhnPgWFWeLLebLHearPWcaUlQnbrT3TyuEJULxrZYblzekwVRfrh2+JQtS89t8ElzYeJvbCCKJsja8yed0Pk3ZYOcGTCZBx4tgO98fxTf8IbjcsSDZ023/IhizoJCardr8CT5+zTaYLWyOt9mGh/wnSEVaPZX6yzIJvJ5kMeXXIA3q+wd5bmRx2Tg2ZgAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/a74bca6e2b8772eafb74516571907678/fcda8/1710332175760-fa2e0b2b-9e8e-4c6c-83e5-3ab658731b3e.png\"\n        srcset=\"/static/a74bca6e2b8772eafb74516571907678/12f09/1710332175760-fa2e0b2b-9e8e-4c6c-83e5-3ab658731b3e.png 148w,\n/static/a74bca6e2b8772eafb74516571907678/e4a3f/1710332175760-fa2e0b2b-9e8e-4c6c-83e5-3ab658731b3e.png 295w,\n/static/a74bca6e2b8772eafb74516571907678/fcda8/1710332175760-fa2e0b2b-9e8e-4c6c-83e5-3ab658731b3e.png 590w,\n/static/a74bca6e2b8772eafb74516571907678/efc66/1710332175760-fa2e0b2b-9e8e-4c6c-83e5-3ab658731b3e.png 885w,\n/static/a74bca6e2b8772eafb74516571907678/c83ae/1710332175760-fa2e0b2b-9e8e-4c6c-83e5-3ab658731b3e.png 1180w,\n/static/a74bca6e2b8772eafb74516571907678/e8649/1710332175760-fa2e0b2b-9e8e-4c6c-83e5-3ab658731b3e.png 2968w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>通过 UI 就可以和代码仓库做深度集成<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3aff7dce24718cb19b30d40eaa81358c/1cc3c/1710332206686-cc07a878-a03a-460a-b129-ac427e76948c.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.78378378378379%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACLklEQVR42pVUy5LiMAzMtwBH4LC7xZ8M5MFpDlvFZ+9cBkgcJ7HzttNbUhDLMDOHdVWXFEVptSU7wa8fP7Hb7bDdbrHZbLFeb25YY7PZcJz81WqF5XKJxWLJdvYXnxD8fn3F6XTC4RAiDCNEUYyXlz2iKEIYRdjvD4jjmN8R4iTheBiGSJIEcXxkHI9HJMkRQZZlcM6haRqMo4P3HnVdgxbFrbXsU4x8iok/DiPqamB4P2GaJgQqvaJparRti2EcmPD9/Yzz+Yy+7zmJSMiKTzniu9HN9oZA5Qqm7GCrDrXpOaEsSwapFjVkBc/PBMqleFAUBZqmhTU1urbHOI4wxrA6Uk1q/mcxIX3E28CEYRiQZldorZHnOVcl4q7rGKSEnsUK5DlQSnE/ZHnnYcoGVVWxUrJESi0g1VT4sWfPCEjF3PCZ0A0TLm81SLn0UUgeC3+75cvlwo4kk+369sN2ZMIEac/XmBDImRNCekFDkp7Ietb2ndqAhiDVZ0IHrRXowMtQmtqi69p/Q2ka9OzPhefiZDsEcniFcBw9/rxppGmGNE1RFhrX3KIoDQ/JO4fKWGRK8Q6ot3TU5qH4LwidR6rnKZN6WuerQp5rGFPBTRMGU6DKzmi77tP274Qy5smPsLZEVRlYa7iqKfT92NDKywqpUtwOglxFvsvPCongomaFRaFZpeaDnt8V63rAVVdo6vrD3f6g8KaP/cy20EXBjadk6ZF86PnH4O/X8lHQX1YN3BoBYI0DAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/3aff7dce24718cb19b30d40eaa81358c/fcda8/1710332206686-cc07a878-a03a-460a-b129-ac427e76948c.png\"\n        srcset=\"/static/3aff7dce24718cb19b30d40eaa81358c/12f09/1710332206686-cc07a878-a03a-460a-b129-ac427e76948c.png 148w,\n/static/3aff7dce24718cb19b30d40eaa81358c/e4a3f/1710332206686-cc07a878-a03a-460a-b129-ac427e76948c.png 295w,\n/static/3aff7dce24718cb19b30d40eaa81358c/fcda8/1710332206686-cc07a878-a03a-460a-b129-ac427e76948c.png 590w,\n/static/3aff7dce24718cb19b30d40eaa81358c/efc66/1710332206686-cc07a878-a03a-460a-b129-ac427e76948c.png 885w,\n/static/3aff7dce24718cb19b30d40eaa81358c/c83ae/1710332206686-cc07a878-a03a-460a-b129-ac427e76948c.png 1180w,\n/static/3aff7dce24718cb19b30d40eaa81358c/1cc3c/1710332206686-cc07a878-a03a-460a-b129-ac427e76948c.png 2322w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>部署时的分布式执行器</li>\n<li>可以有组织级别的强制策略</li>\n<li>RBAC 可以和 SSO 绑定<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7354ae72c433b661ed9820c278246725/ae694/1710330545930-dc12d66a-b091-458b-91aa-f73d715675fa.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZklEQVR42o2Ry0rDQBSG+5puXBWKvoBLFy68bl2L7RsIYleCRG0o+gYxliQ0M2luTaZJc+svc9JKAqk48HNmDme++c+cHhprs9lQFEKAMQ7OHXDO4fs+XNfFarX6rdvVNvdy9bqAeZ7Dtm1YloUgCMEYg2ma9FBXfXO1gFVVUdR1HdPpFEVRkDsJCsMQy+USnudhsVggiqL/O5SXZrMZOZUXJVAqSRLEcUxar9edLvc6VFWVAPLvpLOmQ6kgCKiDJlTGToeyTcMwUJYlDSJNU4JnWUZn6Vbmuu52OtQ0DYryChELMJvDdeW/ueDMgef5JJmzbUbaDWuvwygK4fp2/QgyACXFel+gQt7I5a3W28CqBs51gfH9N56GGsYjHePRV63hVtvc450G5cFsTbvdclkDP5/nOD14wfWRisvBhOLVYILz/hsu+u+4OVZJZ4cKbk8+9gN3La+TAtwUcKy/xQ2BwElbwB+ZdkOvqwWRKQAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/7354ae72c433b661ed9820c278246725/fcda8/1710330545930-dc12d66a-b091-458b-91aa-f73d715675fa.png\"\n        srcset=\"/static/7354ae72c433b661ed9820c278246725/12f09/1710330545930-dc12d66a-b091-458b-91aa-f73d715675fa.png 148w,\n/static/7354ae72c433b661ed9820c278246725/e4a3f/1710330545930-dc12d66a-b091-458b-91aa-f73d715675fa.png 295w,\n/static/7354ae72c433b661ed9820c278246725/fcda8/1710330545930-dc12d66a-b091-458b-91aa-f73d715675fa.png 590w,\n/static/7354ae72c433b661ed9820c278246725/ae694/1710330545930-dc12d66a-b091-458b-91aa-f73d715675fa.png 850w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>在不同的云厂商和不同的账号间提供数据洞察<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/161e46badab78f05e01930cca35cdd5a/9b29b/1710332351966-068fff16-5f15-4d3d-932c-5ceed9632331.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.94594594594595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB20lEQVR42o2Ty3LTMBSG/f6pQ0Lohr4ROzZs2DCQkrZRa93PVRIjO4XC0KT//Btr9PlcNWzW47vNOK5XV+O4Wq2ursbZs8ZxHNfjfL5erz/e3Gw2m+32/Xa7u76+/rDbDcf7h5/fpsPeqiozq2p7lgpRSkVK/6itaW2tFe1eNBhjvny6/fr5AClDyjmmnHLOAIB28sf7Jzs5JhRiIWZi6sJSiogMITjIJvtHcIFCwpAhQIoYAwU3TeYuTE8YUvYRIkCilAiRW2vGPA7euRxjjkmQdf69kDArs8YAh1t7u3fmwbsp5siYNToW6nnX2gYiaq8Isux/2P13e39wwSEkzVGsQcJT0cPLDv0jBDLHHtY+hegBE0Pi6JhJTrCIvApnH6xJ1mKIlAAjQP5T84XIpRaMXLS+1FxtPcEA8H+0ttpKtqxSau/OyX/Br6bd71b0LFRUi8rJy/nlmonIuyiki5UUsxRtz+mfhQGydxYh11IWEymiiPQ2maM5B8dg3eMxTpZiAp8wAgJD7svaN1/1HNxDzLNgEWJaGqaqpZTLNS9wrU1Fa6mzG7P8nu45mLtonk2Z32Rdsn1TZABxXkIs1rHz4rw6i9OdpQSX4f5otQgrYl9JRAZAyKDPyC+bEEMXspuKmAAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/161e46badab78f05e01930cca35cdd5a/fcda8/1710332351966-068fff16-5f15-4d3d-932c-5ceed9632331.png\"\n        srcset=\"/static/161e46badab78f05e01930cca35cdd5a/12f09/1710332351966-068fff16-5f15-4d3d-932c-5ceed9632331.png 148w,\n/static/161e46badab78f05e01930cca35cdd5a/e4a3f/1710332351966-068fff16-5f15-4d3d-932c-5ceed9632331.png 295w,\n/static/161e46badab78f05e01930cca35cdd5a/fcda8/1710332351966-068fff16-5f15-4d3d-932c-5ceed9632331.png 590w,\n/static/161e46badab78f05e01930cca35cdd5a/efc66/1710332351966-068fff16-5f15-4d3d-932c-5ceed9632331.png 885w,\n/static/161e46badab78f05e01930cca35cdd5a/c83ae/1710332351966-068fff16-5f15-4d3d-932c-5ceed9632331.png 1180w,\n/static/161e46badab78f05e01930cca35cdd5a/9b29b/1710332351966-068fff16-5f15-4d3d-932c-5ceed9632331.png 3840w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n</ul>\n<p><a name=ObXfe></a></p>\n<h1>最终产出</h1>\n<p>我们最终采纳了 Pulumi 做为 IaC 框架，但是决定不使用 Pulumi Cloud。不使用 Pulumi Cloud 的原因是在我们的使用场景中，只会用到它的堆栈状态存储，从而一年 1 万美元的价格就显得太贵了。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b6db16467f75f4a92ac6658bf8143839/df438/1710331553327-abd13f43-5721-4efa-9b3a-e07a8654035a.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABaUlEQVR42pWS6W6CUBSEfQrjUrAogiwiWGSRpVdxh8Yltu//JtPcYyFao01/TIYfk48595yabvuw/RSjSQLdDkiSMkT7VcWLNCD/S2WOe60p9NF4kdEQZNRbEurtLpqCjKbYr0KCpJGXErpapWsYAQfOBE7wDttL4QQMQzeG4UxhjqcQezo19tgKfrKCn65Jb9MMbrSA4zOC3gDNIEQ431AwZFuMwzlGHO4zdNURrEkMdtxjWXxhvj0hXe4pG2cf8JLVPbAlKj8jXsZudfpodRQSDxjjEElRYLY5IsqK6sf8m7e8A16/zW/xMAfGu5yacbH1EWx9QDTP4UbZP4GSBtONwA4HLPJPZPmZRs92ZySLByM/A/Kl9DQbmu1DG13El8R9YHlQTfd+y49gPCTKBnl5HrfPod/Aqjt81pBLNhwkRY7Z9kSLKd8wzgoYTkj3ep2vPWpXOm8nqRad0EUWSVIsiD3jZlwO/AYQckmQAqQLIwAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/b6db16467f75f4a92ac6658bf8143839/fcda8/1710331553327-abd13f43-5721-4efa-9b3a-e07a8654035a.png\"\n        srcset=\"/static/b6db16467f75f4a92ac6658bf8143839/12f09/1710331553327-abd13f43-5721-4efa-9b3a-e07a8654035a.png 148w,\n/static/b6db16467f75f4a92ac6658bf8143839/e4a3f/1710331553327-abd13f43-5721-4efa-9b3a-e07a8654035a.png 295w,\n/static/b6db16467f75f4a92ac6658bf8143839/fcda8/1710331553327-abd13f43-5721-4efa-9b3a-e07a8654035a.png 590w,\n/static/b6db16467f75f4a92ac6658bf8143839/efc66/1710331553327-abd13f43-5721-4efa-9b3a-e07a8654035a.png 885w,\n/static/b6db16467f75f4a92ac6658bf8143839/c83ae/1710331553327-abd13f43-5721-4efa-9b3a-e07a8654035a.png 1180w,\n/static/b6db16467f75f4a92ac6658bf8143839/df438/1710331553327-abd13f43-5721-4efa-9b3a-e07a8654035a.png 1556w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>额外的好处是，可以按需创建和销毁资源。我能想到的一个常见场景是，做个定时任务，每天上班定时创建出资源并部署测试环境，下班后自动销毁，从而可以节约成本。</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}