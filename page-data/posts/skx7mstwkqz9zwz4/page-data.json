{"componentChunkName":"component---src-templates-post-js","path":"/posts/skx7mstwkqz9zwz4/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/skx7mstwkqz9zwz4","relativePath":"posts/skx7mstwkqz9zwz4","frontmatter":{"title":"多因素身份认证之在 Keycloak 里集成短信注册登录实战","stackbit_url_path":"posts/skx7mstwkqz9zwz4","date":"2024-02-10T03:39:49","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p>传统的用户名和密码认证方式存在被破解或盗用的风险。未来的身份认证趋势将更加强调多因素身份认证，结合多个不同的身份验证要素，如生物识别技术（指纹、面部识别等）、硬件安全令牌等，提供更强的安全性。<br />多因素身份认证（MFA）使用两个或多个因素的任意组合来验证身份并保护重要资产免受欺诈性访问。目前广泛采用的短信验证码，就是多因素身份认证的一个具体形式：双因素身份验证（2FA）。它将密码与发送到移动设备的 SMS 代码结合起来。如果有一个因素受到影响，系统仍然是安全的。<br />可以使用三种因素来确认身份：</p>\n<ul>\n<li>你所拥有的东西—比如银行卡，钥匙或 U 盘。</li>\n<li>你所知道的东西—比如密码或 PIN。</li>\n<li>你本身就是生物识别因素—比如指纹，语音，虹膜扫描和其他物理特征。</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 141.89189189189187%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAIAAADuuAg3AAAACXBIWXMAAAsTAAALEwEAmpwYAAADMUlEQVR42o1TS4/cRBD27+DKgR/CJReu+RP8BC7c4IqQCBKPQ4BDeAjlhIhEFCkoSCA2aJdddic7yezMjj12+9nuV3VVdSPbE7IsMyGlT5bt7q+rvq6vEiQi763RbdPkeZ5u8jTb5IUoq1qUVSFKUZaFEKKshCjLui7ruqqbpu0MUfI0D4/mMcYoHdZSxRDiSwPAt71RZTX76MNEc7y8++DHbz87vfM5Li+rXkupjHUxxrArmNkTEwDMzxMfI7/7wU+vJd+8eaObt5XsmkYqZeL/BXNIgCNLGb/7/s+DZRfHfPGVgokSj+w8bGTnycc4EKWUq9XKWjvuCRriWRrT5sWpdV1nWYqIifPkPTltANAjIzIAWucBEJEJWRm+ELyu2PthdbvBAnhKiENe1Meni7rtJyVThhBe4Nrn9IcoJOA5BI7xOWnPJe+69pAgcW/o0cytS9f3fddrj+QAXwLwCIBEnMTIv87gxnvq4x+axfz09z9OCtG4UfZ/YSxkeblc5702xJwwc1bjVz/bw4UFcFUjRbWXPPGNBef8kBmQmAfNYwyyiYNH2gckJgrjkxOOXKTu7m1xfNCmeXp6Ni+rFjwZCzvSOmilqtveWBjIIYaLc/Pp++nDe8Wzy8Xh0Wy13rRS76tZVG1WVMrYgeyRPVCVeaNGARwQCQC38P/GYCTyyOBxSwb0mW16sBPNe0QkRPZI18iI5IcX2mqOHB83y9cfvnNrdl8sxdFfZ7PzRdfrRqqrxTvATur1pmylblqZbfLBJJHivC/ePr59Lz1StW5kX9WdqNqibETVXhWstK0bqbTttWk7ebVVk6sHjxJtBwCJr/VpaBKyJyIOI5mi7wt78qXJTzZCrlbrVirv2YGfzLjz2p+bJEZKf4tfvGEOPjl+Jg4eHz5dXG5EPZbdlVV3jaaN66Te9nnIbHu7+sW2mbJkrOuVaaXqpO56LZXZPRvTYEyaeXAlEw++u4Z9Pp1axUcV3XyAX8/04slslRYAu735j8l6Zc2kOTIfVvTW/XDnidssl/OLLN2UE4pyx3jpq2TAoeqhiKHqQMxItAXuwbg0kMcjwti3MB3ArwYk/hu0n0JWcbfcOgAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/cae63ec635825907b5a1e17e6123799e/fcda8/1707474459273-c1a72356-4e49-491e-ae89-3766013547fd.png\"\n        srcset=\"/static/cae63ec635825907b5a1e17e6123799e/12f09/1707474459273-c1a72356-4e49-491e-ae89-3766013547fd.png 148w,\n/static/cae63ec635825907b5a1e17e6123799e/e4a3f/1707474459273-c1a72356-4e49-491e-ae89-3766013547fd.png 295w,\n/static/cae63ec635825907b5a1e17e6123799e/fcda8/1707474459273-c1a72356-4e49-491e-ae89-3766013547fd.png 590w,\n/static/cae63ec635825907b5a1e17e6123799e/efc66/1707474459273-c1a72356-4e49-491e-ae89-3766013547fd.png 885w,\n/static/cae63ec635825907b5a1e17e6123799e/c83ae/1707474459273-c1a72356-4e49-491e-ae89-3766013547fd.png 1180w,\n/static/cae63ec635825907b5a1e17e6123799e/5faa8/1707474459273-c1a72356-4e49-491e-ae89-3766013547fd.png 1444w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />上图展示了 authing.cn 的多因素认证界面，其中短信验证码、电子邮箱验证以及 OTP 口令验证就是利用了“你所拥有的东西”，而“人脸识别验证”和“指纹验证”就是将你本身做为了生物识别因素。“密码验证”则是利用了“你所知道的东西”，在当前版本的 authing.cn 的个人中心，“密码”在“账号安全”标签页里。<br />MFA 一般都会从“你本身是识别因素”、“你所知道的东西”和“你所拥有的东西”中选择两个或多个因素，更多地是选择两个因素的组合。\n<a name=CzAGt></a></p>\n<h1>你所拥有的东西</h1>\n<p><a name=hpkf2></a></p>\n<h2>手机（做为令牌）</h2>\n<p>手机作为令牌的优点是，它们是大多数人都拥有的设备，因此不需要额外的硬件或软件。缺点是，手机可以丢失或被盗，而且不是所有人都有手机。另外，实现起来也比较复杂，因为需要开发原生应用，并且要有推送消息的能力。\n<a name=kp4G7></a></p>\n<h2>通过短信发送的一次性密码</h2>\n<p><br />服务器端生成一个一次性密码（OTP），并将其发送到用户注册的手机。用户在登录时输入 OTP，服务器端验证 OTP 是否正确。这种方法的优点是，它不需要任何额外的硬件或软件，因为它使用用户已经拥有的手机。缺点是，它需要用户在登录时输入 OTP，这可能会导致用户体验不佳。另外，短信验证码的接收可能存在延迟或者被拦截，可能需要准备好客户支持或者技术支持进行排查。\n<a name=cwpRM></a></p>\n<h3>案例：在 Keycloak 里集成短信验证码登录</h3>\n<p><br />在 Keycloak 里，可以通过集成第三方的短信服务商，来实现短信验证码登录。这里以阿里云为例，来演示如何在 Keycloak 里集成阿里云的短信服务。<br />尽管国内的互联网生态里使用短信验证码登录十分常见，采用 Keycloak 做为身份认证解决方案的公司也很多，然而 Keycloak 官方却没有现成的短信验证码登录解决方案，这里通过提供一种建议的解决方案，希望对大家有所帮助。 下图展示了最终的效果。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a328e1e5309cec66440cc549c0bda9bd/1e2b7/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.75675675675677%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAADV0lEQVR42kWS/2saZxzHj/2yP2RdINDAulkIlNrUZZ6eyUXPU7Mz583kzpBUwUBYWduxduu+kJZ135KOQrswNspKSOlGmmxstl2sGp0xd6f5qT+sUNokxniZel/0nnuGZ0JfPD88vOHF5/l8Pg8iFEsFnhfEolAqicVS+yIWeVEsljZ5QdwQRKFY5NtJOy9s8AWe3xDFAi9s8AISj8dj0Wj7xKKTk5Mce8DY2BjDMMFgkKIo2iQYDPp9Pq/XSxAet9uD4zgSi8XOmExMTHAcF4lExsfHOY57zyQUCtE0zZgEAgGSJIeGhlwuF2aCcIeMjo6GQqFwODzGsgzDhBjm/bNnp+JTZ6LR6enpaDQaiYy73W4Mw1AHiqKo3W5/KXfqvDsc8BLuwQEXPjjgcQ/hgy6nw445USdqt7/z9uk+a98pq/XkCav15EuZZdnOC89/PPPZ1zcvXZ375MvvL1+7cenq9YtX5i5emftoZvbDz7859+lXH1y+duGLbyenztlsNoRlWY7jOuOhKGp9fR1CaBiGpjX/qzUUVWsoqqKoqqopiqrrOgAAQphOp3t7exGGYcLhME3TFEX5fL58Pm/KoNVsyvWapqmNRr1Sq2/t115ItYqsSWqrLaceW44fRzr7CAQCfr/f6/UeyADUmsaOAjRgQAjpbOXVxWddK1uvLT9/5c6/8U2lsJZ+8y0LMjIyQpn4/X6CIPL5PACgWt2rVKVGE5iusV7Vlp7LiW0lsa38+qz+pAmzmYzFYkECJsPDwyRJ4jiey+UghK1Wq9ObcQg8pJOnUqk3jh1DfD4fSZIEQXg8HqfTmc1mAQDl8q4kSYqiAADaQ9J1Q9chBAYAeqvdczKZ7OnpQUiS9JjgOI6iaDabhRBqqqy3NAPoZvF2wZoKBuaeYrNPT8w8mUnUc5nHR4/2IK5DHA5Hf39/JpNuGnCr2ijvKzuSvCPJZUku78sv9uRlQfq9KN0rVDa3jeTq393d3Ujnl7pcLhRFT/X1Ff5Zu5HT0evb/vld8odd4tYu90s1fLvqvVWhf9pjft4jbpZ/LMBMavXIkdcPZAzDHA7HaZttfn7+r9W1hfsP7q48urvyaHH54eL9hwtLDxaWEgtLiTu//Xn73h8rieTs7HddXV3/A1iRQ2Ym386LAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/a328e1e5309cec66440cc549c0bda9bd/fcda8/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png\"\n        srcset=\"/static/a328e1e5309cec66440cc549c0bda9bd/12f09/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png 148w,\n/static/a328e1e5309cec66440cc549c0bda9bd/e4a3f/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png 295w,\n/static/a328e1e5309cec66440cc549c0bda9bd/fcda8/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png 590w,\n/static/a328e1e5309cec66440cc549c0bda9bd/efc66/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png 885w,\n/static/a328e1e5309cec66440cc549c0bda9bd/c83ae/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png 1180w,\n/static/a328e1e5309cec66440cc549c0bda9bd/1e2b7/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png 1483w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>如何开通了阿里云短信服务不在本文讨论范围，可以参考官网。这里假设已经开通了阿里云短信服务，并且已经有了一个可用的短信模板。接下来我们详细讨论技术实现。\n<a name=DZyfr></a></p>\n<h4>（1）引用开源的 Keycloak 短信验证码登录插件</h4>\n<p>推荐使用 <a href=\"https://github.com/cooperlyt/keycloak-phone-provider\">https://github.com/cooperlyt/keycloak-phone-provider</a> ，从其 release 页面下载最新的 release 包，然后解压到 Keycloak 的 /opt/keycloak/providers/ 目录下，就完成了引用。推荐使用 Dockerfile 来实现这一步，这样可以在容器启动时自动完成这一步，一个示例的 Dockerfile 如下：\ndockerfile\nARG KEYCLOAK_VERSION=21.0.1\nFROM docker.io/library/keycloak-builder as mvn_builder\nFROM quay.io/keycloak/keycloak:${KEYCLOAK_VERSION} as builder\nCOPY --from=mvn_builder /tmp/target/<em>.jar /opt/keycloak/providers/\nCOPY --from=mvn_builder /tmp/target/</em>.jar /opt/keycloak/deployments/</p>\n<p>COPY idps/phone/keycloak-phone-provider.jar /opt/keycloak/providers/\nCOPY idps/phone/keycloak-phone-provider.resources.jar /opt/keycloak/providers/\nCOPY idps/phone/keycloak-sms-provider-aliyun.jar /opt/keycloak/providers/</p>\n<p>ENV KC_HOSTNAME_STRICT=false\nENV KC_HOSTNAME_STRICT_HTTPS=false\nENV KC_HTTP_ENABLED=true</p>\n<p>USER 1000</p>\n<p>RUN /opt/keycloak/bin/kc.sh build --health-enabled=true</p>\n<p>FROM quay.io/keycloak/keycloak:$KEYCLOAK_VERSION\nCOPY --from=builder /opt/keycloak/ /opt/keycloak/\nWORKDIR /opt/keycloak</p>\n<p>ENTRYPOINT [/opt/keycloak/bin/kc.sh, start-dev, --spi-phone-default-service=aliyun, --spi-message-sender-service-aliyun-region=cn-hangzhou, --spi-message-sender-service-aliyun-key=LTA<strong><strong>ZVd, --spi-message-sender-service-aliyun-secret=e6u</strong></strong>Iwd, --spi-message-sender-service-aliyun-auth-template=SMS_13000053, --hostname-strict=false, --features=preview,scripts, --log-level=INFO]</p>\n<p><br />注意，一共需要复制 3 个 jar 包到 /opt/keycloak/providers/ 目录下。最后，在启动 Keycloak 时需要指定一些参数，这些参数可以通过环境变量来传递，也可以通过命令行参数来传递，这里使用了命令行参数的方式。这里需要注意的是，--spi-phone-default-service=aliyun 这个参数，它指定了默认的短信服务商，这里指定为阿里云；另外，一定要用 --spi-message-sender-service-aliyun-auth-template 来指定短信模板，模板内容必须包含一个名为 code 的参数。下图展示了一个可供参考的短信模板。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a40593aeb7324236a0ca99e230e12ead/9d6a9/1707532722182-7dd57da4-d2f8-47df-8a65-5a7be47551c8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABS0lEQVR42m2QSXLcMAxFef8zxReIl2l32W4PrbgljuIsDiIopiQ6XiR+VVgAhY//CyiGULcNUzZcr5TSEGMIAQC276i1Lot3zllrvfeo7wFA3klaKyllrfUfWfuLUvrp6fnh4SylRFqpUooQMyWEai9sVMapUFtrXQYVat3bdlwghJxO51+nMxczUlICgDGGURpTTnmNMcaUY4yllB71U3wgrcWMsXG0SiHvHACklJZlSTE654wx3nuldc55a+3NyBWg9SSt2evV3v90dz+WywX14S4OIefc/kOHZS3lK7a+4elxsBPfckb7ua1N40gI5oxpreWBEIJzbo1Zc/6KvdW6AqytwWGJ+vT992244Rth44QJIUIIjPE0TZRSznk5nPvPOaOvL5ePYdBaI+dcKSu38YObSYe1AMBe/U97U0p37mLnHKV0nueU0h8T9AS117zoPQAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/a40593aeb7324236a0ca99e230e12ead/fcda8/1707532722182-7dd57da4-d2f8-47df-8a65-5a7be47551c8.png\"\n        srcset=\"/static/a40593aeb7324236a0ca99e230e12ead/12f09/1707532722182-7dd57da4-d2f8-47df-8a65-5a7be47551c8.png 148w,\n/static/a40593aeb7324236a0ca99e230e12ead/e4a3f/1707532722182-7dd57da4-d2f8-47df-8a65-5a7be47551c8.png 295w,\n/static/a40593aeb7324236a0ca99e230e12ead/fcda8/1707532722182-7dd57da4-d2f8-47df-8a65-5a7be47551c8.png 590w,\n/static/a40593aeb7324236a0ca99e230e12ead/efc66/1707532722182-7dd57da4-d2f8-47df-8a65-5a7be47551c8.png 885w,\n/static/a40593aeb7324236a0ca99e230e12ead/c83ae/1707532722182-7dd57da4-d2f8-47df-8a65-5a7be47551c8.png 1180w,\n/static/a40593aeb7324236a0ca99e230e12ead/9d6a9/1707532722182-7dd57da4-d2f8-47df-8a65-5a7be47551c8.png 2256w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br />有了上述的 Dockerfile 之后，可以再配置一个 Docker Compose 文件，来方便地启动 Keycloak，一个示例的 Docker Compose 文件如下：\nyaml\nversion: 3</p>\n<p>services:\nkeycloak:\nbuild:\ncontext: .\ndockerfile: Dockerfile\nenvironment:\nKEYCLOAK_ADMIN: admin\nKEYCLOAK_ADMIN_PASSWORD: admin\nPORT: 8080\nDB_VENDOR: h2\nports:\n- 8080:8080\n- 9990:9990\nvolumes:\n- ~/.m2/repository:/root/.m2/repository</p>\n<p>通过 docker compose up --build 命令，就可以启动 Keycloak 了。\n<a name=Vrwyx></a></p>\n<h4>（2）配置登录流程</h4>\n<p>在 Keycloak 启动后，通过账号 admin、密码 admin 登录后台，创建一个安全领域 Realm，给它取一个名字。如下图所示。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e685b104fea82f4961a483e9e38c2b24/4654d/1707532787622-1ce9d60d-bbac-4c4a-9473-8e40014f43c7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABgElEQVR42o3P207iUBQG4F54yJhIDEKPUrRSAVvFROMDGH0cJx7ii5QrLmagDN6M8FwSy97dB6HSvXe3EUJiRuP4ZV2smz//WspgMHh46P/uhL/a7XYYdsJuJ+x2e70/9/d/+/2vR9GKRd0uO7V6sVBYW/uxurKyvLSkfJNhlTTTUg2zqBmqbuQ28mfnF61Wq/lOEATND4KgqWzvulbJLqiaqhu6aeU28le3dy9JMplM5P8ouzWvUvfMsmOVHdtxc3n18uqGEjIcDqMRfALwKYrgDAAAQhjHMQAgiiKMsVL1D6t+Q9vaNstOyXHXN9Wf17dSyizLYjp5HGGEKUIojmOEEQAQITzbMYRQqdR97+i4Uvf/CQshBOecMc55ujCdTtN3FHf/oHFyWql5hr1TctzcLJwkCcF43j8ej7Ms+/znqt/Y8w4Me2fePA9zxgjGQggpJSGEUvp2ASEcQk4JX3hrrvkNfRGen80Yi0ajNE2llJRSCGHKmCBYoFg8P4uFV/FLYsHpOhZoAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/e685b104fea82f4961a483e9e38c2b24/fcda8/1707532787622-1ce9d60d-bbac-4c4a-9473-8e40014f43c7.png\"\n        srcset=\"/static/e685b104fea82f4961a483e9e38c2b24/12f09/1707532787622-1ce9d60d-bbac-4c4a-9473-8e40014f43c7.png 148w,\n/static/e685b104fea82f4961a483e9e38c2b24/e4a3f/1707532787622-1ce9d60d-bbac-4c4a-9473-8e40014f43c7.png 295w,\n/static/e685b104fea82f4961a483e9e38c2b24/fcda8/1707532787622-1ce9d60d-bbac-4c4a-9473-8e40014f43c7.png 590w,\n/static/e685b104fea82f4961a483e9e38c2b24/efc66/1707532787622-1ce9d60d-bbac-4c4a-9473-8e40014f43c7.png 885w,\n/static/e685b104fea82f4961a483e9e38c2b24/c83ae/1707532787622-1ce9d60d-bbac-4c4a-9473-8e40014f43c7.png 1180w,\n/static/e685b104fea82f4961a483e9e38c2b24/4654d/1707532787622-1ce9d60d-bbac-4c4a-9473-8e40014f43c7.png 2392w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br />然后，在验证（Authentication）的 流程（Flow）下面，将 Browser 复制并命名为 Browser with phone 的流程。过程如下面两张截图所示。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/35f31b60595d956330b9b0ae47dde2e9/ed904/1707532880517-ab7e1330-8646-4891-b801-f7cafc045c9b.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.43243243243243%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABD0lEQVR42nXPO08CQRiF4f0ZBrwBy2UFYkKhwcRGCxt/q5W9tHaAQCAxMViAjDO4O/frN0YsLNS3P8lzkvZpb7+SVtLsYTowYDnjg3n+unUxRoD4XyGEGGOSZp3yYa3cqt6N7gGiD2H0gleYxRjzPBdC/DmGXUmj3d0rVQ4u0sf5RCvvwX/k74wWAEAIQQhprWFngC/KD8YHn6StbqlRPT5vDp8W2jrn7ZbmUiqAwDlXSimpnHERfsshub65Pbu67PX749mztt55Rzm1xgAApZQzLoxAGm3MBgVEApEgOXAJYu1WSf2kc1RrVuvZcLqQxjlrtdLfrxhjRVEUrCAMY4axwG9qvTTLKUxmbjImo08OEy3G5bG0cAAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/35f31b60595d956330b9b0ae47dde2e9/fcda8/1707532880517-ab7e1330-8646-4891-b801-f7cafc045c9b.png\"\n        srcset=\"/static/35f31b60595d956330b9b0ae47dde2e9/12f09/1707532880517-ab7e1330-8646-4891-b801-f7cafc045c9b.png 148w,\n/static/35f31b60595d956330b9b0ae47dde2e9/e4a3f/1707532880517-ab7e1330-8646-4891-b801-f7cafc045c9b.png 295w,\n/static/35f31b60595d956330b9b0ae47dde2e9/fcda8/1707532880517-ab7e1330-8646-4891-b801-f7cafc045c9b.png 590w,\n/static/35f31b60595d956330b9b0ae47dde2e9/efc66/1707532880517-ab7e1330-8646-4891-b801-f7cafc045c9b.png 885w,\n/static/35f31b60595d956330b9b0ae47dde2e9/c83ae/1707532880517-ab7e1330-8646-4891-b801-f7cafc045c9b.png 1180w,\n/static/35f31b60595d956330b9b0ae47dde2e9/ed904/1707532880517-ab7e1330-8646-4891-b801-f7cafc045c9b.png 3838w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/60e2b7af83c3fbb0c92d9df7ad9003aa/c1b63/1707532895727-afd7749d-bc4a-4eb5-a57b-f9acb341f105.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdklEQVR42n2QzW7aQBDH/V55gT5HniSnXqsecusdeq1U9VjZkNh8mTrGpBEiOdAaAsZ48X44uzM7kTFCqFL56ac57cx/Z5x+vw8AjLHyQFEUQgh5Ec65tTYMQ2c4HM5ms6DXGwwGSZL4vp+mKRFZa+k/AACinUwmThiGWus9Y0pKOKC1kVI1+UIILgQi2jMAgIjiOHZGoxFjjO12VfXWpCFilmWbbLPdbjeb9Wq1RARr8SSAOTaPx2Mi4pwrpYypR74Zuy74a85e83KVMWlsWeG5sqqf/Yoe6p23+W7+/LL4m5ZcEtFewmz+nEynv5+ekmRqDNj6BEeJaFGyP6KKoskxGRFP91AapbYKSBpbAZUKzxWVjdbZY14+RLFzFwy/+OXH7+nNt+WPuACAnOtKG22OGoB/PWwXRZHTCUbXX/cfbtOrT+nnnwURZYoM0gWab9bN7VYrHvcHfifsdXv33W7Hu+92PM9zXbepDd4ZrusGQdBut98B+UgmpcCoUzEAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/60e2b7af83c3fbb0c92d9df7ad9003aa/fcda8/1707532895727-afd7749d-bc4a-4eb5-a57b-f9acb341f105.png\"\n        srcset=\"/static/60e2b7af83c3fbb0c92d9df7ad9003aa/12f09/1707532895727-afd7749d-bc4a-4eb5-a57b-f9acb341f105.png 148w,\n/static/60e2b7af83c3fbb0c92d9df7ad9003aa/e4a3f/1707532895727-afd7749d-bc4a-4eb5-a57b-f9acb341f105.png 295w,\n/static/60e2b7af83c3fbb0c92d9df7ad9003aa/fcda8/1707532895727-afd7749d-bc4a-4eb5-a57b-f9acb341f105.png 590w,\n/static/60e2b7af83c3fbb0c92d9df7ad9003aa/efc66/1707532895727-afd7749d-bc4a-4eb5-a57b-f9acb341f105.png 885w,\n/static/60e2b7af83c3fbb0c92d9df7ad9003aa/c83ae/1707532895727-afd7749d-bc4a-4eb5-a57b-f9acb341f105.png 1180w,\n/static/60e2b7af83c3fbb0c92d9df7ad9003aa/c1b63/1707532895727-afd7749d-bc4a-4eb5-a57b-f9acb341f105.png 1200w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>接着，点击刚才复制的 Browser with phone 流程，然后使用 Phone Username Password Form 替换 Username Password Form。在 Phone Username Password Form 的旁边有一个设置按钮，点击它进行配置。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.35135135135135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABtUlEQVR42m2SwWoTURSGZ9I2mXTSViu0ukvSoOLzSNN7Z+6dc+49F+qiKIiv4F4a3LtoFgpC0yI2MxF8AUFFBReuslQo0yQEmszIDBkI6Lc4m8PHf/g5luOslyuOXVqp1xuce+2DDCEEAuA/AECwhFXb2KpWXbu02mi2FmtAVNoXgjHGl2CMSSmNMVSQyW5twy6tNpstVApAoSbPly+OO/1+v9frneecnfWiwYfjzstASiLSOZZb23SKZK01Ihgi3/fDi4tkPh+Px5Oc0WiUpmkYRR7n/5X3lCalkIiE75+ev7saTeI4vs6ZTqeZHIacc11gOVW34qxb9kq9kcmIqDUFwu++ff8nnsRXl7P5LE3T2SybURTx5eSd3Ts7u7fd2ua9+w+yZESltPB493RweZ2myTxJ0yQp5EHEOCMiVJjJWze2b27fWis7e627ShMASBlInz3vnLz6+Dkahl9+f/3088e3X9+Hw+Hr7hvBBekiuVypLp+dyUIIKY1GYwJGjB/x/WcP20/3208O2GPmHXlgQKFCxIVsl9YWhRXPAABKaaONCpSWmoDQYHAYwCHIRzKvRv8FHkv/6BYOmKAAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/a457e73686970364f8b52080bad836a6/fcda8/1707533570580-4b80d4e8-0339-42c1-88a5-170123abd581.png\"\n        srcset=\"/static/a457e73686970364f8b52080bad836a6/12f09/1707533570580-4b80d4e8-0339-42c1-88a5-170123abd581.png 148w,\n/static/a457e73686970364f8b52080bad836a6/e4a3f/1707533570580-4b80d4e8-0339-42c1-88a5-170123abd581.png 295w,\n/static/a457e73686970364f8b52080bad836a6/fcda8/1707533570580-4b80d4e8-0339-42c1-88a5-170123abd581.png 590w,\n/static/a457e73686970364f8b52080bad836a6/efc66/1707533570580-4b80d4e8-0339-42c1-88a5-170123abd581.png 885w,\n/static/a457e73686970364f8b52080bad836a6/c83ae/1707533570580-4b80d4e8-0339-42c1-88a5-170123abd581.png 1180w,\n/static/a457e73686970364f8b52080bad836a6/61fdd/1707533570580-4b80d4e8-0339-42c1-88a5-170123abd581.png 3204w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />然后回到验证（Authentication）的流程列表页，点击 Browser with phone 的 Bind flow，将其绑定至 Browser 流程。过程如下图所示。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA3klEQVR42jXPy0rDQBSA4bxe950k08tczpzTZJoGRCwIrn0EFwqCdOFKkWyki/ZJQirSZmE6K6XYTRxJ0Y//Bf7AdIAPOSHleZ5lmTEGEZMksdbaqU0pJUmkCBCklTKVKpUqUWIqAgBAxJjHL89P72/VdrdzzjVN45zbu/3h83C7vOvNe+yKsct+OA+ji4ifx4MzPp6NA6UUEoVRv3hdfXy138fjz4n3vm1b732xLEJgOtOAQIpId6FG1BgIIQzicMCubx7v11VZbarNn7Is67pePCxGfDQxk+4P/zv5BT7pgmhj/KCkAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/894b33a6a6874b85699a3bcbd7ce3127/fcda8/1707533805647-8267c1f1-1b3e-41d6-9238-afb7a440bd10.png\"\n        srcset=\"/static/894b33a6a6874b85699a3bcbd7ce3127/12f09/1707533805647-8267c1f1-1b3e-41d6-9238-afb7a440bd10.png 148w,\n/static/894b33a6a6874b85699a3bcbd7ce3127/e4a3f/1707533805647-8267c1f1-1b3e-41d6-9238-afb7a440bd10.png 295w,\n/static/894b33a6a6874b85699a3bcbd7ce3127/fcda8/1707533805647-8267c1f1-1b3e-41d6-9238-afb7a440bd10.png 590w,\n/static/894b33a6a6874b85699a3bcbd7ce3127/efc66/1707533805647-8267c1f1-1b3e-41d6-9238-afb7a440bd10.png 885w,\n/static/894b33a6a6874b85699a3bcbd7ce3127/c83ae/1707533805647-8267c1f1-1b3e-41d6-9238-afb7a440bd10.png 1180w,\n/static/894b33a6a6874b85699a3bcbd7ce3127/67326/1707533805647-8267c1f1-1b3e-41d6-9238-afb7a440bd10.png 3218w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />最后，回到 Realm 的设置页，在主题（Theme）选项卡里，将 Login 的主题设置为 phone 即可，如下图所示：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoElEQVR42n2RXWsTQRSG97LY0BpJ2zXdbRJ3m1ZKYsHGjxZFvFAE7/0Zgv9E2pBYRYqFguD/EPy6761UL3Szs/O12Z2ZM0emiwr14+Fl5j0HHhgYb8lvLiz6/sXlc7W53eGoLMuiKLTWxlGdp81tfo/GGADwOqvrftAKO3Gt3hiOxsboJEmyCkonqbsYo4QQSunPtStCSG+9t7ncjlaibq3eGD9/gYhpShjjgnMuZMZzIXPOGOecMUYp5ZwTQqruXbl6rRWvBZ14tt4YPdtHRJlLa+20LA1Ya9GA/RWoigEDFhG97ka/uXIpjFZrcwuj4f5H++Fd+h4BkywrNZTaluZsCg3KQCX3/FY7DLvzwdLj10+O7fEkmWitM0KKokBE+zcATuXLvc1mEAU3opmd+acHe6gwJUQp/fnk67fviXDIM2FMyHzq5CCKLwz8xe1wZvb83u4YEYWQiBZUnkuhtTJ/UH2kk289urt1f+f64HZ3o394dOTeCSZX8PItPcm0G/GfePcePLy5fae/NWjHawevDit5quDNJ/olU9r8x8Ufd8zWIC8546EAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/a3c200923c65f2ad5a0b4030e131f4c3/fcda8/1707533827422-fa0c5e4a-c875-480d-8a18-6764e7c53aa5.png\"\n        srcset=\"/static/a3c200923c65f2ad5a0b4030e131f4c3/12f09/1707533827422-fa0c5e4a-c875-480d-8a18-6764e7c53aa5.png 148w,\n/static/a3c200923c65f2ad5a0b4030e131f4c3/e4a3f/1707533827422-fa0c5e4a-c875-480d-8a18-6764e7c53aa5.png 295w,\n/static/a3c200923c65f2ad5a0b4030e131f4c3/fcda8/1707533827422-fa0c5e4a-c875-480d-8a18-6764e7c53aa5.png 590w,\n/static/a3c200923c65f2ad5a0b4030e131f4c3/efc66/1707533827422-fa0c5e4a-c875-480d-8a18-6764e7c53aa5.png 885w,\n/static/a3c200923c65f2ad5a0b4030e131f4c3/c83ae/1707533827422-fa0c5e4a-c875-480d-8a18-6764e7c53aa5.png 1180w,\n/static/a3c200923c65f2ad5a0b4030e131f4c3/6c9f4/1707533827422-fa0c5e4a-c875-480d-8a18-6764e7c53aa5.png 2326w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />至此，Keycloak 的短信验证码登录配置就完成了。在登录页，可以看到短信验证码登录的入口，如本示例开头的最终效果所示。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.75675675675677%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAADV0lEQVR42kWS/2saZxzHj/2yP2RdINDAulkIlNrUZZ6eyUXPU7Mz583kzpBUwUBYWduxduu+kJZ135KOQrswNspKSOlGmmxstl2sGp0xd6f5qT+sUNokxniZel/0nnuGZ0JfPD88vOHF5/l8Pg8iFEsFnhfEolAqicVS+yIWeVEsljZ5QdwQRKFY5NtJOy9s8AWe3xDFAi9s8AISj8dj0Wj7xKKTk5Mce8DY2BjDMMFgkKIo2iQYDPp9Pq/XSxAet9uD4zgSi8XOmExMTHAcF4lExsfHOY57zyQUCtE0zZgEAgGSJIeGhlwuF2aCcIeMjo6GQqFwODzGsgzDhBjm/bNnp+JTZ6LR6enpaDQaiYy73W4Mw1AHiqKo3W5/KXfqvDsc8BLuwQEXPjjgcQ/hgy6nw445USdqt7/z9uk+a98pq/XkCav15EuZZdnOC89/PPPZ1zcvXZ375MvvL1+7cenq9YtX5i5emftoZvbDz7859+lXH1y+duGLbyenztlsNoRlWY7jOuOhKGp9fR1CaBiGpjX/qzUUVWsoqqKoqqopiqrrOgAAQphOp3t7exGGYcLhME3TFEX5fL58Pm/KoNVsyvWapqmNRr1Sq2/t115ItYqsSWqrLaceW44fRzr7CAQCfr/f6/UeyADUmsaOAjRgQAjpbOXVxWddK1uvLT9/5c6/8U2lsJZ+8y0LMjIyQpn4/X6CIPL5PACgWt2rVKVGE5iusV7Vlp7LiW0lsa38+qz+pAmzmYzFYkECJsPDwyRJ4jiey+UghK1Wq9ObcQg8pJOnUqk3jh1DfD4fSZIEQXg8HqfTmc1mAQDl8q4kSYqiAADaQ9J1Q9chBAYAeqvdczKZ7OnpQUiS9JjgOI6iaDabhRBqqqy3NAPoZvF2wZoKBuaeYrNPT8w8mUnUc5nHR4/2IK5DHA5Hf39/JpNuGnCr2ijvKzuSvCPJZUku78sv9uRlQfq9KN0rVDa3jeTq393d3Ujnl7pcLhRFT/X1Ff5Zu5HT0evb/vld8odd4tYu90s1fLvqvVWhf9pjft4jbpZ/LMBMavXIkdcPZAzDHA7HaZttfn7+r9W1hfsP7q48urvyaHH54eL9hwtLDxaWEgtLiTu//Xn73h8rieTs7HddXV3/A1iRQ2Ym386LAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/a328e1e5309cec66440cc549c0bda9bd/fcda8/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png\"\n        srcset=\"/static/a328e1e5309cec66440cc549c0bda9bd/12f09/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png 148w,\n/static/a328e1e5309cec66440cc549c0bda9bd/e4a3f/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png 295w,\n/static/a328e1e5309cec66440cc549c0bda9bd/fcda8/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png 590w,\n/static/a328e1e5309cec66440cc549c0bda9bd/efc66/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png 885w,\n/static/a328e1e5309cec66440cc549c0bda9bd/c83ae/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png 1180w,\n/static/a328e1e5309cec66440cc549c0bda9bd/1e2b7/1707474620419-f423fa7c-873a-4726-8c11-04a905535450.png 1483w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=QXEPx></a></p>\n<h4>（3）导出配置</h4>\n<p><br />在上面我们看到，整个配置有点繁琐，特别是关于验证流程的配置步骤很多。可以通过将配置好的安全领域导出来，这样，在其他环境的 Keycloak 实例上，再次导入配置，做一些相应的修改（比如安全领域的名称等等）即可，而不用再重复验证流程的配置。导出配置的步骤如下图所示。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4401af0cd1b5c952e5d15ca206b79124/1ed3b/1707534356623-85e8f946-497c-40ad-b66d-061eb2fa6d58.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABV0lEQVR42mXOb0vCQADH8b1HEd128+ad0ip77p+FPhAKpQeG4ainPeod9BYkKGiZz2bFwrW73U2Z4OR2kWIQfZ5/+f0UzljM+XKxYCxqNpuFQkHX9WKxWPgHQlgyy3m1BKEJITRNU6GUMBbFMY8iats2AGAwGAyHw9FodLN1veU4Tu2kpqoaAKYOS8AwShAqQTAnJNzFp6e2ZVme5/m+zxhb76VpKoTonffyWh7UdNVSAdDLpqmE4RelJI759nYDYzybzQilhJAwDNN0LVIhNmKVrdpX7ZyVQ0cIY4wQQhgphIS724xFrVYTIRTMPzOxSZKE81hKyQWfCc/P/O5FF2igiqt472eZsWixiDln9XoDo/LDxPsgSyllskne5VuQBUIKKWW/19c0rVr9G1NKOIsoCW3bPj48OHPuLm/v3ZfXR/dp/DyeutOJO3Fdt9PpGIZRqVR+42+MSBWoKlYCmwAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/4401af0cd1b5c952e5d15ca206b79124/fcda8/1707534356623-85e8f946-497c-40ad-b66d-061eb2fa6d58.png\"\n        srcset=\"/static/4401af0cd1b5c952e5d15ca206b79124/12f09/1707534356623-85e8f946-497c-40ad-b66d-061eb2fa6d58.png 148w,\n/static/4401af0cd1b5c952e5d15ca206b79124/e4a3f/1707534356623-85e8f946-497c-40ad-b66d-061eb2fa6d58.png 295w,\n/static/4401af0cd1b5c952e5d15ca206b79124/fcda8/1707534356623-85e8f946-497c-40ad-b66d-061eb2fa6d58.png 590w,\n/static/4401af0cd1b5c952e5d15ca206b79124/efc66/1707534356623-85e8f946-497c-40ad-b66d-061eb2fa6d58.png 885w,\n/static/4401af0cd1b5c952e5d15ca206b79124/c83ae/1707534356623-85e8f946-497c-40ad-b66d-061eb2fa6d58.png 1180w,\n/static/4401af0cd1b5c952e5d15ca206b79124/1ed3b/1707534356623-85e8f946-497c-40ad-b66d-061eb2fa6d58.png 3790w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=oupOc></a></p>\n<h4>（4）导入配置</h4>\n<p><br />在上述配置导出后，在新的 Keycloak 实例上，可以选择上一步保存好的 json 文件进行导入操作，如下图所示。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d39b2b12186d006dc3dd8a77c5a33d8e/ed904/1707534454282-12071342-0a2c-4a5c-a240-e870c380e30f.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdklEQVR42oWPPU/CcBCHW0BpS4EIIgV10Bh1YWMyfA0dJJICrZODKXHwkxE2YxgxYFhkwgFp2tCX498K9NVQjAEdfHLJ3XBP7ncYQVI0HQ+Fwqn0brPZbLVa7Xa72+2+bNLpdPqv/eendumidH56VigUisUiRpBUNErgeJjJ5UVRNE1zsVjYtuM4jr1qAZZl2b6lgHb3IFS4KsfxPH+LxegESdF4KMIw+fFYBABN01RVQwjNZp/zH2bziT3pTXr8I3/JXpWvy9Uqi8UTSTqexEORLJPTAEYfo8HgTVVV0zQ9z/V9b1XB7IMOjftG5abCsmytVsNidJwgY6vLkiRNp1PDMBxnGdhbw3WXsg660BBYluU4rl6vb8SWJRkAzADLsvzg4roMAIKwJpMUHSUoDI9kmbyiKLIsI4Rc17UD/pEz2VxmLxujE0fHJ6IoTgEQWiZHCAVve37AatB1fUNO7qRS6czWdnT/4HA4fAdk2N/7/t/Yv+Qv0qFgEat9kxEAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/d39b2b12186d006dc3dd8a77c5a33d8e/fcda8/1707534454282-12071342-0a2c-4a5c-a240-e870c380e30f.png\"\n        srcset=\"/static/d39b2b12186d006dc3dd8a77c5a33d8e/12f09/1707534454282-12071342-0a2c-4a5c-a240-e870c380e30f.png 148w,\n/static/d39b2b12186d006dc3dd8a77c5a33d8e/e4a3f/1707534454282-12071342-0a2c-4a5c-a240-e870c380e30f.png 295w,\n/static/d39b2b12186d006dc3dd8a77c5a33d8e/fcda8/1707534454282-12071342-0a2c-4a5c-a240-e870c380e30f.png 590w,\n/static/d39b2b12186d006dc3dd8a77c5a33d8e/efc66/1707534454282-12071342-0a2c-4a5c-a240-e870c380e30f.png 885w,\n/static/d39b2b12186d006dc3dd8a77c5a33d8e/c83ae/1707534454282-12071342-0a2c-4a5c-a240-e870c380e30f.png 1180w,\n/static/d39b2b12186d006dc3dd8a77c5a33d8e/ed904/1707534454282-12071342-0a2c-4a5c-a240-e870c380e30f.png 3838w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br />该 json 文件的关键相关内容如下：\njson\n{\n...,\nloginTheme: phone,\nauthenticationFlows: {\n[\n...,\n{\nid: 070902f7-e4dc-43ee-8156-abc9d7a021e6,\nalias: Browser with phone,\ndescription: browser based authentication,\nproviderId: basic-flow,\ntopLevel: true,\nbuiltIn: false,\nauthenticationExecutions: [\n{\nauthenticator: auth-cookie,\nauthenticatorFlow: false,\nrequirement: ALTERNATIVE,\npriority: 10,\nautheticatorFlow: false,\nuserSetupAllowed: false\n},\n{\nauthenticator: auth-spnego,\nauthenticatorFlow: false,\nrequirement: DISABLED,\npriority: 20,\nautheticatorFlow: false,\nuserSetupAllowed: false\n},\n{\nauthenticator: identity-provider-redirector,\nauthenticatorFlow: false,\nrequirement: ALTERNATIVE,\npriority: 25,\nautheticatorFlow: false,\nuserSetupAllowed: false\n},\n{\nauthenticatorFlow: true,\nrequirement: ALTERNATIVE,\npriority: 30,\nautheticatorFlow: true,\nflowAlias: Browser with phone forms,\nuserSetupAllowed: false\n}\n]\n},\n{\nid: 0ea1be2f-285e-453b-80f5-f365e8c31a0e,\nalias: Browser with phone Browser - Conditional OTP,\ndescription: Flow to determine if the OTP is required for the authentication,\nproviderId: basic-flow,\ntopLevel: false,\nbuiltIn: false,\nauthenticationExecutions: [\n{\nauthenticator: conditional-user-configured,\nauthenticatorFlow: false,\nrequirement: REQUIRED,\npriority: 10,\nautheticatorFlow: false,\nuserSetupAllowed: false\n},\n{\nauthenticator: auth-otp-form,\nauthenticatorFlow: false,\nrequirement: REQUIRED,\npriority: 20,\nautheticatorFlow: false,\nuserSetupAllowed: false\n}\n]\n},\n{\nid: 7bb0c556-7ca1-438c-895c-ff387b14b3c2,\nalias: Browser with phone forms,\ndescription: Username, password, otp and other auth forms.,\nproviderId: basic-flow,\ntopLevel: false,\nbuiltIn: false,\nauthenticationExecutions: [\n{\nauthenticatorConfig: phone,\nauthenticator: auth-phone-username-password-form,\nauthenticatorFlow: false,\nrequirement: REQUIRED,\npriority: 20,\nautheticatorFlow: false,\nuserSetupAllowed: false\n},\n{\nauthenticatorFlow: true,\nrequirement: CONDITIONAL,\npriority: 21,\nautheticatorFlow: true,\nflowAlias: Browser with phone Browser - Conditional OTP,\nuserSetupAllowed: false\n}\n]\n},\n...\n]\n},\n...\n}</p>\n<p><a name=rH2Gu></a></p>\n<h2>通过电子邮件发送一次性密码</h2>\n<p><br />服务器端生成一个一次性密码（OTP），并将其发送到用户注册的电子邮箱。用户在登录时输入 OTP，服务器端验证 OTP 是否正确。这种方法的优点是，它不需要任何额外的硬件或软件，因为它使用用户已经拥有的电子邮箱。但是需要更多的客户支持或者技术支持，因为用户可能会遇到电子邮件延迟或者电子邮件被拦截的问题。\n<a name=Dzwdn></a></p>\n<h2>通过原生应用生成一次性密码</h2>\n<p><br />这需要用户在自己的设备上安装一个支持 OAuth 一次性密码生成算法的原生应用程序，比如 Google Authenticator。在登录时，用户侧和服务器端会使用共享密钥生成同样的一次性密码。这个共享密钥是在注册时添加到生成器中的——通常是通过扫描二维码来实现的。 是 authing.cn 的 OTP 口令验证界面。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.54054054054055%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1ElEQVR42m1S2W4TMRSd//+OijeEeEDwAg9dskxCS4BCy0wyaRZImDTxcjd7NuSZNopQraMrX/sen+tjR9rA7812uVo/LFb7g7ZAxuKLsED5bp/NF0k6vb6ZHJSJlLaTr9/ieNzrDzfb3AIpbbWB/5jaAJJMZ/NBPLq66p+dvcp3+8hYFOfLqi6rSlzB4sUFWHhJH1BcQeycKyxQRCy/ktn55eD8on/Zi/vDcX847g3Gj3t1vII2QCx3SfbpYmQA45vb7GGNxBEgbbb53f00mWbpbJ6k2c/7NEkzpe2pJgD92ebpbGmBlutNvjsE5bCBLOKZHbVg8SxeGzyF0miBiUWbUN81FXUHM5MwEzMTIRK1KTMjMVGIHQCpix0rUgaccyCN5Zp9w76uqsYVYeLLxpdNVTeno25TEacNRAcNTeWu59Xbz+7NyL+f+B/r8nXsP976d1/8h0mxs/WR0zRN9rcsqsa5lnxUVlgfsJ7nlQqxXu3rxWP9fVWBtILPyrmpivKZrA2IOF94bYw2hpiUscYaQEC0TKi00a2pStuiKLsjntoOZOecL9oK6my0SLr9EsZS+xxELIBUlk9k7sih1CIFd90z2rkIy3HFUViU4DkG2Nbtf1Qa3PhNDmWFAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/fbb6fb059d914ff00616ca823af00fc8/fcda8/1707534792259-032b65a9-4f0e-48da-acfc-b850cf511c70.png\"\n        srcset=\"/static/fbb6fb059d914ff00616ca823af00fc8/12f09/1707534792259-032b65a9-4f0e-48da-acfc-b850cf511c70.png 148w,\n/static/fbb6fb059d914ff00616ca823af00fc8/e4a3f/1707534792259-032b65a9-4f0e-48da-acfc-b850cf511c70.png 295w,\n/static/fbb6fb059d914ff00616ca823af00fc8/fcda8/1707534792259-032b65a9-4f0e-48da-acfc-b850cf511c70.png 590w,\n/static/fbb6fb059d914ff00616ca823af00fc8/efc66/1707534792259-032b65a9-4f0e-48da-acfc-b850cf511c70.png 885w,\n/static/fbb6fb059d914ff00616ca823af00fc8/d7abb/1707534792259-032b65a9-4f0e-48da-acfc-b850cf511c70.png 959w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=LfuRC></a></p>\n<h2>通过硬件生成一次性密码</h2>\n<p>需要非常高安全的交易系统比如银行可能会要求通过硬件令牌来生成一次性密码。\n<a name=uHOhq></a></p>\n<h2>智能卡</h2>\n<p>智能卡是一种带有内置集成电路芯片的塑料卡，可以用于存储和处理数据。智能卡可以用于存储用户的身份信息，比如数字证书、私钥等。\n<a name=ZkD8Y></a></p>\n<h2>硬件Fob</h2>\n<p>硬件 Fob 是一种小型硬件设备，可以生成一次性密码。它们通常是通过 USB、蓝牙或者NFC 连接到计算机或者手机的。硬件 Fob 通常是由用户自己购买的，但也可以由公司提供。\n<a name=gzklt></a></p>\n<h1>你所知道的东西</h1>\n<p>“你所知道的东西”有非常多的选项，通常都是用来取代用户的密码的——特别是在手机上，因为输入密码可能会很麻烦。如果一个系统已经采用了用户名密码做为身份认证的基本方式，那么仅仅将“你所知道的东西”做为身份认证的第二因素，经常会被质疑这根本就不是第二因素，因为它和第一因素（用户名密码）是同一类型的。但是，如果你将“你所知道的东西”和“你所拥有的东西”结合起来，那么它就是一个真正的第二因素了。\n<a name=ermKi></a></p>\n<h2>用户名和密码</h2>\n<p>用户名和密码是最常见的身份验证方式。它们的优点是，它们是最简单的身份验证方式，因为它们是用户已经知道的东西。缺点是，它们容易被破解，因为用户通常会选择简单的密码，或者在多个网站上使用相同的密码。\n<a name=KbhdX></a></p>\n<h2>PIN</h2>\n<p>PIN 是一种简单的密码，通常由 4 或者 6 位数字组成。PIN 通常用于 ATM 机和信用卡。PIN 的优点是，它们比密码更容易记忆，因为它们通常只有 4 或者 6 位数字。缺点是，它们容易被破解，因为用户通常会选择简单的 PIN，或者在多个网站上使用相同的 PIN。</p>\n<p>单一采用 PIN 作为身份认证因素的场景比较少见，因为这样的话，安全性非常低。如果是 4 位 PIN 码，那么一共只有 10000 种可能的组合，即攻击者有万分之一的机会第一次就猜中了 PIN 码。如果是 6 位 PIN 码，那么一共只有 1000000 种可能的组合，即攻击者有百万分之一的机会第一次就猜中了 PIN 码。由于暴力破解比较容易，所以需要有严格的错误尝试锁定策略，比如连续输入错误 PIN 码 3 次就锁定账号，需要管理员解锁。或者需要再等待一定时间之后才能开始再试，以此来让暴力破解的成本变得更高。\n<a name=Zf1Es></a></p>\n<h2>安全问题</h2>\n<p>安全问题通常由用户在注册时选择。安全问题的优点是，它们是用户已经知道的东西。缺点是，它们容易被破解，因为用户通常会选择简单的安全问题，或者在多个网站上使用相同的安全问题。\n<a name=Nn7il></a></p>\n<h1>你本身就是生物识别因素</h1>\n<p>这种验证方法经常在科幻电影里看到——比如通过扫描虹膜来打开宇宙飞船的门、或者通过指纹识别来发身核弹。但是，这种验证方法在现实生活中也是存在的，比如指纹识别、面部识别等。\n<a name=nmkPb></a></p>\n<h2>指纹</h2>\n<p>要么应用光学，要么应用电阻的方法来测量摩擦纹理等细节。\n<a name=sOI4Z></a></p>\n<h2>声纹</h2>\n<p>声纹识别是一种生物识别技术，它使用声音特征来识别个人。声纹识别可以用于识别个人的身份，比如微信登录时就可以选择朗读4位数字来登录。\n<a name=jRjOd></a></p>\n<h2>面部识别</h2>\n<p>面部识别是一种生物识别技术，它使用面部特征来识别个人。面部识别可以用于识别个人的身份，比如很多原生应用都支持对接 Face ID 来实现人脸识别登录。\n<a name=hUwt5></a></p>\n<h2>虹膜扫描</h2>\n<p>虹膜在眼睛的前方，管理着进入眼睛的光线。虹膜扫描是一种生物识别技术，它使用虹膜特征来识别个人，但不如视网膜扫描精确。\n<a name=newGf></a></p>\n<h2>视网膜扫描</h2>\n<p>视网膜在眼睛的后半部分，每个人的视网膜都是独一无二的。使用视网膜特征来识别个人需要特别的技术。\n<a name=RQLYM></a></p>\n<h1>小结</h1>\n<p>本文探讨了多因素身份认证，分别介绍了三种因素，即“你所知道的东西”、“你所拥有的东西”和“你本身就是生物识别因素”。并且还拿 Keycloak 做为身份认证平台举例，详细描述了如何实现常见的短信验证码登录。<br />多因素身份认证是未来身份认证的趋势，结合多个不同的身份验证要素，如生物识别技术（指纹、面部识别等）、硬件安全令牌等，提供更强的安全性。\n<a name=ex8du></a></p>\n<h1><br /><br /><br /><br /><br /><br /></h1>\n<p><a name=e878j></a></p>\n<h1><br /><br /><br /><br /><br /><br /><br /></h1>\n<p><a name=KYFeh></a></p>\n<h2><br /><br /></h2>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}