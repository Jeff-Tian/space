{"componentChunkName":"component---src-templates-post-js","path":"/posts/xrpb7v","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/xrpb7v","relativePath":"posts/xrpb7v","frontmatter":{"title":"FreeArch:  一键拥有你自己的身份认证平台 Keycloak，完全免费！","stackbit_url_path":"posts/xrpb7v","date":"2022-08-16T11:54:10","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a href=\"https://dashboard.heroku.com/new?button-url=https%3A%2F%2Fgithub.com%2FJeff-Tian%2Fkeycloak-heroku&#x26;template=https%3A%2F%2Fgithub.com%2FJeff-Tian%2Fkeycloak-heroku\"><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1660650724977-eb150267-63fc-48e5-9980-d74f2749e0a3.png#clientId=u5f9cdaf7-b2a4-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;id=ue0c6975a&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=32&#x26;originWidth=147&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=5277&#x26;status=done&#x26;style=none&#x26;taskId=ub88b4176-c6be-4513-a2f1-bc6a0e204af&#x26;title=\" alt=\"image.png\"></a></p>\n<blockquote>\n<p>通过将官方的 Keycloak 镜像做些修改，适配 Heroku PaaS 平台，就可以免费拥有自己的 Keycloak 啦！</p>\n</blockquote>\n<p>其实在好几年前，我部署了自己的 Keycloak 实例： <a href=\"https://keycloak.jiwai.win\">https://keycloak.jiwai.win</a> 。但那时候的版本，在 Heroku 上的免费 Dyno 上还跑不起来，不得不使用了 Heroku 的 Hobby Dyno，为此每月需要花费 7 美元：<br /><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1660649477769-4e19bca5-9860-4b03-af76-310836b6cb45.png#clientId=u5f9cdaf7-b2a4-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=588&#x26;id=ucd27b402&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1176&#x26;originWidth=2260&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=251887&#x26;status=done&#x26;style=none&#x26;taskId=u7b7da7ef-80b3-4235-90cd-a792da07c4a&#x26;title=&#x26;width=1130\" alt=\"image.png\"></p>\n<p>但是，我当时利用复旦大学研究生的身份，注册了 GitHub Educations 的 Student Pack，获得了 Heroku 的代金券，因此一直是处于实际上的免费使用状态。后来研究生毕业，不能再使用 GitHub 的 Student Pack，于是希望 Keycloak 可以跑在 Heroku 的免费 Dyno 上。在使用较新的镜像后，将 Dyno 类型改成了 Free 版，做了一个实验，完全可以跑起来！尽管日志会有一些报错，报怨内存超出限额，但是从用户体验角度，对此并无实际感知。</p>\n<p><a name=Ne3EI></a></p>\n<h1>如何一键部署 Keycloak 到 Heroku</h1>\n<p>我更新了一键部署按钮，点击这个链接，即可部署 Keycloak 到 Heroku，而且由于使用的是 Free Dyno，应该不再有绑定信用卡的要求了！</p>\n<p><a href=\"https://dashboard.heroku.com/new?button-url=https%3A%2F%2Fgithub.com%2FJeff-Tian%2Fkeycloak-heroku&#x26;template=https%3A%2F%2Fgithub.com%2FJeff-Tian%2Fkeycloak-heroku\">https://dashboard.heroku.com/new?button-url=https%3A%2F%2Fgithub.com%2FJeff-Tian%2Fkeycloak-heroku&#x26;template=https%3A%2F%2Fgithub.com%2FJeff-Tian%2Fkeycloak-heroku</a></p>\n<p><a name=HOBzK></a></p>\n<h1>数据库</h1>\n<p>如果有自己的数据库，可以在 DATABASE_URL 处填写自己的数据库连接字符串：<br /><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1660649997229-125d23d4-8ce3-4a6b-a6d9-4abac7b1d984.png#clientId=u5f9cdaf7-b2a4-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=205&#x26;id=u8cfd70d2&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=410&#x26;originWidth=1616&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=105778&#x26;status=done&#x26;style=none&#x26;taskId=ue147e4d9-e353-4bef-8000-e6b3aeb12fb&#x26;title=&#x26;width=808\" alt=\"image.png\"><br />如果没有，可以不用修改连接字符串，直接部署。在部署完成后，再将 Heroku 自动分配的数据库连接字符串粘贴到 DATABASE_URL 栏：</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1660650091828-dea05078-e631-46b6-9e45-9bed230f80a5.png#clientId=u5f9cdaf7-b2a4-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=613&#x26;id=u653d8919&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1226&#x26;originWidth=2604&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=626943&#x26;status=done&#x26;style=none&#x26;taskId=u4e3e139d-5b6a-411e-b246-85c0a238e4a&#x26;title=&#x26;width=1302\" alt=\"image.png\"></p>\n<p>使用 Heroku 免费分配的数据库，有一些限额（比如只能有 10000 行数据），但足够用很久了。我这个 Keycloak 实例，跑了几年下来，还没有超出限额：<br /><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1660650366841-ba6365af-e5d1-4042-9357-11fd772a0ee2.png#clientId=u5f9cdaf7-b2a4-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=627&#x26;id=u433f0937&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1254&#x26;originWidth=3280&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=240078&#x26;status=done&#x26;style=none&#x26;taskId=u4b3121b9-dcc7-4e7a-b2d4-f9a0ad0fc6c&#x26;title=&#x26;width=1640\" alt=\"image.png\"></p>\n<p><a name=Zctta></a></p>\n<h2>使用 Adminer 查看数据库</h2>\n<p>我还部署了一个 adminer (<a href=\"https://nameless-depths-40663.herokuapp.com/\">https://nameless-depths-40663.herokuapp.com/</a>) 到 Heroku，可以方便查看数据库的情况（不限于 Keycloak 的数据库），比如：<br /><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1660650588357-0ea2337a-8de9-4938-b4fb-30925b5e32f0.png#clientId=u5f9cdaf7-b2a4-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=872&#x26;id=u39def897&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1744&#x26;originWidth=3728&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=998026&#x26;status=done&#x26;style=none&#x26;taskId=u6fdd6ec1-4ce9-49b9-a4be-daed1cb21bc&#x26;title=&#x26;width=1864\" alt=\"image.png\"></p>\n<p>这对应于 Keycloak 的用户，看起来，已经有很多人在我的 Keycloak 实例里注册了，感觉免费的数据库马上要不够用了……</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1660650655742-172a6e04-1719-4c93-a85d-de566406b21c.png#clientId=u5f9cdaf7-b2a4-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=859&#x26;id=u36081317&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1718&#x26;originWidth=2168&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=522703&#x26;status=done&#x26;style=none&#x26;taskId=ub009197e-3a8b-4904-852e-b30070fc436&#x26;title=&#x26;width=1084\" alt=\"image.png\"></p>\n<p><a name=h7Zsp></a></p>\n<h1>自定义域名</h1>\n<p>使用 Keycloak 默认的域名在大多数场景下足够了，但是在和中国生态结合使用时，比如在微信生态中使用的话，就需要域名是备案过的，这时候还是得绑定自定义的备案过的域名，只需要在 Domains 下面设置一下就好:</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1660650278785-ff64f09b-ea83-4d1c-ad65-a20aefe798c5.png#clientId=u5f9cdaf7-b2a4-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=541&#x26;id=ue19e7c11&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1082&#x26;originWidth=3064&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=238253&#x26;status=done&#x26;style=none&#x26;taskId=uc0d8e684-c8ad-4190-a49c-d06fc707411&#x26;title=&#x26;width=1532\" alt=\"image.png\"></p>\n<p><a name=vND06></a></p>\n<h1>后期工作</h1>\n<p>目前这个版本，还是使用了 JBOSS 来运行，后期可以尝试去掉 JBOSS，实现在 Heroku 上更轻量级的部署。</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[]}