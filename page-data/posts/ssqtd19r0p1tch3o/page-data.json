{"componentChunkName":"component---src-templates-post-js","path":"/posts/ssqtd19r0p1tch3o/","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/ssqtd19r0p1tch3o","relativePath":"posts/ssqtd19r0p1tch3o","frontmatter":{"title":"【免费架构】Heroku 不免费了，何去何从之 Keycloak 的容器化部署之路","stackbit_url_path":"posts/ssqtd19r0p1tch3o","date":"2023-03-06T11:53:55","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a name=qf0M3></a></p>\n<h1>前情提要</h1>\n<p>好几年前，我 fork 了一个项目（<a href=\"https://github.com/Jeff-Tian/keycloak-heroku\">https://github.com/Jeff-Tian/keycloak-heroku</a>）并做了一些修改，将 Keycloak 适配到了 Heroku 的免费 Dyno 上，并添加了一键部署按钮。但是，如《<a href=\"https://zhuanlan.zhihu.com/p/567187898\">Free Arch: Bye-bye to Heroku - Jeff Tian的文章 - 知乎</a>》所述，Heroku 不再免费。现在这个仓库，仍然可以一键部署到 Heroku 上，但是，可能产生费用。做为免费架构的拥趸，我必须找一个替代方案。</p>\n<p>如果你看过我前面的文章，没错，是熟悉的味道：《<a href=\"https://zhuanlan.zhihu.com/p/611115815\">免费架构：Heroku 不免费了，何去何从之 eggjs 的容器化部署之路 - Jeff Tian的文章 - 知乎 </a>》。</p>\n<p>本文将参考上文，对 jeff-tian/keycloak-heroku 项目做一个改造，将它部署到 Okteto。</p>\n<p><a name=pwBoU></a></p>\n<h1>在线演示</h1>\n<p>原来的 Heroku 站点是： <a href=\"https://keycloak.jiwai.win\">https://keycloak.jiwai.win</a> ，本来这个站点可以一直访问，Heroku 取消免费之后，我就将 Free Dyno 改成了最便宜的共享 Dyno，一个月 5 美元，但是每月有访问限额。如今只在月初可以访问，这个额度一旦用完就访问不了了。</p>\n<p>替代方案部署在 Okteto，域名是： <a href=\"https://keycloak-jeff-tian.cloud.okteto.net/\">https://keycloak-jeff-tian.cloud.okteto.net/</a>。</p>\n<p><a name=PFtzC></a></p>\n<h1>容器化</h1>\n<p>要部署到 Okteto 以及任何一个 k8s 集群，第一步是需要将应用容器化。我看了一下，原来我已经将 keycloak-heroku 项目容器化了，只是一直没有部署到 k8s 环境里。\n<a name=Tp10G></a></p>\n<h2>本地运行</h2>\n<p>之前容器化后，只在本地以 docker compose up的方式运行，然后打开 <a href=\"http://localhost:8080\">http://localhost:8080</a> 。<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABrUlEQVR42qWS3WsTQRTF9x/2RRCsBYMPVWlo8X/wVfAhPoj44ovYIm2MBEI1bRKCRJuP3ZnZ7M7szPxkJps1/XjzwuEOhzNn7rm7yfHxKw7bR7TbRzx/eciDh494srfP4719nraeRbTqfh9aO/3g4AUJt2ptPf9TibWWXUiRIaRkNpsxGo1QKsc5R1VVEVtdVdmGC+ctn3jvCaDuxhictbGXZRnNnL85ddRzlwtoDH19SRSGTEiUUuR5Hs2XuSbNBGmaYkwVdao0rNIsclrrxvSOoVQ5i8UiCrMsw1YVUqrICSE2jziLrdcQkoSozYTNyHUv1muklFEc4gbRdlehAhfUha4QQlIWxb81BMMQybsAF3G7vL/vq3t0ZSmKklJrnPNY67DOk6j5nHw+p1wt0Vm6Md5ZQYjn6ocazm8MtTFobTCVxVjHQmmSyXmPydk3fvf7LIY/d6bcXN7+Kjc458nWGiUlSoqYMEx5Nl6RnLzpcP62Q+/de/ofPjI8/cpVt8t4MOBycMFwOGY0nXExnXN5LRj+kXyfpnQnKSejFZ+vlnz6cU2n94vXX8b8BVupOzHKwR9IAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/95f3fefc95832273093cb06c1f92d820/fcda8/1678102638223-30db2db2-b5c8-4662-b5d5-16dd1391c82a.png\"\n        srcset=\"/static/95f3fefc95832273093cb06c1f92d820/12f09/1678102638223-30db2db2-b5c8-4662-b5d5-16dd1391c82a.png 148w,\n/static/95f3fefc95832273093cb06c1f92d820/e4a3f/1678102638223-30db2db2-b5c8-4662-b5d5-16dd1391c82a.png 295w,\n/static/95f3fefc95832273093cb06c1f92d820/fcda8/1678102638223-30db2db2-b5c8-4662-b5d5-16dd1391c82a.png 590w,\n/static/95f3fefc95832273093cb06c1f92d820/efc66/1678102638223-30db2db2-b5c8-4662-b5d5-16dd1391c82a.png 885w,\n/static/95f3fefc95832273093cb06c1f92d820/c83ae/1678102638223-30db2db2-b5c8-4662-b5d5-16dd1391c82a.png 1180w,\n/static/95f3fefc95832273093cb06c1f92d820/9cac8/1678102638223-30db2db2-b5c8-4662-b5d5-16dd1391c82a.png 2288w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br />如今要部署到集群，正好可以重用。</p>\n<p><a name=nVJU7></a></p>\n<h2>Dockerfile</h2>\n<p>项目里已经写好了 Dockerfile，只是文件名叫 Dockerfile.test：\ndockerfile\nFROM quay.io/keycloak/keycloak:latest</p>\n<p>COPY idps/wechat-mobile/keycloak-services-social-weixin.jar\n/opt/keycloak/providers/\nCOPY idps/wechat-mobile/templates/realm-identity-provider-weixin-ext.html\n/opt/keycloak/themes/base/admin/resources/partials\nCOPY idps/wechat-mobile/templates/realm-identity-provider-weixin.html\n/opt/keycloak/themes/base/admin/resources/partials</p>\n<p>COPY idps/wecom/keycloak-services-social-wechat-work.jar\n/opt/keycloak/providers/\nCOPY idps/wecom/templates/realm-identity-provider-wechat-work.html\n/opt/keycloak/themes/base/admin/resources/partials\nCOPY idps/wecom/templates/realm-identity-provider-wechat-work-ext.html\n/opt/keycloak/themes/base/admin/resources/partials</p>\n<p>CMD [start-dev, --hostname-strict=false]</p>\n<p><a name=PZKp7></a></p>\n<h2>打包脚本</h2>\n<p>要容器化打包，可以写个脚本来完成：</p>\n<p>shell\ndocker build -f Dockerfile.test -t jefftian/keycloak:$1 .\ndocker images\ndocker run --network host -e CI=true -d -p 127.0.0.1:8080:8080 --name keycloak:$1 jefftian/keycloak\ndocker ps | grep -q keycloak\ndocker ps -aqf name=keycloak$\ndocker push jefftian/keycloak:$1\ndocker logs $(docker ps -aqf name=keycloak$)\ncurl localhost:8080 || docker logs $(docker ps -aqf name=keycloak$)\ndocker kill keycloak || echo keycloak killed\ndocker rm keycloak || echo keycloak removed</p>\n<p>注意它接收一个参数，用来做容器的标记：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a2ed2c170c1bf6e2da0f7ab523865df6/24488/1678102875380-b126aa47-ee5f-44ea-90d7-d75d103ac2f7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.810810810810814%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABcElEQVR42qVSy07DMBDM/98rSgXihMSltE0qlJbv4MAXUA59xq/dxB60TtyEUiEkVho5G+9jdsdZWa6wXr9iVZZ4eH7B/dMck8kdRqMbjMcTzOYLFMUSeV4gz5dXUCAvllgsckynM2QY2O17jce3A/5jWdM0EHjvYYlhHcERw/uAEALS/V+R1XWNFg2MNlBKYa8IylD8z9wj+gnc5w2ROWHUwVqKgdJJLofsBZdsJIaIQMRgbpGJI8XEOSmH/VFBawPH/ryXxOTSpIlzDtZaHI5HGGNSQY6drGNoVyN4jxB8PGWXkmCM7Vj2EF8sAEjEzgzlNI5x0IRd5bBVjMr5KEwy+U4Qk7GFlTSTpkKqH5kYlXb43FWoKoVKRPFtoiQILosK0m6V0tDnkYlBwlLUbAKkTuMDuG4FSS8hJncCpULp7qcokaHFx7bCZnvCZm/jyENW10SRUQVa6yjQ9x1axkkTfPdUUpHfRm4LhzbGWnwB7m+dbKySOmAAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/a2ed2c170c1bf6e2da0f7ab523865df6/fcda8/1678102875380-b126aa47-ee5f-44ea-90d7-d75d103ac2f7.png\"\n        srcset=\"/static/a2ed2c170c1bf6e2da0f7ab523865df6/12f09/1678102875380-b126aa47-ee5f-44ea-90d7-d75d103ac2f7.png 148w,\n/static/a2ed2c170c1bf6e2da0f7ab523865df6/e4a3f/1678102875380-b126aa47-ee5f-44ea-90d7-d75d103ac2f7.png 295w,\n/static/a2ed2c170c1bf6e2da0f7ab523865df6/fcda8/1678102875380-b126aa47-ee5f-44ea-90d7-d75d103ac2f7.png 590w,\n/static/a2ed2c170c1bf6e2da0f7ab523865df6/efc66/1678102875380-b126aa47-ee5f-44ea-90d7-d75d103ac2f7.png 885w,\n/static/a2ed2c170c1bf6e2da0f7ab523865df6/c83ae/1678102875380-b126aa47-ee5f-44ea-90d7-d75d103ac2f7.png 1180w,\n/static/a2ed2c170c1bf6e2da0f7ab523865df6/24488/1678102875380-b126aa47-ee5f-44ea-90d7-d75d103ac2f7.png 2984w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=czdXb></a></p>\n<h1>SOPS</h1>\n<p>由于要将项目跑起来，需要一些秘密数据，想将它们纳入代码管理，但又不想明文展示出来，那就可以利用 SOPS 了。详情可以参考上文《<a href=\"https://zhuanlan.zhihu.com/p/611115815\">免费架构：Heroku 不免费了，何去何从之 eggjs 的容器化部署之路 - Jeff Tian的文章 - 知乎 </a>》，以及《<a href=\"https://zhuanlan.zhihu.com/p/351520284\">加密 Kubernetes 集群中的敏感信息 - Jeff Tian的文章 - 知乎 </a> 》。</p>\n<p><a name=jO01e></a></p>\n<h1>配置 GitHub Action Secrets</h1>\n<p>参考上文，在最终的 CICD 脚本中需要用到一些密码数据：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7c20a359c81933bdfae4402e02e2ba53/6578c/1678103114436-3d391f6d-f4b1-4d0a-8241-0cf0d8555a97.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZElEQVR42nVS2XKDMBDjT9I04bIxPsBArnbSJv//SepoEzMlx4PwwK61kpYsxD1sGOG7CY3toI2HNgG+36EbDmBdtx1KZVFpt4SyUjNuQBtGuG5CptyEfv+DrfL4yBusC4N12cLGE8J0hhu+wJ4m7J+g/U7qw+mKeLyijSdk2k/ycVs7IfssWwHJV1st4HuuPHIVlqcOcme1UdK3zhtkpYlSZGFT2ZmwaiNqO6AyEUXTodDPICFrZdPfewIJe1AlT0IsFwZ+/EY8XER9bceX0G6SOFIkjCDjIx5/JbPK9KKS4HQOUm4UxWlQAr8lEVSWcs2U36Hfn+Vikr2tbznV7SBDUgyP4ND83k+1REY1VMKlzFsuWiFmhhz0uLAE9kiWyotd8kiGyo4LK2Kn6dGEHWw8zttcEFZW7MrSdCe9/zK8wHSHOavb9FsTz3eWX2bIrGiLoP1ESJv82d+REZvKzUtMv9YfwQRO40dhmEgAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/7c20a359c81933bdfae4402e02e2ba53/fcda8/1678103114436-3d391f6d-f4b1-4d0a-8241-0cf0d8555a97.png\"\n        srcset=\"/static/7c20a359c81933bdfae4402e02e2ba53/12f09/1678103114436-3d391f6d-f4b1-4d0a-8241-0cf0d8555a97.png 148w,\n/static/7c20a359c81933bdfae4402e02e2ba53/e4a3f/1678103114436-3d391f6d-f4b1-4d0a-8241-0cf0d8555a97.png 295w,\n/static/7c20a359c81933bdfae4402e02e2ba53/fcda8/1678103114436-3d391f6d-f4b1-4d0a-8241-0cf0d8555a97.png 590w,\n/static/7c20a359c81933bdfae4402e02e2ba53/efc66/1678103114436-3d391f6d-f4b1-4d0a-8241-0cf0d8555a97.png 885w,\n/static/7c20a359c81933bdfae4402e02e2ba53/c83ae/1678103114436-3d391f6d-f4b1-4d0a-8241-0cf0d8555a97.png 1180w,\n/static/7c20a359c81933bdfae4402e02e2ba53/6578c/1678103114436-3d391f6d-f4b1-4d0a-8241-0cf0d8555a97.png 2242w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=BIhgI></a></p>\n<h1>配置 CICD 流水线</h1>\n<p><a name=KHt39></a></p>\n<h2>先准备一些 k8s 声明文件</h2>\n<p>详见项目的 k8s 文件夹，有 secrets.yaml、deployments.yaml、service.yaml 以及 kustomization.yaml 文件。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/15193c53a51fd7b8d09d223019c32cf3/5b6ee/1678103190232-79fc03ed-c4c0-48d4-ae65-741fe37d266e.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABm0lEQVR42n2S3XKcMAyF/ShZdvkxxjK2sYEFkrTdXvSi7fT9H+Z0JJZt02R68Y34kY90ZKk8bWCcTxjnDT6O6CjAkkdn+x1+dxHaOJxL/V+UHVak5Yb59Rsam3CqCefG4UwrqvAFpX+FiRvqLuCp7FDUJEjOB6jKBDSUhIvuhbPuEfMKl1/Q+itaN0JTQt1FaBpEvKg7nEqDU2XucS+mtMuwcUFlIk6VlSpF4+DiDIpXtP0M3V+h/SKxDRt0eEbj17/Y0NAkBZWmDONnUWdBhp9p2BDnT3DjZ9jxBpq+7nH5Drf+fEDrD7jtF2y+wfQjFCW2tqHqolDbAZfWw/gJXWC7+R/SG2yY4YYFTnSed8s0LGj7EfzMM2XblPgiBly0R9kGlCb8ie+Ij/+q1E7EaFiFsvVim2+8C7PMlwsdo3hDZWVuDWUpzherqrYXQT5o+kkEOZmt23gVKxQX6fRYl6J290hS+HDHKP7Y+Rku7XN8uhhJZkHukMdxFCnuG/BOUNYqC0oOc9s2PeweHXIh7vI4/BGcp9143+WM39ikUdeBTHBMAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/15193c53a51fd7b8d09d223019c32cf3/fcda8/1678103190232-79fc03ed-c4c0-48d4-ae65-741fe37d266e.png\"\n        srcset=\"/static/15193c53a51fd7b8d09d223019c32cf3/12f09/1678103190232-79fc03ed-c4c0-48d4-ae65-741fe37d266e.png 148w,\n/static/15193c53a51fd7b8d09d223019c32cf3/e4a3f/1678103190232-79fc03ed-c4c0-48d4-ae65-741fe37d266e.png 295w,\n/static/15193c53a51fd7b8d09d223019c32cf3/fcda8/1678103190232-79fc03ed-c4c0-48d4-ae65-741fe37d266e.png 590w,\n/static/15193c53a51fd7b8d09d223019c32cf3/efc66/1678103190232-79fc03ed-c4c0-48d4-ae65-741fe37d266e.png 885w,\n/static/15193c53a51fd7b8d09d223019c32cf3/c83ae/1678103190232-79fc03ed-c4c0-48d4-ae65-741fe37d266e.png 1180w,\n/static/15193c53a51fd7b8d09d223019c32cf3/5b6ee/1678103190232-79fc03ed-c4c0-48d4-ae65-741fe37d266e.png 1672w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=yFHA6></a></p>\n<h2>准备 github workflow</h2>\n<p>这个文件内容如下：</p>\n<p>yaml</p>\n<h1>This workflow will do a clean installation of node dependencies, build the source code and run tests across different versions of node</h1>\n<h1>For more information see: <a href=\"https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions\">https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions</a></h1>\n<p>name: CICD</p>\n<p>on:\npush:\nbranches: [ master ]\npull_request:\nbranches: [ master ]\nschedule:\n- cron: 0 */12 * * *</p>\n<p>jobs:\nbuild-docker-image:\nruns-on: ubuntu-latest\nsteps:\n- uses: actions/checkout@v3\n- run: echo ${{secrets.DOCKER_PASSWORD}} | docker login -u ${{secrets.DOCKER_USERNAME}} --password-stdin\n- run: git_hash=$(git rev-parse ${{ github.sha }})\n- run: sh .github/dockerize.sh ${{ github.sha }}</p>\n<p>deploy-okteto:\nruns-on: ubuntu-latest\nneeds: build-docker-image\nsteps:\n- uses: actions/checkout@v3</p>\n<pre><code>  - run: mkdir ${HOME}/.aws\n  - run: echo -e [lambda-doc-rotary]naws_access_key_id = ${{secrets.AWS_ACCESS_KEY}}naws_secret_access_key = ${{secrets.AWS_SECRET_KEY}}n > ~/.aws/config\n  - run: wget https://github.com/mozilla/sops/releases/download/v3.7.3/sops-v3.7.3.linux.amd64\n  - run: sudo cp sops-v3.7.3.linux.amd64 /usr/local/bin/sops\n  - run: sudo chmod +x /usr/local/bin/sops\n\n\n  - run: curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl\n  - run: chmod +x ./kubectl\n  - run: sudo mv ./kubectl /usr/local/bin/kubectl\n  - run: mkdir ${HOME}/.kube\n  - run: npm i -g k8ss\n  - run: echo -e machine github.comn  login ${{secrets.GH_TOKEN}} > ~/.netrc\n  - run: git clone https://github.com/Jeff-Tian/k8s-config.git ${HOME}/k8s-config\n  - run: k8ss switch --cluster=okteto --namespace=jeff-tian\n  - run: sops -d k8s/secrets.yaml --aws-profile lambda-doc-rotary | kubectl apply -f -\n  - run: kubectl apply -k k8s\n  - run: kubectl set image deployment keycloak keycloak=jefftian/keycloak:${{ github.sha }}\n</code></pre>\n<p>这个流水线的效果如下图：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4ec59599851ffcd26bebf9d8da588ee6/8079d/1678103427775-900b6b07-b5dc-4146-a55f-9baa8bed6469.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.48648648648649%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5UlEQVR42oVSWZabMBDkGIkn4wWziEWgDRAGY+xxJpPM/c9Ted3YzvgrH/UadetVVxUKztc/6A4ntP0EP8xQ1qM2HUO5Hs5PaPwE0w5Qtkdte+7XxjOy0iCTZqmlQdDPv6H9Gbo7QfsZ0o4o9AGlWWD7M4yfee4OFz434xXNcOVauRGlHbhW7oggLhzy5oLUvSPtPiG6T8T1iChT2MYlNlHxhPU+51lWd7yQluXKQ7UTLwuSwiBXHUTtUZgRovKQukcmHUTVIC0d0tJCyIZrKh0jq1okpcUukQjT6oEgLjTiwiASNeJcI8kVslzxeS8U9lxr7DP1VKNb/UrGhKKxaKclE5J8z6yb3tEdf6Idryi0Z/uk5n8IcjNAd9PDAlsqLaJ8UU6RsJpMIUwlwkQ+KVsU/1MdiKplqw9rt8tkWTcjpBsg7QF1MyJ3bwgzh1J7/iFEUDdHXk7fJCgQ1kK6A9ui5l06kZK6/ZfeLq2xTarH/N6nOO4IUmVQmJ5tfg2XLpJ6uvTtNcJqk2C1ifGyTbBaJ/i+jm+9BS/blBHQeyLZd5I7IW9M5ZIPqeR5hdcww05UiDKNUJDiReWPnVgIKXiySzk+CG+X9DjDnz7QTb9g+wtUe2JSPZ7Qzx9wwxv3CPTgifAvr9Ru4WqjhY4AAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/4ec59599851ffcd26bebf9d8da588ee6/fcda8/1678103427775-900b6b07-b5dc-4146-a55f-9baa8bed6469.png\"\n        srcset=\"/static/4ec59599851ffcd26bebf9d8da588ee6/12f09/1678103427775-900b6b07-b5dc-4146-a55f-9baa8bed6469.png 148w,\n/static/4ec59599851ffcd26bebf9d8da588ee6/e4a3f/1678103427775-900b6b07-b5dc-4146-a55f-9baa8bed6469.png 295w,\n/static/4ec59599851ffcd26bebf9d8da588ee6/fcda8/1678103427775-900b6b07-b5dc-4146-a55f-9baa8bed6469.png 590w,\n/static/4ec59599851ffcd26bebf9d8da588ee6/efc66/1678103427775-900b6b07-b5dc-4146-a55f-9baa8bed6469.png 885w,\n/static/4ec59599851ffcd26bebf9d8da588ee6/c83ae/1678103427775-900b6b07-b5dc-4146-a55f-9baa8bed6469.png 1180w,\n/static/4ec59599851ffcd26bebf9d8da588ee6/8079d/1678103427775-900b6b07-b5dc-4146-a55f-9baa8bed6469.png 2100w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=H7ON9></a></p>\n<h2>完成： 部署到 Okteto</h2>\n<p>部署到 Okteto 后：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/60e4bad64063b3dcbf96029ba25d1100/580b1/1678103485269-7e5f70da-7ab4-45a6-9793-841cfa072442.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.756756756756754%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABNElEQVR42m2N226bQBRF+YZKUWIwzI25gcHcTdw0rqqkT+3/f86qmKpvfVjaZzTn7JWF5sqwvNENN3wz0Y872nZI0yJ0Q6UipQyUKqT3/6h0w7wsLNs3ssK2zPsn0o3YZsNeNq7rgzjcuW7vtOMb1/U73fxA+RkdlsQx/8PEFdP8JYvdyNcfv5F+JPR34nrj8esncR0Ja48Jh2ihjjOlvlDpS0pR90jbo9yIbzdcv+O6nUwFw+3jHdF67NRhhpZh2jidJXkuKXLF80nwkgtOhSQ/q5RlZRDKInWgkg6hHNJEsrzUTK+fqDDh+x3phrSg6wYjIk60lMJTSZsKjkNlPFJ7SlGnFNKm/0OSfXkqcJc72s/UzYa0A8rEZDYyos+ep2fBIT6XOpVUqaBO8yE48qAoNX8Aj9ivA37cUpoAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/60e4bad64063b3dcbf96029ba25d1100/fcda8/1678103485269-7e5f70da-7ab4-45a6-9793-841cfa072442.png\"\n        srcset=\"/static/60e4bad64063b3dcbf96029ba25d1100/12f09/1678103485269-7e5f70da-7ab4-45a6-9793-841cfa072442.png 148w,\n/static/60e4bad64063b3dcbf96029ba25d1100/e4a3f/1678103485269-7e5f70da-7ab4-45a6-9793-841cfa072442.png 295w,\n/static/60e4bad64063b3dcbf96029ba25d1100/fcda8/1678103485269-7e5f70da-7ab4-45a6-9793-841cfa072442.png 590w,\n/static/60e4bad64063b3dcbf96029ba25d1100/efc66/1678103485269-7e5f70da-7ab4-45a6-9793-841cfa072442.png 885w,\n/static/60e4bad64063b3dcbf96029ba25d1100/c83ae/1678103485269-7e5f70da-7ab4-45a6-9793-841cfa072442.png 1180w,\n/static/60e4bad64063b3dcbf96029ba25d1100/580b1/1678103485269-7e5f70da-7ab4-45a6-9793-841cfa072442.png 3688w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>打开自动分配的网址：<br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9568f568a41f844e5618ec5a95d91e8c/b8bf8/1678103468099-27ad54a3-e251-4704-b6e2-7ad9a0d565fa.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABjklEQVR42q1S2U7DQAzMN3I9VSqFAp/LI32JgIeWlqbZkO59DVo3G/UEKmFplKwTjz2zLm5H97i7f8Bo/IjhaEzv44cnDAZDXFxe4/Lq5iwUIQSkeC7f8Dr7QMMY5vMFcv7cKPJLjBH/EUUmatsWVVXRczqdYjKZoCxLWOcQu4Z/QU8YYwBi6Ke11hKOxTE1B4TWB7TSQCkJLgSc85RnwuCLSygpIaSE954KlXEQQhCUUr3nPSFXBi/lOz4XC7CmgVKa8jU3qJoWjNVkidYaqSQ1qqoV6rpG0zSHhMF7rNuWPOSc91K0klh13tJEUiJS8a7sRLgj2RiD2WxGHZfLJZ1zPpGlybJXYUtylnvgYfImF50yf3PeEDbCYFlVNECWS4T7hbkTjqzKzvetjUiE+bKKU/v0G7nz4fgeorP3p93ay5JkxjU+5nPU9QqMsa1bTqMGT7fst5DO6acQulySRdJCl9/IdB1S3oeIwvI1rOBwShJsgtZw1sA7C+ccrPO0+BnGBagE6yE7cOOx1g7fglF2oHGQs9UAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"image.png\"\n        src=\"/static/9568f568a41f844e5618ec5a95d91e8c/fcda8/1678103468099-27ad54a3-e251-4704-b6e2-7ad9a0d565fa.png\"\n        srcset=\"/static/9568f568a41f844e5618ec5a95d91e8c/12f09/1678103468099-27ad54a3-e251-4704-b6e2-7ad9a0d565fa.png 148w,\n/static/9568f568a41f844e5618ec5a95d91e8c/e4a3f/1678103468099-27ad54a3-e251-4704-b6e2-7ad9a0d565fa.png 295w,\n/static/9568f568a41f844e5618ec5a95d91e8c/fcda8/1678103468099-27ad54a3-e251-4704-b6e2-7ad9a0d565fa.png 590w,\n/static/9568f568a41f844e5618ec5a95d91e8c/efc66/1678103468099-27ad54a3-e251-4704-b6e2-7ad9a0d565fa.png 885w,\n/static/9568f568a41f844e5618ec5a95d91e8c/c83ae/1678103468099-27ad54a3-e251-4704-b6e2-7ad9a0d565fa.png 1180w,\n/static/9568f568a41f844e5618ec5a95d91e8c/b8bf8/1678103468099-27ad54a3-e251-4704-b6e2-7ad9a0d565fa.png 1728w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a name=SdOyW></a></p>\n<h1>总结</h1>\n<p>耶！我们又重新拥有了属于自己的<strong>免费的</strong> Keycloak 实例！</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}