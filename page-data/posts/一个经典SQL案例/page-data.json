{"componentChunkName":"component---src-templates-post-js","path":"/posts/一个经典SQL案例/","result":{"data":{"sitePage":{"id":"SitePage /posts/一个经典SQL案例/"}},"pageContext":{"url":"/posts/一个经典SQL案例/","relativePath":"posts/一个经典SQL案例.md","relativeDir":"posts","base":"一个经典SQL案例.md","name":"一个经典SQL案例","frontmatter":{"title":"一个经典SQL案例","stackbit_url_path":"posts/一个经典SQL案例","date":"2010-07-09 10:37:16","excerpt":"","comments_count":0,"positive_reactions_count":0,"tags":[null],"canonical_url":"https://be-net.azurewebsites.net/post/2010/07/09/一个经典SQL案例","template":"post"},"html":"<pre><code>    &#x3C;p>来自：&#x3C;a href=\"http://topic.csdn.net/u/20100701/15/fd028ff8-20b9-4902-a77a-08d6c4f55cf1.html\">http://topic.csdn.net/u/20100701/15/fd028ff8-20b9-4902-a77a-08d6c4f55cf1.html&#x3C;/a>&#x3C;/p>\n</code></pre>\n<hr>\n<p>&nbsp;问：</p>\n<p>&nbsp;</p>\n<p></p><dt style=\"background-color: rgb(245, 245, 245); height: 24px; line-height: 24px; font-weight: bold; text-indent: 6px; color: rgb(51, 51, 51); \">SQL code</dt><dd style=\"border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(221, 221, 221); border-right-color: rgb(221, 221, 221); border-bottom-color: rgb(221, 221, 221); border-left-color: rgb(221, 221, 221); margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; \">\n<pre><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">create</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">table</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> tb(姓名 </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">varchar</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">(</span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">10</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">) , 课程 </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">varchar</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">(</span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">10</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">) , 分数 </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">int</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">)  </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">insert</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">into</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> tb </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">values</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">(</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">张三</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">语文</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">74</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">)  </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">insert</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">into</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> tb </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">values</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">(</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">张三</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">数学</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">83</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">)  </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">insert</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">into</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> tb </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">values</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">(</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">李四</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">语文</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">74</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">)  </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">insert</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">into</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> tb </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">values</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">(</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">李四</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">数学</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">84</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">)  </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">insert</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">into</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> tb </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">values</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">(</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">李四</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">物理</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">94</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">)   </span></div><div>&nbsp;</div><div><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">结果 </span></div><div>&nbsp;</div><div><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">姓名 选择课程 </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">张三 语文,数学 </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">李四 语文,数学,物理</span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"><br></span></div></pre>\n<br>\n</dd><p></p>\n<p>以上可以用一句SQL实现吗？？？</p>\n<p>&nbsp;</p>\n<p>答：</p>\n<p>能！&nbsp;</p>\n<p>&nbsp;</p>\n<p></p><dt style=\"background-color: rgb(245, 245, 245); height: 24px; line-height: 24px; font-weight: bold; text-indent: 6px; color: rgb(51, 51, 51); \">SQL code</dt><dd style=\"border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(221, 221, 221); border-right-color: rgb(221, 221, 221); border-bottom-color: rgb(221, 221, 221); border-left-color: rgb(221, 221, 221); margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; \">\n<pre><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">create</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">table</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> tb(姓名 </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">varchar</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">(</span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">10</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">) , 课程 </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">varchar</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">(</span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">10</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">) , 分数 </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">int</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">)  </span></div><div>&nbsp;</div><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">insert</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">into</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> tb </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">values</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">(</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">张三</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">语文</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">74</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">)  </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">insert</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">into</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> tb </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">values</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">(</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">张三</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">数学</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">83</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">)  </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">insert</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">into</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> tb </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">values</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">(</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">李四</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">语文</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">74</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">)  </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">insert</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">into</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> tb </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">values</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">(</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">李四</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">数学</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">84</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">)  </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">insert</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">into</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> tb </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">values</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">(</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">李四</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">物理</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> , </span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">94</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">)   </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">select</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">  姓名,</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">        选择课程</span><span style=\"line-height: 18px; color: rgb(128, 128, 128); \">=</span><span style=\"line-height: 18px; color: rgb(255, 0, 255); \">stuff</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">((</span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">select</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">,</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">'</span><span style=\"line-height: 18px; color: rgb(128, 128, 128); \">+</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">课程 </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">from</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> TB </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">where</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> 姓名</span><span style=\"line-height: 18px; color: rgb(128, 128, 128); \">=</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">t.姓名 </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">for</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> xml path(</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">''</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">)),</span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">1</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">,</span><span style=\"line-height: 18px; color: rgb(128, 0, 0); font-weight: bold; \">1</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">,</span><span style=\"line-height: 18px; color: rgb(255, 0, 0); \">''</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">) </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">from</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> tb t  </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">group</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">by</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> 姓名  </span></div><div><span style=\"line-height: 18px; color: rgb(0, 128, 128); \">/*</span><span style=\"line-height: 18px; color: rgb(0, 128, 128); \"> </span></div><div><span style=\"line-height: 18px; color: rgb(0, 128, 128); \">姓名         选择课程 </span></div><div><span style=\"line-height: 18px; color: rgb(0, 128, 128); \">---------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- </span></div><div><span style=\"line-height: 18px; color: rgb(0, 128, 128); \">李四         语文,数学,物理 </span></div><div><span style=\"line-height: 18px; color: rgb(0, 128, 128); \">张三         语文,数学  </span></div><div>&nbsp;</div><div><span style=\"line-height: 18px; color: rgb(0, 128, 128); \">(2 行受影响)  </span></div><div>&nbsp;</div><div><span style=\"line-height: 18px; color: rgb(0, 128, 128); \">*/</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \">   </span></div><div>&nbsp;</div><div><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">drop</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> </span><span style=\"line-height: 18px; color: rgb(0, 0, 255); \">table</span><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"> TB </span></div><div><span style=\"line-height: 18px; color: rgb(0, 0, 0); \"><br></span></div></pre>\n</dd><p></p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;&nbsp;</p>\n<p>另附：</p>\n<p>&nbsp;合并列值 <br>\n原著：邹建 <br>\n改编：爱新觉罗.毓华(十八年风雨,守得冰山雪莲花开)  2007-12-16  广东深圳</p>\n<p>表结构，数据如下： <br>\nid    value <br>\n----- ------ <br>\n1    aa <br>\n1    bb <br>\n2    aaa <br>\n2    bbb <br>\n2    ccc</p>\n<p>需要得到结果： <br>\nid    values <br>\n------ ----------- <br>\n1      aa,bb <br>\n2      aaa,bbb,ccc <br>\n即：group by id, 求 value 的和（字符串相加）</p>\n<p>1. 旧的解决方法(在sql server 2000中只能用函数解决。) <br>\n--1. 创建处理函数 <br>\ncreate table tb(id int, value varchar(10)) <br>\ninsert into tb values(1, 'aa') <br>\ninsert into tb values(1, 'bb') <br>\ninsert into tb values(2, 'aaa') <br>\ninsert into tb values(2, 'bbb') <br>\ninsert into tb values(2, 'ccc') <br>\ngo</p>\n<p>CREATE FUNCTION dbo.f_str(@id int) <br>\nRETURNS varchar(8000) <br>\nAS <br>\nBEGIN <br>\nDECLARE @r varchar(8000) <br>\nSET @r = '' <br>\nSELECT @r = @r + ',' + value FROM tb WHERE id=@id <br>\nRETURN STUFF(@r, 1, 1, '') <br>\nEND <br>\nGO</p>\n<p>-- 调用函数 <br>\nSELECt id, value = dbo.f_str(id) FROM tb GROUP BY id</p>\n<p>drop table tb <br>\ndrop function dbo.f_str</p>\n<p>/* <br>\nid          value      <br>\n----------- ----------- <br>\n1          aa,bb <br>\n2          aaa,bbb,ccc <br>\n（所影响的行数为 2 行） <br>\n*/</p>\n<p>--2、另外一种函数. <br>\ncreate table tb(id int, value varchar(10)) <br>\ninsert into tb values(1, 'aa') <br>\ninsert into tb values(1, 'bb') <br>\ninsert into tb values(2, 'aaa') <br>\ninsert into tb values(2, 'bbb') <br>\ninsert into tb values(2, 'ccc') <br>\ngo</p>\n<p>--创建一个合并的函数 <br>\ncreate function f_hb(@id int) <br>\nreturns varchar(8000) <br>\nas <br>\nbegin <br>\ndeclare @str varchar(8000) <br>\nset @str = '' <br>\nselect @str = @str + ',' + cast(value as varchar) from tb where id = @id <br>\nset @str = right(@str , len(@str) - 1) <br>\nreturn(@str) <br>\nEnd <br>\ngo</p>\n<p>--调用自定义函数得到结果： <br>\nselect distinct id ,dbo.f_hb(id) as value from tb</p>\n<p>drop table tb <br>\ndrop function dbo.f_hb</p>\n<p>/* <br>\nid          value      <br>\n----------- ----------- <br>\n1          aa,bb <br>\n2          aaa,bbb,ccc <br>\n（所影响的行数为 2 行） <br>\n*/</p>\n<p>2. 新的解决方法(在sql server 2005中用OUTER APPLY等解决。) <br>\ncreate table tb(id int, value varchar(10)) <br>\ninsert into tb values(1, 'aa') <br>\ninsert into tb values(1, 'bb') <br>\ninsert into tb values(2, 'aaa') <br>\ninsert into tb values(2, 'bbb') <br>\ninsert into tb values(2, 'ccc') <br>\ngo <br>\n-- 查询处理 <br>\nSELECT * FROM(SELECT DISTINCT id FROM tb)A OUTER APPLY( <br>\nSELECT [values]= STUFF(REPLACE(REPLACE( <br>\n( <br>\nSELECT value FROM tb N <br>\nWHERE id = A.id <br>\nFOR XML AUTO <br>\n), ' &lt;N value=\"', ','), '\"/&gt;', ''), 1, 1, '') <br>\n)N <br>\ndrop table tb</p>\n<p>/* <br>\nid          values <br>\n----------- ----------- <br>\n1          aa,bb <br>\n2          aaa,bbb,ccc</p>\n<p>(2 行受影响) <br>\n*/</p>\n<p>--SQL2005中的方法2 <br>\ncreate table tb(id int, value varchar(10)) <br>\ninsert into tb values(1, 'aa') <br>\ninsert into tb values(1, 'bb') <br>\ninsert into tb values(2, 'aaa') <br>\ninsert into tb values(2, 'bbb') <br>\ninsert into tb values(2, 'ccc') <br>\ngo</p>\n<p>select id, [values]=stuff((select ','+[value] from tb t where id=tb.id for xml path('')), 1, 1, '') <br>\nfrom tb <br>\ngroup by id</p>\n<p>/* <br>\nid          values <br>\n----------- -------------------- <br>\n1          aa,bb <br>\n2          aaa,bbb,ccc</p>\n<p>(2 row(s) affected)</p>\n<p>*/</p>\n<p>drop table tb</p>\n<p><br>\n<br>\ncreate table [user](<br>\nid int,name varchar(20)<br>\n)<br>\ngo <br>\ninsert [user] select<br>\n1,      '张三'<br>\nunion all select <br>\n2,     '李四' <br>\nunion all select <br>\n3,      '王五' <br>\ngo<br>\ncreate table skill (<br>\nid int,   uid int,   name varchar(20),   level varchar(20)<br>\n)<br>\ninsert skill select<br>\n1,      1,      '英语',    '6级' <br>\nunion all select <br>\n2,      3,      '日语',    '初级' <br>\nunion all select <br>\n3,      1,      '法语',    '入门'<br>\nunion all select <br>\n4,      3,      '英语',    '4级' <br>\nunion all select <br>\n5,      3,      '德语',    '精通'</p>\n<p>go  <br>\n<br>\ncreate function fn_skill(<br>\n@uid int,<br>\n@name varchar(20)<br>\n)<br>\nreturns varchar(500)<br>\nas<br>\nbegin<br>\ndeclare @r varchar(500)<br>\nif @name = ''             ---空表示查所有<br>\nselect @r = isnull(@r + '、','') + name from skill where uid=@uid<br>\nelse<br>\nselect @r = isnull(@r + '、','') + name from skill where uid=@uid and name = @name<br>\nreturn @r<br>\nend<br>\ngo</p>\n<p>create function fn_skilldetail(<br>\n@uid int,<br>\n@name varchar(20)<br>\n)<br>\nreturns varchar(500)<br>\nas<br>\nbegin<br>\ndeclare @r varchar(500)<br>\nif @name = ''             ---空表示查所有<br>\nselect @r = isnull(@r + '、','') + name + '-' + level from skill where uid=@uid<br>\nelse<br>\nselect @r = isnull(@r + '、','') + name + '-' + level from skill where uid=@uid and name = @name<br>\nreturn @r<br>\nend<br>\ngo</p>\n<p>--1<br>\nselect id as uid,name,dbo.fn_skill(id,'') as skill <br>\nfrom [user]<br>\ngo<br>\n--2<br>\nselect id as uid,name,dbo.fn_skilldetail(id,'') as skill <br>\nfrom [user]</p>\n<p>--3<br>\nselect id as uid,name,dbo.fn_skilldetail(id,'英语') as skill <br>\nfrom [user]</p>\n<p>--4<br>\nselect id as uid,name,dbo.fn_skilldetail(id,'英语') as skill <br>\nfrom [user]<br>\nwhere dbo.fn_skilldetail(id,'英语') is not null</p>\n<p>--结果<br>\nuid         name                 skill<br>\n----------- -------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<br>\n1           张三                   英语、法语<br>\n2           李四                   NULL<br>\n3           王五                   日语、英语、德语</p>\n<p>(3 行受影响)</p>\n<p>uid         name                 skill<br>\n----------- -------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<br>\n1           张三                   英语-6级、法语-入门<br>\n2           李四                   NULL<br>\n3           王五                   日语-初级、英语-4级、德语-精通</p>\n<p>(3 行受影响)</p>\n<p>uid         name                 skill<br>\n----------- -------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<br>\n1           张三                   英语-6级<br>\n2           李四                   NULL<br>\n3           王五                   英语-4级</p>\n<p>(3 行受影响)</p>\n<p>uid         name                 skill<br>\n----------- -------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<br>\n1           张三                   英语-6级<br>\n3           王五                   英语-4级</p>\n<p>(2 行受影响)</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}}}},"staticQueryHashes":[],"slicesMap":{}}