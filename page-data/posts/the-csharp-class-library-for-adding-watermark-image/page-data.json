{"componentChunkName":"component---src-templates-post-js","path":"/posts/the-csharp-class-library-for-adding-watermark-image/","result":{"data":{"sitePage":{"id":"SitePage /posts/the-csharp-class-library-for-adding-watermark-image/"}},"pageContext":{"url":"/posts/the-csharp-class-library-for-adding-watermark-image/","relativePath":"posts/the-csharp-class-library-for-adding-watermark-image.md","relativeDir":"posts","base":"the-csharp-class-library-for-adding-watermark-image.md","name":"the-csharp-class-library-for-adding-watermark-image","frontmatter":{"title":"给图片添加水印的C#类库","stackbit_url_path":"posts/the-csharp-class-library-for-adding-watermark-image","date":"2011-07-12 16:57:00","excerpt":"本文提供了一个给图片添加水印的C#类库，首先介绍了它的使用方法，其次介绍了该类库的结构，最后公开了它的源代码以及整个项目文件。","comments_count":0,"positive_reactions_count":0,"tags":["Watermark","扩展","模板设计模式","水印"],"canonical_url":"https://be-net.azurewebsites.net/post/2011/07/12/the-csharp-class-library-for-adding-watermark-image","template":"post"},"html":"<h1><span style=\"color: #800080;\">相关文件下载：</span></h1>\n<p><span style=\"color: #000000;\">1. 给图片添加水印的类库（dll)文件：<a href=\"/BlogEngine/BlogEngine/BlogEngine.NET/file.axd?file=2011%2f7%2fImageHandler.dll\">ImageHandler.dll (18.00 kb)</a></span></p>\n<p><span style=\"color: #000000;\">2. 整个类库项目文件：<a href=\"/BlogEngine/BlogEngine/BlogEngine.NET/file.axd?file=2011%2f7%2fImageHandler.rar\">ImageHandler.rar (45.03 kb)</a></span><span style=\"color: #800080;\">&nbsp;</span></p>\n<h1><span style=\"color: #800080;\">摘要：</span></h1>\n<p>本文提供了一个给图片添加水印的C#类库，首先介绍了它的使用方法，其次介绍了该类库的结构，最后公开了它的源代码以及整个项目文件。</p>\n<h1><span style=\"color: #800080;\">简介：</span></h1>\n<p><a title=\"使用.NET的GDI+技术给图片加水印\" href=\"http://www.zizhujy.com/BlogEngine/BlogEngine/BlogEngine.NET/post/2011/07/07/add-watermark-to-image-using-csharp-and-gdiplus.aspx\" target=\"_blank\">上篇文章</a>介绍了使用C#及GDI+技术给图片添加水印的原理和技术细节。本文使用其技术做底层实现，采用模板设计模式架构，提供了一个高复用性与易扩展的图片处理类库。</p>\n<p>&nbsp;<a href=\"https://raw.githubusercontent.com/Jeff-Tian/blogengine.net/master/Source/BlogEngine/BlogEngine.NET/App_Data/files/image_30.png\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAACR0lEQVR42j3M6UsTAACG8f0JQUKH6FBBTc2rdOoKDRK1SP1gHzrAWLCiQ8QwM1yRmWw2p8xJU7zwvjY3nUjmUppEBwPp2JzNErcl2vAKK6V6Io1e+H15PzyCkUknS4uf+fhpDpfLhdvtwePx4PJ8QaufRt5uR9FhR9G+o7z13fYnb7dR0TGNqteJsmsaeZsNRfMLBLapSZa9C7jdbrzeRVZXvKwsL7G2usTvrfV/1v7b3PDya3OVnz9WYGsd2GTr+xqLC25evrIikBWXIitt4K68m/vKXpQaAxVqIwr1EHK1CXnNMArNCBWPHqOsG6WyfgxVgxlVo5mq5nEeNo6jG53i28ZXrFN2BMLoAvaHXEIYeQ3/qHz8ogvZHXaTXaG38ImQsSemFF+RHP+jSoTJKgJTawjK0BKc2UJ4TiuB2U3kKSf4u5lZF4LgxNv4hOSzN6II3+gS/A7dIyChnOCUSkKOVxGWoSEyu56Y002IcjsRS/tIzNUiyrlO2hUNIqmBQrVlO+iYnUdwIKUM32gZwvgyAsUVhKbXEp6pRZTbSlp+P8mXe4k900bs2XYSJD3EXzQRm1VAXOI+sgprOVmso6RucifonEdw8EQ1AclKgo5VE36qniRJJ0nSblLy9Iil/cTl9hBzrpvDF3SIJF2Izz8gKl2C6EggWVeLSL3RwZ0W63bQOedB0GZ8jfHpe3SjbxmcsDPyfAaTxYHJMoN+zIbebMcw4cA44WDQ8gHjk2cMmIboMwyjHzYzYLZimZpjbX0D6xsHfwCOpLsVyU3ctwAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"给图片添加水印的C#类库 The C# Class Library for adding watermark to image\" title=\"image\" src=\"/static/4b9aba161dcc1becd652bdfe03d80ca1/fcda8/image_thumb_30.png\" srcset=\"/static/4b9aba161dcc1becd652bdfe03d80ca1/12f09/image_thumb_30.png 148w,\n/static/4b9aba161dcc1becd652bdfe03d80ca1/e4a3f/image_thumb_30.png 295w,\n/static/4b9aba161dcc1becd652bdfe03d80ca1/fcda8/image_thumb_30.png 590w,\n/static/4b9aba161dcc1becd652bdfe03d80ca1/5aae9/image_thumb_30.png 610w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\" loading=\"lazy\">\n    </span></a></p>\n<h1><span style=\"color: #800080;\">一、类库的使用：</span></h1>\n<p>将类库(<a href=\"/BlogEngine/BlogEngine/BlogEngine.NET/file.axd?file=2011%2f7%2fImageHandler.dll\">ImageHandler.dll (18.00 kb)</a>)复制到你的工程Bin文件夹后，在你的代码中添加zizhujy.ImageHandler命名空间，然后打开你要添加水印的图片，实例化一个zizhujy.ImageHandler中的Watermarker类，添加你想要的水印，完毕。就是如此简单！它可以被引用到Windows Console Application、Windows Form Application、Web Application、Web Service Application 等等工程中，以下以ASP.NET MVC 3 Application为例，就文字水印与图片水印分别列出三个代码实例。</p>\n<h2><span style=\"color: #800080;\">1. 添加文字水印：</span></h2>\n<p>代码：</p>\n<pre class=\"brush: csharp\">using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Web;\nusing System.Web.Mvc;\nusing System.Drawing;\nusing System.Drawing.Drawing2D;\nusing System.Drawing.Imaging;\nusing zizhujy.ImageHandler;</pre>\n<p>namespace zizhujy.Controllers\r\n{\r\npublic class TestController : Controller\r\n{\r\npublic void AddWatermark()\r\n{\r\nImage originImage = Image.FromFile(@\"C:\\source.jpg\");\r\nTextWatermarker txtWatermarker = new TextWatermarker(originImage, \"<em class=\"text_cor1\"><a href=\"http://www.zizhujy.com\">www.zizhujy.com</a></em>\");\r\ntxtWatermarker.AddWatermark();</p>\n<pre><code>        // Response and show the watermarked image in the browser\r\n        Response.ContentType = \"image/jpeg\";\r\n        txtWatermarker.WatermarkedImage.Save(Response.OutputStream, System.Drawing.Imaging.ImageFormat.Jpeg);\r\n\r\n        txtWatermarker.Dispose();\r\n        originImage.Dispose();\r\n    }\r\n}\n</code></pre>\n<p>}</pre></p>\n<p>效果：</p>\n<p><a href=\"https://raw.githubusercontent.com/Jeff-Tian/blogengine.net/master/Source/BlogEngine/BlogEngine.NET/App_Data/files/image_28.png\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAACT0lEQVR42iWMbSwUAACG73c/LK1NZiWTfJTdWI656FofplaZpuVH6Vjpa1NpRaJF050c8lG6wvJxczinIslJqKw00Xycj1Prrot25K5NIT3N9W7P3nfvj0fQ/NrA90kzExOfMJpMGI0mTMtttqBs0COrGCKrSo+8chh51TCZ5QP2bf9VI+TWjKOoHuFmxSCZpW8RDPV1MWP5htFkxGKZwmadZmZ6ip9WC0sLNpYWrPy1Y7OzMDfN0vwsf379gEUbMM/ibxuTZiPd73oRpFy+TlKakuQMFddkamR5WrLyHyHPf4IsvxF5QRPyomZu3W0h+95zFEodOQ/ayClpI7esnezSl2h1/Vits7zvG0GwxieBFc5SHNbH4+B2lpUeF1jlfQlHr2RW+6bh5J+OS5AM11AF6yU5uO8uYEN4MZ4HHrI5qgKPg2Uk5nWynJEJMwLP4BScvM/jIkxirV8qrgHpuAVlslGiwGtnLj7hhQgjlPhFlRIYoyL4eC1iqRJR5GlCY3MQxjRw5c6b/0LDVwRe227gLLzKuoAM3MRZeIYVsmlfMaKj5YSdq0Nyqga/wxX4R1cSGFuNKLYJ/4hE/AMcEUcnEXqihNT73Xah3mBCINybh7tEgceO2/juVyKOUxFyUs32hHq2xtcReEzNliPViKQaguJUSKRZhETGs2uPiENnEoi4WERm1Qe7cPyzGUFZfQ8a3SDqZwPUt+tpfDVGQ8coDZ1j1LTqqW3Vo3kxiqZ9DG2HgfqWTrSNj1Frm9E87UCj66Wr/wsz1jl6Phr4B2VGukR9ft/CAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"给图片添加水印的C#类库 The C# Class Library for adding watermark to image\" title=\"image\" src=\"/static/73e2f0f39328eae42e0a6fcb453bf3f0/fcda8/image_thumb_28.png\" srcset=\"/static/73e2f0f39328eae42e0a6fcb453bf3f0/12f09/image_thumb_28.png 148w,\n/static/73e2f0f39328eae42e0a6fcb453bf3f0/e4a3f/image_thumb_28.png 295w,\n/static/73e2f0f39328eae42e0a6fcb453bf3f0/fcda8/image_thumb_28.png 590w,\n/static/73e2f0f39328eae42e0a6fcb453bf3f0/e628c/image_thumb_28.png 619w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\" loading=\"lazy\">\n    </span></a></p>\n<h2><span style=\"color: #800080;\">2. 添加图片水印：</span></h2>\n<p>代码：</p>\n<pre class=\"brush: csharp\">using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Web;\nusing System.Web.Mvc;\nusing System.Drawing;\nusing System.Drawing.Drawing2D;\nusing System.Drawing.Imaging;\nusing zizhujy.ImageHandler;</pre>\n<p>namespace zizhujy.Controllers\r\n{\r\npublic class TestController : Controller\r\n{\r\npublic void AddWatermark()\r\n{\r\nImage originImage = Image.FromFile(@\"C:\\source.jpg\");\r\nImage watermark = Image.FromFile(@\"C:\\clock.png\");</p>\n<pre><code>        ImageWatermarker imgWatermarker = new ImageWatermarker(originImage, watermark);\r\n        imgWatermarker.AddWatermark();\r\n\r\n        // Response and show the watermarked image in the browser\r\n        Response.ContentType = \"image/jpeg\";\r\n        imgWatermarker.WatermarkedImage.Save(Response.OutputStream, System.Drawing.Imaging.ImageFormat.Jpeg);\r\n\r\n        imgWatermarker.Dispose();\r\n        watermark.Dispose();\r\n        originImage.Dispose();\r\n    }\r\n}\n</code></pre>\n<p>}</pre></p>\n<p>效果：</p>\n<p><a href=\"https://raw.githubusercontent.com/Jeff-Tian/blogengine.net/master/Source/BlogEngine/BlogEngine.NET/App_Data/files/image_29.png\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAACS0lEQVR42i2MW0gTAABF99tHhAQZiM2SzInhA+dMrUQo20eZVCAaWZlISWFFYallJmtTNyyzpmmmqcMHaVPXpImaL0ykwnQPE3wM3+ZcUGnaiaYXLvdyPo5A1zXK/Nw0Y2PjTE5amZqaZmZmmqmZ76jfmJBXGFFUbqy8woSsfGjzG8muMqOs/kauxoysfJiHRT0Ihj93MTdrZXxigvn5WZZtCywuzGC3zbO+amd9ZRn+2Pm7utHVn4sOtvZrycFhhbXfP5idttLd248gLeUBqRkvSJNpyFBUI8+rR/G4AcUTLfL8JhT5zSgK3pHzXE9uYQvKoveoig2oSgzklbahLG2n3vCFZdsSfQNDCJxF19iy8wJbhYlsdUti294bOHnexskzhe3e6ezwy8RF8gjhISXCwyrcj+bjfkyNx4lXeJ0qwz2qlJt5nfyPcWQSwb6QVJxF13HxuYOr/z2E4kx2B8nwCFMiOpKHl/QpPieL8D3zksC4SoITagmOUyM5fZWIpAKCEhu4+6zbIRy2TCAQhWXh4puOW2AWe0KzEUkL2B9ZSND5ciKS6wi7XENAzGsCYio4EF9N0CU94qhkJCEuRN4q4HhaAxnFPZvCcQReESpcQ3PYdVCFh1SN+FwF4osaQq7UIYmvwTdWg3d0FT5na/GP0yCOzkQUHoufxA1pQjLhySXcLxtwCM2jVgRVjf00tQ/xtvUrui4Thr4R9D1m9D0WtG1GtO0mmj6Yae60oOu2oGvtoEmvo16rQ9vSQWPHIL2DEyzZ7Hz8ZOIfVoS6V8lmwNsAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"给图片添加水印的C#类库 The C# Class Library for adding watermark to image\" title=\"image\" src=\"/static/2b4a41fd7e6c8d920211090dd4a5e947/fcda8/image_thumb_29.png\" srcset=\"/static/2b4a41fd7e6c8d920211090dd4a5e947/12f09/image_thumb_29.png 148w,\n/static/2b4a41fd7e6c8d920211090dd4a5e947/e4a3f/image_thumb_29.png 295w,\n/static/2b4a41fd7e6c8d920211090dd4a5e947/fcda8/image_thumb_29.png 590w,\n/static/2b4a41fd7e6c8d920211090dd4a5e947/9128f/image_thumb_29.png 603w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\" loading=\"lazy\">\n    </span></a></p>\n<p>&nbsp;</p>\n<h2><span style=\"color: #800080;\">3. 同时添加图片水印和文字水印：</span></h2>\n<p>代码：</p>\n<pre class=\"brush: csharp\">using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Web;\nusing System.Web.Mvc;\nusing System.Drawing;\nusing System.Drawing.Drawing2D;\nusing System.Drawing.Imaging;\nusing zizhujy.ImageHandler;</pre>\n<p>namespace zizhujy.Controllers\r\n{\r\npublic class TestController : Controller\r\n{\r\npublic void AddWatermark()\r\n{\r\n// First, add the image watermark\r\nImage originImage = Image.FromFile(@\"C:\\source.jpg\");\r\nImage watermark = Image.FromFile(@\"C:\\clock.png\");</p>\n<pre><code>        ImageWatermarker imgWatermarker = new ImageWatermarker(originImage, watermark);\r\n        // You can set the watermark size, if you not then the watermark will be its original size by default\r\n        imgWatermarker.SetWatermarkHeight(80);\r\n        imgWatermarker.AddWatermark();\r\n\r\n        // Second, add the text watermark\r\n        TextWatermarker txtWatermarker = new TextWatermarker(imgWatermarker.WatermarkedImage, \"&#x3C;em class=\"text_cor1\">www.zizhujy.com&#x3C;/em>\");\r\n        // You can set the position of the watermark\r\n        txtWatermarker.Position = WatermarkPostion.TopLeft;\r\n        txtWatermarker.AddWatermark();\r\n\r\n        // Response and show the watermarked image in the browser\r\n        Response.ContentType = \"image/jpeg\";\r\n        // Note: save the secondly watermarked image \r\n        //  (txtWatermarker not imgWatermarker because the txtWatermarker comes after than imgWatermarker)\r\n        txtWatermarker.WatermarkedImage.Save(Response.OutputStream, System.Drawing.Imaging.ImageFormat.Jpeg);\r\n\r\n        imgWatermarker.Dispose();\r\n        watermark.Dispose();\r\n        originImage.Dispose();\r\n    }\r\n}\n</code></pre>\n<p>}</pre></p>\n<p>效果：</p>\n<p><a href=\"https://raw.githubusercontent.com/Jeff-Tian/blogengine.net/master/Source/BlogEngine/BlogEngine.NET/App_Data/files/image_30.png\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAACR0lEQVR42j3M6UsTAACG8f0JQUKH6FBBTc2rdOoKDRK1SP1gHzrAWLCiQ8QwM1yRmWw2p8xJU7zwvjY3nUjmUppEBwPp2JzNErcl2vAKK6V6Io1e+H15PzyCkUknS4uf+fhpDpfLhdvtwePx4PJ8QaufRt5uR9FhR9G+o7z13fYnb7dR0TGNqteJsmsaeZsNRfMLBLapSZa9C7jdbrzeRVZXvKwsL7G2usTvrfV/1v7b3PDya3OVnz9WYGsd2GTr+xqLC25evrIikBWXIitt4K68m/vKXpQaAxVqIwr1EHK1CXnNMArNCBWPHqOsG6WyfgxVgxlVo5mq5nEeNo6jG53i28ZXrFN2BMLoAvaHXEIYeQ3/qHz8ogvZHXaTXaG38ImQsSemFF+RHP+jSoTJKgJTawjK0BKc2UJ4TiuB2U3kKSf4u5lZF4LgxNv4hOSzN6II3+gS/A7dIyChnOCUSkKOVxGWoSEyu56Y002IcjsRS/tIzNUiyrlO2hUNIqmBQrVlO+iYnUdwIKUM32gZwvgyAsUVhKbXEp6pRZTbSlp+P8mXe4k900bs2XYSJD3EXzQRm1VAXOI+sgprOVmso6RucifonEdw8EQ1AclKgo5VE36qniRJJ0nSblLy9Iil/cTl9hBzrpvDF3SIJF2Izz8gKl2C6EggWVeLSL3RwZ0W63bQOedB0GZ8jfHpe3SjbxmcsDPyfAaTxYHJMoN+zIbebMcw4cA44WDQ8gHjk2cMmIboMwyjHzYzYLZimZpjbX0D6xsHfwCOpLsVyU3ctwAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"给图片添加水印的C#类库 The C# Class Library for adding watermark to image\" title=\"image\" src=\"/static/4b9aba161dcc1becd652bdfe03d80ca1/fcda8/image_thumb_30.png\" srcset=\"/static/4b9aba161dcc1becd652bdfe03d80ca1/12f09/image_thumb_30.png 148w,\n/static/4b9aba161dcc1becd652bdfe03d80ca1/e4a3f/image_thumb_30.png 295w,\n/static/4b9aba161dcc1becd652bdfe03d80ca1/fcda8/image_thumb_30.png 590w,\n/static/4b9aba161dcc1becd652bdfe03d80ca1/5aae9/image_thumb_30.png 610w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\" loading=\"lazy\">\n    </span></a></p>\n<h1><span style=\"color: #800080;\">二、类库的结构(设计模式)</span></h1>\n<p>此类库采用了模板设计模式。因为对于给图片加水印，至少分为文本水印、图片水印两种。而不同的水印，将其添加到图片上的算法是一样的。即</p>\n<ol>\n<li>获取源图片</li>\n<li>获取水印</li>\n<li>计算水印的位置Point (x,y)</li>\n<li>计算水印的大小Size (width, height)</li>\n<li>在源图片的Point位置处，以Size尺寸，将水印绘制出来，并返回新的图片</li>\n</ol>\n<p>因此很自然想到使用模板设计模式，将以上算法封装在模板类Watermarker类中。对于图片水印与文本水印如何添加到源图片上，其方法是不一样的（详见<a title=\"使用.NET的GDI+技术给图片加水印\" href=\"http://www.zizhujy.com/BlogEngine/BlogEngine/BlogEngine.NET/post/2011/07/07/add-watermark-to-image-using-csharp-and-gdiplus.aspx\" target=\"_blank\">上篇文章</a>说明），故上述第5步，绘制水印的方法应该是抽象的，由具体的类来给予实现，即分别在ImageWatermarker和TextWatermarker中实现。</p>\n<p>类图结构如下：</p>\n<p><a href=\"https://raw.githubusercontent.com/Jeff-Tian/blogengine.net/master/Source/BlogEngine/BlogEngine.NET/App_Data/files/image_31.png\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 89.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACRElEQVR42pVUaY/aMBDl//+jtl+6vWmXNosiWDYEwpmbOLaT2E7gVTYEZTm26khP8THzNJ43k17TNNjv92foPSEESZIgyzKzb1Ff+HZjtOV5jp4+0HY4HMx39LLCh4cBBkMH6yBHSirkTKASNQjlqGuFS2tjbxLOVzGs0RLOPMA6IAgTiiwvwIsKnBdQSp39u7hNeLpoTQdLIcxd+7xLsjczPFwQdutzy+5m2L1oM9Hruq6hpHx13sXNGnaz0mspJZRqoQypxlnp01oIYQS6UnntJ/j8w4Zlu7BsB4t1BFaos6ryJMLU8/HtcYzh2INlTxHEDLv82AFlpVAKha0foOcuIrz7+IS+NcVkFmITMSRZCVZIMFagLEtDOBwv8f5hiL7l4nkWYxUwBGmBlJSgXECqBtvtFr2qkqYtSM7BeGnao6qEebpU8lwrnbHxowUoL8++RVmhLCtTnjRN0btsFW1SKgghj8TmW53E0eSHu6pTSl+rrK1WDb5/stH/MoL1+ILJaInJeI65u8JuR0EIvWrqNyelafZYeRE2yxSRT5CEBGmSI9tR0JyCUXrVt/8ktAbP+PNrDPvJgfPsIUs5Si5RcAGSs/8jrOsGzmiLpbtDuGFIQg6aCRRMoioFOOOmjsdJvUPYrUVTN5i7aziTBVxngeVig5nrYbvxQbIcGcmvxq5NyhBezyfw8+sYv/tTTOw1PDeEN/MR+ilEVYNSdldlzjl6mlXL3ULvwzBBFKaIoyPSZGcQx7H58Xb92xhNFgQB/gLKxXCo66Q0hQAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"给图片添加水印的C#类图 The C# Class Diagram for adding watermark to image\" title=\"image\" src=\"/static/3623fcf14c29868a88b818d14f4fd820/fcda8/image_thumb_31.png\" srcset=\"/static/3623fcf14c29868a88b818d14f4fd820/12f09/image_thumb_31.png 148w,\n/static/3623fcf14c29868a88b818d14f4fd820/e4a3f/image_thumb_31.png 295w,\n/static/3623fcf14c29868a88b818d14f4fd820/fcda8/image_thumb_31.png 590w,\n/static/3623fcf14c29868a88b818d14f4fd820/dba9a/image_thumb_31.png 652w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\" loading=\"lazy\">\n    </span></a></p>\n<p>很简单明了，后面三个Enum是用来表示水印在源图片上出现的位置的struct结构体。</p>\n<p>以下分别看每个类的结构：</p>\n<div style=\"width: 100%; height: auto; overflow: auto;\">&nbsp;<a href=\"https://raw.githubusercontent.com/Jeff-Tian/blogengine.net/master/Source/BlogEngine/BlogEngine.NET/App_Data/files/image_32.png\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 124px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 387.09677419354836%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"给图片添加水印的C#类图 The C# Class Diagram for adding watermark to image\" title=\"image\" src=\"/static/90f79daeace5ce6db14df8fd59140bf8/d6e54/image_32.png\" srcset=\"/static/90f79daeace5ce6db14df8fd59140bf8/d6e54/image_32.png 124w\" sizes=\"(max-width: 124px) 100vw, 124px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\" loading=\"lazy\">\n    </span></a> <a href=\"https://raw.githubusercontent.com/Jeff-Tian/blogengine.net/master/Source/BlogEngine/BlogEngine.NET/App_Data/files/image_33.png\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 248px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 193.24324324324326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAnCAYAAAAPZ2gOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFtElEQVR42o1WaW/bRhD1//8JDVC0H3ohadE0TZsmTYLacerasmSTkihRokjxkkhRvC+RlF8xQ0txHNsJgcEeJN++mXk7uwfb7RZBGCFJC+TFBlGSIs2oX6Lc1DxXFCWyPEcUxYjja0tiJLesaRocBFGKP9908d3jF3j89DW+/f5XfPX1D3j6x1v89OQ5fnzyDL/89gKdCwnrsMTKz+BHOcKkQJKWKMsKKz+BODbg+2sceH6MV4cinv31L35/eYKeZKEjqBAkA+eCgq6gQJQ0zHQXflwhiDeI0gppXiMvG2yqLcqqQZQWWC6XBBjh6GyK56/+w7uzMSR1DXnuY6yuoC9SuEGNVVjDiyp4YdECJhskWYW8qFFuGtTNFZrtFktniQPXC3EqWPj7SMA/J0O8ORbw+qiHl29P0OursFcF7FUGxy/gheWeYZLVDLipWsC6aeC0gAEkNYQ8DzFS11DtBPoyhenmsNwMtpti6eVw/bxlGJUIkxJxukGaV3vQclO1LvtBCFm1cHrWw5PHP6Pb6yPNt/xjnNYI4w33/bC41+i952cwLRsHURQhiDK4QQ5BtmBZDlbrGEs3gG4ssfYTREnJSUiz6m7La2Zs2wsckKboGWtLSGYCz12iPxhgOBzi6OgQgnCJ7bbhb66utrjvoXccwx3gZO5goIdYr1wosxmm0ynOz89hGAYURUFVVTd+vvrI6KEN8jGg7mJkxsxQGo0YkFguFgvIsgzLshAEAcqy/AT0TkByua9HWFgmut0eJEliZo7jYDweYzAYYDabgWK+A7zZfgI41V30NR+mMUe/P2hZ2Ta3n8brC1xWTA9DM4ExV9G76DEjMlEQIIoChsMBu/9QUlzHaWVTlBUGoxnkmcWp1w0LhmlD03RuaTwYjmBaC9T1FaqqQVVtr61BVW+5Mu2FrcyXePX6CI8efYOBNEV9BeQlsGnaNsm3yAogThv4YfmpsbBzXpAZlhWgKGOI/fdYOGtY9hKGuYA0mmCxXCHNqEw1KMq2GNxleVFhseAYtllTpkPI8imWjgtJGkJiYR9BEIR7pHJ1dwx3gLI8wHjcAirKFJPJBN1ul2M6Go2w2WzuzfatLLeAM2UMWT6Hu/JY1KS9s7MzmKbJ+ru4uMB8PueFVFWF53n36bAFnE4lTCYd6LrBPxEIgdLWE0UR/X5/P0eL3Bb4HYAUww5M02KGtFOIEW0/AiRNaprG7Hzf34PcDziRoKqXMEyLY0eABOa6LrOjOWIXhuEe4EGGkiRgKJ1gNtPQ7Z5zzMhFcp8YJUnCtqs6D2y9a9koI06KqmrsIoFR/GgvE9DNn3ctSeeBGFKwqWzNMBj09xWG3O50Ojg8POTYfrY40K1Bt1eQFR3v3p9hMtWQFVtEcYkwLrn8x2nVtsmG+1TuyRKeb+foWz4CwjCCYa8wnzs4PxUwnen80g9zJGnNBxUdmTT2g7w9k9Oa2yAqePE0a7hv0V5Orl2O7AkSLcJkOsXh4REXWUVpdUdnDG1BeTJht8koHL3eBTqdc/5m7zIBUhSihQxv6mCu6+iLIldrSkjvWi7UV653EIGRrJI4ZhllWfbhkPoAOMVaXWHhLCFcCvtdQmLWdZ0FTRIisVPdIzV8yDZuMowp+ciDHL7qQ52rGEkjLggE8rmHM30XYOYnSKwEmq5BFERmeHl5yYwInMbkpm3bDwt7B5h6MUI1hGZoOD4+5kpDwSc3SYsnJye8AI3pJLx36+1dpiuHEcG0TYxHYwYhdgRKCaEsE0NKCCXsCwBTRHoEwzLa004UGXCXbZqjmN48+e51mZ58nSDUQgbsi31mtCuoBEgh2C20q4W3k+O6TgtY1RXyJEO6TuG4DgOR0fVD1+fMjI6FXfWmKwkxqusKdV3zZX1TlpywAxoEgQ9v7WEdeAh8H1EYsoVBgDAMWLxRFHKfWrqcr1YreN4HI3fpu/8BDm9rLKpCJPYAAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"给图片添加水印的C#类图 The C# Class Diagram for adding watermark to image\" title=\"image\" src=\"/static/2cfe88cdc358df191084c5b3aac1396b/544ba/image_33.png\" srcset=\"/static/2cfe88cdc358df191084c5b3aac1396b/12f09/image_33.png 148w,\n/static/2cfe88cdc358df191084c5b3aac1396b/544ba/image_33.png 248w\" sizes=\"(max-width: 248px) 100vw, 248px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\" loading=\"lazy\">\n    </span></a><a href=\"https://raw.githubusercontent.com/Jeff-Tian/blogengine.net/master/Source/BlogEngine/BlogEngine.NET/App_Data/files/image_38.png\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 241px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 157.43243243243242%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEfklEQVR42p2VWW/bVhCF9f//RV+KPARB0aJJgCQPadKmtmzHtlYuWqiF4mruO6mvuFey48Q2HJTAwSUI8nDmzJmZXhBlvP7Q5/e3n/nl19948eoNr/54z4uXf/LytzdcTxbsvAzTjbH9FC/I8MOMMM6Jk4IsLyWm8x2e79Oz3ZB3nwa8+3jJ17HJeOYxnjkMVZOxZmKYEdZNiROU+FFFkNREaU2aN+RlS1V3NO2eompxXZee68d8+Dzi9ftT/jqZ8Hd/yufTMZpxg+XXmG7Ozstxbgq8sCSIK0mYZDV50VBWLXXTsd+D53n0HC/icuow0FwGqs3X8ZrLyRrN8FlbKRs7lSnbNzleWHATlYRJJQmzvKasGuqmpW27Q4Q3QcRI2/LvyQUfP50QJi1R2hLENX5Q4AWFPH1BdkQQlXcI42/YWQ69OEkJgoShbjJR5rheiOtFOF5IlBQyrSz/Hul9ZPURDbbt0MvznK6puNA9TNtH0xQmkwnj8Zgsyzhce37mkhoKwqYuuZq5GJsdi8UcXdeZTqdUVcV+v6frOnkK4Q/nQzwg/Ko5rE0bTVXZbDaPRnD74bOEdVVyrlistja6rjGfz5nNZiiKimmaMuIwDJ8ke0C4b2uuFgGWG6BMx2iaxvX1NZeXlwwGA7bbLft996yGviBM0hTLveFLf8BkqmM7vsRma2PZPjvbI80rqnpPUTYUZXs8f0SL47j0wihmZli8ffuaf76ckuZ74rQhK/akeUeStURJffRc9SSCqDr4MM8zmqZDVc5ZbRbMZnMJoVuSpDKVrts/qd19HDXMqKqawfUXFHWEqqiMRiOpX1EUx0J0d8L/hA8FYcN4dIKxmqHrM2kb4cH/aZuMqm6YTvosDR1N0zEMA9/3pWWCIMCyrLuu+THSxwmrhsm4z2a7ZLk0WC6XXF1dyW5ZLBas1uvvCJ+NUIyf05N3UkPDWEmi4XAo+1lRpg9S/gkNaxYLldVqiapqKKoqCRXlMChE+odqd/fwRJXDMEZbmFxcT+mfXVLWUFaQl1BUBwhPJlkjfZnlnTzTvH3ch0mSEacZprZGVwz0+ZL5Ys1u52KaDsbKZL2x2Fkem63FYrlhaWzYmvaxa75BdkqeF7RdRjifY65sLr6ey3QFRsMh5+fnaJoqx9p6vZYOmM9nGMby8V4W1Wv3LdEqwt7YqJrKdDKV5hbFmc0PXSOqXZbVk2PtbkmJCJsm5Wam4Zg+w9FARicmjpg0gkyQq8dCrVYrmqaRJG3bSjwYX1VTYio7dqsdU2UqR5eYiYJU+LHf78tWFDNS/OTs7EzeCwKx6RzHoa5rfN+jV+Q5RVWwHm/RJzqT6UTqJMiEbUSn3LfMbUTi/sduOUSYZdRtja277NY7FFWREQpTCwgdBXmapg/M/XinZDkdNfHSYrMwGU/GzPSZTNW2beI4llEK3Z6d2P5RwywLCS0D1/HlThH2EOKLLrpNs64ryrKkqkqq8htun5VFIQPoiZeTJEGsgjRNOPwgk4jjSC6nSCASiB7B4XkYBPKb/wCNuywjXx12PAAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"image\" title=\"image\" src=\"/static/7718d5b610b3d0a16ddcfae0b80904e0/2f862/image_thumb_38.png\" srcset=\"/static/7718d5b610b3d0a16ddcfae0b80904e0/12f09/image_thumb_38.png 148w,\n/static/7718d5b610b3d0a16ddcfae0b80904e0/2f862/image_thumb_38.png 241w\" sizes=\"(max-width: 241px) 100vw, 241px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\" loading=\"lazy\">\n    </span></a></div>\n<div style=\"width: 100%; height: auto; overflow: auto;\">&nbsp;<a href=\"https://raw.githubusercontent.com/Jeff-Tian/blogengine.net/master/Source/BlogEngine/BlogEngine.NET/App_Data/files/image_35.png\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 240px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 51.35135135135135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvElEQVR42p2QW2sTURRG8/9fffBFClWklkYaaxQVWwmiDyKIoUnMJE2a21zPOXPmdmYmk8ySJEXxxdsHC/bD3ouP3chNzvzWxrUFMojQKt3jOQHCV0RhQhyle5QM8b2ANEmJogiTGZI4RusIISXGZDTSOKd58oaTR23arQ6Pj1scPzjl/r0jHh494dWLdzRPL3h69pxn5y9pnrW4fNvh6rJD6/yCLDUobbi2Vvi+RyPWGe+vurxuf+T6y4KpJZlaguU0ZDXT2HONs9R4doTwd+0NocyItWF3uy42VOstxpS4rksjVDHdz3M+fbC4GUjs24zVNMGZp3jLjMA2SC8nFAValcS6JI0r8qyizLd74baqqdbVQaiEZtyXuMuE6chlNVeowKCCjFAaIpUThzlJVJDGBVlSYrKS3Kwp8jVlWVFVG4qiwHUdGkpGjHo+k8mEwbc+SRJzSM2fU1PXh72qqvC8u4aTgWSxWDKbzZjcTBBCHNbr+jdwx0G4+SGUEeN+QL/Xp9v9imVZGGP+QviTXxrKQDPqCTzPZzgc4jgO/5Ptdnv4YZKkjIdzgiBAKYkQAY5j/xM70Wq13M/fAUSL7yNghh5TAAAAAElFTkSuQmCC'); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"给图片添加水印的C#类图 The C# Class Diagram for adding watermark to image\" title=\"image\" src=\"/static/f1fa8c25bdc13d1c7dead0cf26bf0da3/8ff5a/image_thumb_35.png\" srcset=\"/static/f1fa8c25bdc13d1c7dead0cf26bf0da3/12f09/image_thumb_35.png 148w,\n/static/f1fa8c25bdc13d1c7dead0cf26bf0da3/8ff5a/image_thumb_35.png 240w\" sizes=\"(max-width: 240px) 100vw, 240px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\" loading=\"lazy\">\n    </span></a> <a href=\"https://raw.githubusercontent.com/Jeff-Tian/blogengine.net/master/Source/BlogEngine/BlogEngine.NET/App_Data/files/image_36.png\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 240px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 51.35135135135135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvklEQVR42pWQW2vbQBCF/f//QqGFBJKGXjCNm9BLAqGQlzwkNXbsNMa32JKs1a53V6u7ra9YLn0qbTNwmPMwfHNmWlmaMZ96BF6EFAatHGbtCHxBFCq0shgdo6I14UoQW4cxlsQlWGOx1qKNIZKSNE1oOZvx9vgzx4cdOu0rjg7avHrxmoOXJxwdvuPs9ILzzgVvTtq033c4//iFy69XnH44IzYZm7ImUo7+45IwXNGyOuHbZZdPnWt6t09MHxWTH4Ll1ODNDP6TIVgawmCXMkUKh1ZJc0meVpTFlqrckmYFQRDQ2p3UvZlzc/3I6D5iMXF4kxh/7lgtEoSXIlcZa5GjZY7VJc6WZMmmARb5hm1VU5XVHqgizXigWEzXLGYSEThkmLAWKVqmGJVhdUZscpzNSeKCNCnI0pI8KymKiqrakOc5QeDTkpFm8qAYj8cMhwOeVzV1XTeuqipWqyahYXQvGAyG9Pt9er0eSqn9eF3/RfzSHrj5DZSGUV9wd/e9SdjtdvF9vxnabrf/gP4hoRSaUV/ieT5CCObzOWEY8tzaLW9+GMeO0cOMKBKNlJRN9z2PwPfw/0M70HK5aPxP903v2UOvaS8AAAAASUVORK5CYII='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"给图片添加水印的C#类图 The C# Class Diagram for adding watermark to image\" title=\"image\" src=\"/static/a41346db3a0f3af706294b44ffa8d3cf/8ff5a/image_thumb_36.png\" srcset=\"/static/a41346db3a0f3af706294b44ffa8d3cf/12f09/image_thumb_36.png 148w,\n/static/a41346db3a0f3af706294b44ffa8d3cf/8ff5a/image_thumb_36.png 240w\" sizes=\"(max-width: 240px) 100vw, 240px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\" loading=\"lazy\">\n    </span></a> <a href=\"https://raw.githubusercontent.com/Jeff-Tian/blogengine.net/master/Source/BlogEngine/BlogEngine.NET/App_Data/files/image_37.png\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 240px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 92.56756756756756%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAAClUlEQVR42p2U2W7bRhiF9f5v0JsiaJGLBmgukqIpkBhp0aZIYDk2tZKmJMqUxEVcxWU4FGl9xYybphsSOz9wOCQw/Hj+hTM45AV12VCVNaJqkM2RRrQ0QiLqBlELpGwpi5LiUFAUBaVSqVRSlaVe1XPfdwzevDb4+qsnnP30jmdPX/Hd42c8/uZ7vn30hB+fn/H61Rte/HDGzk3I04Y8FRR5Q1VI6krStR2rTYzteGRJzGD4u8Xzpz/z9tcpowuHd79NMYYLpsYaa+KyuvaYTxzisKLIj5SHlro80tQdbdPTH28RoiPNCsIgYGAMHX55ecn7t0uCjWS/bYm9lsRvScOWLGops548keSppMhb6uIj8Nj2cALZNAQKuDITvLUg2Ah8t2R3c8B3D4S7ksivSMKaNKrJk4ZDLikPkrpsEfURKY60sqPvTlRVdQdczmNuHI/h8JzxeMzFxYUusoq+77m9vf2sVAhRfwT6uxh7cc1iscDduMRxjGgE94uTvjZNc1fD5Txh64ZcXr1nOp1ql6Zpaqjefjp9VndAcQdczGKiMGcyGTOZTDRwtVr9A/bh/n/9/RvomCnmbMmVcakdGobBcrlkNpv956X7Aa2U2cRmNDY0UMm2bRzH0Z1Tjfkih+PxSLtSUkDLsrTTuq4fDrTmK+bzGfa1rWuoQGrd7/cPT3n1J9AYXWlnCqTSPj8/R0r5JcCEhe1imnO22y2j0eivGqr6PbjLCqgcfgCqGqo5VFA16H+v4b3m0LEyrq01lmXi+74eG9UQlXYURdw3pGwIw4CBOQrY3IRsNi5hGGpn6/VaNynLMv2vdl33Sak96oD1PY/B1g0IgpAsS0niWEPSNCHPMuIo0mmoL39K+32I5+004w9LxZyVY8og8QAAAABJRU5ErkJggg=='); background-size: cover; display: block; transition: opacity 0.5s 0.5s; pointer-events: none;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"给图片添加水印的C#类图 The C# Class Diagram for adding watermark to image\" title=\"image\" src=\"/static/3b827fa129638c2cb7f2c62da851b081/8ff5a/image_thumb_37.png\" srcset=\"/static/3b827fa129638c2cb7f2c62da851b081/12f09/image_thumb_37.png 148w,\n/static/3b827fa129638c2cb7f2c62da851b081/8ff5a/image_thumb_37.png 240w\" sizes=\"(max-width: 240px) 100vw, 240px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;opacity:0;transition:opacity 0.5s;color:inherit;box-shadow:inset 0px 0px 0px 400px white;top:0;left:0;\" loading=\"lazy\">\n    </span></a></div>\n<h1><span style=\"color: #800080;\">三、类库的源码</span></h1>\n<p>先看模板类Watermarker.cs的源码（三个Enum结构体的代码也在这个文件中）：</p>\n<pre class=\"brush:csharp\">using System;\nusing System.Drawing;</pre>\n<p>namespace zizhujy.ImageHandler\r\n{\r\n///\r\n/// Watermarker Template class\r\n///\r\npublic abstract class Watermarker : IDisposable\r\n{\r\n#region Properties</p>\n<pre><code>    private Image originImage;\r\n    public Image OriginImage\r\n    {\r\n        get\r\n        {\r\n            return originImage;\r\n        }\r\n        set\r\n        {\r\n            originImage = value;\r\n        }\r\n    }\r\n\r\n    private Image watermarkedImage;\r\n    public Image WatermarkedImage\r\n    {\r\n        get\r\n        {\r\n            return watermarkedImage;\r\n        }\r\n        set\r\n        {\r\n            watermarkedImage = value;\r\n        }\r\n    }\r\n\r\n    private SizeF watermarkSize;\r\n    protected SizeF WatermarkSize\r\n    {\r\n        get\r\n        {\r\n            return watermarkSize;\r\n        }\r\n        set\r\n        {\r\n            watermarkSize = value;\r\n        }\r\n    }\r\n\r\n    private float x;\r\n    protected float X\r\n    {\r\n        get\r\n        {\r\n            return x;\r\n        }\r\n        set\r\n        {\r\n            x = value;\r\n        }\r\n    }\r\n\r\n    private float y;\r\n    protected float Y\r\n    {\r\n        get\r\n        {\r\n            return y;\r\n        }\r\n        set\r\n        {\r\n            y = value;\r\n        }\r\n    }\r\n\r\n    private bool computeX = true;\r\n    public bool ComputeX\r\n    {\r\n        get { return computeX; }\r\n    }\r\n\r\n    private bool computeY = true;\r\n    public bool ComputeY\r\n    {\r\n        get { return computeY; }\r\n    }\r\n\r\n    private WatermarkHorizontalPostion hPos;\r\n    public WatermarkHorizontalPostion HorizontalPosition\r\n    {\r\n        get\r\n        {\r\n            return hPos;\r\n        }\r\n        set\r\n        {\r\n            computeX = true;\r\n            hPos = value;\r\n        }\r\n    }\r\n\r\n    private WatermarkVerticalPostion vPos;\r\n    public WatermarkVerticalPostion VerticalPosition\r\n    {\r\n        get\r\n        {\r\n            return vPos;\r\n        }\r\n        set\r\n        {\r\n            computeY = true;\r\n            vPos = value;\r\n        }\r\n    }\r\n\r\n    public WatermarkPostion Position\r\n    {\r\n        get\r\n        {\r\n            return GetPosition(this.HorizontalPosition , this.VerticalPosition) ;\r\n        }\r\n        set\r\n        {\r\n            this.HorizontalPosition = GetHorizentalPosition(value);\r\n            this.VerticalPosition = GetVerticalPosition(value);\r\n        }\r\n    }\r\n\r\n    private int hMarginPixel;\r\n    public int HorizontalMarginPixel\r\n    {\r\n        get\r\n        {\r\n            return hMarginPixel;\r\n        }\r\n        set\r\n        {\r\n            hMarginPixel = value;\r\n        }\r\n    }\r\n\r\n    private int vMarginPixel;\r\n    public int VerticalMarginPixel\r\n    {\r\n        get\r\n        {\r\n            return vMarginPixel;\r\n        }\r\n        set\r\n        {\r\n            vMarginPixel = value;\r\n        }\r\n    }\r\n\r\n    public double HorizontalMarginPercent\r\n    {\r\n        get\r\n        {\r\n            return this.HorizontalMarginPixel / this.OriginImage.Width;\r\n        }\r\n        set\r\n        {\r\n            double percent = value &#x26;gt; 1 ? 1 : (value &#x26;lt; 0 ? 0 : value);\r\n            this.HorizontalMarginPixel = (int)(this.OriginImage.Width * percent);\r\n        }\r\n    }\r\n\r\n    public double VerticalMarginPercent\r\n    {\r\n        get\r\n        {\r\n            return this.VerticalMarginPixel / this.OriginImage.Height;\r\n        }\r\n        set\r\n        {\r\n            double percent = value &#x26;gt; 1 ? 1 : (value &#x26;lt; 0 ? 0 : value);\r\n            this.VerticalMarginPixel = (int)(this.originImage.Height * percent);\r\n        }\r\n    }\r\n\r\n    private Color shadowColor;\r\n    public Color ShadowColor\r\n    {\r\n        get\r\n        {\r\n            return shadowColor;\r\n        }\r\n        set\r\n        {\r\n            shadowColor = value;\r\n        }\r\n    }\r\n\r\n    private Color foreColor;\r\n    public Color ForeColor\r\n    {\r\n        get\r\n        {\r\n            return foreColor;\r\n        }\r\n        set\r\n        {\r\n            foreColor = value;\r\n        }\r\n    }\r\n\r\n    public double ShadowOpacity\r\n    {\r\n        get\r\n        {\r\n            return shadowColor.A / 255;\r\n        }\r\n        set\r\n        {\r\n            double percent = value &#x26;gt; 1 ? 1 : (value &#x26;lt; 0 ? 0 : value);\r\n            int alpha = (int)(255 * percent);\r\n\r\n            shadowColor = Color.FromArgb(alpha, shadowColor);\r\n        }\r\n    }\r\n\r\n    public virtual double ForegroundOpacity\r\n    {\r\n        get\r\n        {\r\n            return foreColor.A / 255;\r\n        }\r\n        set\r\n        {\r\n            double percent = value &#x26;gt; 1 ? 1 : (value &#x26;lt; 0 ? 0 : value);\r\n            int alpha = (int)(255 * percent);\r\n\r\n            foreColor = Color.FromArgb(alpha, foreColor);\r\n        }\r\n    }\r\n\r\n    private int shadowOffsetX;\r\n    public int ShadowOffsetX\r\n    {\r\n        get\r\n        {\r\n            return shadowOffsetX;\r\n        }\r\n        set\r\n        {\r\n            shadowOffsetX = value;\r\n        }\r\n    }\r\n\r\n    private int shadowOffsetY;\r\n    public int ShadowOffsetY\r\n    {\r\n        get\r\n        {\r\n            return shadowOffsetY;\r\n        }\r\n        set\r\n        {\r\n            shadowOffsetY = value;\r\n        }\r\n    }\r\n\r\n    #endregion\r\n\r\n    #region Contructor\r\n\r\n    public Watermarker(Image originImage)\r\n    {\r\n        this.OriginImage = originImage;\r\n        // 默认值\r\n        this.ShadowColor = Color.FromArgb(153, 0, 0, 0);\r\n        this.ForeColor = Color.FromArgb(153, 255, 255, 255);\r\n        this.ShadowOffsetX = 1;\r\n        this.ShadowOffsetY = 1;\r\n        this.Position = WatermarkPostion.BottomRight;\r\n        this.HorizontalMarginPixel = 10;\r\n        this.VerticalMarginPixel = 10;\r\n    }\r\n\r\n    #endregion\r\n\r\n    #region Methods\r\n\r\n    public void SetX(float x)\r\n    {\r\n        this.X = x;\r\n        computeX = false;\r\n    }\r\n\r\n    public void SetY(float y)\r\n    {\r\n        this.Y = y;\r\n        computeY = false;\r\n    }\r\n\r\n    public void SetXY(float x, float y)\r\n    {\r\n        SetX(x);\r\n        SetY(y);\r\n    }\r\n\r\n    /// \r\n    /// Add water mark to original image\r\n    /// \r\n    public Image AddWatermark()\r\n    {\r\n        ComputeWatermarkSize();\r\n        UpdateXY();\r\n        watermarkedImage = AddWatermarkToOriginImage();\r\n\r\n        return watermarkedImage;\r\n    }\r\n\r\n    /// \r\n    /// hook\r\n    /// \r\n    /// \r\n    protected virtual SizeF ComputeWatermarkSize()\r\n    {\r\n        this.WatermarkSize = new SizeF(100f, 50f);\r\n        return this.WatermarkSize;\r\n    }\r\n\r\n    /// \r\n    /// hook\r\n    /// \r\n    protected virtual Image AddWatermarkToOriginImage()\r\n    {\r\n        return originImage;\r\n    }\r\n    \r\n    /// \r\n    /// hook\r\n    /// \r\n    protected virtual void UpdateXY()\r\n    {\r\n        if (this.ComputeX)\r\n        {\r\n            switch (this.HorizontalPosition)\r\n            {\r\n                case WatermarkHorizontalPostion.Left:\r\n                    this.X = this.HorizontalMarginPixel;\r\n                    break;\r\n\r\n                case WatermarkHorizontalPostion.Center:\r\n                    this.X = this.OriginImage.Width / 2 - this.WatermarkSize.Width / 2;\r\n                    break;\r\n\r\n                case WatermarkHorizontalPostion.Right:\r\n                    this.X = (this.OriginImage.Width - this.HorizontalMarginPixel - this.WatermarkSize.Width);\r\n                    break;\r\n\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n\r\n        if (this.ComputeY)\r\n        {\r\n            switch (this.VerticalPosition)\r\n            {\r\n                case WatermarkVerticalPostion.Top:\r\n                    this.Y = this.VerticalMarginPixel;\r\n                    break;\r\n\r\n                case WatermarkVerticalPostion.Middle:\r\n                    this.Y = this.OriginImage.Height / 2 - this.WatermarkSize.Height / 2;\r\n                    break;\r\n\r\n                case WatermarkVerticalPostion.Bottom:\r\n                    this.Y = (this.OriginImage.Height - this.VerticalMarginPixel - this.WatermarkSize.Height);\r\n                    break;\r\n\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    private static WatermarkHorizontalPostion GetHorizentalPosition(WatermarkPostion pos)\r\n    {\r\n        // Mask: 000 111\r\n        return (WatermarkHorizontalPostion)((char)pos &#x26;amp; (char)0x07);\r\n    }\r\n\r\n    private static WatermarkVerticalPostion GetVerticalPosition(WatermarkPostion pos)\r\n    {\r\n        // Mask: 111 000\r\n        return (WatermarkVerticalPostion)((char)pos &#x26;amp; (char)0x38);\r\n    }\r\n\r\n    private static WatermarkPostion GetPosition(WatermarkHorizontalPostion hPos, WatermarkVerticalPostion vPos)\r\n    {\r\n        return (WatermarkPostion)((char)hPos | (char)vPos);\r\n    }\r\n\r\n    #endregion\r\n\r\n    #region IDisposable 成员\r\n\r\n    public virtual void Dispose()\r\n    {\r\n        this.OriginImage.Dispose();\r\n        this.WatermarkedImage.Dispose();\r\n    }\r\n\r\n    #endregion\r\n}\r\n\r\npublic enum WatermarkPostion\r\n{\r\n    TopLeft = 0x24,         // 100 100\r\n    TopCenter = 0x22,       // 100 010\r\n    TopRight = 0x21,        // 100 001\r\n    MiddleLeft = 0x14,      // 010 100\r\n    MiddleCenter = 0x12,    // 010 010\r\n    MiddleRight = 0x11,     // 010 001    \r\n    BottomLeft = 0x0C,      // 001 100\r\n    BottomCenter = 0x0A,    // 001 010\r\n    BottomRight = 0x09,     // 001 001\r\n}\r\n\r\npublic enum WatermarkHorizontalPostion\r\n{\r\n    Left = 0x04,            // 000 100\r\n    Center = 0x02,          // 000 010\r\n    Right = 0x01,           // 000 001\r\n}\r\n\r\npublic enum WatermarkVerticalPostion\r\n{\r\n    Top = 0x20,             // 100 000\r\n    Middle = 0x10,          // 010 000\r\n    Bottom = 0x08,          // 001 000\r\n}\n</code></pre>\n<p>}</pre></p>\n<p>再来分别看加图片水印的类ImageWatermarker.cs与加文本水印的类TextWatermark.cs的源码：</p>\r\n<pre class=\"brush: csharp\">using System;\r\nusing System.Collections.Generic;\r\nusing System.Drawing;\r\nusing System.Drawing.Imaging;\n<p>namespace zizhujy.ImageHandler\r\n{\r\npublic class ImageWatermarker : Watermarker\r\n{\r\n#region Properties</p>\n<pre><code>    private Image watermarkImage;\r\n    public Image WatermarkImage\r\n    {\r\n        get\r\n        {\r\n            return watermarkImage;\r\n        }\r\n        set\r\n        {\r\n            watermarkImage =value;\r\n        }\r\n    }\r\n\r\n    private ImageAttributes imageAttributes = new ImageAttributes();\r\n    public ImageAttributes ImageAttributes\r\n    {\r\n        get\r\n        {\r\n            return imageAttributes;\r\n        }\r\n        set\r\n        {\r\n            imageAttributes = value;\r\n        }\r\n    }\r\n\r\n    private List colorMaps = new List();\r\n    public List ColorMaps\r\n    {\r\n        get\r\n        {\r\n            return colorMaps;\r\n        }\r\n        set { colorMaps = value; }\r\n    }\r\n\r\n    public float[][] ColorMatrixElements\r\n    {\r\n        get\r\n        {\r\n            if (this.ColorMatrix != null)\r\n            {\r\n                return new float[][] {\r\n                    new float[] {this.ColorMatrix.Matrix00, this.ColorMatrix.Matrix01, this.ColorMatrix.Matrix02, this.ColorMatrix.Matrix03, this.ColorMatrix.Matrix04},\r\n                    new float[] {this.ColorMatrix.Matrix10, this.ColorMatrix.Matrix11, this.ColorMatrix.Matrix12, this.ColorMatrix.Matrix13, this.ColorMatrix.Matrix14},\r\n                    new float[] {this.ColorMatrix.Matrix20, this.ColorMatrix.Matrix21, this.ColorMatrix.Matrix22, this.ColorMatrix.Matrix23, this.ColorMatrix.Matrix24},\r\n                    new float[] {this.ColorMatrix.Matrix30, this.ColorMatrix.Matrix31, this.ColorMatrix.Matrix32, this.ColorMatrix.Matrix33, this.ColorMatrix.Matrix34},\r\n                    new float[] {this.ColorMatrix.Matrix40, this.ColorMatrix.Matrix41, this.ColorMatrix.Matrix42, this.ColorMatrix.Matrix43, this.ColorMatrix.Matrix44}\r\n                };\r\n            }\r\n            else\r\n            {\r\n                return null;\r\n            }\r\n        }\r\n        set\r\n        {\r\n            this.ColorMatrix.Matrix00 = value[0][0];\r\n            this.ColorMatrix.Matrix01 = value[0][1];\r\n            this.ColorMatrix.Matrix02 = value[0][2];\r\n            this.ColorMatrix.Matrix03 = value[0][3];\r\n            this.ColorMatrix.Matrix04 = value[0][4];\r\n            this.ColorMatrix.Matrix10 = value[1][0];\r\n            this.ColorMatrix.Matrix11 = value[1][1];\r\n            this.ColorMatrix.Matrix12 = value[1][2];\r\n            this.ColorMatrix.Matrix13 = value[1][3];\r\n            this.ColorMatrix.Matrix14 = value[1][4];\r\n            this.ColorMatrix.Matrix20 = value[2][0];\r\n            this.ColorMatrix.Matrix21 = value[2][1];\r\n            this.ColorMatrix.Matrix22 = value[2][2];\r\n            this.ColorMatrix.Matrix23 = value[2][3];\r\n            this.ColorMatrix.Matrix24 = value[2][4];\r\n            this.ColorMatrix.Matrix30 = value[3][0];\r\n            this.ColorMatrix.Matrix31 = value[3][1];\r\n            this.ColorMatrix.Matrix32 = value[3][2];\r\n            this.ColorMatrix.Matrix33 = value[3][3];\r\n            this.ColorMatrix.Matrix34 = value[3][4];\r\n            this.ColorMatrix.Matrix40 = value[4][0];\r\n            this.ColorMatrix.Matrix41 = value[4][1];\r\n            this.ColorMatrix.Matrix42 = value[4][2];\r\n            this.ColorMatrix.Matrix43 = value[4][3];\r\n            this.ColorMatrix.Matrix44 = value[4][4];\r\n        }\r\n    }\r\n\r\n    private ColorMatrix colorMatrix;\r\n    public ColorMatrix ColorMatrix\r\n    {\r\n        get\r\n        {\r\n            return colorMatrix;\r\n        }\r\n        set\r\n        {\r\n            colorMatrix = value;\r\n        }\r\n    }\r\n\r\n    private bool keepScale;\r\n    public bool KeepScale\r\n    {\r\n        get { return keepScale; }\r\n        set { keepScale = value; }\r\n    }\r\n\r\n    public override double ForegroundOpacity\r\n    {\r\n        get\r\n        {\r\n            return base.ForegroundOpacity;\r\n        }\r\n        set\r\n        {\r\n            double percent = value &#x26;gt; 1 ? 1 : (value &#x26;lt; 0 ? 0 : value);\r\n\r\n            base.ForegroundOpacity = percent;\r\n            this.ColorMatrix.Matrix33 = (float)percent;\r\n        }\r\n    }\r\n\r\n    #endregion\r\n\r\n    #region Constructor\r\n\r\n    public ImageWatermarker(Image originImage, Image watermarkImage)\r\n        : base(originImage)\r\n    {\r\n        this.WatermarkImage = watermarkImage;\r\n\r\n        // Default values\r\n        this.ColorMaps.Add(new ColorMap());\r\n        this.ColorMaps[0].OldColor = Color.FromArgb(255, 255, 255, 255);\r\n        this.ColorMaps[0].NewColor = Color.FromArgb(0, 0, 0, 0);\r\n\r\n        float[][] colorMatrixElements = {\r\n            new float[]{1.0f, 0.0f, 0.0f, 0.0f, 0.0f},\r\n            new float[]{0.0f, 1.0f, 0.0f, 0.0f, 0.0f},\r\n            new float[]{0.0f, 0.0f, 1.0f, 0.0f, 0.0f},\r\n            new float[]{0.0f, 0.0f, 0.0f, 0.3f, 0.0f},\r\n            new float[]{0.0f, 0.0f, 0.0f, 0.0f, 1.0f}   \r\n        };\r\n        this.ColorMatrix = new ColorMatrix(colorMatrixElements);\r\n        this.WatermarkSize = this.WatermarkImage.Size;\r\n        this.KeepScale = true;\r\n    }\r\n\r\n    #endregion\r\n\r\n    #region Methods\r\n\r\n    protected override SizeF ComputeWatermarkSize()\r\n    {\r\n        return this.WatermarkSize;\r\n    }\r\n\r\n    protected override Image AddWatermarkToOriginImage()\r\n    {\r\n        this.WatermarkedImage = this.OriginImage;\r\n        Graphics watermarkGraphic = Graphics.FromImage(this.WatermarkedImage);\r\n\r\n        this.ImageAttributes.SetRemapTable(this.ColorMaps.ToArray(), ColorAdjustType.Bitmap);\r\n        this.ImageAttributes.SetColorMatrix(this.ColorMatrix, ColorMatrixFlag.Default, ColorAdjustType.Bitmap);\r\n\r\n        watermarkGraphic.DrawImage(this.WatermarkImage,\r\n            new Rectangle((int)this.X, (int)this.Y, (int)this.WatermarkSize.Width, (int)this.WatermarkSize.Height),\r\n            0, 0, this.WatermarkImage.Width, this.WatermarkImage.Height,\r\n            GraphicsUnit.Pixel, this.ImageAttributes);\r\n\r\n        watermarkGraphic.Dispose();\r\n        imageAttributes.Dispose();\r\n\r\n        return this.WatermarkedImage;\r\n    }\r\n\r\n    public void SetWatermarkWidth(int width)\r\n    {\r\n        float height = this.WatermarkSize.Height;\r\n        if (this.KeepScale)\r\n        {\r\n            height = height * width / this.WatermarkSize.Width;\r\n        }\r\n\r\n        this.WatermarkSize = new SizeF(width, height);\r\n    }\r\n\r\n    public void SetWatermarkHeight(int height)\r\n    {\r\n        float width = this.WatermarkSize.Width;\r\n        if (this.KeepScale)\r\n        {\r\n            width = width * height / this.WatermarkSize.Height;\r\n        }\r\n\r\n        this.WatermarkSize = new SizeF(width, height);\r\n    }\r\n\r\n    public void SetWatermarkSize(int width, int height)\r\n    {\r\n        this.WatermarkSize = new SizeF(width, height);\r\n        this.KeepScale = false;\r\n    }\r\n\r\n    public override void Dispose()\r\n    {\r\n        base.Dispose();\r\n        this.WatermarkImage.Dispose();\r\n    }\r\n\r\n    #endregion\r\n}\n</code></pre>\n<p>}</pre></p>\n<p>&nbsp;</p>\r\n<pre class=\"brush: csharp\">using System;\r\nusing System.Drawing;\r\nusing System.Collections.Generic;\n<p>namespace zizhujy.ImageHandler\r\n{\r\npublic class TextWatermarker : Watermarker\r\n{\r\n#region Properties</p>\n<pre><code>    private string watermarkText;\r\n    public string WatermarkText\r\n    {\r\n        get\r\n        {\r\n            return watermarkText;\r\n        }\r\n        set\r\n        {\r\n            watermarkText = value;\r\n        }\r\n    }\r\n\r\n    // 自动计算最合适的水印文本字体大小\r\n    private bool autoSize = true;\r\n    public bool AutoSize\r\n    {\r\n        get\r\n        {\r\n            return autoSize;\r\n        }\r\n        set\r\n        {\r\n            autoSize = value;\r\n        }\r\n    }\r\n\r\n    private double fontSizePercent;\r\n    public double FontSizePercent\r\n    {\r\n        get { return fontSizePercent; }\r\n        set {\r\n            fontSizePercent = value &#x26;gt; 1 ? 1 : (value &#x26;lt;= 0.01 ? 0.01 : value);\r\n        }\r\n    }\r\n\r\n    private List&#x26;lt;Font&#x26;gt; fonts = new List&#x26;lt;Font&#x26;gt;();\r\n    public List&#x26;lt;Font&#x26;gt; Fonts\r\n    {\r\n        get\r\n        {\r\n            return fonts;\r\n        }\r\n        set\r\n        {\r\n            fonts = value;\r\n        }\r\n    }\r\n\r\n    private Font bestFont = new Font(\"Arial\", 12, FontStyle.Regular, GraphicsUnit.Pixel);\r\n    public Font BestFont{\r\n        get{\r\n            return bestFont;\r\n        }\r\n        set\r\n        {\r\n            bestFont = value;\r\n        }\r\n    }\r\n\r\n    private StringFormat StringFormat\r\n    {\r\n        get\r\n        {\r\n            StringFormat format = new StringFormat();\r\n            if (this.ComputeX)\r\n            {\r\n                switch (this.HorizontalPosition)\r\n                {\r\n                    case WatermarkHorizontalPostion.Left:\r\n                        format.Alignment = StringAlignment.Near;\r\n                        break;\r\n\r\n                    case WatermarkHorizontalPostion.Center:\r\n                        format.Alignment = StringAlignment.Center;\r\n                        break;\r\n\r\n                    case WatermarkHorizontalPostion.Right:\r\n                        format.Alignment = StringAlignment.Far;\r\n                        break;\r\n                }\r\n            }\r\n            else\r\n            {\r\n                format.Alignment = StringAlignment.Near;\r\n            }\r\n\r\n            return format;\r\n        }\r\n    }\r\n\r\n    #endregion\r\n\r\n    #region Constructor\r\n\r\n    public TextWatermarker(Image originImage, string watermarkText) : base(originImage)\r\n    {\r\n        this.WatermarkText = watermarkText;\r\n\r\n        // Default values\r\n        this.Fonts.Add(new Font(\"Arial\", 18, FontStyle.Regular, GraphicsUnit.Pixel));\r\n        this.Fonts.Add(new Font(\"Arial\", 16, FontStyle.Regular, GraphicsUnit.Pixel));\r\n        this.Fonts.Add(new Font(\"Arial\", 14, FontStyle.Regular, GraphicsUnit.Pixel));\r\n        this.Fonts.Add(new Font(\"Arial\", 12, FontStyle.Regular, GraphicsUnit.Pixel));\r\n        this.Fonts.Add(new Font(\"Arial\", 10, FontStyle.Regular, GraphicsUnit.Pixel));\r\n        this.Fonts.Add(new Font(\"Arial\", 8, FontStyle.Regular, GraphicsUnit.Pixel));\r\n        this.Fonts.Add(new Font(\"Arial\", 6, FontStyle.Regular, GraphicsUnit.Pixel));\r\n        this.Fonts.Add(new Font(\"Arial\", 4, FontStyle.Regular, GraphicsUnit.Pixel));\r\n        this.FontSizePercent = 30.00 / 480.00;\r\n        this.AutoSize = true;\r\n    }\r\n\r\n    #endregion\r\n\r\n    #region Methods\r\n\r\n    public void ChangeFontFamily(string fontFamily)\r\n    {\r\n        FontFamily ff = new FontFamily(fontFamily);\r\n        for (int i = 0; i &#x26;lt; this.Fonts.Count; i++)\r\n        {\r\n            this.Fonts[i] = new Font(ff, this.Fonts[i].Size, this.Fonts[i].Style, this.Fonts[i].Unit, this.Fonts[i].GdiCharSet, this.Fonts[i].GdiVerticalFont);\r\n        }\r\n        this.BestFont = new Font(ff, this.BestFont.Size, this.BestFont.Style, this.BestFont.Unit, this.BestFont.GdiCharSet, this.BestFont.GdiVerticalFont);\r\n    }\r\n\r\n    protected override SizeF ComputeWatermarkSize()\r\n    {\r\n        FindAvailableMaxSizedFont();\r\n        return this.WatermarkSize;\r\n    }\r\n\r\n    protected override void UpdateXY()\r\n    {\r\n        if (this.ComputeX)\r\n        {\r\n            switch (this.HorizontalPosition)\r\n            {\r\n                case WatermarkHorizontalPostion.Left:\r\n                    this.X = this.HorizontalMarginPixel;\r\n                    break;\r\n\r\n                case WatermarkHorizontalPostion.Center:\r\n                    this.X = this.OriginImage.Width / 2;\r\n                    break;\r\n\r\n                case WatermarkHorizontalPostion.Right:\r\n                    this.X = (this.OriginImage.Width - this.HorizontalMarginPixel);\r\n                    break;\r\n\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n\r\n        if (this.ComputeY)\r\n        {\r\n            switch (this.VerticalPosition)\r\n            {\r\n                case WatermarkVerticalPostion.Top:\r\n                    this.Y = this.VerticalMarginPixel;\r\n                    break;\r\n\r\n                case WatermarkVerticalPostion.Middle:\r\n                    this.Y = this.OriginImage.Height / 2 - this.WatermarkSize.Height / 2;\r\n                    break;\r\n\r\n                case WatermarkVerticalPostion.Bottom:\r\n                    this.Y = (this.OriginImage.Height - this.VerticalMarginPixel - this.WatermarkSize.Height);\r\n                    break;\r\n\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected override Image AddWatermarkToOriginImage()\r\n    {\r\n        this.WatermarkedImage = this.OriginImage;\r\n        Graphics g = Graphics.FromImage(this.WatermarkedImage);\r\n        g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.AntiAlias;\r\n        SolidBrush semiTransBrushShadow = new SolidBrush(this.ShadowColor);\r\n        \r\n        StringFormat format = this.StringFormat;\r\n        g.DrawString(this.WatermarkText, this.BestFont, semiTransBrushShadow, new PointF(this.X + this.ShadowOffsetX, this.Y + this.ShadowOffsetY), format);\r\n        SolidBrush semiTransBrush = new SolidBrush(this.ForeColor);\r\n        g.DrawString(this.WatermarkText, this.BestFont, semiTransBrush, new PointF(this.X, this.Y), format);\r\n        g.Dispose();\r\n\r\n        return this.WatermarkedImage;\r\n    }\r\n\r\n    private Font FindAvailableMaxSizedFont()\r\n    {\r\n        if (this.AutoSize)\r\n        {\r\n            this.BestFont = FindAvailableMaxSizedFont(false);\r\n            if (this.BestFont.Size &#x26;gt;= 16)\r\n            {\r\n                return this.BestFont;\r\n            }\r\n            else\r\n            {\r\n                return FindAvailableMaxSizedFont(true); \r\n            }\r\n        }\r\n        else\r\n        {\r\n            return FindAvailableMaxSizedFont(true);\r\n        }\r\n    }\r\n\r\n    private Font FindAvailableMaxSizedFont(bool byAbsoluteSizes)\r\n    {\r\n        if (byAbsoluteSizes)\r\n        {\r\n            this.Fonts.Sort(delegate(Font font1, Font font2) { return font2.Size.CompareTo(font1.Size); });\r\n            SizeF size = new SizeF();\r\n            Bitmap image = new Bitmap(1, 1);\r\n            Graphics g = Graphics.FromImage(image);\r\n\r\n            for (int i = 0; i &#x26;lt; this.Fonts.Count; i++)\r\n            {\r\n                //size = MeasureSize(this.WatermarkText, this.Fonts[i]);\r\n                size = g.MeasureString(this.WatermarkText, this.Fonts[i]);\r\n                if ((ushort)(size.Width + this.HorizontalMarginPixel * 2) &#x26;lt; (ushort)this.OriginImage.Width &#x26;amp;&#x26;amp; (ushort)(size.Height + this.VerticalMarginPixel * 2) &#x26;lt; (ushort)this.OriginImage.Height)\r\n                {\r\n                    g.Dispose();\r\n                    image.Dispose();\r\n                    this.WatermarkSize = size;\r\n                    this.BestFont = this.fonts[i];\r\n                    return this.Fonts[i];\r\n                }\r\n            }\r\n\r\n            g.Dispose();\r\n            image.Dispose();\r\n\r\n            this.WatermarkSize = new SizeF(0, 0);\r\n            return null;\r\n        }\r\n        else\r\n        {\r\n            int fontSize = (int)(this.OriginImage.Height * this.FontSizePercent);\r\n            fontSize = fontSize &#x26;gt;= 1 ? fontSize : 1;\r\n            this.BestFont = new Font(this.BestFont.FontFamily, fontSize, this.BestFont.Style, this.BestFont.Unit);\r\n            this.WatermarkSize = MeasureSize(this.WatermarkText, this.BestFont);\r\n            if ((ushort)(this.WatermarkSize.Width + this.HorizontalMarginPixel * 2) &#x26;lt; (ushort)this.OriginImage.Width &#x26;amp;&#x26;amp; (ushort)(this.WatermarkSize.Height + this.VerticalMarginPixel * 2) &#x26;lt; (ushort)this.OriginImage.Height)\r\n            {\r\n                return this.BestFont;\r\n            }\r\n            else\r\n            {\r\n                this.WatermarkSize = new SizeF(0, 0);\r\n                return null;\r\n            }\r\n        }\r\n    }\r\n\r\n    private SizeF MeasureSize(string text, Font font)\r\n    {\r\n        // Use a test image to measure the text.\r\n        Bitmap image = new Bitmap(1, 1);\r\n        Graphics g = Graphics.FromImage(image);\r\n        SizeF size = g.MeasureString(text, font);\r\n        g.Dispose();\r\n        image.Dispose();\r\n\r\n        return size;\r\n    }\r\n\r\n    #endregion\r\n}\n</code></pre>\n<p>}\r\n</pre></p>\n<p>&nbsp;</p>\r\n<h1><span style=\"color: #800080;\">四、总结：</span></h1>\r\n<p>这里采用模板设计模式，可复用性高，能被引用在多种工程之中；可扩展性强，比如当有需要添加HTML水印时，只需要新建一个HtmlWatermarker类，并实现模板类Watermarker中的相关方法即可，不需要更改任何现有代码。</p>\r\n<p>注意，模板设计模式很好地遵循了面向对象设计中的一个重要原则：对修改关闭，对扩展开放。</p>\r\n<h1><span style=\"color: #800080;\">五、相关文件下载：</span></h1>\r\n<p>DLL 文件(若仅需使用)：<a href=\"/BlogEngine/BlogEngine/BlogEngine.NET/file.axd?file=2011%2f7%2fImageHandler.dll\">ImageHandler.dll (18.00 kb)</a></p>\r\n<p>整个项目文件(若还需开发)：<a href=\"/BlogEngine/BlogEngine/BlogEngine.NET/file.axd?file=2011%2f7%2fImageHandler.rar\">ImageHandler.rar (45.03 kb)</a></p>\r\n<p>&nbsp;</p>\r\n<p>[donate: www.zizhujy.com]</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","author":"@zizhujy","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[],"slicesMap":{}}