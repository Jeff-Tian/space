{"componentChunkName":"component---src-templates-post-js","path":"/posts/ytwbzm","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/ytwbzm","relativePath":"posts/ytwbzm","frontmatter":{"title":"编排还是编舞，暨近几年工作回顾","stackbit_url_path":"posts/ytwbzm","date":"2021-12-07T12:23:13","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p>第一次听到编排，还是在学习 K8S 时，了解到容器的编排。后来在微服务架构的实践中，也常听到服务编排这个词组。</p>\n<p>对服务编排的实践，主要限于 BFF 层。最近几年的开发工作，主要都在 BFF 层，编排后端服务，为前端提供一个统一的服务界面。</p>\n<p>细节上有些变化，但总体上就是做了个服务编排的工作而已。</p>\n<p><a name=IYPgC></a></p>\n<h2>第一阶段</h2>\n<p>之前使用 gRPC 调用后端服务，给前端提供 Restful 接口；</p>\n<p><a name=aEOp9></a></p>\n<h2>第二阶段</h2>\n<p>后来使用 restful 调用后端服务，给前端提供 restful 接口，相当于一个手写的网关。这时了解到了 bulk api，可以满足前端批量调用接口的需求，不过没有投入实践；</p>\n<p><a name=Lriaf></a></p>\n<h2>第三阶段</h2>\n<p>如今使用 restful 调用后端服务，给前端提供 graphql 接口，相当于跳过了 bulk api 阶段。</p>\n<p><a name=HbzUn></a></p>\n<h2>快速回顾</h2>\n<p>总之，近几年的饭碗是靠微服务架构的流行所赏赐的。在单体架构的时候，我是会饿死的。</p>\n<p><img src=\"https://cdn.nlark.com/yuque/__graphviz/121d3a6bf9351f4dcba7f841470c4080.svg#lake_card_v2=eyJ0eXBlIjoiZ3JhcGh2aXoiLCJjb2RlIjoiZGlncmFwaCB7XG5cblx0XHRsYWJlbGxvYz1cInRcIjtcblx0XHRsYWJlbD1cIuWNleS9k-aetuaehFwiO1xuXG5cbiAgICBkZXNrdG9wIFtsYWJlbD1cIuahjOmdouerr1wiXVxuICAgIG1vYmlsZSBbbGFiZWwgPSBcIuaJi-acuuerr1wiXVxuICAgIHBhZCBbbGFiZWw9XCLlubPmnb_nq69cIl1cblxuICAgIHNlcnZpY2UgW3NoYXBlPWNpcmNsZSwgY29sb3I9YmxhY2ssIHN0eWxlPWZpbGxlZCwgbGFiZWw9XCLlkI7nq6_mnI3liqFcIiwgZm9udGNvbG9yPXdoaXRlXTtcblxuXG4gICAgZGVza3RvcCAtPiBzZXJ2aWNlXG4gICAgbW9iaWxlIC0-IHNlcnZpY2VcbiAgICBwYWQgLT4gc2VydmljZVxuXG59XG4iLCJ1cmwiOiJodHRwczovL2Nkbi5ubGFyay5jb20veXVxdWUvX19ncmFwaHZpei8xMjFkM2E2YmY5MzUxZjRkY2JhN2Y4NDE0NzBjNDA4MC5zdmciLCJpZCI6IlBhN1cyIiwibWFyZ2luIjp7InRvcCI6dHJ1ZSwiYm90dG9tIjp0cnVlfSwiY2FyZCI6ImRpYWdyYW0ifQ==\" alt=\"\">\n以上就是会饿死我的单体架构示意图，虽然它仍然有存在的价值，但是最近几年换了几家公司，都不再用它了，都迁移到或者直接就上微服务了，微服务和单体架构的对比可以简列如下：</p>\n<table>\n<thead>\n<tr>\n<th><strong>单体</strong></th>\n<th><strong>微服务</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>全量部署，简单粗暴</td>\n<td>局部部署</td>\n</tr>\n<tr>\n<td>要么成功、要么失败</td>\n<td>优雅降级</td>\n</tr>\n<tr>\n<td>跨模块修改很普遍</td>\n<td>清晰的模块边界</td>\n</tr>\n<tr>\n<td>技术栈统一</td>\n<td>技术栈多样</td>\n</tr>\n<tr>\n<td>垂直扩展</td>\n<td>水平扩展</td>\n</tr>\n<tr>\n<td>共享数据存储</td>\n<td>分离的数据存储</td>\n</tr>\n<tr>\n<td>所有人共享</td>\n<td>单一开发人员或者团队拥有</td>\n</tr>\n</tbody>\n</table>\n<p>当然，仅有微服务，我还是没有饭吃，因为前端可以直接访问微服务呀：</p>\n<p><img src=\"https://cdn.nlark.com/yuque/__graphviz/3a040a49473bfcaa3875e15b39636344.svg#lake_card_v2=eyJ0eXBlIjoiZ3JhcGh2aXoiLCJjb2RlIjoiZGlncmFwaCB7XG4gICAgY29tcG91bmQ9dHJ1ZTtcblxuICAgIGdyYXBoW2xheW91dD1cImZkcFwiXVxuXG4gICAgbGFiZWxsb2M9XCJ0XCI7XG4gICAgbGFiZWw9XCLnm7TmjqXorr_pl67lvq7mnI3liqFcIjtcblxuXG4gICAgc3ViZ3JhcGggY2x1c3Rlcl8wIHtcbiAgICAgICAgc3R5bGU9ZmlsbGVkO1xuICAgICAgICBsYWJlbCA9IFwi5ZCO56uv5pyN5YqhXCJcbiAgICAgICAgY29sb3IgPSBcInBpbmtcIlxuXG4gICAgICAgIG5vZGVbZm9udGNvbG9yPXBpbmssIGNvbG9yPXBpbmtdXG4gICAgICAgIHMwXG5cbiAgICAgICAgbm9kZVtzaGFwZT1jaXJjbGUsIGNvbG9yPXJlZCwgc3R5bGU9ZmlsbGVkLCBmb250Y29sb3I9cmVkXVxuICAgICAgICBzMSBzMiBzMyBzNCBzNSBzNiBzNyBzOCBzOSBzMTAgczExIHMxMlxuXG4gICAgICAgIGVkZ2VbY29sb3I9cGlua11cbiAgICAgICAgczAtPntzMSBzMiBzMyBzNCBzNSBzNiBzNyBzOCBzOSBzMTAgczExIHMxMn1cblxuICAgICAgICBlZGdlW2NvbG9yPWJsYWNrXVxuICAgICAgICBzMS0-czItPnMzLT5zNC0-czUtPnM2LT5zNy0-czgtPnM5LT5zMTAtPnMxMS0-czEyLT5zMVxuXG4gICAgICAgIHMxLT5zM1xuICAgICAgICBzMi0-czRcbiAgICAgICAgczMtPnM1XG4gICAgICAgIHM0LT5zNlxuICAgICAgICBzNS0-czdcbiAgICAgICAgczYtPnM4XG4gICAgICAgIHM3LT5zOVxuICAgICAgICBzOC0-czEwXG4gICAgICAgIHM5LT5zMTFcbiAgICAgICAgczEwLT5zMTJcbiAgICAgICAgczExLT5zMVxuICAgIH1cblxuXG4gICAgZGVza3RvcCBbbGFiZWw9XCLmoYzpnaLnq69cIl1cbiAgICBtb2JpbGUgW2xhYmVsID0gXCLmiYvmnLrnq69cIl1cbiAgICBwYWQgW2xhYmVsPVwi5bmz5p2_56uvXCJdXG5cbiAgICBkZXNrdG9wIC0-IHtzMSBzMiBzMyBzNH1cbiAgICBtb2JpbGUgLT4ge3MyIHMzIHM0IHM5fVxuICAgIHBhZCAtPiB7czMgczQgczUgczEwfVxuXG59XG4iLCJ1cmwiOiJodHRwczovL2Nkbi5ubGFyay5jb20veXVxdWUvX19ncmFwaHZpei8zYTA0MGE0OTQ3M2JmY2FhMzg3NWUxNWIzOTYzNjM0NC5zdmciLCJpZCI6Ik1tRTE0IiwibWFyZ2luIjp7InRvcCI6dHJ1ZSwiYm90dG9tIjp0cnVlfSwiY2FyZCI6ImRpYWdyYW0ifQ==\" alt=\"\">从上图的一团乱麻可以看出，点对点的 API 访问非常繁杂。而且，服务越多，API 调用越繁杂。</p>\n<p><img src=\"https://cdn.nlark.com/yuque/__graphviz/91565534cf7f890bc9a59005d0dddc09.svg#lake_card_v2=eyJ0eXBlIjoiZ3JhcGh2aXoiLCJjb2RlIjoiZ3JhcGgge1xuICAgIGxhYmVsPVwi54K55a-554K555qEIEFQSSDosIPnlKhcIlxuICAgIGxhYmVsbG9jPVwidFwiO1xuXG4gICAgZ3JhcGggW3BhZD1cIjAuMlwiLCBub2Rlc2VwPVwiMC41XCIsIHJhbmtzZXA9XCI2XCJdO1xuXG4gICAgc3ViZ3JhcGggY2x1c3Rlcl9BcHBzIHtcbiAgICAgICAgbGFiZWwgPSBcIuW6lOeUqOerr--8iOWIhuW4g-eahO-8iVwiXG5cbiAgICAgICAgZGVza3RvcCBbbGFiZWw9XCLmoYzpnaLnq69cIl1cbiAgICAgICAgbW9iaWxlIFtsYWJlbCA9IFwi5omL5py656uvXCJdXG4gICAgICAgIHBhZCBbbGFiZWw9XCLlubPmnb_nq69cIl1cbiAgICB9XG5cbiAgICBzdWJncmFwaCBjbHVzdGVyX1NlcnZpY2VzIHtcbiAgICAgICAgbGFiZWwgPSBcIuacjeWKoe-8iOiDveWKm--8iVwiXG5cbiAgICAgICAgdXNlciBbbGFiZWw9XCLnlKjmiLfmnI3liqFcIl1cbiAgICAgICAgcHJvZHVjdHMgW2xhYmVsPVwi5Lqn5ZOB5pyN5YqhXCJdXG4gICAgICAgIHByaWNlcyBbbGFiZWw9XCLku7fmoLzmnI3liqFcIl1cbiAgICAgICAgcmV2aWV3cyBbbGFiZWw9XCLor4Tku7fmnI3liqFcIl1cbiAgICAgICAgZmF2b3JpdGVzIFtsYWJlbD1cIuaUtuiXj-acjeWKoVwiXVxuICAgIH1cblxuICAgIGRlc2t0b3AgLS0gdXNlcjtcbiAgICBkZXNrdG9wIC0tIHByb2R1Y3RzO1xuICAgIGRlc2t0b3AgLS0gcHJpY2VzO1xuICAgIGRlc2t0b3AgLS0gcmV2aWV3cztcbiAgICBkZXNrdG9wIC0tIGZhdm9yaXRlcztcblxuICAgIG1vYmlsZSAtLSB1c2VyO1xuICAgIG1vYmlsZSAtLSBwcm9kdWN0cztcbiAgICBtb2JpbGUgLS0gcHJpY2VzO1xuICAgIG1vYmlsZSAtLSByZXZpZXdzO1xuICAgIG1vYmlsZSAtLSBmYXZvcml0ZXM7XG5cbiAgICBwYWQgLS0gdXNlcjtcbiAgICBwYWQgLS0gcHJvZHVjdHM7XG4gICAgcGFkIC0tIHByaWNlcztcbiAgICBwYWQgLS0gcmV2aWV3cztcbiAgICBwYWQgLS0gZmF2b3JpdGVzO1xufSIsInVybCI6Imh0dHBzOi8vY2RuLm5sYXJrLmNvbS95dXF1ZS9fX2dyYXBodml6LzkxNTY1NTM0Y2Y3Zjg5MGJjOWE1OTAwNWQwZGRkYzA5LnN2ZyIsImlkIjoiVnpDWEIiLCJtYXJnaW4iOnsidG9wIjp0cnVlLCJib3R0b20iOnRydWV9LCJjYXJkIjoiZGlhZ3JhbSJ9\" alt=\"\">以上的调用，在增加前端和服务之后：</p>\n<p><img src=\"https://cdn.nlark.com/yuque/__graphviz/aae5f6aa9d36f36a4be9ff406785d5a7.svg#lake_card_v2=eyJ0eXBlIjoiZ3JhcGh2aXoiLCJjb2RlIjoiZ3JhcGgge1xuICAgIGxhYmVsPVwi54K55a-554K555qEIEFQSSDosIPnlKhcIlxuICAgIGxhYmVsbG9jPVwidFwiO1xuXG4gICAgZ3JhcGggW3BhZD1cIjAuMlwiLCBub2Rlc2VwPVwiMC41XCIsIHJhbmtzZXA9XCI2XCJdO1xuXG4gICAgc3ViZ3JhcGggY2x1c3Rlcl9BcHBzIHtcbiAgICAgICAgbGFiZWwgPSBcIuW6lOeUqOerr--8iOWIhuW4g-eahO-8iVwiXG5cbiAgICAgICAgZGVza3RvcCBbbGFiZWw9XCLmoYzpnaLnq69cIl1cbiAgICAgICAgbW9iaWxlIFtsYWJlbCA9IFwi5omL5py656uvXCJdXG4gICAgICAgIHBhZCBbbGFiZWw9XCLlubPmnb_nq69cIl1cbiAgICAgICAgc2NyZWVuIFtsYWJlbD1cIuaxvei9puaZuuaFp-Wxj1wiXVxuICAgIH1cblxuICAgIHN1YmdyYXBoIGNsdXN0ZXJfU2VydmljZXMge1xuICAgICAgICBsYWJlbCA9IFwi5pyN5Yqh77yI6IO95Yqb77yJXCJcblxuICAgICAgICB1c2VyIFtsYWJlbD1cIueUqOaIt-acjeWKoVwiXVxuICAgICAgICBwcm9kdWN0cyBbbGFiZWw9XCLkuqflk4HmnI3liqFcIl1cbiAgICAgICAgcHJpY2VzIFtsYWJlbD1cIuS7t-agvOacjeWKoVwiXVxuICAgICAgICByZXZpZXdzIFtsYWJlbD1cIuivhOS7t-acjeWKoVwiXVxuICAgICAgICBmYXZvcml0ZXMgW2xhYmVsPVwi5pS26JeP5pyN5YqhXCJdXG4gICAgICAgIHJlY29tbWVuZGF0aW9ucyBbbGFiZWw9XCLmjqjojZDmnI3liqFcIl1cbiAgICAgICAgZXh0cmExIFtsYWJlbD1cIuKApuKAplwiXVxuICAgICAgICBleHRyYTIgW2xhYmVsPVwi4oCm4oCmXCJdXG4gICAgfVxuXG4gICAgZGVza3RvcCAtLSB1c2VyO1xuICAgIGRlc2t0b3AgLS0gcHJvZHVjdHM7XG4gICAgZGVza3RvcCAtLSBwcmljZXM7XG4gICAgZGVza3RvcCAtLSByZXZpZXdzO1xuICAgIGRlc2t0b3AgLS0gZmF2b3JpdGVzO1xuICAgIGRlc2t0b3AgLS0gcmVjb21tZW5kYXRpb25zO1xuICAgIGRlc2t0b3AgLS0gZXh0cmExO1xuICAgIGRlc2t0b3AgLS0gZXh0cmEyO1xuXG4gICAgbW9iaWxlIC0tIHVzZXI7XG4gICAgbW9iaWxlIC0tIHByb2R1Y3RzO1xuICAgIG1vYmlsZSAtLSBwcmljZXM7XG4gICAgbW9iaWxlIC0tIHJldmlld3M7XG4gICAgbW9iaWxlIC0tIGZhdm9yaXRlcztcbiAgICBtb2JpbGUgLS0gcmVjb21tZW5kYXRpb25zO1xuICAgIG1vYmlsZSAtLSBleHRyYTE7XG4gICAgbW9iaWxlIC0tIGV4dHJhMjtcblxuICAgIHBhZCAtLSB1c2VyO1xuICAgIHBhZCAtLSBwcm9kdWN0cztcbiAgICBwYWQgLS0gcHJpY2VzO1xuICAgIHBhZCAtLSByZXZpZXdzO1xuICAgIHBhZCAtLSBmYXZvcml0ZXM7XG4gICAgcGFkIC0tIHJlY29tbWVuZGF0aW9ucztcbiAgICBwYWQgLS0gZXh0cmExO1xuICAgIHBhZCAtLSBleHRyYTI7XG5cbiAgICBzY3JlZW4gLS0gdXNlcjtcbiAgICBzY3JlZW4gLS0gcHJvZHVjdHM7XG4gICAgc2NyZWVuIC0tIHByaWNlcztcbiAgICBzY3JlZW4gLS0gcmV2aWV3cztcbiAgICBzY3JlZW4gLS0gZmF2b3JpdGVzO1xuICAgIHNjcmVlbiAtLSByZWNvbW1lbmRhdGlvbnM7XG4gICAgc2NyZWVuIC0tIGV4dHJhMTtcbiAgICBzY3JlZW4gLS0gZXh0cmEyO1xufSIsInVybCI6Imh0dHBzOi8vY2RuLm5sYXJrLmNvbS95dXF1ZS9fX2dyYXBodml6L2FhZTVmNmFhOWQzNmYzNmE0YmU5ZmY0MDY3ODVkNWE3LnN2ZyIsImlkIjoic01mRDEiLCJtYXJnaW4iOnsidG9wIjp0cnVlLCJib3R0b20iOnRydWV9LCJjYXJkIjoiZGlhZ3JhbSJ9\" alt=\"\">为了解决前端到服务的调用变成一团乱麻的问题，业界引入了网关层，也给了我一碗饭吃：</p>\n<p><img src=\"https://cdn.nlark.com/yuque/__graphviz/637700da2a49f284e68827fbf1ad43de.svg#lake_card_v2=eyJ0eXBlIjoiZ3JhcGh2aXoiLCJjb2RlIjoiZGlncmFwaCB7XG4gICAgY29tcG91bmQ9dHJ1ZTtcbiAgICByYW5rZGlyPVwiVEJcIjtcblxuICAgIGdyYXBoW2xheW91dD1cImZkcFwiLHBhZD1cIjAuNVwiLCBub2Rlc2VwPVwiMVwiLCByYW5rc2VwPVwiMlwiXVxuXG4gICAgbGFiZWxsb2M9XCJ0XCI7XG4gICAgbGFiZWw9XCLlvJXlhaXnvZHlhbPlsYJcIjtcblxuXG4gICAgc3ViZ3JhcGggY2x1c3Rlcl9kZXZpY2VzIHtcbiAgICAgICAgbGFiZWw9XCJcIlxuXG4gICAgICAgIGRlc2t0b3AgW2xhYmVsPVwi5qGM6Z2i56uvXCJdXG4gICAgICAgIG1vYmlsZSBbbGFiZWwgPSBcIuaJi-acuuerr1wiXVxuICAgICAgICBwYWQgW2xhYmVsPVwi5bmz5p2_56uvXCJdXG4gICAgICAgIFxuICAgIH1cblxuXG4gICAgc3ViZ3JhcGggY2x1c3Rlcl9nYXRld2F5IHtcbiAgICAgICAgc3R5bGUgPSBmaWxsZWQ7XG4gICAgICAgIGxhYmVsID0gXCLnvZHlhbPlsYJcIjtcbiAgICAgICAgY29sb3IgPSBcImxpZ2h0Ymx1ZVwiXG4gICAgXG5cbiAgICAgICAgbm9kZVtjb2xvcj1saWdodGJsdWUsIGZvbnRjb2xvcj1saWdodGJsdWVdXG4gICAgICAgIGdhdGV3YXlcbiAgICB9XG5cblxuICAgIHN1YmdyYXBoIGNsdXN0ZXJfMCB7XG4gICAgICAgIHN0eWxlPWZpbGxlZDtcbiAgICAgICAgbGFiZWwgPSBcIuWQjuerr-acjeWKoVwiXG4gICAgICAgIGNvbG9yID0gXCJwaW5rXCJcblxuICAgICAgICBub2RlW2ZvbnRjb2xvcj1waW5rLCBjb2xvcj1waW5rXVxuICAgICAgICBzMFxuXG4gICAgICAgIG5vZGVbc2hhcGU9Y2lyY2xlLCBjb2xvcj1yZWQsIHN0eWxlPWZpbGxlZCwgZm9udGNvbG9yPXJlZF1cbiAgICAgICAgczEgczIgczMgczQgczUgczYgczcgczggczkgczEwIHMxMSBzMTJcblxuICAgICAgICBlZGdlW2NvbG9yPXBpbmtdXG4gICAgICAgIHMwLT57czEgczIgczMgczQgczUgczYgczcgczggczkgczEwIHMxMSBzMTJ9XG5cbiAgICAgICAgZWRnZVtjb2xvcj1ibGFja11cbiAgICAgICAgczEtPnMyLT5zMy0-czQtPnM1LT5zNi0-czctPnM4LT5zOS0-czEwLT5zMTEtPnMxMi0-czFcblxuICAgICAgICBzMS0-czNcbiAgICAgICAgczItPnM0XG4gICAgICAgIHMzLT5zNVxuICAgICAgICBzNC0-czZcbiAgICAgICAgczUtPnM3XG4gICAgICAgIHM2LT5zOFxuICAgICAgICBzNy0-czlcbiAgICAgICAgczgtPnMxMFxuICAgICAgICBzOS0-czExXG4gICAgICAgIHMxMC0-czEyXG4gICAgICAgIHMxMS0-czFcbiAgICB9XG5cbiAgICBlZGdlW2NvbG9yPWNhZGV0Ymx1ZTFdXG4gICAgZ2F0ZXdheSAtPiB7czEgczQgczggczEwfVxuXG4gICAgZWRnZVtjb2xvcj1ibHVlXVxuICAgIGRlc2t0b3AgLT4gZ2F0ZXdheVxuICAgIG1vYmlsZSAtPiBnYXRld2F5XG4gICAgcGFkIC0-IGdhdGV3YXlcblxufVxuIiwidXJsIjoiaHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlL19fZ3JhcGh2aXovNjM3NzAwZGEyYTQ5ZjI4NGU2ODgyN2ZiZjFhZDQzZGUuc3ZnIiwiaWQiOiJDV3FPQyIsIm1hcmdpbiI6eyJ0b3AiOnRydWUsImJvdHRvbSI6dHJ1ZX0sImNhcmQiOiJkaWFncmFtIn0=\" alt=\"\">前面提到，我的饭碗进入到第二阶段时，主要是在手写网关层，这个网关层由几个 BFF 项目构成。</p>\n<p><img src=\"https://cdn.nlark.com/yuque/__graphviz/aee3d70ce3c2588302291cc6cd2cae5f.svg#lake_card_v2=eyJ0eXBlIjoiZ3JhcGh2aXoiLCJjb2RlIjoiZ3JhcGgge1xuICAgIGxhYmVsPVwi5omL5YaZ572R5YWz5bGCXCJcbiAgICBsYWJlbGxvYz1cInRcIjtcblxuICAgIGdyYXBoIFtwYWQ9XCIwLjJcIiwgbm9kZXNlcD1cIjAuNVwiLCByYW5rc2VwPVwiNlwiXTtcblxuICAgIHN1YmdyYXBoIGNsdXN0ZXJfQXBwcyB7XG4gICAgICAgIGxhYmVsID0gXCLlupTnlKjnq6_vvIjliIbluIPnmoTvvIlcIlxuXG4gICAgICAgIGRlc2t0b3AgW2xhYmVsPVwi5qGM6Z2i56uvXCJdXG4gICAgICAgIG1vYmlsZSBbbGFiZWwgPSBcIuaJi-acuuerr1wiXVxuICAgICAgICBwYWQgW2xhYmVsPVwi5bmz5p2_56uvXCJdXG4gICAgICAgIHNjcmVlbiBbbGFiZWw9XCLmsb3ovabmmbrmhaflsY9cIl1cbiAgICB9XG5cbiAgICBzdWJncmFwaCBjbHVzdGVyX2JmZiB7XG4gICAgICAgIGxhYmVsID0gXCJCRkYg5o6l5Y-jXCJcblxuICAgICAgICBiZmYxW2xhYmVsPVwiQkZGXCIsIHNoYXBlPU1jaXJjbGVdXG4gICAgICAgIGJmZjJbbGFiZWw9XCJCRkZcIiwgc2hhcGU9TWRpYW1vbmRdXG4gICAgICAgIGJmZjNbbGFiZWw9XCJCRkZcIiwgc2hhcGU9ZWdnXVxuICAgIH1cblxuICAgIHN1YmdyYXBoIGNsdXN0ZXJfU2VydmljZXMge1xuICAgICAgICBsYWJlbCA9IFwi5pyN5Yqh77yI6IO95Yqb77yJXCJcblxuICAgICAgICB1c2VyIFtsYWJlbD1cIueUqOaIt-acjeWKoVwiXVxuICAgICAgICBwcm9kdWN0cyBbbGFiZWw9XCLkuqflk4HmnI3liqFcIl1cbiAgICAgICAgcHJpY2VzIFtsYWJlbD1cIuS7t-agvOacjeWKoVwiXVxuICAgICAgICByZXZpZXdzIFtsYWJlbD1cIuivhOS7t-acjeWKoVwiXVxuICAgICAgICBmYXZvcml0ZXMgW2xhYmVsPVwi5pS26JeP5pyN5YqhXCJdXG4gICAgICAgIHJlY29tbWVuZGF0aW9ucyBbbGFiZWw9XCLmjqjojZDmnI3liqFcIl1cbiAgICAgICAgZXh0cmExIFtsYWJlbD1cIuKApuKAplwiXVxuICAgICAgICBleHRyYTIgW2xhYmVsPVwi4oCm4oCmXCJdXG4gICAgfVxuXG4gICAgZGVza3RvcCAtLSBiZmYxO1xuICAgIGRlc2t0b3AgLS0gYmZmMjtcbiAgICBkZXNrdG9wIC0tIGV4dHJhMTtcbiAgICBkZXNrdG9wIC0tIGV4dHJhMjtcblxuICAgIG1vYmlsZSAtLSBiZmYyO1xuICAgIG1vYmlsZSAtLSBiZmYzO1xuICAgIG1vYmlsZSAtLSByZWNvbW1lbmRhdGlvbnM7XG4gICAgbW9iaWxlIC0tIGV4dHJhMTtcbiAgICBtb2JpbGUgLS0gZXh0cmEyO1xuXG4gICAgcGFkIC0tIGJmZjE7XG4gICAgcGFkIC0tIGJmZjM7XG4gICAgcGFkIC0tIGV4dHJhMTtcbiAgICBwYWQgLS0gZXh0cmEyO1xuXG4gICAgc2NyZWVuIC0tIGJmZjM7XG4gICAgc2NyZWVuIC0tIGJmZjI7XG4gICAgc2NyZWVuIC0tIHByaWNlcztcbiAgICBzY3JlZW4gLS0gZXh0cmEyO1xuXG4gICAgYmZmMSAtLSB1c2VyXG4gICAgYmZmMSAtLSBwcm9kdWN0c1xuICAgIGJmZjEgLS0gcHJpY2VzXG4gICAgYmZmMSAtLSByZXZpZXdzXG4gICAgYmZmMSAtLSBmYXZvcml0ZXNcbiAgICBiZmYxIC0tIHJlY29tbWVuZGF0aW9uc1xuXG4gICAgYmZmMiAtLSB1c2VyXG4gICAgYmZmMiAtLSBwcm9kdWN0c1xuICAgIGJmZjIgLS0gcHJpY2VzXG4gICAgYmZmMiAtLSByZXZpZXdzXG4gICAgYmZmMiAtLWZhdm9yaXRlc1xuICAgIGJmZjIgLS0gcmVjb21tZW5kYXRpb25zXG4gICAgYmZmMiAtLSBleHRyYTFcbiAgICBiZmYyIC0tIGV4dHJhMlxuXG4gICAgYmZmMyAtLSBwcmljZXNcbiAgICBiZmYzIC0tIHJldmlld3NcbiAgICBiZmYzIC0tIGZhdm9yaXRlc1xuICAgIGJmZjMgLS0gZXh0cmExXG4gICAgYmZmMyAtLSBleHRyYTJcbn0iLCJ1cmwiOiJodHRwczovL2Nkbi5ubGFyay5jb20veXVxdWUvX19ncmFwaHZpei9hZWUzZDcwY2UzYzI1ODgzMDIyOTFjYzZjZDJjYWU1Zi5zdmciLCJpZCI6ImdKQWdBIiwibWFyZ2luIjp7InRvcCI6dHJ1ZSwiYm90dG9tIjp0cnVlfSwiY2FyZCI6ImRpYWdyYW0ifQ==\" alt=\"\">可以见到，手写网关层，导致了调用关系的更加繁杂。这时虽然了解到了 bulk api，但是没有投入实践。跳过了 bulk api，直接开始实践 GraphQL。GraphQL 和 restful API 的对比如下：</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th><strong>GraphQL</strong></th>\n<th><strong>REST</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>架构</strong></td>\n<td>客户端驱动</td>\n<td>服务器端驱动</td>\n</tr>\n<tr>\n<td><strong>组织形式</strong></td>\n<td>模式与类型系统</td>\n<td>服务端点</td>\n</tr>\n<tr>\n<td><strong>操作</strong></td>\n<td>查询、修改、订阅</td>\n<td>创建、读取、更新、删除</td>\n</tr>\n<tr>\n<td><strong>数据获取</strong></td>\n<td>单 API 调用获取定制化的数据</td>\n<td>多 API 调用获取固定的数据</td>\n</tr>\n<tr>\n<td><strong>社区</strong></td>\n<td>成长中</td>\n<td>巨大</td>\n</tr>\n<tr>\n<td><strong>性能</strong></td>\n<td>快</td>\n<td>多网络调用更加耗时</td>\n</tr>\n<tr>\n<td><strong>开发速度</strong></td>\n<td>更快</td>\n<td>更慢</td>\n</tr>\n<tr>\n<td><strong>学习曲线</strong></td>\n<td>陡峭</td>\n<td>较平缓</td>\n</tr>\n<tr>\n<td><strong>自文档</strong></td>\n<td>自带</td>\n<td>不支持</td>\n</tr>\n<tr>\n<td><strong>文件上传</strong></td>\n<td>不支持</td>\n<td>支持</td>\n</tr>\n<tr>\n<td><strong>缓存</strong></td>\n<td>需要通过上层库来完成</td>\n<td></td>\n</tr>\n<tr>\n<td>比如 Apollo Response Cache，以及启用 APQ 实现 CDN 缓存</td>\n<td>支持</td>\n<td></td>\n</tr>\n<tr>\n<td><strong>稳定性</strong></td>\n<td>不容易出错，自动验证以及类型检查</td>\n<td>对复杂的查询来说是更好的选择</td>\n</tr>\n<tr>\n<td><strong>使用场景</strong></td>\n<td>多微服务、移动端应用</td>\n<td>简单的应用、资源驱动的应用</td>\n</tr>\n</tbody>\n</table>\n<p><a name=xqDQj></a></p>\n<h2></h2>\n<p><a name=EafSf></a></p>\n<h2>未来展望</h2>\n<p>以上三个阶段全部是在<strong>请求驱动的架构</strong>下工作，做的工作都是<strong>服务编排</strong>的范畴。GraqphQL 是个明显的趋势，未来还需要继续学习，引入并实战 GraphQL Federation。</p>\n<p>最早在《<a href=\"https://zhuanlan.zhihu.com/p/383196356\">基于微服务的事件驱动系统的架构考量</a>》中接触到<strong>事件驱动的架构</strong>这一概念，并同时接触到了<strong>编舞</strong>这个词，不过还没有在工作中实践过，仅仅在参与一个异步 API 的黑客松时，浅尝了一下。后续在实际使用一段时间后，再来分享，这里先放个<strong>编排</strong>与<strong>编舞</strong>的对比表格：</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th><strong>编排</strong></th>\n<th><strong>编舞</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>实时性</strong></td>\n<td>同步</td>\n<td>异步</td>\n</tr>\n<tr>\n<td><strong>扩展性</strong></td>\n<td>点对点集成</td>\n<td>易扩展</td>\n</tr>\n<tr>\n<td><strong>一致性</strong></td>\n<td>强一致</td>\n<td>最终一致</td>\n</tr>\n<tr>\n<td><strong>耦合性</strong></td>\n<td>强耦合</td>\n<td>松耦合</td>\n</tr>\n<tr>\n<td><strong>领域知识</strong></td>\n<td>需要</td>\n<td>很少甚至不需要</td>\n</tr>\n<tr>\n<td><strong>可观测性</strong></td>\n<td>清晰的工作流</td>\n<td>缺少整体状态</td>\n</tr>\n<tr>\n<td><strong>性能考量</strong></td>\n<td>延时</td>\n<td>吞吐</td>\n</tr>\n<tr>\n<td><strong>应用环境</strong></td>\n<td>限界上下文之内</td>\n<td>限界上下文之间</td>\n</tr>\n</tbody>\n</table>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","description":"Full Stack Developer, good at OAuth 2.0","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"关于","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"叽叽歪歪","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"知乎","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"本站源码","url":"https://github.com/Jeff-Tian/space","style":"link","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"紫竹叽歪","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[]}