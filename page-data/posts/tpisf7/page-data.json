{"componentChunkName":"component---src-templates-post-js","path":"/posts/tpisf7","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/tpisf7","relativePath":"posts/tpisf7","frontmatter":{"title":"åˆ©ç”¨ openssl å®‰å…¨åœ°æ¢å¤å‡º GitHub Actions ä¸­çš„ secrets åŸå§‹æ˜æ–‡å€¼","stackbit_url_path":"posts/tpisf7","date":"2022-08-19T10:56:28","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p><a name=DZUvV></a></p>\n<h1>é—®é¢˜</h1>\n<p>å‡ å¹´å‰çš„ GitHub è®ºæ–‡ä»“åº“ï¼Œè®¾ç½®äº†ä¸€ä¸ª GitHub Actionsï¼Œä½¿ç”¨ texlive ç¼–è¯‘æˆæœ€ç»ˆçš„è®ºæ–‡ pdf æ–‡ä»¶ï¼Œé€šè¿‡ä¼ä¸šå¾®ä¿¡æœºå™¨äºº webhook å‘é€åˆ°æˆ‘çš„æ‰‹æœºä¸Šã€‚è¿™ä¸ª GitHub Actionï¼Œä½¿ç”¨åˆ°çš„ä¼ä¸šå¾®ä¿¡æœºå™¨äºº webhook ç›¸å…³çš„é…ç½®ï¼Œé€šè¿‡ repository secrets ä¼ å…¥ï¼š</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1660887225927-8fa10392-38da-435f-bc5d-6f773808a4fd.png#clientId=u0e5ede32-05a3-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=693&#x26;id=u8246327b&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1386&#x26;originWidth=1664&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=220935&#x26;status=done&#x26;style=none&#x26;taskId=u7651b249-c019-4312-a6ca-a79e73a9109&#x26;title=&#x26;width=832\" alt=\"image.png\"></p>\n<p>ç°åœ¨æƒ³é…ç½®åˆ°å¦å¤–çš„åœ°æ–¹ï¼Œä½†æ˜¯æ‰¾ä¸åˆ°åŸå§‹çš„å€¼äº†ï¼Œè€Œ GitHub å¹¶æ²¡æœ‰æä¾›æŸ¥çœ‹åŸå§‹å€¼çš„æ–¹å¼ã€‚</p>\n<p><a name=uM0xT></a></p>\n<h1>å°è¯•</h1>\n<p>ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•æ˜¯ï¼ŒæŠŠè¿™äº›ç§˜å¯†å€¼åœ¨æ—¥å¿—ä¸­æ‰“å°å‡ºæ¥ï¼Œä½†æ˜¯å¤±è´¥äº†ï¼Œå› ä¸ºç›´æ¥ echoï¼ŒåŠ å¯†å€¼ä¼šè¢« GitHub Action æ‰“ç ï¼š</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1660887586643-352fab13-70c4-4f42-b13f-b2e3ec02a0e3.png#clientId=u0e5ede32-05a3-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=889&#x26;id=ua4d3ab17&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1778&#x26;originWidth=1944&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=404790&#x26;status=done&#x26;style=none&#x26;taskId=u1859fea7-623c-46d3-8837-8e83cfe8d7c&#x26;title=&#x26;width=972\" alt=\"image.png\"><br />å…¶å®ï¼Œå¦‚æœ GitHub çœŸçš„åœ¨æ—¥å¿—ä¸­æ˜æ–‡è¾“å‡ºç§˜å¯†å€¼ï¼Œé‚£ä¹ˆä¸€æ—¦ä»“åº“æ˜¯å…¬å¼€çš„ï¼Œå°±ä¼šæ³„å¯†ã€‚\n<a name=hJtZQ></a></p>\n<h1>æ€è€ƒ ğŸ¤”</h1>\n<p>æ—¢ç„¶ç›´æ¥ echo ä¸å·¥ä½œï¼Œå°±æƒ³åˆ°å°†å®ƒä»¬ base64 ä¹‹åè¾“å‡ºï¼š echo xxx | base64ï¼Œä½†æ˜¯è¿™æ ·ï¼Œåˆä¸å®‰å…¨ï¼Œå› ä¸ºä¸€æ—¦ä»“åº“å…¬å¼€ï¼Œå°±ä¼šæ³„å¯†ã€‚æ¯•ç«Ÿä»»ä½•äººçœ‹åˆ°äº† base64 çš„è¾“å‡ºï¼Œéƒ½èƒ½è§£ç æŸ¥çœ‹æ˜æ–‡ã€‚æœ‰æ²¡æœ‰åŠæ³•æ—¢èƒ½ç»•è¿‡ GitHub Action çš„æ‰“ç æœºåˆ¶ï¼Œåˆèƒ½ä¿è¯å®‰å…¨å‘¢ï¼Ÿ</p>\n<p>base64 åªæ˜¯ç¼–ç ï¼Œè¦ä¿è¯å†…å®¹å®‰å…¨ï¼Œè¿˜éœ€è¦åŠ å¯†æ‰è¡Œã€‚ä½¿ç”¨ä¸€ä¸ªå¯†é’¥ï¼Œå°†ç§˜å¯†å€¼è¾“å‡ºä¸ºå¯†æ–‡ï¼Œè€Œåªæœ‰æˆ‘æœ‰å¯†é’¥ï¼Œåœ¨æœ¬åœ°è§£å¯†æŸ¥çœ‹ç§˜å¯†å€¼å³å¯ã€‚</p>\n<p><a name=XcloQ></a></p>\n<h1>å¦‚ä½•åŠ å¯†ï¼Ÿ</h1>\n<p>æ€æ ·ä½¿ç”¨å‘½ä»¤è¡ŒåŠ å¯†å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ openssl è¿™ä¸ªå‘½ä»¤ã€‚åœ¨è¾“å‡ºç§˜å¯†å‰ï¼Œç”¨å®ƒåŠ å¯†ï¼›åœ¨æœ¬åœ°ï¼Œç”¨å®ƒè§£å¯†ã€‚æ³¨æ„ï¼Œopenssl åœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œè¡¨ç°ä¸ä¸€æ ·ï¼Œå¦‚æœåœ¨ GitHub Actions ä¸Šæ˜¯ä½¿ç”¨ Ubuntu è¿›è¡Œ openssl åŠ å¯†çš„è¯ï¼Œåœ¨æœ¬åœ°è§£å¯†æ—¶ä¹Ÿéœ€è¦ç”¨ Ubuntu æ¥è¿è¡Œ opensslï¼Œæ²¡æœ‰ Ubuntu æœºå™¨ï¼Œå¯ä»¥ä½¿ç”¨ docker ä¸‹è½½ä¸€ä¸ªã€‚</p>\n<p><a name=QY6La></a></p>\n<h2>åŠ å¯†å‘½ä»¤</h2>\n<p>ä»¥ä¸Šé¢çš„ TARGET_URL ä¸ºä¾‹ï¼š\nshell\necho ${TARGET_URL} | openssl enc -e -aes-256-cbc -a -pbkdf2 -iter ${MY_OPENSSL_ITER} -k ${MY_OPENSSL_PASSWORD}</p>\n<p>æ³¨æ„ï¼Œè¿™é‡Œåœ¨åŠ å¯†æ—¶ä½¿ç”¨äº†é¢å¤–çš„ä¸¤ä¸ªå‚æ•°ï¼š MY_OPENSSL_ITER å’Œ MY_OPENSSL_PASSWORDã€‚åè€…æ˜¯å¯†é’¥ï¼Œå¯ä»¥å­˜æ”¾åœ¨ GitHub Actions çš„ SECRETS é‡Œï¼Œåœ¨æ‰§è¡Œæ—¶å°†å®ƒæ³¨å…¥ç¯å¢ƒå˜é‡ï¼›å‰è€…æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¶Šå¤§åˆ™è®©æš´åŠ›ç¢°è§£çš„éš¾åº¦è¶Šå¤§ï¼Œæ³¨æ„è¿™ä¸ªå˜é‡å»ºè®®â€œä¸è¦â€å­˜æ”¾åœ¨ SECRETS é‡Œï¼Œæ¯”å¦‚è¿™ä¸ªå€¼å¦‚æœä¸º 5ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ä»¥ä¸Šå‘½ä»¤çš„è¾“å‡ºä¸­ï¼Œä»»ä½•çš„ 5 è¿™ä¸ªæ–‡æœ¬éƒ½ä¼šè¢«æ›¿æ¢æˆ ***ï¼Œä¸‰ä¸ªæ˜Ÿå·ï¼Œå¸¦æ¥ä¸å¿…è¦çš„éº»çƒ¦ã€‚</p>\n<p>æ¯”å¦‚ä½¿ç”¨äº† upload.sh æ¥æ‰§è¡Œå¯¹ä¼ä¸šå¾®ä¿¡ API çš„è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ä¸€æ­¥çš„ GitHub Actions yml å†…å®¹å¦‚ä¸‹ï¼š</p>\n<p>yaml\n...\n- name: send to wechat\nif: ${{ always() }}\nenv:\nMY_OPENSSL_ITER: 5\nMY_OPENSSL_PASSWORD: ${{ secrets.MY_OPENSSL_PASSWORD }}\nTARGET_URL: ${{ secrets.TARGET_URL }}\nFILE_UPLOAD_URL: ${{ secrets.FILE_UPLOAD_URL }}\nSECRET_KEY: ${{ secrets.SECRET_KEY }}\nINPUT_ARGS: *.pdf\nrun: |\nsh ./tools/upload.sh</p>\n<p>è¿™æ ·æ”¹é€ åï¼Œæ‰§è¡Œåçš„ GitHub Actions æ—¥å¿—è¾“å‡ºå¦‚ä¸‹ï¼š</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1660905539867-78872c5f-3c52-413c-ac53-e79d53509081.png#clientId=ub83de44d-07b6-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=686&#x26;id=u8543a604&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1372&#x26;originWidth=2338&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=408958&#x26;status=done&#x26;style=none&#x26;taskId=ud745a81f-ac3b-4e3c-ae2a-a80d36aab09&#x26;title=&#x26;width=1169\" alt=\"image.png\"></p>\n<p><a name=apz5D></a></p>\n<h1>å¦‚ä½•è§£å¯†ï¼Ÿ</h1>\n<p><a name=FiolC></a></p>\n<h2>è§£å¯†å‘½ä»¤</h2>\n<p>shell\necho ENCRYPTED_TEXT | openssl base64 -d | openssl enc -d -pbkdf2 -iter $MY_OPENSSL_ITER -aes-256-cbc -k $MY_OPENSSL_PASSWORD</p>\n<p>æ­£å¦‚ä¹‹å‰æ‰€è¯´çš„ï¼Œå¦‚æœ GitHub Actions è¿è¡Œæ—¶çš„é•œåƒæ˜¯ Ubuntuï¼Œåˆ™ä»¥ä¸Šè§£å¯†å‘½ä»¤ä¹Ÿå¾—åœ¨ Ubuntu ä¸Šè¿è¡Œã€‚å¦‚æœæœ¬åœ°ç”µè„‘æ˜¯ Macï¼Œç›´æ¥è¿è¡Œä¼šæŠ¥é”™ã€‚å¯ä»¥è¿è¡Œä¸€ä¸ª docker é•œåƒï¼Œè¿›è¡Œé•œåƒåˆ†åˆ«æ‰§è¡Œä»¥ä¸Šå‘½ä»¤ï¼Œä¾¿ä¾æ¬¡è§£å¯†äº† GitHub Actions ä¸­çš„ SECRETSï¼Œå¦‚ä¸‹æˆªå›¾æ‰€ç¤ºï¼š</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/221736/1660905990310-92db1e12-8c56-46e0-8b1a-f73933c63cd6.png#clientId=ub83de44d-07b6-4&#x26;crop=0&#x26;crop=0&#x26;crop=1&#x26;crop=1&#x26;from=paste&#x26;height=481&#x26;id=u7cd5329e&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=962&#x26;originWidth=2964&#x26;originalType=binary%E2%88%B6=1&#x26;rotation=0&#x26;showTitle=false&#x26;size=396268&#x26;status=done&#x26;style=none&#x26;taskId=ud74e92f8-f08d-488e-a062-da3c362d7e9&#x26;title=&#x26;width=1482\" alt=\"image.png\"></p>\n<p>ç°åœ¨ï¼Œå°±å¯ä»¥æ„‰å¿«åœ°æ‹·è´è¿™äº›å€¼ï¼Œé…ç½®åˆ°å…¶ä»–éœ€è¦é‡ç”¨å®ƒä»¬çš„åœ°æ–¹äº†ã€‚\n<a name=alSol></a></p>\n<h1>openssl çš„å…¶ä»–ç”¨é€”</h1>\n<p>åœ¨ç”¨ openssl è§£å†³äº†è¿™ä¸ªé—®é¢˜åï¼Œæƒ³èµ·æ¥å¦ä¸€ä¸ªç”¨æ³•ï¼Œå°±æ˜¯ç”¨æ¥ç”Ÿæˆå“ˆå¸Œå€¼ã€‚ä¹‹å‰æœ‰äººåœ¨ StackOverflow é—®å¦‚ä½•ç”¨ python è®¡ç®—å“ˆå¸Œå€¼ï¼Œæˆ‘ç”±äºå…´è¶£åŸå› ï¼Œä¸ä»…ç»™ä»–æä¾›äº† python è„šæœ¬ï¼Œè¿˜æä¾›äº†å¯¹åº”çš„ nodejs å’Œ shell è„šæœ¬ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€è¡Œè„šæœ¬ï¼Œéå¸¸å®ç”¨ã€‚å…¶ä¸­çš„ shell è„šæœ¬ä¹Ÿæ˜¯ç”¨äº† opensslï¼š<br /><a href=\"https://stackoverflow.com/questions/9594125/salt-and-hash-a-password-in-python/71422369#71422369\">https://stackoverflow.com/questions/9594125/salt-and-hash-a-password-in-python/71422369#71422369</a></p>\n<p>æ¯”å¦‚æƒ³å°† password ç”Ÿæˆä¸€ä¸ªå“ˆå¸Œåçš„å€¼ï¼Œå¹¶ç»™è¿™ä¸²å“ˆå¸Œå€¼åŠ ä¸Šç›å€¼ saltï¼Œå¯¹åº”çš„ shell è„šæœ¬éå¸¸ç®€å•ï¼ˆä½¿ç”¨äº† opensslï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥åœ¨ Mac ä¸Šè¿è¡Œã€‚ï¼‰ï¼š</p>\n<p>shell\necho -n password | openssl sha256 -hmac salt</p>\n<p>è€Œå¦‚æœå®‰è£…äº† nodejsï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥è¿™æ ·æ‰§è¡Œï¼š\nshell\necho console.log(require(crypto).createHmac(sha256, salt).update(password).digest(hex)) | node</p>\n<p>å¦‚æœå®‰è£…äº† pythonï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ python ç”Ÿæˆï¼š</p>\n<p>shell\npython3 -c import hashlib;import base64;import hmac;print(hmac.new(bsalt, password.encode(), hashlib.sha256).hexdigest())</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","description":"A wild full stack developer","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"å…³äº","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"å½å½æ­ªæ­ª","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"çŸ¥ä¹","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"Made with Stackbit.","url":"https://www.stackbit.com","style":"link","new_window":true,"type":"action"},{"label":"ç´«ç«¹å½æ­ª","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[]}