{"componentChunkName":"component---src-templates-post-js","path":"/posts/gx48bf","result":{"data":{"sitePage":null},"pageContext":{"url":"posts/gx48bf","relativePath":"posts/gx48bf","frontmatter":{"title":"åç«¯å·¥ç¨‹åœ£æ®¿å½¢è±¡çš„å´©å¡Œä»¥åŠé‡å»º","stackbit_url_path":"posts/gx48bf","date":"2021-05-31T12:39:17","excerpt":"","tags":[],"categories":[],"template":"post"},"html":"<p>ä½œä¸ºä¸€ä¸ªå‰ç«¯ï¼Œä¼¼ä¹ä¸€ç›´æœ‰ç‚¹æŠ¬ä¸èµ·å¤´ã€‚æ€»æ˜¯åœ¨åœˆå­é‡Œè¢«é„™è§†ï¼Œä»€ä¹ˆï¼šå‰ç«¯ä¹Ÿæ˜¯ç¨‹åºå‘˜ï¼Ÿä»€ä¹ˆï¼šJavaScript å·¥ç¨‹å¤ªä¹±ç­‰ç­‰ç­‰ç­‰ã€‚æˆ‘ä¸€ç›´å¯¹åç«¯å·¥ç¨‹å¿ƒå­˜æ•¬ç•ï¼Œæ€»ä¹‹åç«¯åœ¨æˆ‘çœ¼ä¸­ä¸€ç›´æ˜¯é«˜å¤§ä¸Šçš„å½¢è±¡ï¼Œä½†æ˜¯æœ€è¿‘æˆ‘è¿‘è·ç¦»æ·±å…¥æ¥è§¦äº†æŸå…¬å¸çš„åç«¯ Java å·¥ç¨‹ï¼Œä¸‰è§‚å½»åº•è¢«æ¯äº†ï¼šä¸€ç›´é„™è§†æˆ‘ä»¬å‰ç«¯çš„åç«¯å·¥ç¨‹å¸ˆä»¬ï¼Œæ­å‡ºæ¥çš„åç«¯å·¥ç¨‹å°±è¿™ï¼Ÿå¿ƒä¸­ä¸€ä¸‡åŒ¹é©¬å¥”è…¾è€Œè¿‡ã€‚åœ¨æˆ‘åŸæ¥çš„è§‚å¿µé‡Œï¼Œ<strong>åç«¯å·¥ç¨‹ä¸€ç›´å°±åƒæ˜¯åœ£æ®¿èˆ¬çš„å­˜åœ¨ï¼Œå¦‚ä»ŠçœŸæ­£ä¸€çœ‹ï¼Œå´å¦‚åŒåºŸå¢Ÿã€‚</strong></p>\n<p>è‡ªå·±ä¸€ç›´æƒ³å¾€å…¨æ ˆæ–¹å‘å‘å±•ï¼Œäºæ˜¯å†³å®šåœ¨åºŸå¢Ÿä¸­é‡å»ºï¼Œè™½ç„¶ä¸èƒ½ç«‹å³è¾¾åˆ°åœ£æ®¿çš„çº§åˆ«ï¼Œä½†æ˜¯åŠ›æ±‚è¾¾åˆ°å¸¸è§çš„å‰ç«¯å·¥ç¨‹æ°´å‡†ã€‚</p>\n<p><a name=dSVNE></a></p>\n<h2>ç¼˜èµ·</h2>\n<p>åç«¯æ¥å£ä¸€ç›´è°ƒä¸é€šï¼Œåç«¯åŒå­¦æ€»æ˜¯è¯´ä»–é‚£é‡Œæ˜¯å¥½çš„ã€‚æˆ‘è¯´å¼€å‘ç¯å¢ƒè°ƒä¸é€šï¼Œä»–å‘æ¥ä¸€å † SQL ç»™æˆ‘ï¼šä½ å¾—åœ¨æœ¬åœ°ç¯å¢ƒå»ºæ•°æ®å‘€ã€‚ä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œæˆ‘å¹²è„†åœ¨æœ¬åœ°å…‹éš†äº†åç«¯å·¥ç¨‹ï¼Œå¼€å§‹è¿‘è·ç¦»æ¥è§¦ã€‚ä¸€çœ‹ï¼Œä¸‰è§‚å°½æ¯ï¼š</p>\n<p><a name=otbN7></a></p>\n<h2>é¡¹ç›®ä¸èƒ½åœ¨æœ¬åœ°ä¸€é”®å¯åŠ¨</h2>\n<p>æˆ‘æ¥è§¦è¿‡çš„æ‰€æœ‰å‰ç«¯é¡¹ç›®ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ª READMEï¼Œå†™æ¸…æ¥šå¦‚ä½•æœ¬åœ°è¿è¡Œï¼Œå°½ç®¡éƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œå°½ç®¡å¾ˆç®€å•ï¼Œä½†éƒ½ä¼šæ³¨æ˜ã€‚ä¸€èˆ¬éƒ½ä¼šæ”¯æŒ yarn dev æˆ–è€… yarn start ç­‰ç­‰ä¸€é”®è¿è¡Œå‘½ä»¤ã€‚ä½†æ˜¯æˆ‘æ‰“å¼€çš„ java å·¥ç¨‹ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚å½“ç„¶ï¼Œèƒ½çœ‹å‡ºæ˜¯åŸºäº SpringBoot çš„ä¸€ä¸ª maven å·¥ç¨‹ï¼Œäºæ˜¯ Googl äº†ä¸€ä¸‹ maven å·¥ç¨‹çš„å¯åŠ¨æ–¹å¼ï¼Œè¯•äº†ä¸€ä¸‹ mvn bootRun æœç„¶æ˜¯å„ç§æŠ¥é”™ã€‚</p>\n<p><a name=OYMB4></a></p>\n<h3>é‡å»ºæ–¹æ¡ˆ</h3>\n<p>äºæ˜¯æˆ‘é€šè¿‡å„ç§é”™è¯¯æç¤ºï¼Œäº†è§£åˆ°äº†é¡¹ç›®çš„ä¾èµ–ï¼šmysqlã€redis ç­‰ç­‰ï¼Œå°±è¡¥å……äº†ä¸€ä¸ª docker-compose.yaml æ–‡ä»¶ï¼Œåœ¨æ‰§è¡Œ mvn bootRun ä¹‹å‰ï¼Œdocker-compose up -d ä¸€ä¸‹ï¼Œå¯åŠ¨ç›¸å…³çš„ä¾èµ–é¡¹ã€‚å½“ç„¶æ²¡æœ‰é‚£ä¹ˆé¡ºåˆ©ï¼Œä»ç„¶æœ‰å¾ˆå¤šé”™è¯¯ï¼Œè¯¦ç»†çš„å°±ä¸è¯´äº†ï¼Œå¿ƒé‡Œçªç«ã€‚æœ€åçš„è§£å†³åŠæ³•ï¼š</p>\n<ul>\n<li><strong>å†™ä¸€ä¸ªåˆå§‹æ•°æ®åº“çš„è„šæœ¬ï¼Œå¹¶é…ç½®åœ¨ <strong><strong>docker-compose.yaml</strong></strong> æ–‡ä»¶ä¸­ï¼Œä½¿å¾—åœ¨ <strong><strong>docker-compose up -d</strong></strong> æ—¶è‡ªåŠ¨åˆ›å»ºå¥½éœ€è¦çš„æ•°æ®åº“<br />init.sql</strong></li>\n</ul>\n<p>sql\nCREATE DATABASE IF NOT EXISTS dbname;\nUSE dbname;</p>\n<p><strong>docker-compose.yaml</strong>\nyaml\nversion: 3.3\nservices:\nadminer:\nimage: adminer:4.8.0\nrestart: always\nports:\n- 7777:8080\ndb:\nimage: mysql:5.7\nrestart: always\nenvironment:\nMYSQL_DATABASE: dbname\nMYSQL_USER: root\nMYSQL_ROOT_PASSWORD: password\nports:\n- 3306:3306\ncommand: --init-file /data/application/init.sql\nexpose:\n- 3306\nvolumes:\n- my-db:/var/lib/mysql\n- ./init.sql:/data/application/init.sql\nredis:\nimage: redis\ncommand: redis-server --requirepass 123456\nrestart: always\nports:\n- 6379:6379</p>\n<h1>Names our volume</h1>\n<p>volumes:\nmy-db:</p>\n<ul>\n<li><strong>æ–°å»ºä¸€ä¸ª local profile æ–‡ä»¶ï¼Œå¹¶é…ç½®å¥½ç›¸å…³çš„æœ¬åœ°ç¯å¢ƒå˜é‡</strong>\n<ul>\n<li>å¯¹äºæœ¬åœ°æ•°æ®åº“è¿æ¥é…ç½®ï¼Œæ–°å»ºsrc/main/resources/db/datasource-local.ymlæ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š</li>\n</ul>\n</li>\n</ul>\n<p>yaml\nspring:\ndatasource:\ndriver-class-name: com.mysql.cj.jdbc.Driver\nhikari:\nmax-lifetime: 1800000\nmaximum-pool-size: 10\ntype: com.zaxxer.hikari.HikariDataSource\nurl: jdbc:mysql://localhost:3306/dbname?useUnicode=true&#x26;rewriteBatchedStatements=true&#x26;autoReconnect=true&#x26;failOverReadOnly=false&#x26;characterEncoding=UTF-8&#x26;useSSL=false&#x26;allowPublicKeyRetrieval=true&#x26;serverTimezone=Asia/Shanghai\nusername: root\npassword: password</p>\n<ul>\n<li>å¯¹äºæœ¬åœ° Redis é…ç½®ï¼Œæ–°å»º src/main/resources/redis/redis-local.yml æ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š</li>\n</ul>\n<p>yaml\nspring:\nredis:\nhost: localhost\nlettuce:\npool:\nmax-active: 100\nmax-idle: 100\nmax-wait: 6000\nmin-idle: 50\nlock:\nhost: localhost\npassword: 123456\nport: 6379\npassword: 123456\nport: 6379\ntimeout: 5000</p>\n<ul>\n<li>åœ¨ pom.xml é‡Œæ–°å¢ä¸€ä¸ª local profileï¼š</li>\n</ul>\n<p>xml\n...\n<profiles>\n<profile>\n<id>local</id>\n<properties>\n&#x3C;package.environment>local&#x3C;/package.environment>\n</properties>\n<activation>\n<activeByDefault>true</activeByDefault>\n</activation>\n</profile>\n...\n</profiles>\n...</p>\n<ul>\n<li>å¢åŠ  application-local.properties æ–‡ä»¶ï¼š</li>\n</ul>\n<p>xml\nenv=local\nserver.port=8080\nserver.http2.enabled=true</p>\n<ul>\n<li><strong>æ–°å»ºä¸€ä¸ª start.sh æ–‡ä»¶ï¼Œæ— éå°±æ˜¯å¯åŠ¨ç›¸å…³ä¾èµ–ï¼Œå†åˆ©ç”¨ <strong><strong>mvn bootRun</strong></strong> å¯åŠ¨é¡¹ç›®ã€‚æ€»ä¹‹å°è£…æˆä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œæ–¹ä¾¿åç»­æœ¬åœ°ä¸€é”®å¯åŠ¨é¡¹ç›®ã€‚</strong></li>\n</ul>\n<p>shell\nmvn clean install\ndocker-compose up -d\nmvn bootRun</p>\n<p><a name=iLAx9></a></p>\n<h2>å®Œå…¨æ²¡æœ‰ä»»ä½•æµ‹è¯•ä»£ç </h2>\n<p>è¿™çœŸæ˜¯æ—¥äº†ç‹—äº†ã€‚</p>\n<p>æˆ‘æ‰€è§è¿‡çš„å‰ç«¯å·¥ç¨‹ï¼Œæµ‹è¯•å æ¯”å¹¶ä¸å¤šï¼Œç”±äºå‰ç«¯ UI æµ‹è¯•ä»£ä»·æ¯”è¾ƒå¤§ï¼Œå˜åŒ–å¤šï¼Œæ‰€ä»¥å¾ˆå°‘ä¼šå»å†™è¯¦ç»†çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä½†æ˜¯ä¼šåšå¥½ file watchï¼Œä¸€æ—¦ä»£ç å˜åŒ–ï¼Œç•Œé¢ä¹Ÿéšä¹‹æ›´æ–°ï¼Œæ‰€ä»¥ä¹Ÿè¿˜å¥½ã€‚ä½†æ˜¯å¯¹äºå…¬å…±é€»è¾‘ï¼Œæˆ–è€…é‡è¦çš„ç»„ä»¶ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸€ä¸ªå®ç°æ–‡ä»¶å¯¹åº”ç€ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶ç”¨æ¥å¹²ä»€ä¹ˆï¼Œåªè¦çœ‹ä¸‹å¯¹åº”çš„æµ‹è¯•æ–‡ä»¶å°±ä¸€ç›®äº†ç„¶ï¼š<br /><img src=\"https://cdn.nlark.com/yuque/0/2021/png/221736/1622355446000-5eae8033-c041-4f6e-88f4-2f5af0b512ea.png#clientId=u8d7fa753-272e-4&#x26;from=paste&#x26;height=248&#x26;id=u4e0a0f95&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=465&#x26;originWidth=815&#x26;originalType=binary&#x26;size=43855&#x26;status=done&#x26;style=none&#x26;taskId=u10f26eb2-5a99-457b-924d-3f3e99dc526&#x26;width=434.66668701171875\" alt=\"image.png\"><br />ä½†æ˜¯æˆ‘æ‰“å¼€çš„ java å·¥ç¨‹ï¼Œçœ‹ä¼¼å¾ˆä¸“ä¸šï¼Œåˆ†å±‚åˆ†å¾—å¾ˆç»†ï¼Œéµç…§äº†ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹çš„å±‚æ¬¡ç»“æ„ï¼š<img src=\"https://cdn.nlark.com/yuque/0/2021/png/221736/1622355968608-bb1ef753-8d79-4305-9dcc-07b4c5bc40fe.png#clientId=u8d7fa753-272e-4&#x26;from=paste&#x26;height=873&#x26;id=ua4186f0b&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=2620&#x26;originWidth=2970&#x26;originalType=binary&#x26;size=541444&#x26;status=done&#x26;style=none&#x26;taskId=ua2bd916b-7dac-428c-bf19-f678ea3ed07&#x26;width=990\" alt=\"image.png\"><br /><img src=\"https://cdn.nlark.com/yuque/0/2021/png/221736/1622356121139-ad443f97-c81b-475d-9194-cd727b61ae89.png#clientId=u8d7fa753-272e-4&#x26;from=paste&#x26;height=322&#x26;id=ub9ac226d&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=656&#x26;originWidth=1007&#x26;originalType=binary&#x26;size=98138&#x26;status=done&#x26;style=none&#x26;taskId=u6c8fa508-b761-4859-95b9-e21d1c7c8de&#x26;width=493.66668701171875\" alt=\"image.png\"><br />ä½†æ˜¯ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹ä¸­å¼•å…¥è¿™ä¸ªåˆ†å±‚æ¶æ„æ˜¯ä¸ºäº†æ–¹ä¾¿è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¹¶ä¸”è®©ç¨‹åºæœ¬èº«æ›´åŠ ç®€å•æ˜äº†ã€‚æ˜¾ç„¶è¿™ä¸ªé¡¹ç›®å·¥ç¨‹ï¼Œåªæ˜¯ç”Ÿç¡¬ç…§æ¬äº†åˆ†å±‚ç»“æ„ï¼Œå¹¶æ²¡æœ‰å®ç°ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹ä¸­å¼•å…¥è¿™ä¸ªç»“æ„çš„ç›®çš„ã€‚</p>\n<p><a name=UZ9Xa></a></p>\n<h3>éƒ¨åˆ†é‡å»ºæ–¹æ¡ˆ</h3>\n<p>å¯¹äºæ–°åŠ çš„ä»£ç ï¼Œå¿…é¡»æ·»åŠ æµ‹è¯•ã€‚è¿™å¯¹æˆ‘æ¥è¯´å¾ˆè‰°éš¾ï¼Œä¸å¤ªä¼šç”¨ java å†™æµ‹è¯•ï¼Œä½†æœ€ç»ˆæŠŠæµ‹è¯•åŠ å…¥äº†ï¼Œæ¯æ¬¡æŠŠæ”¹åŠ¨æ¨åˆ°è¿œç¨‹ä»“åº“å‰ï¼Œä¼šè‡ªåŠ¨è¿è¡Œé¡¹ç›®ä¸­çš„æµ‹è¯•ã€‚å¯¹äºè¿™ä¸ªæˆ‘è¿˜æ²¡æœ‰å½¢æˆä¸€ä¸ªé€šç”¨çš„æ–¹æ¡ˆï¼Œåªèƒ½è®°å½•ä¸€äº›é›¶ç¢çš„æ–°å¾—ã€‚</p>\n<p><strong>@MockBean å¯ä»¥è§£å†³æµ‹è¯•å®ä¾‹çš„æ›¿æ¢</strong><br />å¯¹äºä¸€äº›ä¾èµ–ï¼Œåœ¨è¿è¡Œæµ‹è¯•æ—¶éœ€è¦æ§åˆ¶ä½ï¼Œè¿™æ—¶å€™å¯ä»¥é‡‡ç”¨ @MockBean å°†å®é™…ä¾èµ–æ›¿æ¢æˆä¸€ä¸ªå‡çš„å¯¹è±¡å®ä¾‹ã€‚å‰ææ˜¯å®ç°ä»£ç åšåˆ°äº†ä¾èµ–ä¸€ä¸ªæŠ½è±¡ï¼Œè€Œä¸æ˜¯å…·ä½“çš„å®ä¾‹ã€‚</p>\n<p><strong>å¯¹äºæ²¡æœ‰ä¾èµ–æ¥å£ï¼Œè€Œæ˜¯ä¾èµ–ç‰¹å®šå®ä¾‹å®ç°çš„ä»£ç ï¼Œå¯ä»¥å¢åŠ ä¸€äº› setter ä»¥æ–¹ä¾¿æµ‹è¯•</strong><br />æ¯”å¦‚è¿™æ ·çš„ä»£ç ï¼š<br /><img src=\"https://cdn.nlark.com/yuque/0/2021/png/221736/1622356992948-d3be2176-5030-4b95-814b-b4fd63f709fc.png#clientId=u8d7fa753-272e-4&#x26;from=paste&#x26;height=298&#x26;id=uc006b883&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=298&#x26;originWidth=508&#x26;originalType=binary&#x26;size=117006&#x26;status=done&#x26;style=none&#x26;taskId=u24d7f28b-13ea-4312-81fc-057dc21c97d&#x26;width=508\" alt=\"image.png\"><br />æ˜¾ç„¶å®ƒå¯¹ HttpClient çš„ä¾èµ–æ²¡æœ‰ä½¿ç”¨ä¾èµ–æ³¨å…¥ã€‚åº”è¯¥æœ‰åŠæ³•æ”¹é€ ä¸€ä¸‹ï¼Œä½†æˆ‘è¿˜ä¸ä¼šï¼Œäºæ˜¯ç»™è¿™ä¸ªç±»å¢åŠ äº†ä¸€ä¸ª setter æ–¹æ³•ï¼š\njava\npublic void setHttpClient(HttpClient client) {\nthis.httpClient = client;\n}</p>\n<p>ç„¶ååœ¨æµ‹è¯•ä»£ç ä¸­ï¼Œé€šè¿‡ @BeforeEach å¯¹å…¶å†…éƒ¨ httpClient è¿›è¡Œæ›¿æ¢ï¼š\njava\n@BeforeEach\nvoid initialize() {\nmpService.setHttpClient(new MockHttpClient());\n}</p>\n<p>å½“ç„¶ï¼Œè¿˜å¯ä»¥åœ¨æµ‹è¯•ä¸­ä¸æ›´æ”¹ HttpClientï¼Œè€Œæ˜¯æ›´æ”¹å¯¹åº”çš„ HttpClient è¦è°ƒç”¨çš„è¿œç¨‹ç«¯ç‚¹ï¼Œä½¿ç”¨ MockServer çš„æ–¹å¼ï¼Œé˜²æ­¢åœ¨æµ‹è¯•ä¸­è°ƒç”¨çœŸæ­£çš„è¿œç¨‹ç«¯ç‚¹ã€‚\njava\n@RunWith(SpringRunner.class)\n@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.None)\npublic class XXXTest {\npublic static MockWebServer mockBackEnd;</p>\n<pre><code>@BeforeAll\nstatic void setUp() throws IOException {\n    mockBackEnd = new MockWebServer();\n    mockBackEnd.start();\n}\n\n@AfterAll\nstatic void tearDown() throws IOException {\n    mockBackEnd.shutdown();\n}\n\n@BeforeEach\nvoid initialize() {\n    String baseUrl = String.format(http://localhost:%s,\n            mockBackEnd.getPort());\n\n    mpService.setQrCodeCreateUrl(baseUrl + /test);\n}\n\n@Autowired\nprivate MpService mpService;\n\n@Test\nvoid XXXTest() {\n    MockResponse mockResponse = new MockResponse();\n    mockResponse.setBody({ticket:gQH47joAAAAAAAAAASxodHRwOi8vd2VpeGluLnFxLmNvbS9xL2taZ2Z3TVRtNzJXV1Brb3ZhYmJJAAIEZ23sUwMEmmn +\n            3sUw==,expire_seconds:60,url:http://weixin.qq.com/q/kZgfwMTm72WWPkovabbI});\n    mockResponse.addHeader(Content-Type, application/json);\n\n    mockBackEnd.enqueue(mockResponse);\n    ...\n    assertThat(...);\n}\n</code></pre>\n<p><strong>æ€»ä¹‹ï¼Œä¸è¦è®©æµ‹è¯•äº§ç”ŸçœŸæ­£çš„è¿œç¨‹è°ƒç”¨ï¼Œè¦ä¹ˆ mock è‡ªå·±ä½¿ç”¨çš„ HttpClientï¼Œå¯¹ sendRequest æ–¹æ³•è¿›è¡Œæ‰“æ¡©ï¼›è¦ä¹ˆ mock è¿™ä¸ªè¿œç¨‹ serverï¼Œå›ºå®šè¿”å›æœŸå¾…çš„ Responseã€‚</strong></p>\n<p><a name=GXnRN></a></p>\n<h2>è®¾è®¡ç‘•ç–µ</h2>\n<p>åç«¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ—¥æœŸå­—æ®µç±»å‹ï¼Œå…¨éƒ¨è®¾ç½®æˆä¸ºäº† Long å‹ï¼Œå­˜å‚¨ä¸€ä¸ªæ—¶é—´çš„ç§’æ•°ã€‚è¿™ä¸ªè®©æˆ‘éå¸¸ä¸è§£ï¼Œé—®ä¸‹æ¥çš„åŸå› æ˜¯æ—¶é—´çš„æ—¶åŒºä¼šå¸¦æ¥é—®é¢˜â€¦â€¦</p>\n<p>æˆ‘æƒ³ä¸å‡ºæ—¥æœŸæ—¶é—´æ ¼å¼ä¼šå¸¦æ¥ä»€ä¹ˆæ—¶åŒºé—®é¢˜ï¼Œå°±ç®—æœ‰ï¼Œé‡‡ç”¨ UTC æ—¶é—´ä¼šæ€æ ·å‘¢ï¼Ÿæ€»ä¹‹ç›®å‰çš„è®¾è®¡ï¼Œå¯¼è‡´ç¼–ç ä¸ä¾¿ï¼Œæ•°æ®åº“æŸ¥è¯¢ä¸ä¾¿ï¼Œä»¥åŠé€ æµ‹è¯•æ•°æ®æ—¶éå¸¸ä¸æ–¹ä¾¿ï¼ˆæ¯”å¦‚ Adminer ç•Œé¢ä¸ä¼šå¼¹å‡ºæ—¥æœŸæ—¶é—´é€‰æ‹©æ¡†ï¼Œè€Œæ˜¯ä¸€ä¸ªæ•°å­—è¾“å…¥æ¡†â€¦â€¦ï¼‰ã€‚</p>\n<p>æ›´åŠ è®½åˆºçš„æ˜¯ï¼Œè¿™ä¸ªè®¾è®¡å·ç§°èƒ½é¿å…æ—¶åŒºé—®é¢˜ï¼Œç»“æœååå¸¦æ¥äº†ä¸åº”è¯¥æœ‰çš„æ—¶åŒºé—®é¢˜ï¼šæ¯”å¦‚ï¼Œæˆ‘åœ¨è°ƒç”¨åç«¯æ¥å£åˆ›å»ºæŸäº›èµ„æºæ—¶ï¼Œç”±äºä¸šåŠ¡é€»è¾‘é™åˆ¶å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´å¿…é¡»åœ¨åŒä¸€å¤©ï¼Œæˆ‘çš„å‰ç«¯æ˜æ˜ä¼ äº†åŒä¸€å¤©çš„æ—¶é—´ç»™åˆ°åç«¯ï¼Œä½†åç«¯å°±æ˜¯ä¸€ç›´æŠ¥å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ä¸åœ¨åŒä¸€å¤©çš„é”™è¯¯ï¼<br /><img src=\"https://cdn.nlark.com/yuque/0/2021/png/221736/1622357986780-0d090bf0-c2fd-4589-b79a-bc9309e88163.png#clientId=u8d7fa753-272e-4&#x26;from=paste&#x26;height=467&#x26;id=u5ab044be&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=467&#x26;originWidth=546&#x26;originalType=binary&#x26;size=31620&#x26;status=done&#x26;style=none&#x26;taskId=ue59dc185-cc52-427d-bfce-3d9beaf88df&#x26;width=546\" alt=\"image.png\"><br />æœ€åæŸ¥çœ‹åç«¯ä»£ç ï¼Œæ˜¯è¿™æ ·å†™çš„ï¼š\njava\nLocalDate eventStartDate = eventStartTime == null ? null : Instant.ofEpochSecond(eventStartTime).atZone(ZoneId.systemDefault()).toLocalDate();\nLocalDate eventEndDate = eventEndTime == null ? null : Instant.ofEpochSecond(eventEndTime).atZone(ZoneId.systemDefault()).toLocalDate();</p>\n<p>æ˜¾ç„¶å½“å‰çš„ BUG è¯æ˜äº†ç³»ç»Ÿçš„é»˜è®¤æ—¶åŒºå’Œç”¨æˆ·çœŸæ­£ä½¿ç”¨çš„æ—¶åŒºå¹¶ä¸ç›¸åŒã€‚ä¸ºä»€ä¹ˆæˆ‘å€¾å‘äºç›´æ¥é‡‡ç”¨æ—¥æœŸæ—¶é—´ç±»å‹ï¼Œæ˜¯å› ä¸ºæ—¥æœŸæ—¶é—´ç±»å‹åœ¨åºåˆ—åŒ–æ—¶å¯ä»¥å¸¦ä¸Šæ—¶åŒºä¿¡æ¯ï¼Œæ¯”å¦‚ 2021-05-31 00:00:00+8 ä»£è¡¨äº†åœ¨ä¸œå…«åŒºä¸‹ 5 æœˆ 31 æ—¥çš„æœ€å¼€å§‹æ—¶åˆ»ï¼Œä½†æ˜¯å®ƒåœ¨ UTC æ—¶é—´ä¸‹ï¼Œå°±æ˜¯ 5 æœˆ 30 æ—¥ã€‚</p>\n<p><a name=V2J7h></a></p>\n<h3>æš‚æ—¶çš„è§£å†³æ–¹æ¡ˆ</h3>\n<p>ç”±äºç›´æ¥å°†æ•´ä¸ªç³»ç»Ÿçš„æ—¶é—´è®¾è®¡ä»é•¿æ•´å‹æ”¹æˆæ—¥æœŸæ—¶é—´å‹ï¼Œå·¥ä½œé‡è¾ƒå¤§ï¼Œæˆ‘åªèƒ½å…ˆä¿®å¤äº†è¿™ä¸ªé—®é¢˜ã€‚ä¿®å¤å¯ä»¥é€šè¿‡æŠŠæœåŠ¡å™¨çš„æ—¶åŒºè®¾ç½®æ”¹æˆå’Œç”¨æˆ·çš„æ—¶åŒºï¼ˆä¸œå…«åŒºï¼‰ç›¸åŒï¼Œä½†æ˜¯ç”±äºæœåŠ¡å™¨çš„é…ç½®å¹¶æ²¡æœ‰ä»£ç è¯ï¼Œæˆ‘æ²¡æœ‰é‡‡ç”¨ä¿®æ”¹æœåŠ¡å™¨è®¾ç½®ã€‚ç†æƒ³æƒ…å†µæ˜¯ä¸€åˆ‡åŸºç¡€è®¾æ–½ä¹Ÿä»£ç åŒ–ï¼Œå°†ä¸€åˆ‡ç³»ç»ŸçŸ¥è¯†é‡‡ç”¨æ–‡æœ¬è®°å½•å¹¶ç”± git è·Ÿè¸ªã€‚</p>\n<p>ç”±äºç°åœ¨å¢åŠ æ—¶åŒºä¿¡æ¯è®©å‰ç«¯ä¼ é€’ä¸å¤ªåˆé€‚ï¼ˆè€Œä¸”åæœŸå¦‚æœæ”¹æˆæ—¥æœŸæ—¶é—´æ ¼å¼ï¼Œå¹¶ä¸éœ€è¦å‰ç«¯å•ç‹¬ä¼ é€’æ—¶åŒºä¿¡æ¯ï¼‰ï¼Œä»¥åŠè€ƒè™‘åˆ°äº§å“åªé¢å‘ä¸­å›½ç”¨æˆ·ï¼Œå› æ­¤æš‚æ—¶åœ¨ä»£ç ä¸­å°†æ—¶åŒºä»é»˜è®¤æ”¹æˆäº†ä¸œå…«åŒº, ä¸è¿‡ï¼Œä»»ä½•ä»£ç çš„æ”¹åŠ¨ï¼Œéƒ½æ·»åŠ äº†æµ‹è¯•ä»£ç ï¼Œä»¥ä¿è¯é‡æ„çš„å®‰å…¨ã€‚\ndiff</p>\n<ul>\n<li>\n<pre><code>       LocalDate eventStartDate = eventStartTime == null ? null : Instant.ofEpochSecond(eventStartTime).atZone(ZoneId.systemDefault()).toLocalDate();\n</code></pre>\n</li>\n<li>\n<pre><code>       LocalDate eventEndDate = eventEndTime == null ? null : Instant.ofEpochSecond(eventEndTime).atZone(ZoneId.systemDefault()).toLocalDate();\n</code></pre>\n</li>\n</ul>\n<ul>\n<li>\n<pre><code>       LocalDate eventStartDate = eventStartTime == null ? null : Instant.ofEpochSecond(eventStartTime).atZone(ZoneId.of(Asia/Shanghai)).toLocalDate();\n</code></pre>\n</li>\n<li>\n<pre><code>       LocalDate eventEndDate = eventEndTime == null ? null : Instant.ofEpochSecond(eventEndTime).atZone(ZoneId.of(Asia/Shanghai)).toLocalDate();\n  \t\t\t\tif (eventEndDate != null &#x26;&#x26; eventStartDate != null &#x26;&#x26; !eventStartDate.equals(eventEndDate)) {\n          return åœºæ¬¡å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´éœ€è¦åœ¨åŒä¸€å¤©ï¼;\n      }\n</code></pre>\n</li>\n</ul>\n<p>java\nimport org.junit.jupiter.api.BeforeAll;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;</p>\n<p>import java.time.ZoneId;\nimport java.util.TimeZone;</p>\n<p>import static org.assertj.core.api.Assertions.assertThat;\nimport static org.junit.jupiter.api.Assertions.*;</p>\n<p>class CampaignEventValidationUseCaseImplTest {\nprivate CampaignEventValidationUseCaseImpl sut;</p>\n<pre><code>@BeforeEach\nvoid setUp() {\n    sut = new CampaignEventValidationUseCaseImpl();\n}\n\n/**\n * BUGï¼šå¼€å§‹æ—¶é—´é€‰æ‹© 2021-05-20 00:05ï¼Œç»“æŸæ—¶é—´é€‰æ‹© 2021-05-20 23:55ï¼Œæ ¡éªŒæŠ¥é”™è¯´ï¼šåœºæ¬¡å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´éœ€è¦åœ¨åŒä¸€å¤©\n */\n@Test\nvoid validateåœºæ¬¡å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´éœ€è¦åœ¨åŒä¸€å¤©() {\n    TimeZone.setDefault(TimeZone.getTimeZone(Europe/Kiev)); // æ¨¡æ‹ŸæœåŠ¡å™¨æ—¶åŒºæ²¡æœ‰è®¾ç½®åœ¨ä¸œå…«åŒº\n    \n    sut = new CampaignEventValidationUseCaseImpl();\n\n    EventTime4Check event = new EventTime4Check();\n    event.setEventEndTime(1621526100L);\n    event.setEventStartTime(1621440300L);\n\n    CampaignDto campaignDto = new CampaignDto();\n    campaignDto.setCampaignId(12345);\n    campaignDto.setStartTime(1621483200L);\n    campaignDto.setEndTime(1622188000L);\n\n    assertNotNull(sut);\n\n    assertThat(sut.validate(event, campaignDto)).isNotEqualTo(åœºæ¬¡å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´éœ€è¦åœ¨åŒä¸€å¤©ï¼);\n}\n</code></pre>\n<p>}</p>\n<p><a name=kEl0O></a></p>\n<h2></h2>\n<p><a name=Ieq6s></a></p>\n<h2>é•¿ç¯‡æ²¡æœ‰æµ‹è¯•åˆæ»¡æ˜¯ BUG çš„å‡½æ•°</h2>\n<p>è¿™ä¸ªå·¥ç¨‹é‡Œå……æ–¥ç€é•¿ç¯‡å‡½æ•°ï¼ŒçŠ¶æ€å˜é‡ç‰¹åˆ«å¤šï¼Œè€Œä¸”å¾€å¾€åœ¨å‡½æ•°å¼€å¤´å°±å®šä¹‰ä¸€å †ã€‚å¦‚å‰æ‰€è¿°ï¼Œæœ‰æ²¡æœ‰æµ‹è¯•ï¼Œè€Œä¸”å®é™…è”è°ƒä¸‹æ¥åˆæœ‰ BUGã€‚</p>\n<p><a name=uHKmB></a></p>\n<h3>éƒ¨åˆ†é‡å»ºæ–¹æ¡ˆ</h3>\n<p><a name=XimNW></a></p>\n<h4>å†…è”åªè¢«ç”¨åˆ°ä¸€æ¬¡çš„å˜é‡ï¼Œå¯¹äºè¢«å¼•ç”¨å¤šæ¬¡çš„å˜é‡ï¼Œå°†å…¶å®šä¹‰æŒªåˆ°ç¬¬ä¸€æ¬¡å¼•ç”¨ä¹‹å‰ï¼›</h4>\n<p><a name=Rdb5U></a></p>\n<h4>å¯¹äºå·²çŸ¥æœ‰ BUG çš„åˆ†æ”¯ï¼Œä½¿ç”¨æå‰é€€å‡ºï¼Œå¹¶åœ¨å•ç‹¬çš„å°å‡½æ•°ä¸­è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•å¹¶ä¿®å¤ï¼š</h4>\n<p>java\n@Override\npublic Boolean queryCampaignHasReservableEvent(String campaignId, CampaignType campaignType) throws Exception {\n// æ–°å¢ä»£ç \nif (campaignType == CampaignType.CAMPAIGN) {\n// è”è°ƒå‘ç°è¿™ä¸ªåˆ†æ”¯æœ‰ BUGï¼Œæå‰è¿”å›æ–°çš„å‡½æ•°ï¼Œå¹¶å¯¹å…¶è¿›è¡Œå……åˆ†çš„è‡ªåŠ¨åŒ–æµ‹è¯•\nreturn queryCampaignHasReservableEventForCampaign(campaignId);\n}</p>\n<pre><code>    // åŸæœ‰ä»£ç \n    EventQueryCondition queryCondition = new EventQueryCondition();\n    queryCondition.setCampaignId(campaignId);\n    // æ­¤å¤„çœç•¥åŸæœ‰çš„å‡ åè¡Œæ¼æ´ä»£ç \n    ...\n    PageInfo&#x3C;EventDto> pageInfo = getOnlyEvents(queryCondition);\n    return pageInfo.getTotal() != 0;\n}\n</code></pre>\n<p><a name=hnyrc></a></p>\n<h2>å…¶ä»–é‡å¤ä»£ç ç­‰ç­‰é—®é¢˜</h2>\n<p>é¡¹ç›®ä¸­å±…ç„¶æœ‰å¾ˆå¤šæ•´æ®µæ•´æ®µçš„ä»£ç é‡å¤ï¼Œä»¥åŠæ ¼å¼ä¸è§„æ•´çš„é—®é¢˜ï¼Œè¿™äº›é—®é¢˜éƒ½å¯ä»¥è¢«è‡ªåŠ¨æ‰«æå‡ºæ¥ï¼Œäºæ˜¯æ­å»ºä¸€ä¸ª SonarQubeï¼Œä»¥æ–¹ä¾¿å¿«é€Ÿå®šä½è¿™äº›é—®é¢˜ï¼ˆæ‰«æç»“æœä¸å ªå…¥ç›®ğŸ™ˆï¼Œè¿™è¿˜åªæ˜¯æ–°å»ºæ²¡å¤šä¹…çš„é¡¹ç›®å•Šâ€¦â€¦ï¼‰ï¼š<br /><img src=\"https://cdn.nlark.com/yuque/0/2021/png/221736/1622464119723-b9350125-e10e-4be6-b175-4033e9f59c1f.png#clientId=u8d50202b-7c2c-4&#x26;from=paste&#x26;height=1117&#x26;id=udc24a279&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=1117&#x26;originWidth=1293&#x26;originalType=binary&#x26;size=137528&#x26;status=done&#x26;style=none&#x26;taskId=u4105fe18-ae93-4986-9f43-285055e99c7&#x26;width=1293\" alt=\"image.png\"><br /><img src=\"https://cdn.nlark.com/yuque/0/2021/png/221736/1622464170293-832de223-f13d-451a-84d1-b621b8d737e3.png#clientId=u8d50202b-7c2c-4&#x26;from=paste&#x26;height=664&#x26;id=u2f803133&#x26;margin=%5Bobject%20Object%5D&#x26;name=image.png&#x26;originHeight=664&#x26;originWidth=846&#x26;originalType=binary&#x26;size=40661&#x26;status=done&#x26;style=none&#x26;taskId=ub7769d2e-84a5-4c6d-9fc4-c7ddf4abf39&#x26;width=846\" alt=\"image.png\"></p>\n<p>å¯ä»¥çœ‹å‡ºï¼Œé‡å»ºå¾ˆè‰°éš¾ï¼Œä¹Ÿæ˜¯ä¸ªé•¿æœŸå·¥ç¨‹ï¼Œä»Šå¤©å°±è®°å½•åˆ°è¿™é‡Œã€‚</p>","pages":[],"site":{"siteMetadata":{"title":"Jeff Tian","description":"Full Stack Developer, good at OAuth 2.0","palette":"yellow","header":{"title":"Jeff Tian","tagline":"A wild developer","logo_img":"https://images.ctfassets.net/qixg1o8tujmf/7z1ua3nTOC5B7DwwzAki8I/4e1a05f8db770c285a492eeb1eaa398f/imageedit_3_2509022194.png","background_img":"https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg","has_nav":true,"nav_links":[{"label":"Home","url":"/","style":"link","type":"action"},{"label":"About","url":"/about","style":"link","type":"action"},{"label":"å…³äº","url":"https://ggyy.pa-pa.me/about","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"},{"label":"Contact","url":"/contact","style":"link","type":"action"},{"label":"Support Me","url":"/support-me","style":"link","type":"action"},{"label":"å½å½æ­ªæ­ª","url":"https://ggyy.pa-pa.me/","style":"link","icon_class":"lorem-ipsum","new_window":true,"type":"action"}],"has_social":true,"social_links":[{"label":"Twitter","url":"https://twitter.com/zizhujy","style":"icon","icon_class":"fa-twitter","new_window":true,"type":"action"},{"label":"Instagram","url":"https://www.instagram.com/jefftian5","style":"icon","icon_class":"fa-instagram","new_window":true,"type":"action"},{"label":"GitHub","url":"https://github.com/jeff-tian","style":"icon","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"LinkedIn","url":"https://www.linkedin.com/jeff~tian","style":"icon","icon_class":"fa-linkedin","new_window":true,"type":"action"},{"label":"DEV","url":"https://dev.to/jefftian","style":"icon","icon_class":"fa-dev","new_window":true,"type":"action"},{"label":"çŸ¥ä¹","url":"https://www.zhihu.com/people/jefftian","style":"icon","icon_class":"fa-zhihu","new_window":true,"type":"action"}],"type":"header"},"footer":{"content":"&copy; All rights reserved.","links":[{"label":"æœ¬ç«™æºç ","url":"https://github.com/Jeff-Tian/space","style":"link","icon_class":"fa-github","new_window":true,"type":"action"},{"label":"ç´«ç«¹å½æ­ª","url":"https://zizhujy.apphb.com","style":"link","icon_class":"http://zizhujy.apphb.com/Content/Images/logo.png","new_window":true,"type":"action"}],"type":"footer"}},"pathPrefix":"","data":{"data":{"author":{"name":"Jeff Tian","avatar":"https://res.cloudinary.com/practicaldev/image/fetch/s--a5qDZLv3--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/318420/3bfd2d99-430c-4049-8dd5-e2adc961e1e0.png"},"social":{"devto":{"username":"jefftian"},"twitter":{"username":"zizhujy"},"github":{"username":"Jeff-Tian"}}}}},"menus":{}}},"staticQueryHashes":[]}